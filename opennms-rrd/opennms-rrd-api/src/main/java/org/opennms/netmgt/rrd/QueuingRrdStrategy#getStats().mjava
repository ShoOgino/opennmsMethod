    /**
     * Print queue statistics.
     */
    public String getStats() {
        long now = System.currentTimeMillis();

        long currentElapsedMillis = Math.max(now - lastStatsTime, 1);
        long totalElapsedMillis = Math.max(now - updateStart, 1);

        long currentEnqueuedOps = (enqueuedOperations - lastEnqueued);
        long currentDequeuedOps = (dequeuedOperations - lastDequeued);
        long currentDequeuedItems = (dequeuedItems - lastDequeuedItems);

        long currentSigOpsEnqueued = (significantOpsEnqueued - lastSignificantEnqueued);
        long currentSigOpsDequeued = (significantOpsDequeued - lastSignificantDequeued);
        //long currentSigOpsCompleted = (significantOpsCompleted - lastSignificantCompleted);

        long currentEnqueueRate = (long) (currentEnqueuedOps * 1000.0 / currentElapsedMillis);
        long currentSigEnqueueRate = (long) (currentSigOpsEnqueued * 1000.0 / currentElapsedMillis);
        long currentInsigEnqueueRate = (long) ((currentEnqueuedOps - currentSigOpsEnqueued) * 1000.0 / currentElapsedMillis);
        long overallEnqueueRate = (long) (enqueuedOperations * 1000.0 / totalElapsedMillis);
        long overallSigEnqueueRate = (long) (significantOpsEnqueued * 1000.0 / totalElapsedMillis);
        long overallInsigEnqueueRate = (long) ((enqueuedOperations - significantOpsEnqueued) * 1000.0 / totalElapsedMillis);

        long currentDequeueRate = (long) (currentDequeuedOps * 1000.0 / currentElapsedMillis);
        long currentSigDequeueRate = (long) (currentSigOpsDequeued * 1000.0 / currentElapsedMillis);
        long currentInsigDequeueRate = (long) ((currentDequeuedOps - currentSigOpsDequeued) * 1000.0 / currentElapsedMillis);
        long overallDequeueRate = (long) (dequeuedOperations * 1000.0 / totalElapsedMillis);
        long overallSigDequeueRate = (long) (significantOpsDequeued * 1000.0 / totalElapsedMillis);
        long overallInsigDequeueRate = (long) ((dequeuedOperations - significantOpsDequeued) * 1000.0 / totalElapsedMillis);

        long currentItemDequeueRate = (long) (currentDequeuedItems * 1000.0 / currentElapsedMillis);
        long overallItemDequeueRate = (long) (dequeuedItems * 1000.0 / totalElapsedMillis);

        String stats = "\nQS:\t" + "totalOperationsPending=" + totalOperationsPending + ", significantOpsPending=" + (significantOpsEnqueued - significantOpsCompleted) + ", filesWithSignificantWork=" + filesWithSignificantWork.size() + ", filesWithInsignificantWork=" + filesWithInsignificantWork.size()

        + "\nQS:\t" + ", createsCompleted=" + createsCompleted + ", updatesCompleted=" + updatesCompleted + ", errors=" + errors + ", promotionRate=" + ((double) (promotionCount * 1000.0 / totalElapsedMillis)) + ", promotionCount=" + promotionCount

        + "\nQS:\t" + ", currentEnqueueRates=(" + currentSigEnqueueRate + "/" + currentInsigEnqueueRate + "/" + currentEnqueueRate + ")" + ", currentDequeueRate=(" + currentSigDequeueRate + "/" + currentInsigDequeueRate + "/" + currentDequeueRate + ")" + ", currentItemDequeRate=" + currentItemDequeueRate + ", currentOpsPerUpdate=" + (currentDequeuedOps / Math.max(currentDequeuedItems, 1.0)) + ", currentPrcntSignificant=" + (currentSigOpsEnqueued * 100.0 / Math.max(currentEnqueuedOps, 1.0)) + "%" + ", elapsedTime=" + ((currentElapsedMillis + 500) / 1000)

        + "\nQS:\t" + ", overallEnqueueRate=(" + overallSigEnqueueRate + "/" + overallInsigEnqueueRate + "/" + overallEnqueueRate + ")" + ", overallDequeueRate=(" + overallSigDequeueRate + "/" + overallInsigDequeueRate + "/" + overallDequeueRate + ")" + ", overallItemDequeRate=" + overallItemDequeueRate + ", overallOpsPerUpdate=" + (dequeuedOperations / Math.max(dequeuedItems, 1.0)) + ", overallPrcntSignificant=" + (significantOpsEnqueued * 100.0 / Math.max(enqueuedOperations, 1.0)) + "%" + ", totalElapsedTime=" + ((totalElapsedMillis + 500) / 1000);

        lastStatsTime = now;
        lastEnqueued = enqueuedOperations;
        lastDequeued = dequeuedOperations;
        lastDequeuedItems = dequeuedItems;
        lastSignificantEnqueued = significantOpsEnqueued;
        lastSignificantDequeued = significantOpsDequeued;
        lastSignificantCompleted = significantOpsCompleted;
        lastOpsPending = totalOperationsPending;

        return stats;
    }


    /**
     * Executes the given graph command as process with workDir as the current
     * directory. The output stream of the command (a PNG image) is copied to a
     * the InputStream returned from the method.
     */
    public InputStream createGraph(String command, File workDir) throws IOException, RrdException {
        InputStream tempIn;
        String[] commandArray = StringUtils.createCommandArray(command, '@');
        Process process;
        try {
             process = Runtime.getRuntime().exec(commandArray, null, workDir);
        } catch (IOException e) {
            IOException newE = new IOException("IOException thrown while executing command '" + command + "' in " + workDir.getAbsolutePath() + ": " + e);
            newE.initCause(e);
            throw newE;
        }

        ByteArrayOutputStream tempOut = new ByteArrayOutputStream();
        BufferedInputStream in = new BufferedInputStream(process.getInputStream());

        StreamUtils.streamToStream(in, tempOut);

        in.close();
        tempOut.close();

        BufferedReader err = new BufferedReader(new InputStreamReader(process.getErrorStream()));
        String line = err.readLine();
        StringBuffer buffer = new StringBuffer();

        while (line != null) {
            buffer.append(line);
            line = err.readLine();
        }

        if (buffer.length() > 0) {
            throw new RrdException(buffer.toString());
        }

        byte[] byteArray = tempOut.toByteArray();
        tempIn = new ByteArrayInputStream(byteArray);
        return tempIn;
    }


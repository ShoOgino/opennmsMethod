    @Test
    public void testDeleteUser() throws Exception {
        createUser("deleteMe");

        String xml = sendRequest(GET, "/users", 200);
        assertTrue(xml.contains("deleteMe"));

        sendRequest(DELETE, "/users/idontexist", 400);

        setUser("doesntHavePermissions", new String[] { "ROLE_USER" });
        sendRequest(DELETE, "/users/deleteMe", 400);

        setUser("admin", new String[] { "ROLE_ADMIN" });
        sendRequest(DELETE, "/users/deleteMe", 200);

        sendRequest(GET, "/users/deleteMe", 404);
    }


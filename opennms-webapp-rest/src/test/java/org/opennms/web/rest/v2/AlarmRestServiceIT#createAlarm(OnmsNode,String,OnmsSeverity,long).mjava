    @SuppressWarnings("deprecation")
    private OnmsAlarm createAlarm(final OnmsNode node, final String eventUei, final OnmsSeverity severity, final long epoch) {
        final OnmsIpInterface alarmNode = node.getIpInterfaces().iterator().next();

        final OnmsEvent event = new OnmsEvent();
        event.setDistPoller(m_databasePopulator.getDistPollerDao().whoami());
        event.setEventCreateTime(new Date(epoch));
        event.setEventDisplay("Y");
        event.setEventHost("127.0.0.1");
        event.setEventLog("Y");
        event.setEventSeverity(OnmsSeverity.INDETERMINATE.getId());
        event.setEventSource("JUnit");
        event.setEventTime(new Date(epoch));
        event.setEventUei(eventUei);
        if (ALARM_COUNTER.getAndIncrement() % 2 == 0) {
            event.addEventParameter(new OnmsEventParameter(event, "testParm1", "This is an awesome parm!", "string"));
        } else {
            event.addEventParameter(new OnmsEventParameter(event, "testParm2", "This is a weird parm", "string"));
        }
        event.addEventParameter(new OnmsEventParameter(event, "testParm3", "Here's another parm", "string"));
        event.setIpAddr(alarmNode.getIpAddress());
        event.setNode(node);
        event.setServiceType(m_databasePopulator.getServiceTypeDao().findByName(ICMP_SERVICE));
        event.setEventSeverity(severity.getId());
        event.setIfIndex(alarmNode.getIfIndex());
        m_databasePopulator.getEventDao().save(event);
        m_databasePopulator.getEventDao().flush();

        final OnmsAlarm alarm = new OnmsAlarm();
        alarm.setDistPoller(m_databasePopulator.getDistPollerDao().whoami());
        alarm.setUei(event.getEventUei());
        alarm.setAlarmType(OnmsAlarm.PROBLEM_TYPE);
        alarm.setNode(node);
        alarm.setDescription("This is a test alarm");
        alarm.setLogMsg("this is a test alarm log message");
        alarm.setCounter(1);
        alarm.setIpAddr(alarmNode.getIpAddress());
        alarm.setSeverity(severity);
        alarm.setFirstEventTime(event.getEventTime());
        alarm.setLastEventTime(event.getEventTime());
        alarm.setLastEvent(event);
        alarm.setServiceType(m_databasePopulator.getServiceTypeDao().findByName(ICMP_SERVICE));
        alarm.setReductionKey(getReductionKey(eventUei, node, alarmNode.getIpAddressAsString(), ICMP_SERVICE));
        alarm.setIfIndex(alarmNode.getIfIndex());
        m_databasePopulator.getAlarmDao().save(alarm);
        m_databasePopulator.getAlarmDao().flush();
        return alarm;
    }


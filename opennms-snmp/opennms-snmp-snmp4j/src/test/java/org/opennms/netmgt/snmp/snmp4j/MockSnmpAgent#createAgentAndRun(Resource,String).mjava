	public static MockSnmpAgent createAgentAndRun(Resource moFile, String bindAddress) throws InterruptedException {
        try {
            Assert.assertNotNull("could not get InputStream mock object resource; does it exist?  Resource: " + moFile, moFile.getInputStream());
        } catch (IOException e) {
            AssertUtils.fail("Got IOException while checking for existence of mock object file: " + e, e);
        }
		MockSnmpAgent agent = new MockSnmpAgent(new File("/dev/null"), new File("/dev/null"), moFile, bindAddress);
		Thread thread = new Thread(agent);
		thread.start();

		try {
			while (!agent.isRunning() && thread.isAlive()) {
				Thread.sleep(100);
			} 
		} catch (InterruptedException e) {
			agent.shutDownAndWait();
			throw e;
		}
		
		if (!thread.isAlive()) {
			agent.m_running = false;
			agent.m_stopped = true;
			throw new IllegalStateException("agent failed to start--check logs");
		}
		
		return agent;
	}


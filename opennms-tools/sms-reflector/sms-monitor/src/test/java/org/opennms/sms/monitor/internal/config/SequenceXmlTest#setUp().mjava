    @Before
    public void setUp() throws Exception {
    	m_fileAnticipator = new FileAnticipator();

    	MobileSequenceConfigBuilder bldr = new MobileSequenceConfigBuilder();
    	
    	bldr.variable("amount", UniqueNumber.class).parameter("min", 1).parameter("max", 15);
    	
    	bldr.ussdRequest("req-balance-transfer", "ACM0", "*327*${recipient}*${amount}#").withTransactionLabel("ussd-transfer").withGatewayId("ACM0")
    	    .expectUssdResponse("balance-conf-resp")
    	    .onGateway("ACM0")
    	    .withSessionStatus(USSDSessionStatus.FURTHER_ACTION_REQUIRED)
    	    .matching("^Transfiere L ${amount} al ${recipient}$");
    	

    	MobileSequenceTransactionBuilder transBldr = bldr.ussdRequest("conf-transfer", "ACM0", "1");

    	transBldr.withTransactionLabel("req-conf").withGatewayId("ACM0")
    	    .expectUssdResponse("processing")
    	    .onGateway("ACM0")
    	    .withSessionStatus(USSDSessionStatus.NO_FURTHER_ACTION_REQUIRED)
    	    .matching("^.*Su transaccion se esta procesando.*$");
    	
    	transBldr.expectSmsResponse("transferred")
    	    .onGateway("ACM0")
    	    .matching("^.*le ha transferido L ${amount}.*$")
    	    .srcMatches("+3746");
    	
    	m_smsSequence = bldr.getSequence();

    	m_context = JAXBContext.newInstance(
    			MobileSequenceConfig.class,
    			SmsSequenceRequest.class,
    			UssdSequenceRequest.class,
    			SmsSequenceResponse.class,
    			UssdSequenceResponse.class,
    			SmsFromRecipientResponseMatcher.class,
    			SmsSourceMatcher.class,
    			TextResponseMatcher.class,
    			UssdSessionStatusMatcher.class
    			);

    	m_marshaller = m_context.createMarshaller();
    	m_marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
        m_marshaller.setProperty("com.sun.xml.bind.namespacePrefixMapper", new MobileSequenceNamespacePrefixMapper());

    	m_unmarshaller = m_context.createUnmarshaller();
    	m_unmarshaller.setSchema(null);

    	XMLUnit.setIgnoreComments(true);
        XMLUnit.setIgnoreWhitespace(true);
        XMLUnit.setIgnoreAttributeOrder(true);
        XMLUnit.setNormalize(true);
    }


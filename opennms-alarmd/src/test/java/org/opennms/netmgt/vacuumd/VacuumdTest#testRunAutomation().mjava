    /**
     * This tests the running of automations directly as if they were scheduled.
     * @throws SQLException
     * @throws InterruptedException 
     */
    @Test
    public final void testRunAutomation() throws SQLException, InterruptedException {
        final int major = OnmsSeverity.MAJOR.getId();
        
        bringNodeDownCreatingEvent(1);
        Thread.sleep(1000);
        
        assertEquals(1, countAlarms());
        assertEquals(major, getSingleResultSeverity());
        assertEquals("counter in the alarm", 1, m_jdbcTemplate.queryForInt("select counter from alarms"));

        bringNodeDownCreatingEvent(1);
        Thread.sleep(1000);

        assertEquals(1, countAlarms());
        assertEquals(major, getSingleResultSeverity());
        assertEquals("counter in the alarm", 2, m_jdbcTemplate.queryForInt("select counter from alarms"));

        AutomationProcessor ap = new AutomationProcessor(VacuumdConfigFactory.getInstance().getAutomation("autoEscalate"));
        assertTrue(ap.runAutomation());
        Thread.sleep(1000);
        assertEquals(major+1, getSingleResultSeverity());
    }


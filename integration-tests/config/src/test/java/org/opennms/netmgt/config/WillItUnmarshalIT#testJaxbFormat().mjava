    @Test
    public void testJaxbFormat() {
        if (!checkFormat) {
            return;
        }
        final Resource resource = this.createResource();
        assertNotNull("Resource must not be null", resource);
        try {
            String onDisk = readResource(resource);
            Object result = JaxbUtils.unmarshal(this.clazz, resource);
            final Pattern p = COMMENT_START_PATTERN;
            final Matcher m = p.matcher(onDisk);
            onDisk = m.replaceAll("<!--");
            final String marshalled = JaxbUtils.marshal(result);
            final List<Difference> diffs = XmlTest.getDifferencesSimple(onDisk, marshalled);
            if (diffs.size() != 0) {
                System.err.println("----------------------------------------------------------------------");
                System.err.println(resource.getFilename() + " on disk:");
                System.err.println(onDisk);
                System.err.println(resource.getFilename() + " marshalled:");
                System.err.println(marshalled);
                throw new AssertionFailedError(resource.getFilename() + ": " + diffs);
            }
        } catch (final Exception e) {
            throw new RuntimeException(e);
        }
    }


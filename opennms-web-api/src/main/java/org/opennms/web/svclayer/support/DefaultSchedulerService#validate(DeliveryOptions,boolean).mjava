    private void validate(DeliveryOptions deliveryOptions, boolean update) {
        Objects.requireNonNull(deliveryOptions);

        try {
            if (!update) { // We skip the instanceId check if we update
                final Set<String> intanceIds = m_scheduler.getTriggerKeys(GroupMatcher.groupEquals(m_triggerGroup)).stream()
                        .map(tk -> tk.getName())
                        .collect(Collectors.toSet());
                if (intanceIds.contains(deliveryOptions.getInstanceId())) {
                    throw new SchedulerContextException("instanceId", "The provided value already exists");
                }
                if (Strings.isNullOrEmpty(deliveryOptions.getInstanceId())) {
                    throw new SchedulerContextException("instanceId", PROVIDE_A_VALUE_TEXT);
                }
            }

            if (!deliveryOptions.isSendMail() && !deliveryOptions.isPersist() && !deliveryOptions.isWebhook()) {
                throw new SchedulerContextException("sendMail_persist_webhook", "Either sendMail, webhook or persist must be set");
            }
            if (deliveryOptions.getFormat() == null) {
                throw new SchedulerContextException("format", PROVIDE_A_VALUE_TEXT);
            }
            if (deliveryOptions.isSendMail()) {
                if (Strings.isNullOrEmpty(deliveryOptions.getMailTo())) {
                    throw new SchedulerContextException("mailTo", PROVIDE_A_VALUE_TEXT);
                }
                // Try parsing the input
                try {
                    InternetAddress.parse(deliveryOptions.getMailTo(), false);
                } catch (AddressException e) {
                    throw new SchedulerContextException("mailTo", "Provided recipients could not be parsed: {0}", e.getMessage(), e);
                }
            }
            if (deliveryOptions.isWebhook()) {
                if (Strings.isNullOrEmpty(deliveryOptions.getWebhookUrl())) {
                    throw new SchedulerContextException("webhookUrl", PROVIDE_A_VALUE_TEXT);
                }
                try {
                    new URL(deliveryOptions.getWebhookUrl());
                } catch (MalformedURLException ex) {
                    throw new SchedulerContextException("webhookUrl", "The provided URL ''{0}'' is not valid: ''{1}''", deliveryOptions.getWebhookUrl(), ex.getMessage());
                }
            }
        } catch (SchedulerException e) {
            throw new org.opennms.web.svclayer.support.SchedulerException(e);
        }
    }


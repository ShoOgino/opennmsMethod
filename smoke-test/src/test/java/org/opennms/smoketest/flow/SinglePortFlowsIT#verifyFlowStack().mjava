    // Verifies that when OpenNMS and ElasticSearch is running and configured, that sending a flow packet
    // will actually be persisted in elastic
    @Test
    public void verifyFlowStack() throws Exception {
        final InetSocketAddress opennmsSinglePortAddress = testEnvironment.getServiceAddress(ContainerAlias.OPENNMS, 50000, "udp");
        final InetSocketAddress opennmsWebAddress = testEnvironment.getServiceAddress(ContainerAlias.OPENNMS, 8980);
        final InetSocketAddress elasticRestAddress = testEnvironment.getServiceAddress(NewTestEnvironment.ContainerAlias.ELASTICSEARCH_5, 9200, "tcp");

        final List<FlowPacket> collect = Packets.getFlowPackets().stream()
                .map(p -> new FlowPacket(p.getResource(), p.getFlowCount(), opennmsSinglePortAddress))
                .collect(Collectors.toList());
        final FlowTester tester = new FlowTestBuilder()
                .withFlowPackets(collect)
                .verifyOpennmsRestEndpoint(opennmsWebAddress)
                .build(elasticRestAddress);
        tester.verifyFlows();
    }


    // Configures the elastic bundle and also installs the flows feature to expose a NetflowRepository.
    // This is required, otherwise persisting does not work, as no FlowRepository implementation exists.
    private void setupOnmsContainer(InetSocketAddress opennmsSshAddress) throws Exception {
        try (final SshClient sshClient = new SshClient(opennmsSshAddress, "admin", "admin")) {
            PrintStream pipe = sshClient.openShell();

            // Update feature configuration to point url to elastic container
            pipe.println("config:edit org.opennms.features.flows.persistence.elastic");
            pipe.println("config:property-set elasticUrl http://elasticsearch:9200");
            pipe.println("config:update");

            // Install feature
            pipe.println("feature:install flows");
            pipe.println("feature:list | grep -i flows");
            pipe.println("log:set INFO");
            pipe.println("logout");

            try {
                await().atMost(2, MINUTES).until(sshClient.isShellClosedCallable());
            } finally {
                LOG.info("Karaf output:\n{}", sshClient.getStdout());
            }
        }
    }


    @Test
    public void testSeverityChange() throws Exception {
        final RestClient restClient = stack.opennms().getRestClient();
        restClient.sendEvent(getServiceProblemEvent(42, "Warning"));

        final AlarmDao alarmDao = stack.postgres().getDaoFactory().getDao(AlarmDaoHibernate.class);

        final OnmsAlarm onmsAlarm1 = await().atMost(2, MINUTES).pollInterval(10, SECONDS)
                .until(DaoUtils.findMatchingCallable(alarmDao, new CriteriaBuilder(OnmsAlarm.class)
                        .eq("uei", "uei.opennms.org/bsm/serviceProblem")
                        .toCriteria()), notNullValue());

        assertEquals(1L, (long) onmsAlarm1.getCounter());
        assertEquals(OnmsSeverity.WARNING, onmsAlarm1.getSeverity());

        restClient.sendEvent(getServiceProblemEvent(42, "Minor"));

        final OnmsAlarm onmsAlarm2 = await().atMost(2, MINUTES).pollInterval(10, SECONDS)
                .until(DaoUtils.findMatchingCallable(alarmDao, new CriteriaBuilder(OnmsAlarm.class)
                        .eq("uei", "uei.opennms.org/bsm/serviceProblem")
                        .toCriteria()), notNullValue());

        assertEquals(2L, (long) onmsAlarm2.getCounter());
        assertEquals(OnmsSeverity.MINOR, onmsAlarm2.getSeverity());
    }


    private static void createElasticsearchIndex(InetSocketAddress esTransportAddr, Date date) {
        Settings settings = ImmutableSettings.settingsBuilder()
            .put("cluster.name", "opennms").build();
        TransportClient esClient = new TransportClient(settings).addTransportAddress(new InetSocketTransportAddress(esTransportAddr));

        String indexName = new IndexNameFunction().apply("opennms", date);

        try {
            // Delete the index if it already exists
            boolean indexExists = esClient.admin().indices().prepareExists(indexName).execute().actionGet().isExists();
            if (indexExists) {
                esClient.admin().indices().prepareDelete(indexName).execute().actionGet();
            }
            esClient.admin().indices().prepareCreate(indexName).execute().actionGet();
        } catch (Throwable e) {
            LOG.warn("Error while trying to create index: " + indexName, e);
        } finally {
            esClient.close();
        }

        LOG.info("Finished creating index {}", new IndexNameFunction().apply("opennms", date));

        // Sleep to ensure that the index is fully operational
        try { Thread.sleep(1000); } catch (InterruptedException e) {}
    }


    protected static void installFeaturesOnOpenNMS(InetSocketAddress opennmsSshAddr, InetSocketAddress kafkaAddress, InetSocketAddress zookeeperAddress) throws Exception {
        try (final SshClient sshClient = new SshClient(opennmsSshAddr, "admin", "admin")) {
            PrintStream pipe = sshClient.openShell();

            // Configure and install the Elasticsearch REST event forwarder
            pipe.println("config:edit org.opennms.plugin.elasticsearch.rest.forwarder");
            pipe.println("config:propset logAllEvents true");
            pipe.println("config:propset batchSize 500");
            pipe.println("config:propset batchInterval 500");
            pipe.println("config:propset timeout 5000");
            // Retry enough times that all events are eventually sent
            // even if transient ES outages occur
            pipe.println("config:propset retries 200");
            pipe.println("config:update");
            pipe.println("feature:install opennms-es-rest");

            pipe.println("feature:list -i");
            // Set the log level to INFO
            pipe.println("log:set INFO");
            pipe.println("logout");
            try {
                await().atMost(2, MINUTES).until(sshClient.isShellClosedCallable());
            } finally {
                LOG.info("Karaf output:\n{}", sshClient.getStdout());
            }
        }
    }


    @Test
    public void testCanHandleIpServicesDuringEdit() throws Exception {
        final String IP_Service_Select_XPATH = "//*[@id=\"ipServiceSelect\"]";
        final String ADD_BUTTON_XPATH = IP_Service_Select_XPATH + "/div[2]/div[1]/span/span";
        final String REMOVE_BUTTON_XPATH =  IP_Service_Select_XPATH + "/div[2]/div[3]/span/span";
        final String IP_SERVICE_1_XPATH_SELECTED = IP_Service_Select_XPATH + "/select[2]/option[1]";
        final String IP_SERVICE_1_XPATH_SELECTED_NOT = IP_Service_Select_XPATH + "/select[1]/option[1]";
        final String IP_SERVICE_2_XPATH_SELECTED = IP_Service_Select_XPATH + "/select[2]/option[2]";
        final String IP_SERVICE_2_XPATH_SELECTED_NOT = IP_Service_Select_XPATH + "/select[1]/option[2]";

        try {
            createTestSetup();

            // Create a BusinessService and open editor
            final String serviceName = createUniqueBusinessServiceName();
            createBusinessService(serviceName);
            findEditButton(serviceName).click();
            wait.until(pageContainsText("Business Service Edit"));

            // Check that the ipServices are known
            final String IP_SERVICE_1 = "NodeA//0:0:0:0:0:0:0:1/AAA";
            final String IP_SERVICE_2 = "NodeA//0:0:0:0:0:0:0:1/BBB";
            final String IP_SERVICE_3 = "NodeA//127.0.0.1/CCC";
            final String IP_SERVICE_4 = "NodeA//127.0.0.1/DDD";
            wait.until(pageContainsText(IP_SERVICE_1));
            wait.until(pageContainsText(IP_SERVICE_2));
            wait.until(pageContainsText(IP_SERVICE_3));
            wait.until(pageContainsText(IP_SERVICE_4));

            // Locate relevant components
            findElementById("ipServiceSelect");
            WebElement addButton = findElementByXpath(ADD_BUTTON_XPATH);
            findElementByXpath(REMOVE_BUTTON_XPATH);

            // Check for not selected ipServices
            findElementByXpath(IP_SERVICE_1_XPATH_SELECTED_NOT);
            findElementByXpath(IP_SERVICE_2_XPATH_SELECTED_NOT);

            // Add ipServices to selection
            addButton.click();
            addButton.click();
            addButton.click();

            // Check for selected ipServices
            findElementByXpath(IP_SERVICE_1_XPATH_SELECTED);
            findElementByXpath(IP_SERVICE_2_XPATH_SELECTED);

            // save
            findElementById("saveButton").click();

            // Open the BusinessService and check the ipServices are in place
            wait.until(pageContainsText("edit"));
            Thread.sleep(200); // wait for vaadin
            findEditButton(serviceName).click();

            // Verify that the previously added ip services are still selected
            wait.until(pageContainsText("Business Service Edit"));
            findElementByXpath(IP_SERVICE_1_XPATH_SELECTED);
            findElementByXpath(IP_SERVICE_2_XPATH_SELECTED);

            // Close dialog and delete BusinessService
            findElementById("cancelButton").click();
            findDeleteButton(serviceName).click();
            verifyElementNotPresent(By.id("deleteButton-" + serviceName));

        } finally {
            removeTestSetup();
        }
    }


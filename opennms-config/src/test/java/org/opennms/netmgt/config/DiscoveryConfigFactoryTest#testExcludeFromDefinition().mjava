    @Test
    public void testExcludeFromDefinition() {
        final DiscoveryConfiguration conf = new DiscoveryConfiguration();

        // Add definition with exclude range.
        Definition definition1 = new Definition();
        definition1.setLocation("MINION");
        IncludeRange ir = new IncludeRange();
        ir.setBegin("192.168.0.1");
        ir.setEnd("192.168.0.254");
        ExcludeRange er = new ExcludeRange();
        er.setBegin("192.168.0.100");
        er.setEnd("192.168.0.150");
        definition1.addExcludeRange(er);
        definition1.addIncludeRange(ir);

        Specific s = new Specific();
        s.setAddress("192.168.1.1");
        definition1.addSpecific(s);
        conf.addDefinition(definition1);

        //Add include ranges and exclude ranges with default location
        Definition definition2 = new Definition();
        ir = new IncludeRange();
        ir.setBegin("192.168.2.1");
        ir.setEnd("192.168.2.255");
        definition2.addIncludeRange(ir);

        s = new Specific();
        s.setAddress("192.168.4.1");
        definition2.addSpecific(s);

        er = new ExcludeRange();
        er.setBegin("192.168.2.200");
        er.setEnd("192.168.4.254");
        definition2.addExcludeRange(er);
        conf.addDefinition(definition2);

        final DiscoveryConfigFactory factory = new DiscoveryConfigFactory(conf);
        factory.initializeExcludeRanges();

        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.1"), "MINION"));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.2"), "MINION"));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.99"), "MINION"));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.0.100"), "MINION"));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.0.140"), "MINION"));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.0.150"), "MINION"));
        // Verify that default location won't exclude
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.140"), "Default"));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.150"), "Default"));

        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.0.151"), "MINION"));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.1.1"), "MINION"));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.2.1"), null));
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.2.100"), null));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.2.200"), null));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.2.220"), null));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.2.255"), null));
        assertTrue(factory.isExcluded(InetAddressUtils.addr("192.168.4.1"), null));
        // Verify that address at different location won't be excluded.
        assertFalse(factory.isExcluded(InetAddressUtils.addr("192.168.4.1"), "MINION"));


    }


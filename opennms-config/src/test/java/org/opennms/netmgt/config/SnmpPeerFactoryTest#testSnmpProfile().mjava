    public void testSnmpProfile() {
        SnmpPeerFactory.setInstance(new SnmpPeerFactory(new ByteArrayResource(getSnmpConfig().getBytes())));
        List<SnmpProfile> profiles = SnmpPeerFactory.getInstance().getProfiles();
        assertEquals(2, profiles.size());
        for(SnmpProfile snmpProfile : profiles) {
            SnmpAgentConfig snmpAgentConfig = SnmpPeerFactory.getInstance().
                    getAgentConfigFromProfile(snmpProfile, InetAddressUtils.addr("10.1.12.1"));
            assertEquals("profileContext", snmpAgentConfig.getContextName());
            // Even if read-community/write-community is not specified, should use defaults.
            assertEquals("public", snmpAgentConfig.getReadCommunity());
            assertEquals("private", snmpAgentConfig.getWriteCommunity());
            assertNull(snmpAgentConfig.getPrivProtocol());
            assertThat(snmpAgentConfig.getVersionAsString(), Matchers.isOneOf("v2c", "v3"));
        }
    }


    /** {@inheritDoc} */
    @Override
    public Map<InetAddress, Set<String>> getIPAddressServiceMap(final String rule) throws FilterParseException {
        final Map<Integer, Map<InetAddress, Set<String>>> nodeIpServices = getNodeIPAddressServiceMap(rule);

        // Flatten the map, remove the node
        final Map<InetAddress, Set<String>> ipServices = new TreeMap<>(new InetAddressComparator());
        nodeIpServices.values().forEach(ipServicesForNode -> {
            ipServicesForNode.forEach((ipAddr, services) -> {
                ipServices.computeIfAbsent(ipAddr, key -> new TreeSet<>()).addAll(services);
            });
        });

        return ipServices;
    }


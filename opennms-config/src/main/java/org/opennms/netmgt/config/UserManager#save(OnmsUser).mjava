    public void save(final OnmsUser onmsUser) throws Exception {
        update();

        m_writeLock.lock();
        
        try {
            User castorUser = _getUser(onmsUser.getUsername());
            if (castorUser == null) {
                castorUser = new User();
                castorUser.setUserId(onmsUser.getUsername());
            }
            castorUser.setFullName(onmsUser.getFullName());
            castorUser.setUserComments(onmsUser.getComments());

            // Contact info
            _setContact(castorUser, ContactType.email, onmsUser.getEmail());
            
            final Password pass = new Password();
            pass.setContent(onmsUser.getPassword());
            pass.setSalt(onmsUser.getPasswordSalted());
            castorUser.setPassword(pass);
    
            if (onmsUser.getDutySchedule() != null) {
                castorUser.setDutySchedule(new ArrayList<String>(onmsUser.getDutySchedule()));
            }
            if (onmsUser.getRoles() != null) {
                castorUser.setRole(new ArrayList<String>(onmsUser.getRoles()));
            }
            
            _writeUser(onmsUser.getUsername(), castorUser);
        } finally {
            m_writeLock.unlock();
        }
    }


    /**
     * <p>getNotifForEvent</p>
     *
     * @param event a {@link org.opennms.netmgt.xml.event.Event} object.
     * @return an array of {@link org.opennms.netmgt.config.notifications.Notification} objects.
     * @throws java.io.IOException if any.
     * @throws org.exolab.castor.xml.MarshalException if any.
     * @throws org.exolab.castor.xml.ValidationException if any.
     */
    public Notification[] getNotifForEvent(final Event event) throws IOException, MarshalException, ValidationException {
        update();
        List<Notification> notifList = new ArrayList<Notification>();
        boolean matchAll = getConfigManager().getNotificationMatch();

        // This if statement will check to see if notification should be suppressed for this event.

        if (event == null) {
            LOG.warn("unable to get notification for null event!");
            return null;
        } else if (event.getLogmsg() != null && !(event.getLogmsg().getNotify())) {

            LOG.debug("Event {} is configured to suppress notifications.", event.getUei());
            return null;
        }

        for (Notification curNotif : m_notifications.getNotificationCollection()) {

            LOG.debug("Checking {} against {}", curNotif.getUei(), event.getUei());

            if (event.getUei().equals(curNotif.getUei()) || "MATCH-ANY-UEI".equals(curNotif.getUei())) {
                // Match!
            } else if (curNotif.getUei().charAt(0) == '~') {
                if (event.getUei().matches(curNotif.getUei().substring(1))) {
                    // Match!
                } else {

                    LOG.debug("Notification regex {} failed to match event UEI: {}", event.getUei(), curNotif.getUei());
                    continue;
                }
            } else {

                LOG.debug("Event UEI {} did not match {}", curNotif.getUei(), event.getUei());
                continue;
            }

            /**
             * Check if event severity matches pattern in notification
             */

            LOG.debug("Checking event severity: {} against notification severity: {}", curNotif.getEventSeverity(), event.getSeverity());
            // parameter is optional, return true if not set
            if (curNotif.getEventSeverity() == null) {
                // Skip matching on severity
            } else if (event.getSeverity().toLowerCase().matches(curNotif.getEventSeverity().toLowerCase())) {
                // Severities match
            } else {

                LOG.debug("Event severity: {} did not match notification severity: {}", curNotif.getEventSeverity(), event.getSeverity());
                continue;
            }

            // The notice has to be "on"
            // The notice has to match a severity if configured - currHasSeverity should be true if there is no severity rule 
            // The notice has to match the UEI of the event or MATCH-ANY-UEI
            // If all those things are true:
            // Then the service has to match if configured, the interface if configured, and the node if configured.

            if (curNotif.getStatus().equals("on")) {
                if (nodeInterfaceServiceValid(curNotif, event)) {
                    boolean parmsmatched = getConfigManager().matchNotificationParameters(event, curNotif);

                    if (!parmsmatched) {

                        LOG.debug("Event {} did not match parameters for notice {}", curNotif.getName(), event.getUei());
                        continue;
                    }
                    // Add this notification to the return value
                    notifList.add(curNotif);


                    LOG.debug("Event {} matched notice {}", curNotif.getName(), event.getUei());

                    if (!matchAll)
                        break;
                } else {

                    LOG.debug("Node/interface/service combination in the event was invalid");
                }
            } else {

                LOG.debug("Current notification is turned off.");
            }
        }

        if (!notifList.isEmpty()) {
            return notifList.toArray(new Notification[0]);
        } else {
            return null;
        }
    }


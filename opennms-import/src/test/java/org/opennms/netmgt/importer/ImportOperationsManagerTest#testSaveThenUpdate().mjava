    public void testSaveThenUpdate() throws Exception {
    	
    	
        m_transTemplate.execute(new TransactionCallback() {
            public Object doInTransaction(TransactionStatus status) {
            	OnmsServiceType icmp = getServiceTypeDao().findByName("ICMP");
            	OnmsServiceType snmp = getServiceTypeDao().findByName("SNMP");
                OnmsDistPoller distPoller = getDistPollerDao().get("localhost");
                NetworkBuilder builder = new NetworkBuilder(distPoller);
                builder.addNode("node7").setForeignSource("imported:").setForeignId("7");
                builder.getCurrentNode().getAssetRecord().setDisplayCategory("cat7");
                builder.addInterface("192.168.7.1").setIsManaged("M").setIsSnmpPrimary("P");
                builder.addService(icmp);
                builder.addService(snmp);
                getNodeDao().save(builder.getCurrentNode());
                return builder.getCurrentNode();
            }
        });
        
        //getDistPollerDao().clear();

        m_transTemplate.execute(new TransactionCallback() {
            public Object doInTransaction(TransactionStatus status) {
                OnmsNode node = getNodeDao().findByForeignId("imported:", "7");
            	assertNotNull(node);
            	assertEquals("node7", node.getLabel());
            	assertEquals("cat7", node.getAssetRecord().getDisplayCategory());
            	assertEquals(1, node.getIpInterfaces().size());
            	OnmsIpInterface iface = node.getIpInterfaces().iterator().next();
            	assertEquals("192.168.7.1", iface.getIpAddress());
            	assertEquals("M", iface.getIsManaged());
            	assertEquals(2, iface.getMonitoredServices().size());
            	
            	System.err.println("###################3 UPDATE ####################");
            	getNodeDao().update(node);
            	return null;
            }
        });

    }


    private List<String> getEndpoints(String uri) {
        final ServiceReference<ApplicationRegistry> serviceReference = bundleContext.getServiceReference(ApplicationRegistry.class);
        try {
            final ApplicationRegistry applicationRegistry = bundleContext.getService(serviceReference);
            return applicationRegistry.getEndpoints().stream()
                    .filter(endpoint -> uri.equals(endpoint) || uri.startsWith(endpoint)).collect(Collectors.toList());
        } finally {
            bundleContext.ungetService(serviceReference);
        }
    }


    /**
     * Any feature that starts with '!' will be removed
     * from the list, and will remove all other features
     * with the same name and version.
     *
     * i.e. if the feature list contains:
     * <pre>
     *   feature-a
     *   feature-b
     *   !feature-b
     *   !feature-c
     * </pre>
     *
     * after calling this function, the list will contain:
     * <pre>
     *   feature-a
     * </pre>
     *
     * @param features
     */
    public void filterFeatures(List<Feature> features) {
        // Determine the set of features to remove
        final Set<Feature> featuresToExclude = new HashSet<>();
        final Iterator<Feature> it = features.iterator();
        while (it.hasNext()) {
            final Feature feature = it.next();
            if (feature.getName().startsWith("!") && feature.getName().length() > 1) {
                featuresToExclude.add(Feature.builder()
                                .withName(feature.getName().substring(1))
                                .withVersion(feature.getVersion())
                                .build());
                it.remove();
            }
        }
        // Remove all matching features
        features.removeAll(featuresToExclude);
    }


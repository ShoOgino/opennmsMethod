    @Test
    public void canGenerateRepositoryList() throws IOException, URISyntaxException {
        // Create repositories
        File repositories = tempFolder.newFolder("repositories");
        repositories.mkdirs();

        // Create an empty repository
        File emptyRepository = new File(repositories, "empty");
        emptyRepository.mkdirs();

        // Create a release (non-snapshot) repository
        File releaseRepository = new File(repositories, "release");
        releaseRepository.mkdirs();
        Files.write("mvn:group.id/artifact.id/2.0.0/xml",
                new File(releaseRepository, "features.uri"), StandardCharsets.UTF_8);
        Files.write("  # comment\n" + "released-feature",
                new File(releaseRepository, "features.boot"), StandardCharsets.UTF_8);

        // Create a snapshot repository
        File snapshotRepository = new File(repositories, "snapshot");
        snapshotRepository.mkdirs();
        Files.write("#feature uris\n" +
                "mvn:other.group.id/other.artifact.id/1.0-SNAPSHOT/xml",
                new File(snapshotRepository, "features.uri"), StandardCharsets.UTF_8);
        Files.write("snapshot-feature",
                new File(snapshotRepository, "features.boot"), StandardCharsets.UTF_8);

        // Read and verify
        assertEquals(Lists.newArrayList(
                new Repository(emptyRepository.toPath(), Collections.emptyList(), Collections.emptyList()),
                new Repository(releaseRepository.toPath(),
                        Lists.newArrayList(new URI("mvn:group.id/artifact.id/2.0.0/xml")),
                        Lists.newArrayList(Feature.builder().withName("released-feature").build())),
                new Repository(snapshotRepository.toPath(),
                        Lists.newArrayList(new URI("mvn:other.group.id/other.artifact.id/1.0-SNAPSHOT/xml")),
                        Lists.newArrayList(Feature.builder().withName("snapshot-feature").build()))),
                karafExtender.getRepositories());
    }


	public void contextInitialized(ServletContextEvent sce) {

		try {
			
			m_servletContext = sce.getServletContext();

			File karafRoot = new File(m_servletContext.getRealPath("/") + "/WEB-INF/karaf");

			final String opennmsHome = System.getProperty("opennms.home");
			if (opennmsHome != null) {
				karafRoot = new File(opennmsHome);
			}

			/*
			String karafHome = System.getProperty("karaf.home");
			if (karafHome != null) {
				karafRoot = new File(karafHome);
			}
			*/

			System.err.println("contextInitialized");
			final String root = karafRoot.getAbsolutePath();
			System.err.println("Root: " + root);
			System.setProperty("karaf.home", root);
            System.setProperty("karaf.base", root);
            System.setProperty("karaf.data", root + "/data");
            System.setProperty("karaf.history", root + "/data/history.txt");
            System.setProperty("karaf.instances", root + "/instances");
			System.setProperty("karaf.startLocalConsole", "false");
			System.setProperty("karaf.startRemoteShell", "true");
            System.setProperty("karaf.lock", "false");
			main = new Main(new String[0]);
            main.launch();
            
            // get bundle context for registering service
            m_framework = main.getFramework().getBundleContext();
            
            // add bundle context to servlet context for Proxy Servlet
            m_servletContext.setAttribute(BundleContext.class.getName(), m_framework);

            
            m_bridge.start(m_framework);

		} catch (final Exception e) {
			main = null;
			e.printStackTrace();
		}
	}


	public Map<String, Number> parallelPing(InetAddress host, int count) throws IOException {
        Category log = ThreadCategory.getInstance(this.getClass());
        LinkedHashMap<String, Number> returnval = new LinkedHashMap<String, Number>();
        
        Long tidKey = getTidKey();
        ArrayList<PingRequest> requests = new ArrayList<PingRequest>();
        parallelWaiting.put(tidKey, requests);
        for (int i = 0; i < count; i++) {
        	short sid = sequenceId++;
        	PingRequest reply = new PingRequest(host, sid);
        	// log.debug("sending packet with ID '" + tidKey + "' and sequence '" + reply.getSequenceId());
        	requests.add(reply);
        	DatagramPacket pkt = getDatagram(host, tidKey, reply.getSequenceId());
        	synchronized(reply) {
        		sendPacket(pkt);
        	}
       		try {
       			Thread.sleep(50);
       		} catch (InterruptedException ex) {
                Thread.currentThread().interrupt();
       		}
        }
        
        try {
            synchronized(requests) {
            	Thread.sleep(timeout);
            	requests.wait(1);
            	/* requests.wait(timeout); */
            }
        } catch (InterruptedException ex) {
            // interrupted so return, reset interrupt.
            Thread.currentThread().interrupt();
        }

        parallelWaiting.remove(tidKey);

        Collections.sort(requests, new Comparator<PingRequest>() {
			public int compare(PingRequest arg0, PingRequest arg1) {
				if (!arg0.isSignaled()) {
					return -1;
				}
				if (!arg1.isSignaled()) {
					return 1;
				}
				return (int)(arg0.getPacket().getPingRTT() - arg1.getPacket().getPingRTT());
			}
        });
        for (int i = 0; i < requests.size(); i++) {
        	PingRequest reply = requests.get(i);
        	if (reply.isSignaled()) {
        		Long rtt = getRTT(reply);
        		if (rtt <= (timeout * 1000)) {
        			returnval.put("ping" + (i+1), rtt);
        		} else {
        			log.debug("a response came back, but it was too old: sid = " + reply.getSequenceId() + ", rtt = " + rtt);
        			returnval.put("ping" + (i+1), null);
        		}
    		} else {
    			log.debug("no response came back: sid = " + reply.getSequenceId());
    			returnval.put("ping" + (i+1), null);
        	}
        }

        ArrayList<Number> al = new ArrayList<Number>(returnval.values());
        returnval.put("loss", new Long(CollectionMath.countNull(al)));
        returnval.put("median", new Long(CollectionMath.median(al).longValue()));
        returnval.put("response-time", new Long(CollectionMath.average(al).longValue()));
        
        return returnval;
	}


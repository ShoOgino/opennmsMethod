    /**
     * Writes the ICMP header out to the specified buffer at the starting
     * offset. If the buffer does not have sufficent data to store the
     * information then an IndexOutOfBoundsException is thrown.
     * 
     * @param buf
     *            The storage buffer.
     * @param offset
     *            The location to start in buf.
     * 
     * @return The new offset after storing to the buffer.
     * 
     * @exception IndexOutOfBoundsException
     *                Thrown if the buffer does not have enough storage space.
     * 
     */
    protected int storeToBuffer(byte[] buf, int offset) {
        if (buf.length < (offset + 8))
            throw new IndexOutOfBoundsException("Array index overflow in buffer");

        buf[offset++] = (byte) (m_type);
        buf[offset++] = (byte) (m_code);
        buf[offset++] = (byte) ((m_checksum >>> 8) & 0xff);
        buf[offset++] = (byte) (m_checksum & 0xff);
        buf[offset++] = (byte) ((m_ident >>> 8) & 0xff);
        buf[offset++] = (byte) (m_ident & 0xff);
        buf[offset++] = (byte) ((m_sequence >>> 8) & 0xff);
        buf[offset++] = (byte) (m_sequence & 0xff);

        return offset;
    }


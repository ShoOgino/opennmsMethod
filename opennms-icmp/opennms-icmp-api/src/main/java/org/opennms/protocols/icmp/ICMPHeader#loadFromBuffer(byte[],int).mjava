    /**
     * Reads the ICMP header from the specified buffer and sets the internal
     * fields equal to the data. If the buffer does not have sufficent data to
     * restore the header then an IndexOutOfBoundsExceptoin is thrown by the
     * method.
     * 
     * @param buf
     *            The buffer to read the data from.
     * @param offset
     *            The offset to start reading data.
     * 
     * @return The new offset after reading the data.
     * 
     * @exception IndexOutOfBoundsException
     *                is thrown if there is not sufficent data in the buffer.
     * 
     */
    protected int loadFromBuffer(byte[] buf, int offset) {
        if (buf.length < (offset + 8))
            throw new IndexOutOfBoundsException("Insufficient data to load ICMP header");

        m_type = (byte) (buf[offset++]);
        m_code = (byte) (buf[offset++]);
        m_checksum = (short) (byteToShort(buf[offset++]) << 8 | byteToShort(buf[offset++]));

        m_ident = (short) (byteToShort(buf[offset++]) << 8 | byteToShort(buf[offset++]));

        m_sequence = (short) (byteToShort(buf[offset++]) << 8 | byteToShort(buf[offset++]));

        return offset;
    }


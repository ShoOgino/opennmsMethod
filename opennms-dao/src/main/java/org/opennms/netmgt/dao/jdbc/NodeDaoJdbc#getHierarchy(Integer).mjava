    @SuppressWarnings("unchecked")
	public OnmsNode getHierarchy(Integer id) {
    	
    	NodeHierarchyMapper rowMapper = new NodeHierarchyMapper(getDataSource());
    	

    	final String hierarchyQuery = "SELECT " +
    	rowMapper.getColumns() +
    	"FROM node " +
    	"LEFT JOIN ipInterface ON (node.nodeId = ipInterface.nodeId) " +
    	"LEFT JOIN ifservices ON (ipInterface.nodeId = ifservices.nodeId AND ipInterface.ipAddr = ifservices.ipAddr) " +
    	"LEFT JOIN outages ON (ifServices.nodeId = outages.nodeId AND ifServices.ipAddr = outages.ipAddr AND ifServices.serviceID = outages.serviceId AND outages.ifRegainedService is null) " +
    	"WHERE node.nodeId = ?" +
    	"";
    	
    	Set<OnmsNode> nodes = new HashSet<OnmsNode>(getJdbcTemplate().query(hierarchyQuery, new Object[] { id }, rowMapper));
    	if (nodes.isEmpty())
    		return null;
    	else if (nodes.size() == 1)
    		return (OnmsNode)nodes.iterator().next();
    	else
    		throw new IncorrectResultSizeDataAccessException("Unexpected number of nodes returned.", 1, nodes.size());
    }


    /**
     * Called from upsert after it creates a transaction.
     */
    private T doUpsert() {
        T dbObj = query();
        if (dbObj != null) {
            // if we found the object then update and return
            return update(dbObj);
        }

        // lock the table since we are about to insert and don't want it inserted 
        m_dao.lock();

        // make sure it wasn't inserted while we waited for the lock
        dbObj = query();
        if (dbObj != null) {
            // if was!! so update and return
            return update(dbObj);
        }
        
        // now it is save to insert it
        return insert();
    }


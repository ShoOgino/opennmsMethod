	public void testGetActiveIPListWithDeletedNode() throws Exception {
        List<InetAddress> list = m_dao.getIPAddressList("ipaddr == '192.168.1.1'");
        final List<OnmsIpInterface> ifaces = m_interfaceDao.findByIpAddress("192.168.1.1");
        
        assertEquals("should be 1 interface", 1, ifaces.size());

		OnmsIpInterface iface = ifaces.get(0);
    	iface.setIsManaged("D");
    	m_interfaceDao.save(iface);
    	m_interfaceDao.flush();

        setComplete();
        endTransaction();
        startNewTransaction();

        list = m_dao.getActiveIPAddressList("ipaddr == '192.168.1.1'");
        assertNotNull("returned list should not be null", list);
        assertEquals("no nodes should be returned, since the only one has been deleted", 0, list.size());
    }


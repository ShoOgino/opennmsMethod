    @Test
    @Transactional
    public void testSetId() throws Exception {
        InetAddress ipAddr = m_databasePopulator.getNode2().getPrimaryInterface().getIpAddress();
        long expectedNodeId = Long.parseLong(m_databasePopulator.getNode2().getNodeId());

        long nodeId = m_cache.getNodeId(MonitoringLocationDao.DEFAULT_MONITORING_LOCATION_ID, ipAddr);
        Assert.assertEquals(expectedNodeId, nodeId);

        // Address already exists on database and it is not primary.
        Assert.assertEquals(-1, m_cache.setNodeId(MonitoringLocationDao.DEFAULT_MONITORING_LOCATION_ID, addr("192.168.1.3"), 1));

        // Address already exists on database but the new node also contain the address and is their primary address.
        Assert.assertEquals(1, m_cache.setNodeId(MonitoringLocationDao.DEFAULT_MONITORING_LOCATION_ID, addr("192.168.1.3"), m_testNodeId)); // return old nodeId
        Assert.assertEquals(m_testNodeId, m_cache.getNodeId(MonitoringLocationDao.DEFAULT_MONITORING_LOCATION_ID, addr("192.168.1.3"))); // return the new nodeId
    }


    @Test
    @Transactional
    public void testLldpSaveAndUpdate() throws InterruptedException {
        OnmsDistPoller distPoller = getDistPoller();

        OnmsNode node = new OnmsNode(distPoller);
        node.setLabel("MyFirstLldpNode");
        getNodeDao().save(node);
        getNodeDao().flush();
        
        OnmsDistPoller dp = getDistPoller();
        assertSame(distPoller, dp);
        Collection<OnmsNode> nodes = getNodeDao().findNodes(dp);
        assertEquals(7, nodes.size());
        Integer nodeid = null;
        for (OnmsNode retrieved : nodes) {
            if (retrieved.getLabel().equals("MyFirstLldpNode")) {
            	nodeid = retrieved.getId();
                System.out.println("nodeid: " +nodeid);
            }
        }
        
        OnmsNode dbnode1 = getNodeDao().get(nodeid);
        assertNotNull(dbnode1);
        
        if (dbnode1.getLldpElement() == null ) {
	        LldpElement lldpElement = new LldpElement();
	        lldpElement.setLldpChassisId("abc123456");
	        lldpElement.setLldpChassisIdSubType(LldpChassisIdSubType.LLDP_CHASSISID_SUBTYPE_MACADDRESS);
	        lldpElement.setLldpSysname("prova");
	        lldpElement.setNode(node);
	        lldpElement.setLldpNodeLastPollTime(lldpElement.getLldpNodeCreateTime());
	        dbnode1.setLldpElement(lldpElement);
    	}
        getNodeDao().save(dbnode1);
        getNodeDao().flush();

        OnmsNode dbnode2 = getNodeDao().get(nodeid);
        assertNotNull(dbnode2);
        assertNotNull(dbnode2.getLldpElement());

        System.out.println("lldp element id: " + dbnode2.getLldpElement().getId());
        System.out.println("lldp element create time: " + dbnode2.getLldpElement().getLldpNodeCreateTime());
        System.out.println("lldp element last poll time: " + dbnode2.getLldpElement().getLldpNodeLastPollTime());
        assertEquals("abc123456", dbnode2.getLldpElement().getLldpChassisId());
        assertEquals(LldpChassisIdSubType.LLDP_CHASSISID_SUBTYPE_MACADDRESS, dbnode2.getLldpElement().getLldpChassisIdSubType());
        assertEquals("prova", dbnode2.getLldpElement().getLldpSysname());
        assertNotNull(dbnode2.getLldpElement().getLldpNodeCreateTime());
        assertNotNull(dbnode2.getLldpElement().getLldpNodeLastPollTime());
        
        System.out.println("---------");
        Thread.sleep(1000);
        System.out.println("---------");

        LldpElement lldpUpdateElement = new LldpElement();
        lldpUpdateElement.setLldpChassisId("abc012345");
        lldpUpdateElement.setLldpChassisIdSubType(LldpChassisIdSubType.LLDP_CHASSISID_SUBTYPE_MACADDRESS);
        lldpUpdateElement.setLldpSysname("prova");

        LldpElement dbLldpElement = dbnode2.getLldpElement();
        dbLldpElement.merge(lldpUpdateElement);
        dbnode2.setLldpElement(dbLldpElement);

        getNodeDao().save(dbnode2);
        getNodeDao().flush();

        OnmsNode dbnode3 = getNodeDao().get(nodeid);
        assertNotNull(dbnode3);
        assertNotNull(dbnode3.getLldpElement());

        System.out.println("lldp element id: " + dbnode3.getLldpElement().getId());
        System.out.println("lldp element create time: " + dbnode3.getLldpElement().getLldpNodeCreateTime());
        System.out.println("lldp element last poll time: " + dbnode3.getLldpElement().getLldpNodeLastPollTime());
        assertEquals("abc012345", dbnode3.getLldpElement().getLldpChassisId());
        assertEquals(LldpChassisIdSubType.LLDP_CHASSISID_SUBTYPE_MACADDRESS, dbnode3.getLldpElement().getLldpChassisIdSubType());
        assertEquals("prova", dbnode3.getLldpElement().getLldpSysname());
        assertNotNull(dbnode3.getLldpElement().getLldpNodeCreateTime());
        assertNotNull(dbnode3.getLldpElement().getLldpNodeLastPollTime());

        
    }    


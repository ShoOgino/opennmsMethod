    /**
     * Test that adding a "include.directory" property to the main graph config file
     * will cause included files to be read on reload of the main config file
     * (early code didn't do this right)
     * @throws Exception
     */
    @Test
    public void testAddingIncludeDirectory() throws Exception {
        File rootFile = m_fileAnticipator.tempFile("snmp-graph.properties");

        m_outputStream = new FileOutputStream(rootFile);
        m_writer = new OutputStreamWriter(m_outputStream, "UTF-8");
        m_writer.write(s_prefab);
        m_writer.close();
        m_outputStream.close();
        
        HashMap<String, Resource> perfConfig = new HashMap<String, Resource>();
        perfConfig.put("performance", new FileSystemResource(rootFile));
        PropertiesGraphDao dao = createPropertiesGraphDao(perfConfig, s_emptyMap);

        assertNotNull(dao.getPrefabGraph("mib2.bits"));
        try {
            PrefabGraph mib2errors = dao.getPrefabGraph("mib2.errors");
            fail("Should have thrown an ObjectRetrievalFailureException retrieving graph " + mib2errors);
        } catch (ObjectRetrievalFailureException e) {
            
        }
        
        //Wait long enough to make the FileReloadContainers do their thing reliably
        Thread.sleep(1100);

        //Now create the new graph in a sub-directory, and rewrite the rootFile with an include.directory property 
        File graphDirectory = m_fileAnticipator.tempDir("snmp-graph.properties.d");
        File graphErrors = m_fileAnticipator.tempFile(graphDirectory, "mib2.errors.properties");
        
        graphDirectory.mkdir();
        m_outputStream = new FileOutputStream(graphErrors);
        m_writer = new OutputStreamWriter(m_outputStream, "UTF-8");
        m_writer.write(s_separateErrorsGraph);
        m_writer.close();
        m_outputStream.close();
        
        m_outputStream = new FileOutputStream(rootFile);
        m_writer = new OutputStreamWriter(m_outputStream, "UTF-8");
        m_writer.write(s_prefab.replace("output.mime", "include.directory=snmp-graph.properties.d\n" +
        		"output.mime"));
        m_writer.close();
        m_outputStream.close();
        
        assertNotNull(dao.getPrefabGraph("mib2.bits")); //Just checking the reload didn't lose existing graphs
        assertNotNull(dao.getPrefabGraph("mib2.errors")); //This is the core: this graph should have been picked up
    }


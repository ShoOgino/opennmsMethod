	@Test
	@Transactional
	public void testAlarmSummary() {
	    OnmsEvent event = new OnmsEvent();
	    event.setEventLog("Y");
	    event.setEventDisplay("Y");
	    event.setEventCreateTime(new Date());
	    event.setDistPoller(m_distPollerDao.load("localhost"));
	    event.setEventTime(new Date());
	    event.setEventSeverity(new Integer(7));
	    event.setEventUei("uei://org/opennms/test/EventDaoTest");
	    event.setEventSource("test");
	    m_eventDao.save(event);

	    OnmsNode node = m_nodeDao.findAll().iterator().next();

	    OnmsAlarm alarm = new OnmsAlarm();

	    alarm.setNode(node);
	    alarm.setUei(event.getEventUei());
	    alarm.setSeverityId(event.getEventSeverity());
	    alarm.setFirstEventTime(event.getEventTime());
	    alarm.setSeverityId(event.getEventSeverity());
	    alarm.setLastEvent(event);
	    alarm.setCounter(1);
	    alarm.setDistPoller(m_distPollerDao.load("localhost"));

	    m_alarmDao.save(alarm);

	    List<AlarmSummary> summary = m_alarmDao.getNodeAlarmSummaries();
	    Assert.assertNotNull(summary);
	    Assert.assertEquals(1, summary.size());
	    AlarmSummary sum = summary.get(0);
	    Assert.assertEquals(node.getLabel(), sum.getNodeLabel());
            Assert.assertEquals(alarm.getSeverity().getId(), sum.getMaxSeverity().getId());
	}


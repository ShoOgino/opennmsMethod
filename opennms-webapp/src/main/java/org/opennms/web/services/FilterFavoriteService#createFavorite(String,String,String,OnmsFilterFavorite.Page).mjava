    public OnmsFilterFavorite createFavorite(String userName, String favoriteName, String filterString, OnmsFilterFavorite.Page page) throws FilterFavoriteException {
        // Input string is URL-Encoded and some html-entities are already escaped.
        // Revert this process, to allow WebSecurityUtils to work properly.
        try {
            favoriteName = StringEscapeUtils.unescapeHtml(URLDecoder.decode(favoriteName, "UTF-8"));
            filterString = StringEscapeUtils.unescapeHtml(URLDecoder.decode(filterString, "UTF-8"));
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException(e);
        }

        // Sanitize input
        favoriteName = WebSecurityUtils.sanitizeString(favoriteName);
        filterString = WebSecurityUtils.sanitizeString(filterString);

        // Validate input
        validate(userName, favoriteName, filterString, page);

        // Create filter
        OnmsFilterFavorite filter = new OnmsFilterFavorite();
        filter.setUsername(userName);
        filter.setFilter(filterString);
        filter.setName(favoriteName);
        filter.setPage(page);
        favoriteDao.save(filter);
        return filter;
    }


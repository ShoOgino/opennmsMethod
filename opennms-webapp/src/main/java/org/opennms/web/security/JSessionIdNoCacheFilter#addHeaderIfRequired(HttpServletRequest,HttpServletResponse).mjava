    private void addHeaderIfRequired(final HttpServletRequest request, final HttpServletResponse response) {
        boolean cacheControlHeaderNeeded = false;

        if (request.getSession(false) != null) {
            cacheControlHeaderNeeded = true;
        }

        if (!cacheControlHeaderNeeded) {
            final Collection<String> cookies = response.getHeaders("Set-Cookie");

            // check for session id in cookies
            for(final String cookie : cookies) {
                if(cookie.contains(sessionIdName)){
                    cacheControlHeaderNeeded = true;
                    break;
                }
            }
        }

        if (!cacheControlHeaderNeeded) {
            // check for session id in location url
            String location = response.getHeader("Location");
            if(location != null && location.contains(sessionIdName.toLowerCase())) {
                cacheControlHeaderNeeded = true;
            }
        }

        if(cacheControlHeaderNeeded) {
            response.addHeader("Cache-Control", "no-cache");
        }
    }


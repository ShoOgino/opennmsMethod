    /**
     * <p>getNodesWithCategories</p>
     *
     * @param nodeDao a {@link org.opennms.netmgt.dao.NodeDao} object.
     * @param categoryDao a {@link org.opennms.netmgt.dao.CategoryDao} object.
     * @param categories1 an array of {@link java.lang.String} objects.
     * @param onlyNodesWithDownAggregateStatus a boolean.
     * @return an array of {@link org.opennms.web.element.Node} objects.
     */
    public Node[] getNodesWithCategories(String[] categories, boolean onlyNodesWithDownAggregateStatus) {
        Collection<OnmsNode> ourNodes = getNodesInCategories(categories);
        
        if(onlyNodesWithDownAggregateStatus) {
            AggregateStatus as = new AggregateStatus(new HashSet<OnmsNode>(ourNodes));
            ourNodes = as.getDownNodes();
        }
        return convertOnmsNodeCollectionToNodeArray(ourNodes);
    }


    /**
     * Perform the actual transformation, writing to the HTTP response via the
     * FOP Driver.
     */

    protected void doTransform(Map model, javax.xml.transform.Source source,
            HttpServletRequest request, HttpServletResponse response)
            throws Exception {

        driver = new Driver();
        driver.setRenderer(renderer);
        driver.setOutputStream(response.getOutputStream());
        Result result = new SAXResult(driver.getContentHandler());

        // delegate to the superclass for the actual output having constructed
        // the Result
        doTransform(source, getParameters(request), result,
                    response.getCharacterEncoding());
    }


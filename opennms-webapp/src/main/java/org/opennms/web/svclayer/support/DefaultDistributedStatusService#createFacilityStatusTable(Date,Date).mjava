    /*
     * XXX what do we do if any of the DAO calls return null, or do they
     * throw DataAccessException?
     */
    public SimpleWebTable createFacilityStatusTable(Date startDate,
            Date endDate) {
        SimpleWebTable table = new SimpleWebTable();
        
        List<OnmsMonitoringLocationDefinition> locationDefinitions =
            m_locationMonitorDao.findAllMonitoringLocationDefinitions();
        
        List<OnmsApplication> sortedApplications =
            new ArrayList<OnmsApplication>(m_applicationDao.findAll());
        Collections.sort(sortedApplications,
                         new Comparator<OnmsApplication>(){
            public int compare(OnmsApplication o1, OnmsApplication o2) {
                return o1.getLabel().compareTo(o2.getLabel());
            }
        });
        
        Collection<OnmsLocationSpecificStatus> statuses =
            m_locationMonitorDao.getAllMostRecentStatusChanges();
        
        table.setTitle("Distributed Poller Status Summary");
        
        table.addColumn("Area", "simpleWebTableRowLabel");
        table.addColumn("Location", "simpleWebTableRowLabel");
        for (OnmsApplication application : sortedApplications) {
            table.addColumn(application.getLabel(), "simpleWebTableRowLabel");
        }
        
        for (OnmsMonitoringLocationDefinition locationDefinition : locationDefinitions) {
            OnmsLocationMonitor monitor = m_locationMonitorDao.findByLocationDefinition(locationDefinition);
            
            table.newRow();
            table.addCell(locationDefinition.getArea(), "simpleWebTableRowLabel");
            table.addCell(locationDefinition.getName(), "simpleWebTableRowLabel");
            
            for (OnmsApplication application : sortedApplications) {
                String status = calculateCurrentStatus(monitor, application.getMemberServices(), statuses);
                String percentage = calculatePercentageUptime(monitor, application.getMemberServices(), startDate, endDate);

                table.addCell(percentage, status,
                              createDetailsPageUrl(locationDefinition, application));
            }
        }
        
        //table.newRow();
        
        return table;
    }


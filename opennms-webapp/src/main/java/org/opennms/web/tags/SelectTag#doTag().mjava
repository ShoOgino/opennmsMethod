    @Override
    public void doTag() throws JspException, IOException {


        // prepare output
        List<T> viewElements = new ArrayList<T>();
        if (elements != null) {
            viewElements.addAll(elements);
        }
        if (comparator != null) {
            Collections.sort(viewElements, comparator);
        }
        viewElements.add(0, null); // "" empty at the beginning of the line

        // create output
        StringBuffer optionsBuffer = new StringBuffer();
        for (T eachElement : viewElements) {
            optionsBuffer.append(getOption(eachElement, selected));
        }
        String output = TEMPLATE
                .replace("{ONCHANGE}", StringUtils.isEmpty(onChange) ? "" : "onChange=\"" + onChange + "\"")
                .replace("{OPTIONS}", optionsBuffer.toString());

        // write output
        getJspContext().getOut().write(output);
    }


    @Override
    protected ModelAndView handleRequestInternal(HttpServletRequest request,
            HttpServletResponse res) throws Exception {
        String[] requiredParameters = new String[] { "format", "reportid" };

        for (String requiredParameter : requiredParameters) {
            if (request.getParameter(requiredParameter) == null) {
                throw new MissingParameterException(requiredParameter,
                                                    requiredParameters);
            }
        }
        try {
            m_reportId = WebSecurityUtils.safeParseInt(request.getParameter("reportid"));
        } catch (NumberFormatException e) {
        }
        ModelAndView mav = new ModelAndView();
        String format = WebSecurityUtils.sanitizeString(request.getParameter("format"));
        if (format.equalsIgnoreCase("pdf")) {
            mav.setViewName("/report/availability/pdfreportviewer");
        } else if (format.equalsIgnoreCase("svg")) {
            mav.setViewName("/report/availability/svgreportviewer");
        } else {
            mav.setViewName("/report/availability/htmlreportviewer");
        }
        m_viewerService.setReportId(m_reportId);
        mav.addObject("source", m_viewerService.createSource());
        return mav;
    }


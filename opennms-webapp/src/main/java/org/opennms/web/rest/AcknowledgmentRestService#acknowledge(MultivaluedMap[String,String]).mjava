    /**
     * <p>acknowledgeAlarm</p>
     *
     * @param alarmId a {@link java.lang.String} object.
     * @param action a {@link java.lang.String} object.
     * @return a {@link org.opennms.netmgt.model.OnmsAcknowledgment} object.
     */
    @POST
    @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
    @Transactional
    public OnmsAcknowledgment acknowledge(MultivaluedMap<String, String> formParams) {
    	writeLock();
    	
    	try {
	        String alarmId = formParams.getFirst("alarmId");
	        String notifId = formParams.getFirst("notifId");
	        String action = formParams.getFirst("action");
	        if (action == null) {
	            action = "ack";
	        }
	    	OnmsAcknowledgment ack = null;
	    	if (alarmId == null && notifId == null) {
	    		throw new IllegalArgumentException("You must supply either an alarmId or notifId!");
	    	} else if (alarmId != null && notifId != null) {
	    		throw new IllegalArgumentException("You cannot supply both an alarmId and a notifId!");
	    	} else if (alarmId != null) {
	    		final OnmsAlarm alarm = m_alarmDao.get(Integer.valueOf(alarmId));
	            ack = new OnmsAcknowledgment(alarm);
	    	} else if (notifId != null) {
	    		final OnmsNotification notification = m_notificationDao.get(Integer.valueOf(notifId));
	    		ack = new OnmsAcknowledgment(notification);
	    	}
	        
	        if ("ack".equals(action)) {
	            ack.setAckAction(AckAction.ACKNOWLEDGE);
	        } else if ("unack".equals(action)) {
	            ack.setAckAction(AckAction.UNACKNOWLEDGE);
	        } else if ("clear".equals(action)) {
	            ack.setAckAction(AckAction.CLEAR);
	        } else if ("esc".equals(action)) {
	            ack.setAckAction(AckAction.ESCALATE);
	        } else {
	            throw new IllegalArgumentException(
	            "Must supply the 'action' parameter, set to either 'ack, 'unack', 'clear', or 'esc'");
	        }

	        m_ackDao.processAck(ack);
	        return ack;
    	} finally {
    		writeUnlock();
    	}
    }


    private String getSql(final String selectCause, final EventCriteria criteria) {
        final StringBuilder buf = new StringBuilder(selectCause);
        
        criteria.visit(new EventCriteriaVisitor<RuntimeException>(){
            
            boolean first = true;
            
            public void and(StringBuilder buf){
                if(first){
                    buf.append(" WHERE ");
                    first = false;
                } else {
                    buf.append(" AND ");
                }
            }
            
            public void visitAckType(AcknowledgeType ackType) throws RuntimeException {
                and(buf);
                buf.append(EventFactory.getAcknowledgeTypeClause(ackType));
            }

            public void visitFilter(Filter filter) throws RuntimeException {
                and(buf);
                buf.append(filter.getParamSql());
            }

            public void visitLimit(int limit, int offset) throws RuntimeException {
                buf.append(" LIMIT ").append(limit).append(" OFFSET ").append(offset);
            }

            public void visitSortStyle(SortStyle sortStyle) throws RuntimeException {
                buf.append(" ");
                buf.append(EventFactory.getOrderByClause(sortStyle));
            }
            
        });
        
        return buf.toString();
    }


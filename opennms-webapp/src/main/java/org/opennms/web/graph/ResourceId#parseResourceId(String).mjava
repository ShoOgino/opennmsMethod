    public static ResourceId parseResourceId(String resourceId) {
        Pattern p = Pattern.compile("([^\\[]+)\\[([^\\]]*)\\]\\.([^\\[]+)\\[([^\\]]*)\\]");
        Matcher m = p.matcher(resourceId);
        if (!m.matches()) {
            throw new IllegalArgumentException("resourceId '" + resourceId
                                               + "' does not match pattern '"
                                               + p.toString() + "'");
        }
        
        String parentResourceType = Util.decode(m.group(1));
        String parentResource = Util.decode(m.group(2));
        String resourceType = Util.decode(m.group(3));
        String resource = Util.decode(m.group(4));

        return new ResourceId(parentResourceType, parentResource,
                            resourceType, resource);
    }


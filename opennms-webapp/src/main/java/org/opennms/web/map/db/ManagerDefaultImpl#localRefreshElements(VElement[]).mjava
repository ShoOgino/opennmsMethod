   	private VElement[] localRefreshElements(VElement[] mapElements) throws MapsException {
    		List<VElement> elems = new ArrayList<VElement>();
        	Vector<Integer> deletedNodeids= dbManager.getDeletedNodes();
        	java.util.Map<Integer,OutageInfo> outagedNodes=getOutagedNodes();
        	java.util.Map<Integer,Double> avails=dbManager.getAvails(mapElements);
        	Set nodesBySource = new HashSet();
        	if(dataSource!=null)
        		nodesBySource = dbManager.getNodeIdsBySource(filter);

    		VElement ve = null;
    		if (mapElements != null) 
        	for(int i=0;i<mapElements.length;i++){
        		ve = refresh(mapElements[i],nodesBySource,deletedNodeids,outagedNodes,avails);
        		if (ve!=null) {
    				elems.add(ve);
    			}
        		
        		if(sessionMap!=null && mapElements[i].getMapId()==sessionMap.getId()){
        			sessionMap.removeElement(mapElements[i].getId(), mapElements[i].getType());
        			sessionMap.addElement(ve);
        		}
        	}
    		
        	return elems.toArray(new VElement[0]);
    }


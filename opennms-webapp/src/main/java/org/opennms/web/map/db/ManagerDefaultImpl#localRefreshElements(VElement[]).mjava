   	private VElement[] localRefreshElements(VElement[] mapElements) throws MapsException {
    		List<VElement> elems = new ArrayList<VElement>();
        	Vector<Integer> deletedNodeids= dbManager.getDeletedNodes();
        	java.util.Map<Integer,AlarmInfo> outagedNodes=getAlarmedNodes();
        	java.util.Map<Integer,Double> avails=dbManager.getAvails(mapElements);
        	Set<Integer> nodesBySource = new HashSet<Integer>();
        	if(dataSource!=null) {
                nodesBySource = dbManager.getNodeIdsBySource(filter);
            }

    		VElement ve = null;
    		if (mapElements != null) {
                for (VElement mapElement : mapElements) {
                	ve = refresh(mapElement,nodesBySource,deletedNodeids,outagedNodes,avails);
                	if (ve!=null) {
                		elems.add(ve);
                	}
                	
                	if(sessionMap!=null && mapElement.getMapId()==sessionMap.getId()){
                		sessionMap.removeElement(mapElement.getId(), mapElement.getType());
                		sessionMap.addElement(ve);
                	}
                }
            }
    		
        	return elems.toArray(new VElement[0]);
    }


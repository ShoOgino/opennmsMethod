    private String getCommandToExec(HttpServletRequest request, String command, String address) {

        String commandToExec = command;
        int timeOut = 1;
        int numberOfRequest = 10;
        int packetSize = 56;
        String hopAddress = null;

        String numericoutput = request.getParameter("numericOutput");
        if (numericoutput != null && numericoutput.equals("true")) {
            commandToExec = commandToExec + " -n ";
        }

        if (command.equals("ping")) {
            String timeout = request.getParameter("timeOut");
            if (timeout != null)
                timeOut = WebSecurityUtils.safeParseInt(timeout);
            String numberofrequest = request.getParameter("numberOfRequest");
            if (numberofrequest != null)
                numberOfRequest = WebSecurityUtils.safeParseInt(numberofrequest);
            String packetsize = request.getParameter("packetSize");
            if (packetsize != null)
                packetSize = WebSecurityUtils.safeParseInt(packetsize);
            // these are optionals
            String solaris = request.getParameter("solaris");
            if (solaris != null && solaris.equals("true")) {
                commandToExec = commandToExec + " -I " + timeOut + " "
                        + address + " " + packetSize + " " + numberOfRequest;
            } else {
                commandToExec = commandToExec + " -c " + numberOfRequest
                        + " -i " + timeOut + " -s " + packetSize + " "
                        + address;
            }

        } else if (command.equals("traceroute")) {
            hopAddress = request.getParameter("hopAddress");
            if (hopAddress != null) {
                commandToExec = commandToExec + " -g " + hopAddress + " "
                        + address;
            } else {
                commandToExec = commandToExec + " " + address;
            }
        } else if (command.equals("ipmitool")) {
            String ipmiCommand = request.getParameter("ipmiCommand");
            String ipmiUserName = request.getParameter("ipmiUser");
            String ipmiPassword = request.getParameter("ipmiPassword");
            String ipmiProtocol = request.getParameter("ipmiProtocol");

            if (ipmiCommand != null && ipmiUserName != null
                    && ipmiPassword != null) {
                commandToExec = commandToExec + " -I " + ipmiProtocol
                        + " -U " + ipmiUserName + " -P " + ipmiPassword
                        + " -H " + address + " " + ipmiCommand;
            } else
                throw new IllegalStateException(
                                                "IPMITool requires Protocol, Command, Usernane and Password");

        } else {
            throw new IllegalStateException("Command " + command
                    + " not supported.");
        }
        return commandToExec;
    }


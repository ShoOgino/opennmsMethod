        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {


    		if (!(request instanceof HttpServletRequest)) {
                throw new ServletException("Can only process HttpServletRequest");
            }

            if (!(response instanceof HttpServletResponse)) {
                throw new ServletException("Can only process HttpServletResponse");
            }
        	
            HttpServletRequest httpRequest = (HttpServletRequest) request;
        	HttpServletResponse httpResponse = (HttpServletResponse) response;

    		log().debug(
    				"passAuthFilter: parsing request: "
    						+ httpRequest.getRequestURL());
    		log().debug("passAuthFilter: AUTH Type: " + httpRequest.getAuthType());
            
        	Authentication authResult = SecurityContextHolder.getContext().getAuthentication();
        	
        	
        	if (authResult == null && !skipAuthUrl(httpRequest)) {
        		if (log().isDebugEnabled()) {
                    log().debug("Request is to process NTLM authentication");
                }
        		boolean authenticated;
                try {
                    onPreAuthentication(httpRequest, httpResponse);
                	
                    authResult= attemptAuthentication(request, response, chain);
                	
                    authenticated = true;
                } catch (AuthenticationException failed) {
                    // Authentication failed
                    unsuccessfulAuthentication(httpRequest, httpResponse, failed);
                    authenticated = false;
                    return;
                }
                
                if (authenticated)
                	successfulAuthentication( httpRequest, httpResponse, authResult);
            } 

        	chain.doFilter(request, response);
            
            // allora se si ottiene successo nell'autenticazione bisogna effettuare il chaindofilter
            // se mi autentico con NTLM non ho bisogno di effettuare altro.
            // allora vediamo di ragionare:
            
            // 1) provo l'autenticazione utilizzando NTLM
            // 2) se fallisce vado avanti nella catena
            // 3) se mi autentico vado avanti nella catena
            // 4) se comincio con /hhhhh.xyz vado avanti nella catena
            // 5) se e' autenticato vado avanti nella catena.
        }


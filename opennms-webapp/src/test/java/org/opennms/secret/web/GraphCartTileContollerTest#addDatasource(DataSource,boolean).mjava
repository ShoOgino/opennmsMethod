    private GraphDataElement addDatasource(DataSource ds, boolean shouldWork) throws Exception {
        assertGraph();
        int countBefore = m_graphDef.getGraphDataElements().size();
        int countExpected = countBefore + (shouldWork ? 1 : 0);

        m_request.addParameter("add", ds.getId());
        callController();
        
        assertGraph();
        assertEquals("graph data elements size", countExpected,
                m_graphDef.getGraphDataElements().size());
        if (countExpected > 0) {
            GraphDataElement dataElem = (GraphDataElement) m_graphDef.getGraphDataElements().get(0);
            assertEquals(ds.getId(), dataElem.getDataSource().getId());
            
            return dataElem;
        } else {
            return null;
        }
    }


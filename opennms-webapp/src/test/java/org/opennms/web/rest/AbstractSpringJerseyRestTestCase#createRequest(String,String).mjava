    protected MockHttpServletRequest createRequest(final String requestType, final String urlPath) {
        final MockHttpServletRequest request = new MockHttpServletRequest(getServletContext(), requestType, contextPath + urlPath) {

            @Override
            // FIXME: remove when we update to Spring 3.1
            public void setContentType(final String contentType) {
                super.setContentType(contentType);
                super.addHeader("Content-Type", contentType);
            }

        };
        request.setContextPath(contextPath);
        MockUserPrincipal.setName(m_username);
        request.setUserPrincipal(MockUserPrincipal.getInstance());
        if (m_username != null) {
            request.setRemoteUser(m_username);
            for (final String role : m_roles) {
                request.addUserRole(role);
            }
        }
        return request;
    }


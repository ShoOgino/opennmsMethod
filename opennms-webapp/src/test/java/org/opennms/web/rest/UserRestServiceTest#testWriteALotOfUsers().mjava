    @Test
    public void testWriteALotOfUsers() throws Exception {
        int userCount = 40;

        ExecutorService pool = Executors.newCachedThreadPool();
        List<Future<?>> createFutures = new ArrayList<Future<?>>();
        for (int i = 0; i < userCount; i++) {
            final String userName = "test" + i;
            createFutures.add(pool.submit(Executors.callable(new Runnable() {
                @Override
                public void run() {
                    try {
                        createUser(userName);
                    } catch (Exception e) {
                        e.printStackTrace();
                        fail(e.getMessage());
                    }
                }
            })));
        }

        // Wait for all of the REST operations to complete
        for(Future<?> future : createFutures) {
            future.get();
        }

        sendRequest(GET, "/users", 200);

        // Try changing the password for every user to make sure that they
        // are properly accessible in the UserManager
        for (int i = 0; i < userCount; i++) {
            String xml = sendRequest(GET, "/users/test" + i, 200);
            assertTrue(xml.contains(String.format("<user><user-id>test%d</user-id>", i)));

            sendPut("/users/test" + i, "password=MONKEYS", 303, "/users/test" + i);

            xml = sendRequest(GET, "/users/test" + i, 200);
            assertTrue(xml.contains(">MONKEYS<"));
        }
    }


    protected void createUser(final String username, final String email) throws Exception {
        final String previousUser = getUser();
        final Collection<String> previousRoles = getUserRoles();

        clearUserInfo();
        setUser("admin");
        addUserRole("ROLE_ADMIN");

        String userXml = "<user>" +
                "<user-id>" + username + "</user-id>" +
                "<full-name>" + username + " Full Name</full-name>" +
                "{EMAIL}" + 
                "<user-comments>Autogenerated by a unit test...</user-comments>" +
                "<password>" + PASSWORD + "</password>" +
                "</user>";
        userXml = userXml.replace("{EMAIL}", email != null ?  "<email>" + email + "</email>": "");
        sendPost("/users", userXml, 303, "/users/" + username);

        clearUserInfo();
        setUser(previousUser);
        for (final String role : previousRoles) {
            addUserRole(role);
        }
    }


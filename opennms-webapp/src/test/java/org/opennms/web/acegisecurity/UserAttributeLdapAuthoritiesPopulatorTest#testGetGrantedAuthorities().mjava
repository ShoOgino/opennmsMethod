    public void testGetGrantedAuthorities() {
        UserAttributeLdapAuthoritiesPopulator populator = init();
        
        LdapUserDetails userDetails = createMock(LdapUserDetails.class);
        Attributes attributes = new BasicAttributes();
        expect(userDetails.getDn()).andReturn(s_dn).anyTimes();
        expect(userDetails.getAttributes()).andReturn(attributes);
        
        replay(userDetails);
        GrantedAuthority[] authorities =
            populator.getGrantedAuthorities(userDetails);
        verify(userDetails);

        assertNotNull("GrantedAuthority[] list returned from "
                      + "getGrantedAuthorities cannot be null", authorities);
    }


    public void testGetGrantedAuthoritiesMultiple() {
        UserAttributeLdapAuthoritiesPopulator populator = init();
        //LdapUserDetails userDetails = new OurLdapUserDetailsImpl();
        
        LdapUserDetails userDetails = createMock(LdapUserDetails.class);
        Attributes attributes = new BasicAttributes(true);
        Attribute attribute = new BasicAttribute(s_userAttribute);
        attribute.add("OpenNMS Administrator");
        attribute.add("OpenNMS User");
        attributes.put(attribute);
        expect(userDetails.getDn()).andReturn(s_dn).anyTimes();
        expect(userDetails.getAttributes()).andReturn(attributes);
        
        replay(userDetails);
        GrantedAuthority[] authorities =
            populator.getGrantedAuthorities(userDetails);
        verify(userDetails);
        
        assertNotNull("GrantedAuthority[] list returned from "
                      + "getGrantedAuthorities cannot be null", authorities);
        assertEquals("Incorrect number of entries in the GrantedAuthority list",
                     2, authorities.length); 
        assertEquals("User that we were expecting", "ROLE_ADMIN", authorities[0].getAuthority());
        assertEquals("User that we were expecting", "ROLE_USER", authorities[1].getAuthority());
    }


    private void generateData(String categoryName, Report report,
            String format, String monthFormat,
            Date periodEndDate)
            throws IOException, MarshalException, ValidationException,
            Exception {
        ThreadCategory.setPrefix(LOG4J_CATEGORY);
        org.apache.log4j.Category log = ThreadCategory.getInstance(this.getClass());
        log.debug("Inside AvailabilityData");

        m_nodes = new ArrayList<Node>();
        
        initializeInterval(periodEndDate);

        Catinfo config = null;
        try {
            CategoryFactory.init();
            m_catFactory = CategoryFactory.getInstance();
            config = m_catFactory.getConfig();
        } catch (IOException e) {
            log.fatal("Initializing CategoryFactory", e);
            throw e;
        } catch (MarshalException e) {
            log.fatal("Initializing CategoryFactory", e);
            throw e;
        } catch (ValidationException e) {
            log.fatal("Initializing CategoryFactory", e);
            throw e;
        }
        
        // FIXME There's some magic in here regarding multiple categories in a report

        if (log.isDebugEnabled()) {
            log.debug("CATEGORY " + categoryName);
        }
        if (categoryName.equals("") || categoryName.equals("all")) {
            int catCount = 0;
            if (log.isDebugEnabled()) {
                log.debug("catCount " + catCount);
            }
            
            for(Categorygroup cg : config.getCategorygroupCollection()) {
            
                // go through the categories
                org.opennms.netmgt.config.categories.Categories cats = cg.getCategories();
            
                for(org.opennms.netmgt.config.categories.Category cat : cats.getCategoryCollection()) {

                    if (log.isDebugEnabled()) {
                        log.debug("CATEGORY " + cat.getLabel());
                    }
                    catCount++;
                    populateDataStructures(cat, report, format, monthFormat, catCount);
                }
            }
            if (log.isDebugEnabled()) {
                log.debug("catCount " + catCount);
            }
        } else {
            org.opennms.netmgt.config.categories.Category cat = (org.opennms.netmgt.config.categories.Category) m_catFactory.getCategory(categoryName);
            if (log.isDebugEnabled()) {
                log.debug("CATEGORY - now populating data structures "
                        + cat.getLabel());
            }
            populateDataStructures(cat, report, format, monthFormat, 1);
        }

        SimpleDateFormat simplePeriod = new SimpleDateFormat("MMMMMMMMMMM dd, yyyy");
        String reportPeriod = simplePeriod.format(new java.util.Date(
                                                                     m_startTime))
                + " - " + simplePeriod.format(new java.util.Date(m_endTime));
        Created created = report.getCreated();
        if (created == null) {
            created = new Created();
        }
        created.setPeriod(reportPeriod);
        report.setCreated(created);

        if (log.isDebugEnabled()) {
            log.debug("After availCalculations");
        }
    }


    public void run(HashMap<String, Object> reportParms, DeliveryOptions deliveryOptions, String reportId) {
        
        Resource xsltResource;
        String inputFileName;
        String outputFileName;
        ReportRenderer renderer;
        
        inputFileName = runInternal(reportParms, reportId, deliveryOptions.getPersist());
        
        if ((inputFileName != null) && deliveryOptions.getSendMail()) {
 
            try {
                
                if (deliveryOptions.getMailFormat().equalsIgnoreCase(HTML_FORMAT)) {
                    renderer = new HTMLReportRenderer();
                    xsltResource =  new UrlResource(m_configDao.getHtmlStylesheetLocation(reportId));
                    outputFileName = HTML_OUTPUT_FILE_NAME;
                } else {
                    renderer = new PDFReportRenderer();
                    if (deliveryOptions.getMailFormat().equalsIgnoreCase(SVG_FORMAT)) {
                        xsltResource =  new UrlResource(m_configDao.getSvgStylesheetLocation(reportId));
                        outputFileName = SVG_OUTPUT_FILE_NAME;
             
                    } else {
                        xsltResource =  new UrlResource(m_configDao.getPdfStylesheetLocation(reportId));
                        outputFileName = PDF_OUTPUT_FILE_NAME;
                    }
                }
                String baseDir = System.getProperty("opennms.report.dir");
                log.debug("render base dir: " + baseDir);
                log.debug("render input file: " + inputFileName);
                log.debug("render output file: " + outputFileName);
                log.debug("render template: " + xsltResource);
                renderer.setBaseDir(baseDir);
                renderer.render(inputFileName, outputFileName, xsltResource);
                ReportMailer mailer = new ReportMailer(
                                                       deliveryOptions.getMailTo(),
                                                       baseDir + "/" + outputFileName);
                mailer.send();
                
            } catch (MalformedURLException e) {
                log.fatal("Malformed URL for xslt template");
            } catch (ReportRenderException e) {
                log.fatal("unable to render report");
            } catch (IOException e) {
                log.fatal("unable to mail report");
            }
        }


    }


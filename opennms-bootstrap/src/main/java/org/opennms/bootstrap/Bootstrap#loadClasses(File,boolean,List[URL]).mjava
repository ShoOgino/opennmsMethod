    /**
     * Add JARs found in dir to the LinkedList urls.
     *
     * @param dir
     *            Directory to search for JARs
     * @param recursive
     *            Whether to recurse into subdirectories of the directory in
     *            dir
     * @param urls
     *            LinkedList to append found JARs onto
     * @throws java.net.MalformedURLException if any.
     */
    public static void loadClasses(File dir, boolean recursive, List<URL> urls) throws MalformedURLException {
        try {
            // Attempt to resolve the canonical file for the given directory
            // and avoid loading any classes if the corresponding directory
            // is excluded
            final File canonicalDir = dir.getCanonicalFile();
            if (CLASSLOADER_DIRECTORY_EXCLUDES.contains(canonicalDir)) {
                if (DEBUG) {
                   System.err.println("Skipping excluded directory: " + canonicalDir);
                }
                return;
            }
        } catch (IOException e) {
            if (DEBUG) {
                System.err.printf("Failed to determine the canonical path for '%s'.\n", dir);
                e.printStackTrace();
            }
        }

        // Add the directory
        urls.add(dir.toURI().toURL());

        if (recursive) {
            // Descend into sub-directories
            File[] dirlist = dir.listFiles(m_dirFilter);
            if (dirlist != null) {
                Arrays.sort(dirlist);
                for (File childDir : dirlist) {
                    loadClasses(childDir, recursive, urls);
                }
            }
        }

        // Add individual JAR files
        File[] children = dir.listFiles(m_jarFilter);
        if (children != null) {
            Arrays.sort(children);
            for (File childFile : children) {
                urls.add(childFile.toURI().toURL());
            }
        }
    }


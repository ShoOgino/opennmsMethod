    /**
     * Load default properties from the specified OpenNMS home into the
     * system properties.
     *
     * @param opennmsHome the OpenNMS home directory
     * @throws IOException
     */
    protected static void loadSystemProperties(File opennmsHome) throws IOException {
        // Grab a copy of the set of existing system properties:
        //  The set will include $OPENNMS_HOME and the values set via the Java command line
        Map<String, String> systemProperties = System.getProperties().entrySet().stream()
                .collect(Collectors.toMap(
                   // Explicitly convert the property names and values to string
                    e -> e.getKey().toString(),
                    e -> e.getValue().toString()
                ));

        // Load the properties from all of the available properties files
        // Order matters here since value may be overwritten by files
        // that appear later in the list
        for (File propertiesFile : getPropertiesFiles(opennmsHome)) {
            try (
                    InputStream is = new FileInputStream(propertiesFile);
            ) {
                if (DEBUG) { System.err.println("Loading system properties from: " + propertiesFile.getAbsolutePath()); }
                Properties props = new Properties();
                props.load(is);
                for (Entry<Object, Object> entry : props.entrySet()) {
                    String key = entry.getKey().toString();
                    String value = entry.getValue().toString();

                    if (systemProperties.containsKey(key)) {
                        if (DEBUG) {
                            System.err.printf("Skipping system property entry '%s' with value '%s' found in '%s'. "
                                    + " The property was already set on the JVM command line.\n",
                                    key, value, propertiesFile.getAbsolutePath());
                        }
                        // Skip properties that were already set outside of the .properties files
                        continue;
                    }

                    if (DEBUG) {
                        System.err.printf("Setting system property '%s' to '%s' found in '%s'.\n",
                                key, value, propertiesFile.getAbsolutePath());
                    }
                    System.setProperty(key, value);
                }
            } catch (FileNotFoundException e) {
                // Skip missing files
                if (DEBUG) { System.err.println("Skipping: " + propertiesFile.getAbsolutePath()); }
            }
        }
    }


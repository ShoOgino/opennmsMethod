    protected static void executeClass(final String classToExec, final String classToExecMethod, final String[] classToExecArgs, boolean appendClasspath, final boolean recurse) throws ClassNotFoundException, NoSuchMethodException, IOException {
        String dir = System.getProperty("opennms.classpath");
        if (dir == null) {
            final String home = System.getProperty(OPENNMS_HOME_PROPERTY);
            dir = Paths.get(home, "lib", "endorsed").toString() + File.pathSeparator
                    + Paths.get(home, "classes").toString() + File.pathSeparator
                    + Paths.get(home, "lib").toString() + File.pathSeparator
                    + Paths.get(home, "etc").toString();
        }

        // Add the JDK tools.jar to the classpath so that we can use the Attach API
        final Path toolsJar = Paths.get(System.getProperty("java.home"), "..", "lib", "tools.jar").toAbsolutePath();
        if (toolsJar.toFile().exists()) {
            dir += File.pathSeparator + toolsJar.toString();
        }

        if (System.getProperty("org.opennms.protocols.icmp.interfaceJar") != null) {
        	dir += File.pathSeparator + System.getProperty("org.opennms.protocols.icmp.interfaceJar");
        }
        
        if (System.getProperty("org.opennms.rrd.interfaceJar") != null) {
        	dir += File.pathSeparator + System.getProperty("org.opennms.rrd.interfaceJar");
        }

        if (DEBUG) {
            System.err.println("dir = " + dir);
        }

        final ClassLoader cl = Bootstrap.loadClasses(dir, recurse, appendClasspath);

        writePid(cl);
        configureRMI(cl);

        if (classToExec != null) {
            final String className = classToExec;
            final Class<?>[] classes = new Class[] { classToExecArgs.getClass() };
            final Object[] methodArgs = new Object[] { classToExecArgs };
            Class<?> c = cl.loadClass(className);
            final Method method = c.getMethod(classToExecMethod, classes);

            Runnable execer = new Runnable() {
                @Override
                public void run() {
                    try {
                        method.invoke(null, methodArgs);
                    } catch (final Exception e) {
                        e.printStackTrace();
                        System.exit(1);
                    }
                }

            };
            Thread bootstrapper = new Thread(execer, "Main");
            bootstrapper.setContextClassLoader(cl);
            bootstrapper.start();
        }
    }


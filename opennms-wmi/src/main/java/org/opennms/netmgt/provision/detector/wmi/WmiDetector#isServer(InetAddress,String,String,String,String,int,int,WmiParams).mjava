    private WmiResult isServer(InetAddress host, String user, String pass,
            String domain, String matchType, int retries, int timeout,
            WmiParams params) {
        boolean isAServer = false;

        WmiResult result = null;
        for (int attempts = 0; attempts <= retries && !isAServer; attempts++) {
            WmiManager mgr = null;
            try {
                // Create the WMI Manager
                mgr = new WmiManager(host.getHostAddress(), user,
                        pass, domain, matchType);

                // Connect to the WMI server.
                mgr.init();

                // Perform the operation specified in the parameters.
                result = mgr.performOp(params);
                if(params.getWmiOperation().equals(WmiParams.WMI_OPERATION_WQL)) {
                    log().debug(
                        "WmiPlugin: "
                                + params.getWql()                               
                                + " : "
                                + WmiResult.convertStateToString(result
                                        .getResultCode()));
                } else {
                    log().debug(
                        "WmiPlugin: \\\\"
                                + params.getWmiClass()
                                + "\\"
                                + params.getWmiObject()
                                + " : "
                                + WmiResult.convertStateToString(result
                                        .getResultCode()));
                }

                isAServer = true;
            } catch (WmiException e) {
                StringBuffer message = new StringBuffer();
                message.append("WmiPlugin: Check failed... : ");
                message.append(e.getMessage());
                message.append(" : ");
                message.append((e.getCause() == null ? "" : e.getCause().getMessage()));
                log().info(message.toString());
                isAServer = false;
            } finally {
                if (mgr != null) {
                    try {
                        mgr.close();
                    } catch (WmiException e) {
                        log().warn("an error occurred closing the WMI Manager", e);
                    }
                }
            }
        }
        return result;
    }


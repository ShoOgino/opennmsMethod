	/**
	 * Test that the WMI manager properly handles invalid host exceptions
	 * from the WMI client.
	 * 
	 * Test method for {@link org.opennms.protocols.wmi.WmiManager#init()}.
     *
     * @throws WmiException if there is a problem with the mock object.
	 */
	public final void testInitBadHostname() throws WmiException {
		// Set up WMI mock client.
		// 1) Expect a call to connect() with a bad hostname.
		// 2) Throw a new WmiException indictating a bad hostname.
		m_WmiMock.connect("bad-hostname", "Administrator", "password", WmiParams.WMI_DEFAULT_NAMESPACE);
		expectLastCall()
				.andThrow(
						new WmiException(
								"Unknown host 'bad-hostname'. Failed to connect to WMI agent."));
		replay(m_WmiMock);

		try {
			// Create a manager.
			WmiManager wmiManager = new WmiManager("bad-hostname",
					"Administrator", "password");
			// Initialize
			wmiManager.init(m_WmiMock);

		} catch (WmiException e) {
			assertTrue("Exception missing message: Unknown host: " + e, e
					.getMessage().contains("Unknown host"));
		}
		verify(m_WmiMock);

		reset(m_WmiMock);
	}


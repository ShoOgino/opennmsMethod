  /** Process end element events. */
  public void endElement(int nameCode) throws TransformerException {
    int thisFingerprint   = namePool.getFingerprint(nameCode);
    boolean isLink = (thisFingerprint == htmlAFingerprint
		      || thisFingerprint == xhtmlAFingerprint);

    rtfEmitter.endElement(nameCode);
    elementStack.pop();

    if (isLink) {
      linkDepth--;
    }

    if (inSkip) {
      skipDepth--;
      inSkip = (skipDepth > 0);
      if (!inSkip) {
	// Reopen all the ones we closed before...
	while (!saveStack.empty()) {
	  StartElementInfo elem = (StartElementInfo) saveStack.pop();

	  AttributeCollection attr = (AttributeCollection)elem.getAttributes();
	  AttributeCollection newAttr = new AttributeCollection(namePool);

	  for (int acount = 0; acount < attr.getLength(); acount++) {
	    String localName = attr.getLocalName(acount);
	    String type = attr.getType(acount);
	    String value = attr.getValue(acount);
	    String uri = attr.getURI(acount);
	    String prefix = "";

	    if (localName.indexOf(':') > 0) {
	      prefix = localName.substring(0, localName.indexOf(':'));
	      localName = localName.substring(localName.indexOf(':')+1);
	    }

	    if (uri.equals("")
		&& ((foStylesheet
		     && localName.equals("id"))
		    || (!foStylesheet
			&& (localName.equals("id")
			    || localName.equals("name"))))) {
	      // skip this attribute
	    } else {
	      newAttr.addAttribute(prefix, uri, localName, type, value);
	    }
	  }

	  rtfEmitter.startElement(elem.getNameCode(),
				  newAttr,
				  elem.getNamespaces(),
				  elem.getNSCount());
	}
      }
    }
  }


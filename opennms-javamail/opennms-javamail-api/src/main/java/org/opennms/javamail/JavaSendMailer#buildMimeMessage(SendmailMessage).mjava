    /**
     * Builds the mime message.
     *
     * @param msg the sendmail message
     * @return the mime message
     */
    public MimeMessage buildMimeMessage(final SendmailMessage msg) {
        MimeMessage mimeMsg = new MimeMessage(m_session);
        if (m_config.getSendmailMessage().orElse(null) != msg) {
            m_config.setSendmailMessage(msg);
        }

        if (m_config.getSendmailMessage().isPresent()) {
            final SendmailMessage configMsg = m_config.getSendmailMessage().get();

            try {
                final String charset = m_config.getSendmailProtocol().isPresent()? m_config.getSendmailProtocol().get().getCharSet() : Charset.defaultCharset().name();
                final MimeMessageHelper helper = new MimeMessageHelper(mimeMsg, false, charset);
                helper.setFrom(configMsg.getFrom());
                helper.setTo(configMsg.getTo());
                helper.setSubject(configMsg.getSubject());
            } catch (final MessagingException e) {
                LOG.warn("found a problem building message: {}", e.getMessage());
            }
        } else {
            LOG.warn("Missing sendmail message configuration. This MIME message will probably be wrong.");
        }

        return mimeMsg;
    }


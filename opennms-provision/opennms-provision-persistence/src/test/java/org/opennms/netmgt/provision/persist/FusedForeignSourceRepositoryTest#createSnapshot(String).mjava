    protected URL createSnapshot(final String foreignSource) throws MalformedURLException {
        System.err.println("--- creating snapshot for " + foreignSource + " ---");
        Requisition pending = m_pending.getRequisition(foreignSource);
        Requisition deployed = m_active.getRequisition(foreignSource);

        final Date deployedDate = deployed == null? null : deployed.getDate();
        final Date pendingDate  = pending  == null? null : pending.getDate();
        
        if (deployedDate == null) return RequisitionFileUtils.createSnapshot(m_pending, foreignSource, pending.getDate()).toURI().toURL();
        if (pendingDate  == null) return m_active.getRequisitionURL(foreignSource);

        final URL url;
        if (deployedDate.before(pendingDate)) {
            url = RequisitionFileUtils.createSnapshot(m_pending, foreignSource, pendingDate).toURI().toURL();
        } else {
            url = m_active.getRequisitionURL(foreignSource);
        }

        System.err.println("deployedDate = " + deployedDate);
        System.err.println("pendingDate  = " + pendingDate);
        System.err.println("url          = " + url);

        return url;
    }


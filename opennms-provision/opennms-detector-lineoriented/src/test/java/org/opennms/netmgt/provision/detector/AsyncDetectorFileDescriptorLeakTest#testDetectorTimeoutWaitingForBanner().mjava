    @Test
    public void testDetectorTimeoutWaitingForBanner() throws Throwable {
        // Start a socket that doesn't have a thread servicing it
        setUpSocket();
        final int port = m_socket.getLocalPort();
        final InetAddress address = m_socket.getInetAddress();

        AsyncServiceDetector detector = getNewDetector(port, "Hello");

        assertNotNull(detector);

        final DetectFuture future = (DetectFuture)detector.isServiceDetected(address);

        assertNotNull(future);
        future.awaitFor();
        if (future.getException() != null) {
            LogUtils.debugf(this, future.getException(), "got future exception");
            throw future.getException();
        }
        assertFalse("False positive during detection!!", future.isServiceDetected());
        assertNull(future.getException());
    }


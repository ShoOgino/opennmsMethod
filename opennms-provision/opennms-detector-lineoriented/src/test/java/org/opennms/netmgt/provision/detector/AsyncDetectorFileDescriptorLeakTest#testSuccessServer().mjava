    @Test
    public void testSuccessServer() throws Throwable {
        setUpServer();
        final int port = m_server.getLocalPort();
        final InetAddress address = m_server.getInetAddress();

        final double connectionRate = 0.2;
        
        final long startTime = System.currentTimeMillis();

        int i = 0;
        while (i < 10000) {
            long now = Math.max(System.currentTimeMillis(), 1);
            double actualRate = ((double)i) / ((double)(now - startTime));
            LogUtils.debugf(this, "Expected Rate: %f Actual Rate: %f Events Sent: %d", connectionRate, actualRate, i);
            if (actualRate < connectionRate) {
                setUp();
                LogUtils.debugf(this, "current loop: %d", i);
                assertNotNull(m_detector);

                m_detector.setPort(port);

                final DetectFuture future = (DefaultDetectFuture)m_detector.isServiceDetected(address, new NullDetectorMonitor());

                future.awaitForUninterruptibly();
                assertNotNull(future);
                if (future.getException() != null) {
                    LogUtils.debugf(this, future.getException(), "got future exception");
                    throw future.getException();
                }
                assertTrue(future.isServiceDetected());

                i++;
            } else {
                Thread.sleep(5);
            }
        }
    }


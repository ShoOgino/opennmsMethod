    public boolean isValid() {
        if (httpResponse == null || expectedRange == null) {
            return false;
        }

        Integer statusCode = httpResponse.getStatusLine().getStatusCode();
        log().debug("HTTP response status code: " + statusCode);
        boolean retval = inRange(expectedRange, statusCode);

        if (expectedText != null) {
            try {
                String responseText = EntityUtils.toString(httpResponse.getEntity());
                log().debug("HTTP response text: " + responseText);
                log().debug("HTTP checking if output matches " + expectedText);
                if (expectedText.charAt(0) == '~') {
                    final Pattern p = Pattern.compile(expectedText.substring(1), Pattern.MULTILINE);
                    final Matcher m = p.matcher(responseText);
                    retval = m.find();
                } else {
                    retval = responseText.equals(expectedText);
                }
            } catch (Exception e) {
                log().info(e.getMessage(), e);
                retval = false;
            }
        }

        log().debug("HTTP detected ? " + retval);
        return retval;
    }


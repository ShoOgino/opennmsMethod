    @Test(timeout=300000)
    public void testProvisionServiceGetScheduleForNodesUponDelete() throws Exception {
        importFromResource("classpath:/tec_dump.xml.smalltest", Boolean.TRUE.toString());
        getScanExecutor().pause();

        m_provisioner.scheduleRescanForExistingNodes();
        List<NodeScanSchedule> schedulesForNode = m_provisionService.getScheduleForNodes();

        assertEquals(10, schedulesForNode.size());

        getScanExecutor().resume();
        importFromResource("classpath:/tec_dump.xml.smalltest.delete", Boolean.TRUE.toString());
        getScanExecutor().pause();

        m_provisioner.scheduleRescanForExistingNodes();
        schedulesForNode = m_provisionService.getScheduleForNodes();

        assertEquals(9, schedulesForNode.size());
        assertEquals(9, m_provisioner.getScheduleLength());

        // Check that re-scheduling won't trigger duplicate scheduling for a given node.
        getScanExecutor().resume();
        m_provisioner.addToScheduleQueue(schedulesForNode.get(0));
        m_provisioner.scheduleRescanForExistingNodes();
        schedulesForNode = m_provisionService.getScheduleForNodes();

        assertEquals(9, schedulesForNode.size());
        assertEquals(9, m_provisioner.getScheduleLength());
    }


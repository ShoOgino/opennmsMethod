    @Test(timeout=300000)
    public void testRequisitionedCategoriesWithPolicies() throws Exception {
        final int nextNodeId = m_nodeDao.getNextNodeId();

        final ForeignSource fs = m_foreignSourceRepository.getForeignSource("empty");
        final PluginConfig policy = new PluginConfig("addDumbCategory", NodeCategorySettingPolicy.class.getName());
        policy.addParameter("category", "Dumb");
        policy.addParameter("label", "test");
        fs.addPolicy(policy);
        m_foreignSourceRepository.save(fs);

        importFromResource("classpath:/provisioner-testCategories-oneCategory.xml", true);

        // after import, we should have 1 category, because policies haven't been applied yet
        OnmsNode n = getNodeDao().get(nextNodeId);
        assertEquals(1, n.getCategories().size());
        assertEquals("TotallyMadeUpCategoryName", n.getCategories().iterator().next().getName());
        assertEquals(0, n.getRequisitionedCategories().size());

        final NodeScan scan = m_provisioner.createNodeScan(nextNodeId, "empty", "1");
        runScan(scan);

        // when the scan has completed, both categories should have been applied
        n = getNodeDao().get(nextNodeId);

        assertEquals(2, n.getCategories().size());
        assertTrue(n.hasCategory("TotallyMadeUpCategoryName"));
        assertTrue(n.hasCategory("Dumb"));
    }


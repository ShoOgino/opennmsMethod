    @Test(timeout=300000)
    @JUnitTemporaryDatabase // Relies on records created in @Before so we need a fresh database
    public void testImportWithNodeCategoryEvents() throws Exception {
        final int nextNodeId = m_nodeDao.getNextNodeId();

        final MockNetwork network = new MockNetwork();
        final MockNode node = network.addNode(nextNodeId, "test");
        network.addInterface("172.16.1.1");
        network.addService("ICMP");
        anticipateCreationEvents(node);
        m_eventAnticipator.anticipateEvent(getNodeCategoryEvent(nextNodeId, "test"));
        m_eventAnticipator.anticipateEvent(new EventBuilder(EventConstants.NODE_UPDATED_EVENT_UEI, "Test").setNodeid(nextNodeId).getEvent());

        // we should not get category update events on a re-import now, that happens during the scan phase
        //m_eventAnticipator.anticipateEvent(getNodeCategoryEvent(nextNodeId, "test"));
        importFromResource("classpath:/requisition_with_node_categories.xml", Boolean.TRUE.toString());
        importFromResource("classpath:/requisition_with_node_categories_changed.xml", Boolean.TRUE.toString());

        m_eventAnticipator.verifyAnticipated();
    }


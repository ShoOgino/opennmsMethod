    /**
     * Test for NMS-7636
     */
    @Test(timeout=300000)
    public void resourcesAreNotDeletedWhenNodeScanIsAborted() throws InterruptedException, ExecutionException, UnknownHostException {
        // Setup a node with a single interface and service
        NetworkBuilder builder = new NetworkBuilder();
        builder.addNode("node1");

        builder.addInterface("192.168.0.1")
            .getInterface()
            // Pretend this was discovered an hour ago
            .setIpLastCapsdPoll(new Date(new Date().getTime() - 60*60*1000));

        builder.addService(new OnmsServiceType());

        OnmsNode node = builder.getCurrentNode();
        getNodeDao().save(node);

        // Preliminary check
        assertEquals(1, node.getIpInterfaces().size());

        // Issue a scan without setting up the requisition
        // Expect a nodeScanAborted event
        m_eventAnticipator.anticipateEvent(nodeScanAborted(node.getId()));
        m_eventAnticipator.setDiscardUnanticipated(true);

        final NodeScan scan = m_provisioner.createNodeScan(node.getId(), "should_not_exist", "1");
        runScan(scan);

        m_eventAnticipator.verifyAnticipated();
        m_eventAnticipator.reset();

        // The interface should remain
        assertEquals(1, node.getIpInterfaces().size());
    }


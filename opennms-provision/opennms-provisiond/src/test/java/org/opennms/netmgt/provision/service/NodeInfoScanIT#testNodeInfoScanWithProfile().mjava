    @Test(timeout = 60000)
    public void testNodeInfoScanWithProfile() throws InterruptedException {
        try (InputStream configStream = getClass().getResource("/snmp-config1.xml").openStream()) {
            // Make default scan fail by setting wrong read community.
            snmpPeerFactory = new ProxySnmpAgentConfigFactoryExtension(configStream);
            provisionService = Mockito.mock(ProvisionService.class);
            FilterDao filterDao = Mockito.mock(FilterDao.class);
            when(filterDao.isValid(Mockito.anyString(), Mockito.contains("IPLIKE"))).thenReturn(true);
            SnmpProfileMapper profileMapper = new SnmpProfileMapperImpl(filterDao, snmpPeerFactory, locationAwareSnmpClient);
            when(provisionService.getSnmpProfileMapper()).thenReturn(profileMapper);
            when(provisionService.getLocationAwareSnmpClient()).thenReturn(locationAwareSnmpClient);
            nodeInfoScan = new NodeInfoScan(node, InetAddressUtils.getInetAddress("192.0.1.206"),
                    "fs", monitoringLocation, scanProgress, snmpPeerFactory, provisionService, 1);
            TaskCoordinator taskCoordinator = new DefaultTaskCoordinator("TaskTest");
            BatchTask batchTask = new BatchTask(taskCoordinator, null);
            nodeInfoScan.run(batchTask);
            batchTask.schedule();
            await().atMost(30, TimeUnit.SECONDS).until(node::getSysObjectId, is(".1.3.6.1.4.1.8072.3.2.255"));
        } catch (IOException e) {
            fail();
        }
    }


    public List<NodeScanSchedule> getScheduleForNodes() {
        List<OnmsNode> nodes = m_nodeDao.findAll();
        List<NodeScanSchedule> scheduledNodes = new ArrayList<NodeScanSchedule>();
        
        long now = System.currentTimeMillis();
        for(OnmsNode node : nodes) {
            OnmsForeignSource fs = m_foreignSourceRepository.get(node.getForeignSource());
            
            long lastPoll = (node.getLastCapsdPoll() == null ? 0 : node.getLastCapsdPoll().getTime());
            long nextPoll = lastPoll + fs.getScanInterval();
            long initialDelay = Math.max(0, nextPoll - now);
            
            NodeScanSchedule nSchedule = new NodeScanSchedule();
            nSchedule.setForeignSource(node.getForeignSource());
            nSchedule.setInitialDelay(initialDelay);
            nSchedule.setNodeId(node.getId());
            nSchedule.setScanInterval(fs == null ? 1000 : fs.getScanInterval());
            
            scheduledNodes.add(nSchedule);
        }
        
        return scheduledNodes;
    }


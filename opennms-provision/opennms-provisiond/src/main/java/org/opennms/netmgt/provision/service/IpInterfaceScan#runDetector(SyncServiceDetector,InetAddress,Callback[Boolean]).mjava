    protected static Runnable runDetector(final SyncServiceDetector detector, final InetAddress address, final Callback<Boolean> cb) {
        return new Runnable() {
            @Override
            public void run() {
                try {
                    LOG.info("Attemping to detect service {} on address {}", detector.getServiceName(), str(address));
                    cb.accept(detector.isServiceDetected(address));
                } catch (final Throwable t) {
                    cb.handleException(t);
                } finally {
                    detector.dispose();
                }
            }

            @Override
            public String toString() {
                return String.format("Run detector %s on address %s", detector.getServiceName(), str(address));
            }

        };
    }


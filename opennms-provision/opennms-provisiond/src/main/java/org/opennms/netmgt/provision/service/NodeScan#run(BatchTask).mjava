    /** {@inheritDoc} */
    @Override
    public void run(final BatchTask parent) {
        LOG.info("Scanning node {}/{}/{}", m_nodeId, m_foreignSource, m_foreignId);
        if (m_parentSpan != null) {
            m_span = getProvisionService().buildAndStartSpan("NodeScan", m_parentSpan.context());
        } else {
            m_span = getProvisionService().buildAndStartSpan("ScheduledScan", null);
        }
        if (m_nodeId != null && m_nodeId > 0) {
            m_span.setTag(NODE_ID, m_nodeId);
            m_span.setTag(LOCATION, getLocationName());
        }
        parent.getBuilder().addSequence(
                                        new RunInBatch() {
                                            @Override
                                            public void run(final BatchTask phase) {
                                                Span span = getProvisionService().buildAndStartSpan("LoadNode", m_span.context());
                                                loadNode(phase);
                                                span.finish();
                                            }
                                        },
                                        new RunInBatch() {
                                            @Override
                                            public void run(final BatchTask phase) {
                                                Span span = getProvisionService().buildAndStartSpan("DetectAgents", m_span.context());
                                                detectAgents(phase);
                                                span.finish();
                                            }
                                        },
                                        new RunInBatch() {
                                            @Override
                                            public void run(final BatchTask phase) {
                                                Span span = getProvisionService().buildAndStartSpan("HandleAgentUndetected", m_span.context());
                                                handleAgentUndetected(phase);
                                                span.finish();
                                            }
                                        },
                                        new RunInBatch() {
                                            @Override
                                            public void run(final BatchTask phase) {
                                                Span span = getProvisionService().buildAndStartSpan("ApplyNodePolicies", m_span.context());
                                                applyNodePolicies(phase);
                                                span.finish();
                                            }
                                        },
                                        new RunInBatch() {
                                            @Override
                                            public void run(final BatchTask phase) {
                                                Span span = getProvisionService().buildAndStartSpan("ScanCompletedEvent", m_span.context());
                                                scanCompleted(phase);
                                                span.finish();
                                                m_span.finish();
                                            }
                                        }
                );



    }


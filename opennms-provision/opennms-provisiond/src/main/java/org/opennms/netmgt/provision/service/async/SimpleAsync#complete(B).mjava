    private void complete(B b) throws Exception {
        //debugf("Setting result for %s to %s", this, b);
        
        // set this first so its available to addCallback
        // when it tries to add a callback to a completed task
        m_result.set(b);

        /* This is the tricky part.. we set this to complete
         * to signal to addCallback that we're already done so
         * it can call the callback directly.  We do this atomically
         * so no locks are needed
         */ 
        Action<B> cb = m_callback.getAndSet(COMPLETE);
        
        // now we can set this but we don't really use it
        m_complete.set(true);
        
        // ok to call the callbacks
        cb.action(b);
    }


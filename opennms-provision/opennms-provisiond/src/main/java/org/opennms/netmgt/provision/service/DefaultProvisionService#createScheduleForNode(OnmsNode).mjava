    private NodeScanSchedule createScheduleForNode(OnmsNode node) {
        Assert.notNull(node, "Node may not be null");
        long now = System.currentTimeMillis();

        OnmsForeignSource fs = null;
        try {
            fs = m_foreignSourceRepository.getForeignSource(node.getForeignSource());
        } catch (ForeignSourceRepositoryException e) {
            log().warn("unable to get foreign source repository", e);
        }

        long scanInterval = fs == null ? 86400000 : fs.getScanInterval();
        
        long lastPoll = (node.getLastCapsdPoll() == null ? 0 : node.getLastCapsdPoll().getTime());
        long nextPoll = lastPoll + scanInterval;
        long initialDelay = Math.max(0, nextPoll - now);
        
        NodeScanSchedule nSchedule = new NodeScanSchedule();
        nSchedule.setForeignSource(node.getForeignSource());
        nSchedule.setInitialDelay(initialDelay);
        nSchedule.setNodeId(node.getId()); 
        nSchedule.setScanInterval(scanInterval);
        
        return nSchedule;
    }


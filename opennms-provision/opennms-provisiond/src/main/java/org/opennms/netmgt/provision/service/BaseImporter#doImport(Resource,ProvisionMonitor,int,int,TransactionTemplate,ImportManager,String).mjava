    private void doImport(Resource resource, ProvisionMonitor monitor,
            int scanThreads, int writeThreads,
            TransactionTemplate transTemplate, ImportManager importManager,
            String foreignSource) throws ModelImportException, IOException {
        
        importManager.getClass();
        monitor.beginImporting();
    	monitor.beginLoadingResource(resource);
    	
        SpecFile specFile = new SpecFile();
        specFile.loadResource(resource);
        
        monitor.finishLoadingResource(resource);
        
        
        if (foreignSource != null) {
            specFile.setForeignSource(foreignSource);
        }
        
        monitor.beginAuditNodes();
        createDistPollerIfNecessary();
        
        Map<String, Integer> foreignIdsToNodes = getForeignIdToNodeMap(specFile.getForeignSource());
        
        ImportOperationsManager opsMgr = createImportOperationsManager(foreignIdsToNodes, monitor);
        opsMgr.setForeignSource(specFile.getForeignSource());
        opsMgr.setScanThreads(scanThreads);
        opsMgr.setWriteThreads(writeThreads);
        
        auditNodes(opsMgr, specFile);
        
        monitor.finishAuditNodes();
        
        opsMgr.persistOperations();
        
        monitor.beginRelateNodes();
        
        relateNodes(specFile);
        
        monitor.finishRelateNodes();
    
        monitor.finishImporting();
    }


    private OnmsNode saveOrUpdate(OnmsNode node) {
        

        Set<OnmsCategory> updatedCategories = new HashSet<OnmsCategory>();
        for(Iterator<OnmsCategory> it = node.getCategories().iterator(); it.hasNext(); ) {
            OnmsCategory category = it.next();
            if (category.getId() == null) {
                it.remove();
                
                OnmsCategory newCategory = createCategoryIfNecessary(category.getName());
                updatedCategories.add(newCategory);
            }
        }
        
        node.getCategories().addAll(updatedCategories);
        
        m_nodeDao.saveOrUpdate(node);
        
        return node;
        
    }


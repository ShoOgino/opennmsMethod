    /**
     * Sets up the test (initialize a trap listener).
     *
     * @throws Exception the exception
     */
    @Before
    public void setUp() throws Exception {
        MockLogAppender.setupLogging();
        resetTrapsReceived();
        System.setProperty("opennms.home", "src/test/resources");
        SnmpPeerFactory.init();
        Assert.assertEquals("Snmp4JStrategy", SnmpUtils.getStrategy().getClass().getSimpleName());

        SnmpAgentConfig config = SnmpPeerFactory.getInstance().getAgentConfig(TRAP_DESTINATION);
        SnmpV3User user = new SnmpV3User(config.getSecurityName(), config.getAuthProtocol(), config.getAuthPassPhrase(), config.getPrivProtocol(), config.getPrivPassPhrase());
        SnmpUtils.registerForTraps(this, new NullTrapProcessorFactory(), TRAP_DESTINATION, TRAP_PORT, Collections.singletonList(user));
        LOG.info("Registered Trap Listener for {} on port {}", TRAP_DESTINATION, TRAP_PORT);
    }


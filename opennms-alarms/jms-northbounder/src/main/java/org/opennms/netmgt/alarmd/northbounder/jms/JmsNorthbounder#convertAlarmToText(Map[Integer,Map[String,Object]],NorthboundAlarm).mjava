    private String convertAlarmToText(
            Map<Integer, Map<String, Object>> alarmMappings,
            NorthboundAlarm alarm) {

        String alarmXml = null;
        Map<String, Object> mapping = null;
        if (alarmMappings != null) {
            mapping = alarmMappings.get(alarm.getId());
        }

        if (mapping == null) {
            mapping = createMapping(alarmMappings, alarm);
        }

        LOG.debug("Making substitutions for tokens in message format for alarm: {}.",
                  alarm.getId());
        if (m_jmsDestination.getMessageFormat() != null) {
            alarmXml = PropertiesUtils.substitute(m_jmsDestination.getMessageFormat(),
                                                  mapping);
        } else {
            alarmXml = PropertiesUtils.substitute(m_config.getMessageFormat(),
                                                  mapping);
        }
        return alarmXml;
    }


    /**
     * Test alarm forwarding with nagles.
     *
     * @throws InterruptedException the interrupted exception
     */
    @Test
    public void testAlarmForwardingWithNagles() throws InterruptedException {
        TestNorthbounder tnb = new TestNorthbounder();
        tnb.setAccepting(true);

        tnb.setNaglesDelay(500);
        tnb.start();

        NorthboundAlarm a1 = createNorthboundAlarm(1);
        NorthboundAlarm a2 = createNorthboundAlarm(2);
        NorthboundAlarm a3 = createNorthboundAlarm(3);

        tnb.onAlarm(a1);
        Thread.sleep(100);
        tnb.onAlarm(a2);
        Thread.sleep(100);
        tnb.onAlarm(a3);

        tnb.waitForAcceptsToBeCalled(2000);
        tnb.waitForForwardToBeCalled(2000);

        assertNotNull(tnb.getAlarms());

        assertEquals(3, tnb.getAlarms().size());

        assertTrue(tnb.getAlarms().contains(a1));
        assertTrue(tnb.getAlarms().contains(a2));
        assertTrue(tnb.getAlarms().contains(a3));
    }


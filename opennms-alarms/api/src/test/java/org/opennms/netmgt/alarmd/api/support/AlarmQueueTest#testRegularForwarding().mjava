    @Test
    public void testRegularForwarding() throws InterruptedException {
        AlarmQueue queue = new AlarmQueue();
        queue.setMaxBatchSize(3);
        queue.init();
    
        queue.accept(createAlarm());
        queue.preserve(createAlarm());
        queue.accept(createAlarm());
        
        List<Alarm> alarms = queue.getAlarmsToForward();
        assertNotNull(alarms);
        assertEquals(3, alarms.size());
        
        queue.forwardSuccessful(alarms);
        
        queue.preserve(createAlarm());
        queue.accept(createAlarm());
        queue.preserve(createAlarm());
        queue.accept(createAlarm());
        
        alarms = queue.getAlarmsToForward();
        assertNotNull(alarms);
        assertEquals(3, alarms.size());
        
        queue.forwardSuccessful(alarms);
        
        alarms = queue.getAlarmsToForward();
        assertNotNull(alarms);
        assertEquals(1, alarms.size());
        
        queue.forwardSuccessful(alarms);

        
    }


    private OnmsAcknowledgment getLatestAcknowledgement(OnmsAlarm alarm) {
        final CriteriaBuilder builder = new CriteriaBuilder(OnmsAcknowledgment.class)
                .eq("refId", alarm.getId())
                .limit(1)
                .orderBy("ackTime").desc()
                .orderBy("id").desc();
        List<OnmsAcknowledgment> acks = acknowledgmentDao.findMatching(builder.toCriteria());
        if (acks.isEmpty()) {
            // For the purpose of making rule writing easier, we fake an
            // Un-Acknowledgment for Alarms that have never been Acknowledged.
            OnmsAcknowledgment ack = new OnmsAcknowledgment(alarm, DefaultAlarmService.DEFAULT_USER, alarm.getFirstEventTime());
            ack.setAckAction(AckAction.UNACKNOWLEDGE);
            ack.setId(0);
            return ack;
        } else {
            return acks.get(0);
        }
    }


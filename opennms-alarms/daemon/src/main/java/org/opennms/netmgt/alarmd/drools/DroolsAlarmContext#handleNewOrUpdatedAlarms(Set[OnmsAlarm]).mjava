    private void handleNewOrUpdatedAlarms(Set<OnmsAlarm> alarms) {
        if (alarms.isEmpty()) {
            return;
        }

        Map<Integer, OnmsAcknowledgment> acksByRefId = fetchAcks(alarms);

        for (OnmsAlarm alarm : alarms) {
            handleNewOrUpdatedAlarmNoLock(alarm);
            handleAlarmAcknowledgements(alarm, acksByRefId.get(alarm.getId()));
        }
    }


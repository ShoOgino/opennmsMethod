    public ScenarioResults run(Scenario scenario) {
        // Run the test
        final JUnitCore jUnitCore = new JUnitCore();
        final JUnitScenarioRunner runner;
        try {
            runner = new JUnitScenarioRunner(AlarmdDriver.class, scenario);
        } catch (InitializationError initializationError) {
            throw new IllegalStateException(initializationError);
        }

        final Result junitResult = jUnitCore.run(runner);
        if(!junitResult.wasSuccessful()) {
            throw new RuntimeException("Playback failed:" + junitResult.getFailures());
        }

        final ScenarioResults results = runner.getResults();
        if (results == null) {
            throw new IllegalStateException("Results not set");
        }

        return results;
    }


    @Test
    public void canIssueDeleteCallbacks() throws Exception {
        // Send a nodeDown
        sendNodeDownEvent(1);
        await().until(getNodeDownAlarmFor(1), hasSeverity(OnmsSeverity.MAJOR));

        // Send a nodeUp
        sendNodeUpEvent(1);
        await().until(getNodeDownAlarmFor(1), hasSeverity(OnmsSeverity.CLEARED));

        // Wait for the clear to be flushed to the database
        int alarmId = getNodeDownAlarmFor(1).call().getId();
        await().until(() -> m_alarmDao.get(alarmId), hasSeverity(OnmsSeverity.CLEARED));

        // We need to wait for the cleanUp automation which triggers when:
        //  'lastautomationtime' and 'lasteventtime' < "5 minutes ago"
        // so we cheat a little and update the timestamps ourselves instead of waiting
        transactionTemplate.execute(status -> {
            OnmsAlarm alarm = m_alarmDao.get(alarmId);
            LocalDateTime tenMinutesAgo = LocalDateTime.now().minusMinutes(10);
            Date then = Date.from(tenMinutesAgo.toInstant(ZoneOffset.UTC));
            alarm.setLastAutomationTime(then);
            alarm.setLastEventTime(then);
            alarm.setLastEvent(null);
            m_alarmDao.save(alarm);
            m_alarmDao.flush();
            return null;
        });

        await().until(getNodeDownAlarmFor(1), nullValue());
    }


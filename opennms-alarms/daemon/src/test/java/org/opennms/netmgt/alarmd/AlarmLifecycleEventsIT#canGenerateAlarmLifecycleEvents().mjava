    @Test
    public void canGenerateAlarmLifecycleEvents() {
        // Expect an alarmCreated event
        m_anticipator.resetAnticipated();
        m_anticipator.anticipateEvent(new EventBuilder(EventConstants.ALARM_CREATED_UEI, "alarmd").getEvent());
        m_anticipator.setDiscardUnanticipated(true);

        // Send a nodeDown
        sendNodeDownEvent(1);

        // Wait until we've received the alarmCreated event
        await().until(allAnticipatedEventsWereReceived());

        // Expect an alarmUpdatedWithReducedEvent event
        m_anticipator.resetAnticipated();
        m_anticipator.anticipateEvent(new EventBuilder(EventConstants.ALARM_UPDATED_WITH_REDUCED_EVENT_UEI, "alarmd").getEvent());
        m_anticipator.setDiscardUnanticipated(true);

        // Send another nodeDown
        sendNodeDownEvent(1);
        
        // Wait until we've received the alarmUpdatedWithReducedEvent event
        await().until(allAnticipatedEventsWereReceived());

        // Expect an alarmCreated and a alarmCleared event
        m_anticipator.resetAnticipated();
        m_anticipator.anticipateEvent(new EventBuilder(EventConstants.ALARM_CREATED_UEI, "alarmd").getEvent());
        m_anticipator.anticipateEvent(new EventBuilder(EventConstants.ALARM_CLEARED_UEI, "alarmd").getEvent());
        m_anticipator.setDiscardUnanticipated(true);

        // Send a nodeUp
        sendNodeUpEvent(1);

        // Wait until we've received the alarmCreated and alarmCleared events
        // We need to wait for the cosmicClear automation, which currently runs every 30 seconds
        await().atMost(1, MINUTES).until(allAnticipatedEventsWereReceived());

        // Expect an alarmUncleared event
        m_anticipator.resetAnticipated();
        m_anticipator.anticipateEvent(new EventBuilder(EventConstants.ALARM_UNCLEARED_UEI, "alarmd").getEvent());
        m_anticipator.setDiscardUnanticipated(true);

        // Send another nodeDown
        sendNodeDownEvent(1);

        // Wait until we've received the alarmUncleared event
        // We need to wait for the unclear automation, which currently runs every 30 seconds
        await().atMost(1, MINUTES).until(allAnticipatedEventsWereReceived());
    }


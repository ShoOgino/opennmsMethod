    /**
     * Verifies the basic life-cycle of a trigger, followed by a clear.
     *
     * Indirectly verifies the cosmicClear and fullCleanUp automations.
     */
    @Test
    public void canTriggerAcknowledgeAndClearAlarm() {
        Scenario scenario = Scenario.builder()
                .withLegacyAlarmBehavior()
                .withNodeDownEvent(1, 1)
                .withAcknowledgmentForNodeDownAlarm(2, 1)
                .withNodeUpEvent(3, 1)
                .build();
        ScenarioResults results = scenario.play();

        // Verify the set of alarms at various points in time

        // t=0, no alarms
        assertThat(results.getAlarms(0), hasSize(0));
        // t=1, a single problem alarm that is not yet acknowledged
        assertThat(results.getAlarms(1), hasSize(1));
        assertThat(results.getProblemAlarm(1), hasSeverity(OnmsSeverity.MAJOR));
        assertThat(results.getProblemAlarm(1), not(acknowledged()));
        // t=2, a single problem alarm that is acknowledged
        assertThat(results.getAlarms(2), hasSize(1));
        assertThat(results.getProblemAlarm(2), hasSeverity(OnmsSeverity.MAJOR));
        assertThat(results.getProblemAlarm(2), acknowledged());
        // t=3, a (acknowledged & cleared) problem and a resolution
        assertThat(results.getAlarms(3), hasSize(2));
        assertThat(results.getProblemAlarm(3), hasSeverity(OnmsSeverity.CLEARED));
        assertThat(results.getProblemAlarm(3), acknowledged());
        assertThat(results.getResolutionAlarm(3), hasSeverity(OnmsSeverity.NORMAL));
        // t=âˆž
        assertThat(results.getAlarmsAtLastKnownTime(), hasSize(0));

        // Now verify the state changes for the particular alarms

        // the problem
        List<State> problemStates = results.getStateChangesForAlarmWithId(results.getProblemAlarm(1).getId());
        assertThat(problemStates, hasSize(4)); // major, major+acked, cleared+acked, deleted
        // state 0 at t=1
        assertThat(problemStates.get(0).getTime(), equalTo(1L));
        assertThat(problemStates.get(0).getAlarm(), hasSeverity(OnmsSeverity.MAJOR));
        // state 1 at t=2
        assertThat(problemStates.get(1).getTime(), equalTo(2L));
        assertThat(problemStates.get(1).getAlarm(), hasSeverity(OnmsSeverity.MAJOR));
        assertThat(problemStates.get(1).getAlarm(), acknowledged());
        // state 2 at t=3
        assertThat(problemStates.get(2).getTime(), equalTo(3L));
        assertThat(problemStates.get(2).getAlarm(), hasSeverity(OnmsSeverity.CLEARED));
        assertThat(problemStates.get(2).getAlarm(), acknowledged());
        // state 3 at t in [23h,25h]
        assertThat(problemStates.get(3).getTime(), greaterThanOrEqualTo(TimeUnit.HOURS.toMillis(23)));
        assertThat(problemStates.get(3).getTime(), lessThan(TimeUnit.HOURS.toMillis(25)));
        assertThat(problemStates.get(3).getAlarm(), nullValue()); // DELETED
    }


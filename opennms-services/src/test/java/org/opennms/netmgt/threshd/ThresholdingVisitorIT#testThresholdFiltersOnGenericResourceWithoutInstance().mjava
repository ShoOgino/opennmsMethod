    /**
     * Verifies that we are able to generate thresholds for CollectionSets
     * using GenericTypeResourceWithoutInstance resources.
     *
     * These are commonly used by the WS-Man collector, where data is returned
     * in a tabular format and the resource name is set using
     * the SiblingColumnStorageStrategy.
     *
     */
    @Test
    public void testThresholdFiltersOnGenericResourceWithoutInstance() throws Exception {
        initFactories("/threshd-configuration.xml", "/test-thresholds-wsman.xml");
        ThresholdingVisitor visitor = createVisitor();

        SnmpCollectionAgent agent = createCollectionAgent();
        NodeLevelResource nodeResource = new NodeLevelResource(agent.getNodeId());

        org.opennms.netmgt.config.datacollection.ResourceType wmiLogicalDisk = createWmiLogicalDiskResourceType();
        // A resource for each drive
        GenericTypeResource volume16 = new GenericTypeResource(nodeResource, wmiLogicalDisk, "0");
        GenericTypeResource iDrive = new GenericTypeResource(nodeResource, wmiLogicalDisk, "1");

        // Create the entries in strings.properties
        ResourcePath path = ResourcePath.get("snmp", "1", "wmiLogicalDisk", "HarddiskVolume16");
        m_resourceStorageDao.setStringAttribute(path, "wmiLDName", "HarddiskVolume16");
        path = ResourcePath.get("snmp", "1", "wmiLogicalDisk", "I");
        m_resourceStorageDao.setStringAttribute(path, "wmiLDName", "I");

        // Build a collection set containing attributes for both resources
        CollectionSet collectionSet = new CollectionSetBuilder(agent)
                .withStringAttribute(volume16, "windows-os-wmi-LogicalDisk", "wmiLDName", "HarddiskVolume16")
                .withNumericAttribute(volume16, "windows-os-wmi-LogicalDisk", "wmiLDPctFreeMBytes", 1.0, AttributeType.GAUGE)
                .withNumericAttribute(volume16, "windows-os-wmi-LogicalDisk", "wmiLDPctFreeSpace", 10, AttributeType.GAUGE)
                .withStringAttribute(iDrive, "windows-os-wmi-LogicalDisk", "wmiLDName", "I")
                .withNumericAttribute(iDrive, "windows-os-wmi-LogicalDisk", "wmiLDPctFreeMBytes", 2668498.0, AttributeType.GAUGE)
                .withNumericAttribute(iDrive, "windows-os-wmi-LogicalDisk", "wmiLDPctFreeSpace", 10, AttributeType.GAUGE)
                .build();

        // Expect a low threshold event (as configured in test-thresholds-wsman.xml)
        addEvent("uei.opennms.org/threshold/lowThresholdExceededWSManLogStorage", // uei
                "127.0.0.1", // ipaddr
                "SNMP", // service
                2, // trigger
                10240.0, // threshold
                12288.0, // rearm
                1.0, // value
                "HarddiskVolume16", // label
                "0", // instance
                "wmiLDPctFreeMBytes", // ds
                null, // iflabel
                null, // ifindex
                m_anticipator, m_anticipatedEvents);

        // Visit the collection set twice (the trigger is set to 2)
        collectionSet.visit(visitor);
        collectionSet.visit(visitor);

        // Verify!
        verifyEvents(0);
    }


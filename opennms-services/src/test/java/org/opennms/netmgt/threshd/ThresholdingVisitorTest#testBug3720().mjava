    /*
     * This test uses this files from src/test/resources:
     * - thresd-configuration-bug3554.xml
     * - test-thresholds-bug3554.xml
     * 
     * This test demonstrate that we can force filter auto-reload.
     */
    @Test
    public void testBug3720() throws Exception {
        System.setProperty("org.opennms.thresholds.filtersReloadEnabled", "true");
        runTestForBug3554();
        
        // Validate FilterDao Calls
        int numOfPackages = ThreshdConfigFactory.getInstance().getConfiguration().getPackage().length;
        int expectedCalls = numOfPackages * 26; // Not sure why is 5^2+1
        LoggingEvent[] events = MockLogAppender.getEventsGreaterOrEqual(Level.DEBUG);
        int count = 0;
        String expectedMsgHeader = "createPackageIpMap: package ";
        for (LoggingEvent e : events) {
            if (e.getMessage().toString().startsWith(expectedMsgHeader))
                count++;
        }
        assertEquals("expecting " + expectedCalls + " events", expectedCalls, count);
        
        // Validate number of re-initializations
        expectedCalls = 25; // 5 nodes => 5^2 times
        events = MockLogAppender.getEventsGreaterOrEqual(Level.INFO);
        count = 0;
        expectedMsgHeader = "getThresholdGroupNames: re-initializing filters.";
        for (LoggingEvent e : events) {
            if (e.getMessage().toString().equals(expectedMsgHeader))
                count++;
        }
        assertEquals("expecting " + expectedCalls + " events", expectedCalls, count);
    }


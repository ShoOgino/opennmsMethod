    @Test
    public void testMakeGroupTasksWithDutySchedule() throws Exception {
        final String groupName = "EscalationGroup";

        // set up a duty schedule for the group
        Group group = m_groupManager.getGroup(groupName);
        group.addDutySchedule("MoTuWeThFr0900-1700");
        m_groupManager.saveGroups();
        
        long dayTime = getTimeStampFor("21-FEB-2005 11:59:56");
        
        NotificationTask[] dayTasks = m_eventProcessor.makeGroupTasks(dayTime, m_params, 1, "EscalationGroup", m_commands, new LinkedList<NotificationTask>(), null, INTERVAL);
        
        assertTasksWithEmail(dayTasks, "brozow@opennms.org", "david@opennms.org");
        assertStartInterval(dayTasks, dayTime, INTERVAL);
        
        long nightTime = getTimeStampFor("21-FEB-2005 23:00:00");

        NotificationTask[] nightTasks = m_eventProcessor.makeGroupTasks(nightTime, m_params, 1, "EscalationGroup", m_commands, new LinkedList<NotificationTask>(), null, INTERVAL);

        assertTasksWithEmail(nightTasks, "brozow@opennms.org", "david@opennms.org");
        // delayed start due to group duty schedule
        assertStartInterval(nightTasks, nightTime+36000000, INTERVAL);

    }


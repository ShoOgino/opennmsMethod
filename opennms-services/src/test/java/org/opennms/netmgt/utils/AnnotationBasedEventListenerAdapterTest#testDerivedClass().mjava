    public void testDerivedClass() throws Exception {
        
        AnnotationBasedEventListenerAdapter adapter = new AnnotationBasedEventListenerAdapter();

        // expect a subscription for the new adapter
        m_eventIpcMgr.addEventListener(adapter, m_subscriptions);
        
        m_mockUtils.replayAll();

        // finish expectations for the old adapter
        m_adapter.afterPropertiesSet();

        
        // setup the derivied listener
        DerivedListener derivedListener = new DerivedListener();
        
        adapter.setAnnotatedListener(derivedListener);
        adapter.setEventIpcManager(m_eventIpcMgr);
        adapter.afterPropertiesSet();
        

        assertEquals(0, derivedListener.preProcessedEvents);
        assertEquals(0, derivedListener.receivedEventCount);
        assertEquals(0, derivedListener.postProcessedEvents);
        
        adapter.onEvent(createEvent(EventConstants.NODE_DOWN_EVENT_UEI));
        
        assertEquals(1, derivedListener.preProcessedEvents);
        assertEquals(1, derivedListener.receivedEventCount);
        assertEquals(1, derivedListener.postProcessedEvents);
        
        m_mockUtils.verifyAll();
    }


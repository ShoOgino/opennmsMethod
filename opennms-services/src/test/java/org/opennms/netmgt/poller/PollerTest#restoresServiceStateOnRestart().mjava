    @Test
    public void restoresServiceStateOnRestart() {
        MockNode node = m_network.getNode(2);
        MockService criticalService = m_network.getService(2, "192.168.1.3", "ICMP");

        // Bring the critical service down
        anticipateDown(node);
        criticalService.bringDown();

        // Start the poller
        startDaemons();

        // Verify
        verifyAnticipated(10000);

        // Stop the poller
        stopDaemons();

        // Bring the critical service up and expect a nodeUp
        // The service should restore the proper state and know that the outage
        // was triggered by a node down
        anticipateUp(node);
        criticalService.bringUp();

        // (Re)start the poller
        startDaemons();

        // Verify
        verifyAnticipated(10000);
    }


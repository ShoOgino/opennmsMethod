    @Test
    public void canUpdateLastGoodAndLastFailTimestamps() {
        final Date startOfTest = new Date();

        MockInterface iface = m_network.getInterface(3, "192.168.1.4");
        MockService svc = iface.getService("SMTP");
        assertThat(svc, notNullValue());

        // Start the poller
        startDaemons();

        // Wait until we poll the service
        await().atMost(1, TimeUnit.MINUTES)
                .ignoreExceptions()
                .until(() -> m_monitoredServiceDao.get(svc.getNodeId(), svc.getAddress(), svc.getSvcName()).getLastGood(),
                        greaterThanOrEqualTo(startOfTest));

        // Now take the service offline
        final Date beforeDown = new Date();
        svc.bringDown();

        // Wait until we detect the service to be offline
        await().atMost(1, TimeUnit.MINUTES)
                .ignoreExceptions()
                .until(() -> m_monitoredServiceDao.get(svc.getNodeId(), svc.getAddress(), svc.getSvcName()).getLastFail(),
                        greaterThanOrEqualTo(beforeDown));
    }


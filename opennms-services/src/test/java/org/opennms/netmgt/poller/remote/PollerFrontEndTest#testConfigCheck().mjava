    public void testConfigCheck() throws Exception {
        
        expect(m_settings.getMonitorId()).andReturn(1).atLeastOnce();
        
        anticipateNewConfig(pollConfig());
        
        
        expect(m_backEnd.pollerStarting(1)).andReturn(true);

        
        expect(m_backEnd.pollerCheckingIn(1, m_pollerConfiguration.getConfigurationTimestamp())).andReturn(true);
        
        DemoPollerConfiguration newPollerConfiguration = new DemoPollerConfiguration();
        anticipateNewConfig(newPollerConfiguration);
        
        PropertyChangeEvent e = new PropertyChangeEvent(m_frontEnd, "configuration", m_pollerConfiguration.getConfigurationTimestamp(), newPollerConfiguration.getConfigurationTimestamp());
        m_configChangeListener.configurationChanged(eq(e));
        
        
        replayMocks();
        
        m_frontEnd.afterPropertiesSet();

        m_frontEnd.addConfigurationChangedListener(m_configChangeListener);
        
        m_frontEnd.checkConfig();

        verifyMocks();
    }


    @Test
	public void testNodeGainedDynamicService() throws Exception {
		m_pollerConfig.setNodeOutageProcessingEnabled(true);

		startDaemons();
        
        TestCapsdConfigManager capsdConfig = new TestCapsdConfigManager(CAPSD_CONFIG);
        OpennmsServerConfigFactory onmsSvrConfig = new OpennmsServerConfigFactory(ConfigurationTestUtils.getReaderForConfigFile("opennms-server.xml"));
        DatabaseSchemaConfigFactory.setInstance(new DatabaseSchemaConfigFactory(ConfigurationTestUtils.getReaderForConfigFile("database-schema.xml")));
        CollectdConfigFactory collectdConfig = new CollectdConfigFactory(ConfigurationTestUtils.getReaderForResource(this, "/org/opennms/netmgt/capsd/collectd-configuration.xml"), onmsSvrConfig.getServerName(), onmsSvrConfig.verifyServer());
        
        JdbcTemplate jdbcTemplate = new JdbcTemplate(m_db);

        JdbcCapsdDbSyncer syncer = new JdbcCapsdDbSyncer();
        syncer.setJdbcTemplate(jdbcTemplate);
        syncer.setOpennmsServerConfig(onmsSvrConfig);
        syncer.setCapsdConfig(capsdConfig);
        syncer.setPollerConfig(m_pollerConfig);
        syncer.setCollectdConfig(collectdConfig);
        syncer.setNextSvcIdSql(m_db.getNextServiceIdStatement());
        syncer.afterPropertiesSet();

		OpenNMSProvisioner provisioner = new OpenNMSProvisioner();
		provisioner.setPollerConfig(m_pollerConfig);
		provisioner.setCapsdConfig(capsdConfig);
		provisioner.setCapsdDbSyncer(syncer);

		provisioner.setEventManager(m_eventMgr);
		provisioner.addServiceDNS("MyDNS", 3, 100, 1000, 500, 3000, 53,
				"www.opennms.org");

		assertNotNull("The service id for MyDNS is null", m_db
				.getServiceID("MyDNS"));
		MockUtil.println("The service id for MyDNS is: "
				+ m_db.getServiceID("MyDNS").toString());

		m_anticipator.reset();
		testSendNodeGainedService("MyDNS", "HTTP");

	}


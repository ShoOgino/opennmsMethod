    @Test(timeout=30000)
    public void testPersistEvent() throws Exception {
        CriteriaBuilder cb = new CriteriaBuilder(OnmsEvent.class);
        cb.eq("eventuei", EventConstants.NODE_DOWN_EVENT_UEI);
        assertEquals(0, m_eventDao.countMatching(cb.toCriteria()));

        OnmsNode node = m_databasePopulator.getNode1();
        assertNotNull(node);
        sendNodeDownEvent(null, node);

        while(m_eventDao.countMatching(cb.toCriteria()) < 1) {
            Thread.sleep(SLEEP_TIME);
        }

        final List<OnmsEvent> matching = m_eventDao.findMatching(cb.toCriteria());
        System.err.println("matching = " + matching);
        assertEquals(1, m_eventDao.countMatching(cb.toCriteria()));

        node = m_databasePopulator.getNode2();
        assertNotNull(node);
        Event generatedEvent = sendNodeDownEvent(null, node);

        while(m_eventDao.countMatching(cb.toCriteria()) < 2) {
            Thread.sleep(SLEEP_TIME);
        }

        assertEquals(2, m_eventDao.countMatching(cb.toCriteria()));

        assertNull(generatedEvent.getInterfaceAddress());
        cb.isNull("ipaddr");
        assertEquals("failed, found: " + m_eventDao.findMatching(cb.toCriteria()), 2, m_eventDao.countMatching(cb.toCriteria()));
    }


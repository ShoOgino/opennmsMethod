    /**
     * Test that eventd's service ID lookup works properly.
     */
    public void testPersistEventWithService() throws Exception {

        assertEquals(0, m_db.countRows("select * from events"));

        MockNode node = m_network.getNode(1);
        MockInterface intf = node.getInterface("192.168.1.1");
        MockService svc = intf.getService("ICMP");
        sendServiceDownEvent(null, svc);

        sleep(1000);
        assertEquals("event count", 1, m_db.countRows("select * from events"));
        assertNotSame("service ID for event", 0, new JdbcTemplate(m_db.getDataSource()).queryForInt("select serviceID from events"));
    }


    /*
    *
    * ACCESSPOINT:  GigabitEthernet (but no ifindex because no snmp on) ------> port  2/39 (ifindex 47):CISCO_WS_C2948_IP
    * 
    */
   @Test
   @JUnitSnmpAgents(value={
           @JUnitSnmpAgent(host=CISCO_WS_C2948_IP, port=161, resource=CISCO_WS_C2948_SNMP_RESOURCE)
   })
   public void testLinkCiscoAccessPointCiscoWsUsingCdp() throws Exception {
       Package example1 = m_linkdConfig.getPackage("example1");
       example1.setUseLldpDiscovery(false);
       example1.setUseOspfDiscovery(false);
       example1.setUseIpRouteDiscovery(false);
       example1.setUseBridgeDiscovery(false);
       example1.setUseIsisDiscovery(false);
       example1.setUseCdpDiscovery(true);
       
       example1.setSaveRouteTable(false);
       example1.setSaveStpNodeTable(false);
       example1.setSaveStpInterfaceTable(false);
       example1.setEnableVlanDiscovery(false);

       m_nodeDao.save(builder.getCiscoWsC2948());
       m_nodeDao.save(builder.getNodeWithoutSnmp(ACCESSPOINT_NAME, ACCESSPOINT_IP));
       m_nodeDao.flush();

       assertEquals(2, m_nodeDao.countAll());
       final OnmsNode ciscoap = m_nodeDao.findByForeignId("linkd", ACCESSPOINT_NAME);
       final OnmsNode ciscows = m_nodeDao.findByForeignId("linkd", CISCO_WS_C2948_NAME);

       assertTrue(m_linkd.scheduleNodeCollection(ciscows.getId()));
       assertTrue(!m_linkd.scheduleNodeCollection(ciscoap.getId()));

       assertTrue(m_linkd.runSingleSnmpCollection(ciscows.getId()));
       
       final Collection<LinkableNode> linkables = m_linkd.getLinkableNodesOnPackage("example1");
       assertEquals(1, linkables.size());
       
       for (LinkableNode lnode: linkables) {
           if (ciscows.getId() == lnode.getNodeId()) {
               assertEquals(true, lnode.hasCdpInterfaces());
               assertEquals(2, lnode.getCdpInterfaces().size());
           } else {
               assertTrue("Found node not added!!!!!",false);
           }
       }
       

       assertEquals(0,m_dataLinkInterfaceDao.countAll());
               
                       
       assertEquals(1, m_linkd.getLinkableNodesOnPackage("example1").size());

       assertTrue(m_linkd.runSingleLinkDiscovery("example1"));

       
       final List<DataLinkInterface> links = m_dataLinkInterfaceDao.findAll();
       assertEquals(1,links.size());
       
       final DataLinkInterface ciscoaplinktociscows = links.get(0);
       
       assertEquals(ciscoap.getId(), ciscoaplinktociscows.getNode().getId());
       assertEquals(-1, ciscoaplinktociscows.getIfIndex().intValue());
       assertEquals(ciscows.getId(), ciscoaplinktociscows.getNodeParentId());
       assertEquals(47,ciscoaplinktociscows.getParentIfIndex().intValue());
               
   }


    protected void setUp() throws Exception {
        super.setUp();
        m_capsd = Capsd.getInstance();
        DatabaseSchemaConfigFactory.setInstance(new DatabaseSchemaConfigFactory(new StringReader(DB_SCHEMA_CONFIG)));
        CapsdConfigFactory capsdConfigFactory = new CapsdConfigFactory(new StringReader(CAPSD_CONFIG));
        capsdConfigFactory.setNextSvcIdSql(m_db.getNextServiceIdStatement());
        CapsdConfigFactory.setInstance(capsdConfigFactory);
        
        OpennmsServerConfigFactory onmsSvrConfig = new OpennmsServerConfigFactory(new StringReader(SVR_CONFIG));
        OpennmsServerConfigFactory.setInstance(onmsSvrConfig);
        PollerConfigFactory.setInstance(new PollerConfigFactory(System.currentTimeMillis(), new StringReader(POLLER_CONFIG), onmsSvrConfig.getServerName(), onmsSvrConfig.verifyServer()));

	RrdConfig.loadProperties(new ByteArrayInputStream(RRD_CONFIG.getBytes()));
	// This isn't needed here, but it makes error pop up earlier
	RrdUtils.initialize();

	DataCollectionConfigFactory.setInstance(new DataCollectionConfigFactory(new StringReader(DATACOLLECTION_CONFIG)));

        CollectdConfigFactory.setInstance(new CollectdConfigFactory(new StringReader(COLLECTD_CONFIG), onmsSvrConfig.getServerName(), onmsSvrConfig.verifyServer()));
    }


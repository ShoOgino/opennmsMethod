    @Test
    public void testQueueing() throws Exception {
        Date date = new Date();
        anticipateNotifyReceivedEvent(m_anticipator1);
        m_xmlrpcd.init();
        m_xmlrpcd.start();

        anticipateRouterServiceCall(m_anticipator1, "sendServiceDownEvent", date);

        Event nodeOneEvent = svcEvent(EventConstants.NODE_LOST_SERVICE_EVENT_UEI, 1, "192.168.1.1", "ICMP", date);
        getEventIpcManager().sendNow(nodeOneEvent);

        Thread.sleep(1000);
        m_anticipator1.verifyAnticipated();
        System.err.println("Stopping xmlrpc servier for anticipator1");
        m_anticipator1.shutdown();

        Event nodeTwoEvent = svcEvent(EventConstants.NODE_LOST_SERVICE_EVENT_UEI, 2, "192.168.1.2", "SNMP", date);
        getEventIpcManager().sendNow(nodeTwoEvent);
        
        Thread.sleep(1000);
        
        /*
         * Tell the anticipator to not setup the web server until have
         * anticipated the sendServiceDownEvent call. We don't want to miss the
         * call if xmlrpcd sends the event after the web server comes up but
         * before we have anticipated it.
         */
                m_anticipator1 = new XmlrpcAnticipator(m_port1, true);
        anticipateNotifyReceivedEvent(m_anticipator1);

        anticipateServerServiceCall(m_anticipator1, "sendServiceDownEvent", date);

        System.err.println("Restarting xmlrpc servier for anticipator1");
        m_anticipator1.setupWebServer();
        
        Thread.sleep(1000);
        m_xmlrpcd.stop();
        Thread.sleep(2000);
        
        finishUp();
    }


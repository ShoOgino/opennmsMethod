    @Test
    public void canHandleServiceDeletedEvents() {
        // Handle a serviceDeleted event targeting svc2
        OnmsNode node = new OnmsNode();
        node.setId(svc2.getNodeId());

        OnmsIpInterface iface = new OnmsIpInterface();
        iface.setId(101);
        iface.setNode(node);
        iface.setIpAddress(svc2.getAddress());

        Event e = new EventBuilder(EventConstants.SERVICE_DELETED_EVENT_UEI, "test")
                .setIpInterface(iface)
                .setService(svc2.getServiceName())
                .getEvent();
        collectd.onEvent(ImmutableMapper.fromMutableEvent(e));

        // The delete flag should be set (and only set) on svc2
        assertFalse("deletion flag was set on svc1!", svc1.getCollectorUpdates().isDeletionFlagSet());
        assertTrue("deletion flag was not set on svc2!", svc2.getCollectorUpdates().isDeletionFlagSet());
    }


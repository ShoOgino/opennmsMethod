    /**
     * Sends a message based on properties set on this bean.
     */
    public void mailSend() throws JavaMailerException {
        checkEnvelopeAndContents();
        
        Properties props = System.getProperties();
        
        props.put("mail.smtp.auth", String.valueOf(isAuthenticate()));
        props.put("mail.smtp.starttls.enable", String.valueOf(isStartTlsEnabled()));
        props.put("mail.smtp.quitwait", String.valueOf(isQuitWait()));
        props.put("mail.smtp.port", String.valueOf(getSmtpPort()));
        if (isSmtpSsl()) {
            props.put("mail.smtps.auth", String.valueOf(isAuthenticate()));
        	props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
        	props.put("mail.smtp.socketFactory.port", String.valueOf(getSmtpPort()));
        	props.put("mail.smtp.socketFactory.fallback", "false");
        }

        Session session = Session.getInstance(props, createAuthenticator());
        //Session session = Session.getInstance(props, null);
        session.setDebugOut(new PrintStream(new LoggingByteArrayOutputStream(log()), true));
        session.setDebug(isDebug());
        
        log().debug(createLogMsg());        
        sendMessage(session, buildMessage(session));
    }


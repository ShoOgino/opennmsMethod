    /**
     * Creates the categories map. Reads the categories from the categories.xml
     * and creates the 'RTCCategory's map
     */
    private void createCategoriesMap() {
        CatFactory cFactory = null;
        try {
            CategoryFactory.init();
            cFactory = CategoryFactory.getInstance();

        } catch (IOException ex) {
            log().error("Failed to load categories information", ex);
            throw new UndeclaredThrowableException(ex);
        } catch (MarshalException ex) {
            log().error("Failed to load categories information", ex);
            throw new UndeclaredThrowableException(ex);
        } catch (ValidationException ex) {
            log().error("Failed to load categories information", ex);
            throw new UndeclaredThrowableException(ex);
        }

        m_categories = new HashMap<String, RTCCategory>();

        cFactory.getReadLock().lock();
        try {
            for (Categorygroup cg : cFactory.getConfig().getCategorygroupCollection()) {
                final String commonRule = cg.getCommon().getRule();
    
                for (final org.opennms.netmgt.config.categories.Category cat : cg.getCategories().getCategoryCollection()) {
                    m_categories.put(new RTCCategory(cat, commonRule).getLabel(), new RTCCategory(cat, commonRule));
                }
            }
        } finally {
            cFactory.getReadLock().unlock();
        }
    }


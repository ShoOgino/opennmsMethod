    private boolean isServer(InetAddress host, int port, int retries, int timeout) {

        boolean isAServer = false;
        for (int attempts = 0; attempts <= retries && !isAServer; attempts++) {
            Socket socket = null;
            try {
                socket = new Socket();
                socket.connect(new InetSocketAddress(host, port), timeout);
                socket.setSoTimeout(timeout);
                LOG.debug("MSExchangePlugin: connected to host: {} on port: {}", host, port);

                // Allocate a line reader
                //
                BufferedReader lineRdr = new BufferedReader(new InputStreamReader(socket.getInputStream()));

                // Read the banner line and see if it contains the
                // substring "Microsoft Exchange"
                //
                String banner = lineRdr.readLine();
                if (banner != null) {
                    int rc = banner.indexOf(BANNER_STRING);
                    if (rc > -1)
                        isAServer = true;
                }
            } catch (ConnectException e) {
                // Connection refused!! Continue to retry.
                //
                LOG.debug("isServer: Connection refused to {}: {}", InetAddressUtils.str(host), port);
            } catch (NoRouteToHostException e) {
                // No Route to host!!!
                //
                e.fillInStackTrace();
                LOG.info("isServer: Failed to connect to host {}, no route to host", InetAddressUtils.str(host), e);
                throw new UndeclaredThrowableException(e);
            } catch (InterruptedIOException e) {
                // ignore this
                LOG.debug("MSExchangePlugin: did not connect to host within timeout: {} attempt: {}", timeout, attempts);
            } catch (IOException e) {
                LOG.info("isServer: Unexpected I/O exception occured with host {} on port {}", InetAddressUtils.str(host), port, e);
            } catch (Throwable t) {
                LOG.error("isServer: Undeclared throwable caught communicating with host {} on port {}", InetAddressUtils.str(host), port, t);
            } finally {
                try {
                    if (socket != null) {
                        socket.close();
                        socket = null;
                    }
                } catch (IOException e) {
                }
            }
        }

        return isAServer;
    }


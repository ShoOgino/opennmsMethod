    /**
     * <p>syncServices</p>
     *
     * @param conn a {@link java.sql.Connection} object.
     * @throws java.sql.SQLException if any.
     */
    public void syncServices(Connection conn) throws SQLException {
        
        List<String> serviceNames = syncServicesTable(conn);
    
        PreparedStatement delFromIfServicesStmt = null;
        final DBUtils d = new DBUtils(getClass());
        try { 
            
            List<String> protocols = getCapsdConfig().getConfiguredProtocols();
            
            /*
             * now iterate over the services from the 'service' table
             * and determine if any no longer exist in the list of
             * configured protocols
             */
           for(String service : serviceNames) {
                if (!protocols.contains(service)) {
                    if (log().isDebugEnabled()) {
                        log().debug("syncServices: service " + service + " exists in the database but not in the Capsd config file.");
                    }
    
                    Integer id = m_serviceNameToId.get(service);
    
                    // Delete 'ifServices' table entries which refer to the
                    // service
                    if (log().isDebugEnabled()) {
                        log().debug("syncServices: deleting all references to service id " + id + " from the IfServices table.");
                    }
                    delFromIfServicesStmt = conn.prepareStatement(DELETE_IFSERVICES_SQL);
                    d.watch(delFromIfServicesStmt);
                    delFromIfServicesStmt.setInt(1, id.intValue());
                    delFromIfServicesStmt.executeUpdate();
                    log().info("syncServices: deleted service id " + id + " for service '" + service + "' from the IfServices table.");
                }
            }
        } finally {
            d.cleanUp();
        }
        
    }


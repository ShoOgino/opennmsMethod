    /**
     * Read the required properties and set up the logs, the archive etc.
     * @throws ArchiverException Thrown if a required property is not specified or is incorrect
     */
    private void init() throws ArchiverException {
        Map mdc = MDC.getCopyOfContextMap();

        try {
        
            // The general logs from the events archiver go to this category'
            MDC.put(Logging.PREFIX_KEY, "OpenNMS.Archiver.Events");


        EventsArchiverConfigFactory eaFactory;
        
        try {
            EventsArchiverConfigFactory.init();
             eaFactory =
                EventsArchiverConfigFactory.getInstance();
        } catch (MarshalException ex) {
            LOG.error("MarshalException", ex);
            throw new UndeclaredThrowableException(ex);
        } catch (ValidationException ex) {
            LOG.error("ValidationException", ex);
            throw new UndeclaredThrowableException(ex);
        } catch (IOException ex) {
            LOG.error("IOException", ex);
            throw new UndeclaredThrowableException(ex);
        }

        // get archive age
        String archAgeStr = eaFactory.getArchiveAge();
        long archAge;
        try {
            archAge = TimeConverter.convertToMillis(archAgeStr);
        } catch (NumberFormatException nfe) {
            throw new ArchiverException("Archive age: " + archAgeStr
                                        + "- Incorrect format "
                                        + nfe.getMessage());
        }

        /*
         * Set actual time that is to be used for the select from the
         * database.
         */
        m_archAge = System.currentTimeMillis() - archAge;

        // get the separator to be used between column names in the archive
        String separator = eaFactory.getSeparator();
        if (separator == null) {
            m_archSeparator = "#";
        } else {
            m_archSeparator = separator;
        }

        // info logs
        if (LOG.isInfoEnabled()) {
            // get this in readable format
            archAgeStr = new java.util.Date(m_archAge).toString();
            LOG.info("Events archive age specified = {}", archAgeStr);
            LOG.info("Events archive age in millisconds = {}", archAge);

            LOG.info("Events created before \'" + archAgeStr + " \' will be deleted");

            LOG.info("Separator to be used in archive: {}", m_archSeparator);
        }

        // Make sure we can connect to the database
        try {
            DataSourceFactory.init();
            m_conn = DataSourceFactory.getInstance().getConnection();
        } catch (IOException e) {
            LOG.error("IOException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        } catch (MarshalException e) {
            LOG.error("MarshalException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        } catch (ValidationException e) {
            LOG.error("ValidationException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        } catch (PropertyVetoException e) {
            LOG.error("PropertyVetoException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        } catch (SQLException e) {
            LOG.error("SQLException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        } catch (ClassNotFoundException e) {
            LOG.error("ClassNotFoundException while initializing database", e);
            throw new UndeclaredThrowableException(e);
        }
        // XXX should we be throwing ArchiverException instead?
        } finally {
            MDC.setContextMap(mdc);
        }
    }


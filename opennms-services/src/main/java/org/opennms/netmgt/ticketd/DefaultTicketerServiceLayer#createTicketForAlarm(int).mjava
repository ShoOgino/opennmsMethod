	/*
	 * (non-Javadoc)
	 * @see org.opennms.netmgt.ticketd.TicketerServiceLayer#createTicketForAlarm(int)
	 */
	/** {@inheritDoc} */
	public void createTicketForAlarm(int alarmId) {
	    
		OnmsAlarm alarm = m_alarmDao.get(alarmId);
        
        Ticket ticket = createTicketFromAlarm(alarm);
        
        try {
            m_ticketerPlugin.saveOrUpdate(ticket);
            alarm.setTTicketId(ticket.getId());
            alarm.setTTicketState(TroubleTicketState.OPEN);
        } catch (PluginException e) {
            alarm.setTTicketState(TroubleTicketState.CREATE_FAILED);
            log().error("Unable to create ticket for alarm: "  + e.getMessage());
            m_eventIpcManager.sendNow(createEvent(e.getMessage()));
        }
        
		m_alarmDao.saveOrUpdate(alarm);
		
	}


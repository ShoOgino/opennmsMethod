    /**
     * Use RRD strategy to "fetch" value of the datasource from the RRD file
     * using the threshold configuration.
     */
    private Double getDataSourceValue(SnmpThresholdConfiguration thresholdConfiguration, File file, String datasource) {
        Double dsValue;

        try {
        	if (thresholdConfiguration.getRange() != 0) {
        		if (log().isDebugEnabled()) {
                    log().debug("Checking datasource '" + datasource + "' for values within " + thresholdConfiguration.getRange() + " milliseconds of last possible PDP with interval " + thresholdConfiguration.getInterval() + ".");
                }
        		dsValue = RrdUtils.fetchLastValueInRange(file.getAbsolutePath(), datasource, thresholdConfiguration.getInterval(), thresholdConfiguration.getRange());
        	} else {
        		if (log().isDebugEnabled()) {
                    log().debug("Checking datasource '" + datasource + "' for value of last possible PDP only with interval " + thresholdConfiguration.getInterval() + ".");
                }
        		dsValue = RrdUtils.fetchLastValue(file.getAbsolutePath(), datasource, thresholdConfiguration.getInterval());
        	}
        } catch (NumberFormatException e) {
            log().warn("Unable to convert retrieved value for datasource '" + datasource + "' to a double: " + e);
            return null;
        } catch (RrdException e) {
            log().info("An error occurred retriving the last value for datasource '" + datasource + "': " + e, e);
            return null;
        }

        if (dsValue == null) {
            log().info("fetch value for data source '" + datasource + "' was null.");
            return null;
        }
        
        if (dsValue.isNaN()) {
            log().info("fetch value for data source '" + datasource + "' was NaN.");
            return null;
        }
        
        return dsValue;
    }


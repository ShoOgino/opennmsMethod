    /**
     * Use RRD strategy to "fetch" value of the datasource from the RRD file
     * using the threshold configuration.
     */
    private Double getDataSourceValue(SnmpThresholdConfiguration thresholdConfiguration, File file, String datasource) {
        Double dsValue;

        try {
        	if (thresholdConfiguration.getRange() != 0) {
			LOG.debug("Checking datasource '{}' for values within {} milliseconds of last possible PDP with interval {}.", datasource, thresholdConfiguration.getRange(), thresholdConfiguration.getInterval());
        		dsValue = RrdUtils.fetchLastValueInRange(file.getAbsolutePath(), datasource, thresholdConfiguration.getInterval(), thresholdConfiguration.getRange());
        	} else {
			LOG.debug("Checking datasource '{}' for value of last possible PDP only with interval {}.", datasource, thresholdConfiguration.getInterval());
        		dsValue = RrdUtils.fetchLastValue(file.getAbsolutePath(), datasource, thresholdConfiguration.getInterval());
        	}
        } catch (NumberFormatException e) {
            LOG.warn("Unable to convert retrieved value for datasource '{}' to a double", datasource, e);
            return null;
        } catch (RrdException e) {
            LOG.info("An error occurred retriving the last value for datasource '{}'", datasource, e);
            return null;
        }

        if (dsValue == null) {
            LOG.info("fetch value for data source '{}' was null.", datasource);
            return null;
        }
        
        if (dsValue.isNaN()) {
            LOG.info("fetch value for data source '{}' was NaN.", datasource);
            return null;
        }
        
        return dsValue;
    }


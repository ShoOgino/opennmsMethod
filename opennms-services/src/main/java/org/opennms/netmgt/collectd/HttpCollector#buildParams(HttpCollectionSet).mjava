    private HttpClientParams buildParams(final HttpCollectionSet collectionSet) {
        HttpClientParams params = new HttpClientParams(DefaultHttpParams.getDefaultParams());
        params.setVersion(computeVersion(collectionSet.getUriDef()));
        params.setSoTimeout(Integer.parseInt(ParameterMap.getKeyedString(collectionSet.getParameters(), "timeout", DEFAULT_SO_TIMEOUT)));
        
        //review the httpclient code, looks like virtual host is checked for null
        //and if true, sets Host to the connection's host property
        params.setVirtualHost(collectionSet.getUriDef().getUrl().getVirtualHost());
        
        String key = "retry";
        if (collectionSet.getParameters().containsKey("retries")) {
            key = "retries";
        }
        Integer retryCount = ParameterMap.getKeyedInteger(collectionSet.getParameters(), key, DEFAULT_RETRY_COUNT);
        params.setParameter(HttpMethodParams.RETRY_HANDLER, new DefaultHttpMethodRetryHandler(retryCount, false));
        
        params.setParameter(HttpMethodParams.USER_AGENT, determineUserAgent(collectionSet, params));


        return params;
    }


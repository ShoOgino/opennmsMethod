    private HttpClientParams buildParams(Uri uri, Map<String, String> parameters) {
        HttpClientParams params = new HttpClientParams(DefaultHttpParams.getDefaultParams());
        params.setVersion(computeVersion(uri));
        params.setSoTimeout(Integer.parseInt(ParameterMap.getKeyedString(parameters, "timeout", DEFAULT_SO_TIMEOUT)));
        
        //review the httpclient code, looks like virtual host is checked for null
        //and if true, sets Host to the connection's host property
        params.setVirtualHost(uri.getUrl().getVirtualHost());
        Integer retryCount = ParameterMap.getKeyedInteger(parameters, "retries", DEFAULT_RETRY_COUNT);
        params.setParameter(HttpMethodParams.RETRY_HANDLER, new DefaultHttpMethodRetryHandler(retryCount, false));

        return params;
    }


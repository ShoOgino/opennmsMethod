    public void insertOrUpdateAlarm(Header eventHeader, Event event) throws SQLException {
        int alarmId = isReductionNeeded(eventHeader, event);
        if (alarmId != -1) {
            if (log().isDebugEnabled()) {
                log().debug("Reducing event for: " + event.getDbid() + ": " + event.getUei());
            }
            updateAlarm(eventHeader, event, alarmId);
            
            // This removes all previous events that have been reduced.
            if (log().isDebugEnabled()) {
                log().debug("insertOrUpdate: auto-clean is: " + event.getAlarmData().getAutoClean());
            }
            if (event.getAlarmData().getAutoClean() == true) {
                log().debug("insertOrUpdate: deleting previous events");
                cleanPreviousEvents(alarmId, event.getDbid());
            }
            
        } else {
            if (log().isDebugEnabled()) {
                log().debug("Not reducing event for: " + event.getDbid() + ": " + event.getUei());
            }
            insertAlarm(eventHeader, event);
        }
    }


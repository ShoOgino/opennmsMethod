	@Override
	protected void saveVlan(final Connection dbConn, final OnmsVlan v) throws SQLException {
	    new UpsertTemplate<OnmsVlan, VlanDao>(m_transactionManager, m_vlanDao) {

	        @Override
	        protected OnmsVlan query() {
	            return m_vlanDao.findByNodeAndVlan(v.getNode().getId(), v.getVlanId());
	        }

	        @Override
	        protected OnmsVlan doUpdate(OnmsVlan vlan) {
	            // Make sure that the fields used in the query match
	            Assert.isTrue(vlan.getNode().equals(v.getNode()));
	            Assert.isTrue(vlan.getVlanId().equals(v.getVlanId()));

	            if (vlan.getId() == null && v.getId() != null) {
	                vlan.setId(v.getId());
	            }
	            vlan.setLastPollTime(v.getLastPollTime());
	            vlan.setStatus(v.getStatus());
	            vlan.setVlanName(v.getVlanName());
	            vlan.setVlanStatus(v.getVlanStatus());
	            vlan.setVlanType(v.getVlanType());
	            m_vlanDao.update(v);
	            m_vlanDao.flush();
	            return vlan;
	        }

	        @Override
	        protected OnmsVlan doInsert() {
	            m_vlanDao.save(v);
	            m_vlanDao.flush();
	            return v;
	        }
	    }.execute();
	}


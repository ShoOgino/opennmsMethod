    public FifoQueue<String> readLines(InputStream in) {
        Category log = ThreadCategory.getInstance(getClass());
        String EOL = "\n";

        String alreadyRecdData = null;

        FifoQueue<String> retval = new FifoQueueImpl<String>();

        ByteArrayOutputStream xmlStr = new ByteArrayOutputStream();
        int bytesInThisRead = 0;

        // loop until we've read it all or we have to shutdown
        while (true) {
            // read data off the socket's input stream
            try {
                byte[] message = new byte[1024];

                bytesInThisRead = in.read(message);
                if (log.isDebugEnabled()) {
                    log.debug("bytesInThisRead: " + bytesInThisRead);
		}

                /*
                 * Check the result code. A negative value
                 * means that the end of file has been reached
                 * Otherwise the value must be greater than zero
                 * according to the Java API documentation
                 */
                if (bytesInThisRead < 0) {
                    break;
		}

                /*
                 * Check if current chunk of data has end of data
                 * care should be exercised since the buffer may contain
                 * more than one log message.
                 */
                String newData = new String(message, 0, bytesInThisRead);
                String tempStr;
                if (alreadyRecdData != null) {
                    tempStr = alreadyRecdData + newData;
                } else {
                    tempStr = newData;
		}

                int index = -1;
                while ((index = tempStr.indexOf(EOL)) != -1) {
                    int tlen = index + EOL.length();
                    if (tlen > tempStr.length()) {
                        tlen = tempStr.length();
                    }

                    byte[] tempb = tempStr.substring(0, tlen).getBytes();
                    xmlStr.write(tempb, 0, tlen);

                    // Create a new text message
                    retval.add(new String(xmlStr.toByteArray(), 0, xmlStr.size()));

                    xmlStr.reset();
                    alreadyRecdData = null;

                    if (tlen != tempStr.length()) {
                        tempStr = tempStr.substring(tlen);
                    } else if (tlen == tempStr.length()) {
                        tempStr = "";
                    }
                }

                if (tempStr.length() != 0) {
                    alreadyRecdData = tempStr;
                }

                if (bytesInThisRead < 1024) {
                    /*
                     * Return any remaining data as the last line
                     * in the queue.
		     */
                    if ((alreadyRecdData != null) && (alreadyRecdData.length() != 0)) {
                        retval.add(alreadyRecdData);
                    }
                    break;
                }
            } catch (FifoQueueException ex) {
                log.warn(ex);
            } catch (InterruptedException ex) {
                log.warn(ex);
            } catch (IOException e) {
                log.warn(e);
            }
        }
        return retval;
    }


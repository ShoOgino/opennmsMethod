    /**
     * Poll the specified address for service availability.
     * 
     * During the poll an attempt is made to connect on the specified port. If
     * the connection request is successful, the banner line generated by the
     * interface is parsed and if the banner text indicates that we are talking
     * to Provided that the interface's response is valid we set the service
     * status to SERVICE_AVAILABLE and return.
     * @param parameters
     *            The package parameters (timeout, retry, and others) to be used
     *            for this poll.
     * @param iface
     *            The network interface to test the service on.
     * @return The availibility of the interface and if a transition event
     *         should be supressed.
     * 
     * @throws java.lang.RuntimeException
     *             Thrown if the interface experiences errors during the poll.
     */
    public PollStatus poll(MonitoredService svc, Map parameters) {
        NetworkInterface iface = svc.getNetInterface();

        //
        // Process parameters
        //
        Category log = ThreadCategory.getInstance(getClass());

        //
        // Get interface address from NetworkInterface
        //
        if (iface.getType() != NetworkInterface.TYPE_IPV4)
            throw new NetworkInterfaceNotSupportedException("Unsupported interface type, only TYPE_IPV4 currently supported");

        int retry = ParameterMap.getKeyedInteger(parameters, "retry", DEFAULT_RETRY);
        int timeout = ParameterMap.getKeyedInteger(parameters, "timeout", DEFAULT_TIMEOUT);
        int IORport = ParameterMap.getKeyedInteger(parameters, "ior-port", DEFAULT_IORPORT);

        // Port
        //
        int port = ParameterMap.getKeyedInteger(parameters, "port", DEFAULT_PORT);

        // Get the address instance.
        //
        InetAddress ipv4Addr = (InetAddress) iface.getAddress();

        if (log.isDebugEnabled())
            log.debug("poll: address = " + ipv4Addr.getHostAddress() + ", port = " + port + ", timeout = " + timeout + ", retry = " + retry);


        // Lets first try to the the IOR via HTTP, if we can't get that then any
        // other process that can
        // do it the right way won't be able to connect anyway
        //
        try {
            retrieveIORText(ipv4Addr.getHostAddress(), IORport);
        } catch (Exception e) {
            return logDown(Level.DEBUG, "failed to get the corba IOR from " + ipv4Addr, e);
        }

        // SO LETS DO IT THE OLD FASHIONED WAY
        String failureReason = null; 
        
        for (int attempts = 0; attempts <= retry; attempts++) {
            Socket socket = null;
            try {
                //
                // create a connected socket
                //
            	long startTime = System.currentTimeMillis();
                socket = new Socket();
                socket.connect(new InetSocketAddress(ipv4Addr, port), timeout);
                socket.setSoTimeout(timeout);
                long endTime = System.currentTimeMillis();
                log.debug("DominoIIOPMonitor: connected to host: " + ipv4Addr + " on port: " + port);

                // got here so its up...
                return PollStatus.up(endTime - startTime);
            } catch (NoRouteToHostException e) {
                e.fillInStackTrace();
                log.warn("DominoIIOPMonitor: No route to host exception for address " + ipv4Addr.getHostAddress(), e);
                
                return PollStatus.unavailable("No route to host exception for address " + ipv4Addr.getHostAddress());
            } catch (InterruptedIOException e) {
            	failureReason = "did not connect to host within timeout: " + timeout + " attempt: " + attempts;
                log.debug("DominoIIOPMonitor: "+failureReason);
            } catch (ConnectException e) {
                // Connection refused. Continue to retry.
                //
                e.fillInStackTrace();
                failureReason = "Connection exception for address: " + ipv4Addr+" : "+e.getMessage();
                if (log.isDebugEnabled())
                    log.debug("DominoIIOPMonitor: "+failureReason, e);
            } catch (IOException e) {
                // Ignore
                e.fillInStackTrace();
                failureReason = "IOException while polling address: " + ipv4Addr+" : "+e.getMessage();
                if (log.isDebugEnabled())
                    log.debug("DominoIIOPMonitor: "+failureReason, e);
                
            } finally {
                try {
                    // Close the socket
                    if (socket != null)
                        socket.close();
                } catch (IOException e) {
                    e.fillInStackTrace();
                    if (log.isDebugEnabled())
                        log.debug("DominoIIOPMonitor: Error closing socket.", e);
                }
            }
        }

        //
        // return the status of the service
        //
        return PollStatus.unavailable(failureReason);
    }


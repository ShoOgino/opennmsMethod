    /**
     * This method is responsible for determining the
     * node label of a node, and the up/down status
     * and status color
     *
     * @param nodeIDStr a {@link java.lang.String} object.
     * @param conn a {@link java.sql.Connection} object.
     * @return an array of {@link java.lang.String} objects.
     * @throws java.sql.SQLException if any.
     */
    @Override
    public String[] getLabelAndStatus(String nodeIDStr, Connection conn) {
        String[] result = new String[3];
        result[1] = "Cleared";
        result[2] = "Unmanaged";

        int nodeID = WebSecurityUtils.safeParseInt(nodeIDStr);

        OnmsNode node = nodeDao.get(nodeID);
        if (node == null) {
            // TODO Log that node could not be found in database
            return result;
        }

        result[0] = node.getLabel();

        final org.opennms.core.criteria.Criteria crit = new org.opennms.core.criteria.Criteria(OnmsMonitoredService.class)
        .setAliases(Arrays.asList(new Alias[] {
            //new Alias("monitoredService","monitoredService", JoinType.LEFT_JOIN),
            new Alias("ipInterface","ipInterface", JoinType.LEFT_JOIN)
        }))
        .addRestriction(new EqRestriction("status", "A"))
        .addRestriction(new EqRestriction("ipInterface.node", node));

        // Get all active services on the node
        List<OnmsMonitoredService> services = monitoredServiceDao.findMatching(crit);

        int countManagedSvcs = services.size();

        // Count how many of these services have open outages
        int countOutages = 0;
        for (OnmsMonitoredService service : services) {
            OnmsOutage out = outageDao.currentOutageForService(service);
            if (out != null) {
                countOutages++;
            }
        }

        if(countManagedSvcs == countOutages) {
            result[1] = "Critical";
            result[2] = "All Services Down";
        } else if(countOutages == 0) {
            result[1] = "Normal";
            result[2] = "All Services Up";
        } else {
            result[1] = "Minor";
            result[2] = "Some Services Down";
        }

        return result;
    }


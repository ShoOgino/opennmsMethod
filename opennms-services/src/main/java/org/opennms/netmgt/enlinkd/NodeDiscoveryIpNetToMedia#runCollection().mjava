    protected void runCollection() {

    	final Date now = new Date(); 

        IpNetToMediaTableTracker ipNetToMediaTableTracker = new IpNetToMediaTableTracker() {
            public void processIpNetToMediaRow(final IpNetToMediaRow row) {
                IpNetToMedia macep = row.getIpNetToMedia();
                if (macep.getPhysAddress() == null && macep.getNetAddress() == null) {
                    LOG.debug("processIpNetToMediaRow: node [{}], null:null:{}. ip and mac addresses null. skipping",
                              getNodeId(),
                              macep.getIpNetToMediaType());
                } else  if (macep.getPhysAddress() == null) {
                        LOG.debug("processIpNetToMediaRow: node [{}], null:{}:{}. mac address null. skipping",
                                  getNodeId(),
                                  str(macep.getNetAddress()),
                                  macep.getIpNetToMediaType());
                } else if (macep.getNetAddress() == null) {
                    LOG.warn("processIpNetToMediaRow: node [{}], {}:null:{}. ip address null. skipping",
                             getNodeId(),
                             macep.getPhysAddress(), 
                             macep.getIpNetToMediaType());
                } else if (macep.getIpNetToMediaType() == IpNetToMediaType.IPNETTOMEDIA_TYPE_DYNAMIC
                        || macep.getIpNetToMediaType() == IpNetToMediaType.IPNETTOMEDIA_TYPE_STATIC) {
                    LOG.debug("processIpNetToMediaRow: node [{}], mac address {} and ip {} mediatype {}. saving",
                              getNodeId(),
                              macep.getPhysAddress(), 
                              str(macep.getNetAddress()),
                              macep.getIpNetToMediaType());
                    m_linkd.getQueryManager().store(getNodeId(), macep);
                } else {
                    LOG.warn("processIpNetToMediaRow: node [{}],  {}:{}:{}. mediatype not valid. skipping",
                             getNodeId(),
                             macep.getPhysAddress(), 
                             str(macep.getNetAddress()),
                             macep.getIpNetToMediaType());
                }

            }
        };
		
        SnmpAgentConfig peer = m_linkd.getSnmpAgentConfig(getPrimaryIpAddress(), getLocation());
        try {
            m_linkd.getLocationAwareSnmpClient().walk(peer,
                                                      ipNetToMediaTableTracker).withDescription("ipNetToMedia").withLocation(getLocation()).execute().get();
        } catch (ExecutionException e) {
            LOG.info("run: node [{}]: Agent error while scanning the ipNetToMedia table", 
                     getNodeId(),
                     e);
            return;
        } catch (final InterruptedException e) {
            LOG.info("run: [{}]: collection interrupted, exiting",
                     getNodeId(),
                     e);
            return;       
        }

        m_linkd.getQueryManager().reconcileIpNetToMedia(getNodeId(), now);
    }


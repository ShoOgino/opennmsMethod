	protected void runCollection() {

	        LOG.info("run: start: node discovery operations for bridge: '{}'",getNodeId());
		final Date now = new Date();

		LOG.debug("run: collecting: {}", getPeer());
		Map<Integer,String> vlanmap = getVtpVlanMap();
		Map<Integer,Integer> bridgeifindex = new HashMap<Integer, Integer>();
		List<BridgeMacLink> bft = new ArrayList<BridgeMacLink>();
		
		if (vlanmap.isEmpty()) {
			bridgeifindex.putAll(walkDot1d(null,null));
                        bft = walkDot1dTpFdp(null,bridgeifindex,bft);
		} else {
			String community = getPeer().getReadCommunity();
			for (Entry<Integer, String> entry: vlanmap.entrySet()) {
				LOG.debug("run: cisco vlan collection setting peer community: {} with VLAN {}",
						community, entry.getKey());
				getPeer().setReadCommunity(community + "@" + entry.getKey());
				bridgeifindex.putAll(walkDot1d(entry.getKey(), entry.getValue()));
			        bft = walkDot1dTpFdp(entry.getKey(),bridgeifindex,bft);

			}
			getPeer().setReadCommunity(community);
		}
		LOG.debug("run: found on node: '{}' bridge ifindex map {}",getNodeId(), bridgeifindex);
		bft = walkDot1qTpFdb(bridgeifindex,bft);
		m_linkd.getQueryManager().store(getNodeId(), bft);
                LOG.debug("run: reconciling bridge: '{}' time {}",getNodeId(), now);
		m_linkd.getQueryManager().reconcileBridge(getNodeId(), now);
                LOG.debug("run: updating topology bridge: '{}'",getNodeId());
                LOG.info("run: end: node discovery operations for bridge: '{}'",getNodeId());
	}


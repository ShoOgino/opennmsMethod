        Object constructValue(final ApplicationContext context) {
            
        	final String type = getType();
        	Class<?> typeClass = Object.class;
            if (type != null) {
            	final PropertyEditor classEditor = getDefaultEditor(Class.class);
                classEditor.setAsText(type);
                typeClass = (Class<?>)classEditor.getValue();
            }
        
            final String value = getValue();
            if (value != null) {
                if (typeClass == String.class) {
                    return value;
                } else {
                    try {
                        final PropertyEditor valueEditor = getDefaultEditor(typeClass);
                        valueEditor.setAsText(value);
                        return valueEditor.getValue();
                    } catch (Exception e) {
                        throw new IllegalArgumentException("Unable to find a property editor for " + typeClass);
                    }
                }
            }
            
            final String ref = getRef();
            if (ref != null) {
            	return context.getBean(ref, typeClass);
            }
            
            throw new IllegalArgumentException("One of either the value or the ref must be specified");
            
        }


    @Test
    public void testDontFlapWhenOnlyTwoOutages() throws Exception {
        
        DroolsCorrelationEngine engine = findEngineByName("locationMonitorRules");

        engine.correlate(createRemoteNodeLostServiceEvent(1, "192.168.1.1", "AVAIL", 7));
        
        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeLostServiceEvent(1, "192.168.1.1", "HTTP", 7));

        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeRegainedServiceEvent(1, "192.168.1.1", "AVAIL", 7));
        
        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeRegainedServiceEvent(1, "192.168.1.1", "HTTP", 7));
        
        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeLostServiceEvent(1, "192.168.1.1", "AVAIL", 7));
        
        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeLostServiceEvent(1, "192.168.1.1", "HTTP", 7));

        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeRegainedServiceEvent(1, "192.168.1.1", "AVAIL", 7));
        
        Thread.sleep(50);
        
        engine.correlate(createRemoteNodeRegainedServiceEvent(1, "192.168.1.1", "HTTP", 7));
        
        m_anticipatedMemorySize = 6;
        
        Thread.sleep(100);
        
        verify(engine);
        
        Thread.sleep(1000);
        
        m_anticipatedMemorySize = 0;
        
        verify(engine);

    }


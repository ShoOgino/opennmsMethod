    @Override
	protected void setUp() throws Exception {
		super.setUp();
		
    	m_anticipator = m_eventIpcMgr.getEventAnticipator();

        TimerFactoryBean timerFactory = new TimerFactoryBean();
        timerFactory.afterPropertiesSet();
        m_timer = (Timer)timerFactory.getObject();

        
        String[] ueis = {
                EventConstants.REMOTE_NODE_LOST_SERVICE_UEI,
                EventConstants.REMOTE_NODE_REGAINED_SERVICE_UEI
        };
        
        Map<String, Object> globals = new HashMap<String, Object>();
        globals.put("WIDE_SPREAD_THRESHOLD", new Integer(3));
        globals.put("FLAP_INTERVAL", new Long(1000));
        globals.put("FLAP_COUNT", new Integer(3));
        
        
        m_engine = new DroolsCorrelationEngine();

        Resource rules = new ClassPathResource("Correlation.drl", m_engine.getClass());

		m_engine.setEventIpcManager(m_eventIpcMgr);
		m_engine.setScheduler(m_timer);
        m_engine.setInterestingEvents(Arrays.asList(ueis));
        m_engine.setRulesResources(Collections.singletonList(rules));
        m_engine.setGlobals(globals);

        m_engine.afterPropertiesSet();
		
	}


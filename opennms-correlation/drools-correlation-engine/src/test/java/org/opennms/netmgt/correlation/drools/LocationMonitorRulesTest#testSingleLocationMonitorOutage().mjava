    @Test
    public void testSingleLocationMonitorOutage() throws Exception {

        resetAnticipated();

        DroolsCorrelationEngine engine = findEngineByName("locationMonitorRules");

        // receive outage event for only a single monitor
        engine.correlate(createPerspectiveNodeLostServiceEvent(1, "192.168.1.1", "HTTP", 7));

        // expect memory to contain only the single 'application' for this service
        m_anticipatedMemorySize = 2;

        verify(engine);

        engine.correlate(createPerspectiveNodeRegainedServiceEvent(1, "192.168.1.1", "HTTP", 7));

        m_anticipatedMemorySize = 2;

        verify(engine);

        // let flaps time out
        Thread.sleep(1100);

        m_anticipatedMemorySize = 0;

        verify(engine);
    }


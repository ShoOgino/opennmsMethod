    @Test
    public void aggregateWithInterval() throws Exception {
        SinkModuleWithAggregateAndInterval aggregatingSinkModule = new SinkModuleWithAggregateAndInterval();
        try(MessageProducer<UDPPacket> producer = capturingProducerFactory.getProducer(aggregatingSinkModule)) {
            // Send less than COMPLETION_SIZE packets
            assertThat(COMPLETION_SIZE, greaterThan(1));
            UDPPacket packet = new UDPPacket(localhost, ByteBuffer.wrap(new byte[]{(byte)42}));
            producer.send(packet);

            // Now wait until the aggregate is dispatched
            await().atMost(4 * COMPLETION_INTERVAL_MS, MILLISECONDS)
                .pollDelay(50, MILLISECONDS)
                .until(() -> dispatchedMessages, hasSize(1));
        }
    }


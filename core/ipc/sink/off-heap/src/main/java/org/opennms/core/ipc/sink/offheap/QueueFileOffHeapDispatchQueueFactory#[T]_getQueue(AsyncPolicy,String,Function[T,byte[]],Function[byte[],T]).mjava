    @Override
    public <T> DispatchQueue<T> getQueue(AsyncPolicy asyncPolicy, String moduleName, Function<T, byte[]> serializer,
                                         Function<byte[], T> deserializer) {
        if (asyncPolicy.getNumThreads() > inMemoryEntrySize) {
            throw new IllegalArgumentException("The in memory queue size must be greater than or equal to the number" +
                    " of consuming threads");
        }

        return (DispatchQueue<T>) queues.computeIfAbsent(moduleName, (k) -> {
            try {
                return new QueueFileOffHeapDispatchQueue<>(serializer, deserializer, k, baseFilePath,
                        inMemoryEntrySize, batchSize,
                        offHeapSize);
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        });
    }


        byte[] toSerializedBatchAndClear() throws IOException, ExecutionException, InterruptedException {
            List<byte[]> serializedMessages = serdesPool.submit(() ->
                    batchedMessages.parallelStream()
                            .map(serializer)
                            .collect(Collectors.toList())).get();
            byte[] serializedBatch = new SerializedBatch(serializedMessages).toBytes();
            batchedMessages.clear();

            return serializedBatch;
        }


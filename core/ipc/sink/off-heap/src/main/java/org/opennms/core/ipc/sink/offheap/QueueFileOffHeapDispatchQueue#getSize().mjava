    @Override
    public int getSize() {
        if (offHeapQueue == null) {
            return inMemoryQueue.size();
        } else {
            offHeapLock.lock();
            try {
                return inMemoryQueue.size() + (offHeapQueue.size() * batchSize) + batch.size();
            } finally {
                offHeapLock.unlock();
            }
        }
    }


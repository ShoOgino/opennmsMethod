    @SuppressWarnings("unchecked")
    @Override
    public <T extends Message> void registerConsumer(MessageConsumer<T> consumer)
            throws Exception {
        if (consumer == null) {
            return;
        }

        try (MDCCloseable mdc = Logging.withPrefixCloseable(MessageConsumerManager.LOG_PREFIX)) {
            LOG.info("Registering consumer: {}", consumer);
            final SinkModule<Message> module = (SinkModule<Message>)consumer.getModule();
            consumersByModule.put(module, (MessageConsumer<Message>)consumer);
            if (!routeIdsByModule.containsKey(module)) {
                LOG.info("Creating route for module: {}", module);
                final DynamicIpcRouteBuilder routeBuilder = new DynamicIpcRouteBuilder(context, this, (SinkModule<Message>)consumer.getModule());
                context.addRoutes(routeBuilder);
                routeIdsByModule.put(module, routeBuilder.getRouteId());
            }
        }
    }


    @Test
    public void canUseForeignIdAsSystemId() {
        final Map<String, Object> attributes = new HashMap<>();
        attributes.put(RpcTargetHelper.SYSTEM_ID_KEY, "yy");
        attributes.put(RpcTargetHelper.USE_FOREIGN_IS_AS_SYSTEM_ID_KEY, Boolean.TRUE.toString());

        final OnmsNode node = mock(OnmsNode.class);
        when(node.getForeignId()).thenReturn("aa");
        final NodeDao nodeDao = mock(NodeDao.class);
        when(nodeDao.get(1)).thenReturn(node);

        final RpcTarget target = new RpcTargetHelper().target()
                .withSystemId("y")
                .withServiceAttributes(attributes)
                .withNodeId(1)
                .withNodeDao(nodeDao)
                .build();
        assertThat(target.getLocation(), nullValue());
        assertThat(target.getSystemId(), equalTo("aa"));
    }


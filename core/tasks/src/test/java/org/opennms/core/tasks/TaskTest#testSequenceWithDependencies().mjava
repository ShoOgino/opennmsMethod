    @Test
    public void testSequenceWithDependencies() throws Exception {
        
        
        List<String> sequence = new Vector<>();
        
        AbstractTask task1 = createTask(appender(sequence, "task1"));
        AbstractTask task2 = createTask(appender(sequence, "task2"));

        SequenceTask seq = createSequence();

        seq.add(appender(sequence, "subtask1"));
        seq.add(appender(sequence, "subtask2"));
        seq.add(appender(sequence, "subtask3"));
        
        seq.addPrerequisite(task1);
        task2.addPrerequisite(seq);

        seq.schedule();

        task1.schedule();
        
        task2.schedule();
        
        task2.waitFor(3500, TimeUnit.MILLISECONDS);
        
        assertArrayEquals(new String[] { "task1", "subtask1", "subtask2", "subtask3", "task2" }, sequence.toArray(new String[0]));
    }


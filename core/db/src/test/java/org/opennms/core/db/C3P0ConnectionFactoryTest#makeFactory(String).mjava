    private C3P0ConnectionFactory makeFactory(String database) throws MarshalException, ValidationException, PropertyVetoException, SQLException, IOException {
        InputStream stream = new ByteArrayInputStream(ConfigurationTestUtils.getConfigForResourceWithReplacements(this, ConfigFileConstants.getFileName(ConfigFileConstants.OPENNMS_DATASOURCE_CONFIG_FILE_NAME)).getBytes());
        DataSourceConfigurationFactory factory = new DataSourceConfigurationFactory(stream);
        try {
            factory.getJdbcDataSource("opennms").marshal(new OutputStreamWriter(System.err));
            System.err.println();
            return new C3P0ConnectionFactory(factory.getJdbcDataSource("opennms"));
        } finally {
            IOUtils.closeQuietly(stream);
        }
    }


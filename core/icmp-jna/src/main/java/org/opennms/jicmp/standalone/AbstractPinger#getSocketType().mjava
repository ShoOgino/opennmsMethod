    public static int getSocketType() {
        if (
            // If the user has set an environment variable
            "1".equals(System.getenv(SOCK_DGRAM_ENVIRONMENT_VARIABLE)) || 
            "true".equalsIgnoreCase(System.getenv(SOCK_DGRAM_ENVIRONMENT_VARIABLE)) ||
            // or we're on Mac OS X where SOCK_DGRAM ping is supported by the kernel 
            Platform.isMac()
        ) {
            return NativeDatagramSocket.SOCK_DGRAM;
        } else {
            return NativeDatagramSocket.SOCK_RAW;
        }
    }


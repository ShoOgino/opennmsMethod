    public EmbeddedElasticSearchServer(Settings settings, List<Class<? extends Plugin>> plugins) {
        final String homeDirectory = settings.get(Environment.PATH_HOME_SETTING.getKey());
        if (homeDirectory == null || homeDirectory.isEmpty()) {
            throw new IllegalArgumentException("Value for " + Environment.PATH_HOME_SETTING.getKey() + " is null or empty.");
        }
        this.settings = settings;
        this.plugins = new LinkedHashSet<>(plugins);
        this.plugins.addAll(ALWAYS_ON_PLUGINS);
    }


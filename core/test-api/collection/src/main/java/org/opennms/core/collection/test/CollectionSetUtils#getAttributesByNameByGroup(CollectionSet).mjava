    public static Map<String, Map<String, CollectionAttribute>> getAttributesByNameByGroup(CollectionSet collectionSet) {
        final Map<String, Map<String, CollectionAttribute>> attributesByNameByGroup = Maps.newHashMap();
        collectionSet.visit(new AbstractCollectionSetVisitor() {
            private String groupName = null;
            private Map<String, CollectionAttribute> attributesByName = Maps.newHashMap();

            @Override
            public void visitGroup(AttributeGroup group) {
                groupName = group.getName();
            }

            @Override
            public void visitAttribute(CollectionAttribute attribute) {
                attributesByName.put(attribute.getName(), attribute);
            }

            @Override
            public void completeGroup(AttributeGroup group) {
                attributesByNameByGroup.put(groupName, attributesByName);
                attributesByName = Maps.newHashMap();
            }
        });
        return attributesByNameByGroup;
    }


    protected static String getQueryString(final Map<?,?> parameters) {
        final StringBuffer sb = new StringBuffer();

        try {
            for (final Entry<?,?> entry : parameters.entrySet()) {
                final Object key = entry.getKey();
                if (key instanceof String) {
                    final Object value = entry.getValue();
                    String[] valueEntries = null;
                    if (value instanceof String[]) {
                        valueEntries = (String[])value;
                    } else if (value instanceof String) {
                        valueEntries = new String[] { (String)value };
                    } else {
                        LOG.warn("value was not a string or string array! ({})", value);
                        continue;
                    }

                    for (final String valueEntry : valueEntries) {
                        sb.append(URLEncoder.encode((String)key, StandardCharsets.UTF_8.name())).append("=").append(URLEncoder.encode((String)valueEntry, StandardCharsets.UTF_8.name())).append("&");
                    }
                } else {
                    LOG.warn("key was not a string! ({})", key);
                }
            }
        } catch (final UnsupportedEncodingException e) {
            LOG.warn("unsupported encoding UTF-8?!?  WTF??!", e);
        }

        return sb.toString();
    }


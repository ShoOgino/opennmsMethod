    public void setupDatabase() throws TemporaryDatabaseException {
        try {
            setDataSource(new SimpleDataSource(m_driver, m_url + getTestDatabase(), m_adminUser, m_adminPassword));
            setAdminDataSource(new SimpleDataSource(m_driver, m_url + ADMIN_DATABASE, m_adminUser, m_adminPassword));
            m_xaDataSource = createPgXADataSource("localhost", getTestDatabase());
            m_adminXaDataSource = createPgXADataSource("localhost", ADMIN_DATABASE);
        } catch (final ClassNotFoundException e) {
            throw new TemporaryDatabaseException("Failed to initialize driver " + m_driver + ": " + e.getMessage(), e);
        }

        if (!m_useExisting) {
            // Synchronize around a static mutex to prevent multiple connections
            // to the template1 database
            synchronized(TEMPLATE1_MUTEX) {
                createTestDatabase();
            }
        }

        setJdbcTemplate(new JdbcTemplate(this));

        // Test connecting to test database and ensuring we can do a basic query
        try {
            getJdbcTemplate().queryForObject("SELECT now()", Date.class);
        } catch (DataAccessException e) {
            throw new TemporaryDatabaseException("Error occurred while testing database is connectable: " + e.getMessage(), e);
        }

        if (!m_useExisting) {
            setupBlame(getJdbcTemplate(), getBlame());
        }
    }


    public void setupDatabase() throws TemporaryDatabaseException {

        try {
            setDataSource(new SimpleDataSource(m_driver, m_url + getTestDatabase(), m_adminUser, m_adminPassword));
            setAdminDataSource(new SimpleDataSource(m_driver, m_url + "template1", m_adminUser, m_adminPassword));
            m_xaDataSource = new PGXADataSource();
            m_xaDataSource.setServerName("localhost");
            m_xaDataSource.setDatabaseName(getTestDatabase());
            m_xaDataSource.setUser(m_adminUser);
            m_xaDataSource.setPassword(m_adminPassword);
            m_adminXaDataSource = new PGXADataSource();
            m_adminXaDataSource.setServerName("localhost");
            m_adminXaDataSource.setDatabaseName("template1");
            m_adminXaDataSource.setUser(m_adminUser);
            m_adminXaDataSource.setPassword(m_adminPassword);
        } catch (final ClassNotFoundException e) {
            throw new TemporaryDatabaseException("Failed to initialize driver " + m_driver, e);
        }

        if (!m_useExisting) {
            // Synchronize around a static mutex to prevent multiple connections
            // to the template1 database
            synchronized(TEMPLATE1_MUTEX) {
                createTestDatabase();
            }
        }

        // Test connecting to test database.
        try {
            getConnection().close();
        } catch (final SQLException e) {
            throw new TemporaryDatabaseException("Error occurred while testing database is connectable.", e);
        }
        setJdbcTemplate(new JdbcTemplate(this));
    }


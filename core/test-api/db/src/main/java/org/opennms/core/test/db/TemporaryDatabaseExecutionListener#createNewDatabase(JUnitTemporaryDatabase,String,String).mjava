    private static TemporaryDatabase createNewDatabase(JUnitTemporaryDatabase jtd, String className, String methodName) throws Exception {
        boolean useExisting = false;
        if (jtd.useExistingDatabase() != null) {
            useExisting = !jtd.useExistingDatabase().equals("");
        }

        final String dbName = useExisting ? jtd.useExistingDatabase() : null;

        final TemporaryDatabase retval = ((jtd.tempDbClass()).getConstructor(String.class, Boolean.TYPE).newInstance(dbName, useExisting));
        retval.setPopulateSchema(jtd.createSchema() && !useExisting);
        if (className != null) {
            retval.setClassName(className);
        }
        if (methodName != null) {
            retval.setMethodName(methodName);
        }
        StringBuffer b = new StringBuffer();
        if (jtd.useExistingDatabase() != null && !"".equals(jtd.useExistingDatabase())) {
            b.append("use existing database: " + jtd.useExistingDatabase() + " ");
        }
        b.append("reuse database: " + jtd.reuseDatabase());
        retval.setTestDetails(b.toString());
        retval.create();
        return retval;
    }


    @Before
    public void setUp() throws Exception {
        // Reset any previous test failures
        setTestFailureThrowable(null);

        TemporaryDatabasePostgreSQL.failIfUnitTest();
        
        m_leaveDatabase = "true".equals(System.getProperty(LEAVE_PROPERTY));
        m_leaveDatabaseOnFailure = "true".equals(System.getProperty(LEAVE_ON_FAILURE_PROPERTY));

        setTestDatabase(getTestDatabaseName());
        
        setDataSource(new SimpleDataSource(m_driver, m_url + getTestDatabase(), m_adminUser, m_adminPassword));
        setAdminDataSource(new SimpleDataSource(m_driver, m_url + "template1", m_adminUser, m_adminPassword));

        createTestDatabase();

        generateBlame();

        // Test connecting to test database.
        getConnection().close();

        m_initialized = true;
    }


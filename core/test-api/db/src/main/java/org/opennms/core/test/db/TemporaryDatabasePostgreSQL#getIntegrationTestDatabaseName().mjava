    public synchronized static String getIntegrationTestDatabaseName() throws Throwable {
        if (s_templateDatabaseName == null) {
            GenericApplicationContext context = Migrator.ensureLiquibaseFilesInClassPath(new StaticApplicationContext());
            String hash = generateLiquibaseHash(context);

            String dbName = TEMPLATE_DATABASE_NAME_PREFIX + hash;

            final Migration migration = createMigration(dbName);

            DataSource dataSource = new SimpleDataSource("org.postgresql.Driver", "jdbc:postgresql://localhost:5432/" + migration.getDatabaseName(), migration.getDatabaseUser(), migration.getDatabasePassword());
            DataSource adminDataSource = new SimpleDataSource("org.postgresql.Driver", "jdbc:postgresql://localhost:5432/template1", migration.getDatabaseUser(), migration.getDatabasePassword());

            final Migrator migrator = createMigrator(dataSource, adminDataSource);

            if (!migrator.databaseExists(migration)) {
                createIntegrationTestDatabase(context, migration, migrator, dataSource);
            }

            s_templateDatabaseName = dbName;
        }

        return s_templateDatabaseName;
    }


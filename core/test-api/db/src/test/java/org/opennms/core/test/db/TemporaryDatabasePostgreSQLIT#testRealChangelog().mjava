    @Test
    public void testRealChangelog() throws Throwable {
        String dbName = TemporaryDatabasePostgreSQL.TEMPLATE_DATABASE_NAME_PREFIX + System.currentTimeMillis();

        GenericApplicationContext context = TemporaryDatabasePostgreSQL.ensureLiquibaseFilesInClassPath(new StaticApplicationContext());

        final Migration migration = TemporaryDatabasePostgreSQL.createMigration(dbName);

        DataSource dataSource = new SimpleDataSource("org.postgresql.Driver", "jdbc:postgresql://localhost:5432/" + migration.getDatabaseName(), migration.getDatabaseUser(), migration.getDatabasePassword());
        DataSource adminDataSource = new SimpleDataSource("org.postgresql.Driver", "jdbc:postgresql://localhost:5432/template1", migration.getDatabaseUser(), migration.getDatabasePassword());

        final Migrator migrator = TemporaryDatabasePostgreSQL.createMigrator(dataSource, adminDataSource);

        TemporaryDatabasePostgreSQL.createIntegrationTestDatabase(context, migration, migrator, dataSource);

        migrator.databaseRemoveDB(migration);
    }


    public void migrate(Migration migration) throws MigrationException {
        Database db;
        try {
            db = CommandLineUtils.createDatabaseObject(
                getMigrationClassLoader(migration),
                migration.getJdbcUrl(),
                migration.getAdminUser(),
                migration.getAdminPassword(),
                migration.getJdbcDriver(),
                "public",
                null);
        } catch (JDBCException e) {
            throw new MigrationException("unable to get database implementation for migration " + migration, e);
        }

        if (db != null) {
            FileSystemFileOpener fsOpener = new FileSystemFileOpener();
            CommandLineFileOpener clOpener = new CommandLineFileOpener(getMigrationClassLoader(migration));
            CompositeFileOpener fileOpener = new CompositeFileOpener(fsOpener, clOpener);
            Liquibase liquibase = new Liquibase(migration.getChangeLog(), fileOpener, db);
            try {
                liquibase.update(null);
            } catch (LiquibaseException e) {
                throw new MigrationException("unable to update the database", e);
            }
        }
        
    }


    // XXX This should be in a test context only
    public static GenericApplicationContext ensureLiquibaseFilesInClassPath(GenericApplicationContext context)
            throws MalformedURLException, IOException, Exception {
        String migratorClass = "/" + Migrator.class.getName().replace('.', '/') + ".class";
        URL migratorUrl = Migrator.class.getResource(migratorClass);
        assert migratorUrl != null : "Could not find resource for Migrator.class anywhere in the classpath with " + migratorClass;
        if ("file".equals(migratorUrl.getProtocol()) && migratorUrl.getPath().endsWith("core/schema/target/classes" + migratorClass)) {
            URL[] urls = { new URL(migratorUrl.getProtocol(), migratorUrl.getHost(), migratorUrl.getFile().replaceFirst("core/schema/target/classes/.*$", "core/schema/src/main/liquibase/")) };
            context.setClassLoader(new URLClassLoader(urls, context.getClassLoader()));
        }

        validateLiquibaseChangelog(context);

        return context;
    }


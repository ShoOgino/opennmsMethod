    public void setupDatabase(Migration migration, boolean updateDatabase, boolean vacuum, boolean fullVacuum, boolean iplike, ApplicationContext context) throws MigrationException, Exception, IOException {
        validateDatabaseVersion();

        if (updateDatabase) {
            prepareDatabase(migration);
        }

        checkUnicode(migration);
        checkTime(migration);

        if (updateDatabase) {
            databaseSetOwner(migration);

            for (final Resource resource : context.getResources(LIQUIBASE_CHANGELOG_LOCATION_PATTERN)) {
                if (m_liquibaseChangelogFilter != null && !m_liquibaseChangelogFilter.test(resource)) {
                    continue;
                }
                LOG.info("- Running migration for changelog: " + resource.getDescription());
                migration.setAccessor(new ExistingResourceAccessor(resource));
                migrate(migration);
            }
        }

        if (vacuum) {
            vacuumDatabase(fullVacuum);
        }

        if (iplike) {
            updateIplike();
        }
    }


    @Override
    public <T> T lookup(C criteria, F filter) {
        Objects.requireNonNull(criteria);

        // Lookup
        T service = delegate.lookup(criteria, filter);
        if (service != null) {
            return service;
        }

        // A service matching the filter is not currently available.
        // Wait until the system has finished starting up (uptime >= grace period)
        // while ensuring we've waited for at least WAIT_PERIOD_MS before aborting the search.
        final long waitUntil = System.currentTimeMillis() + this.waitTimeMs;
        while (uptimeSupplier.get() < this.gracePeriodInMs
                || System.currentTimeMillis() < waitUntil) {
            try {
                Thread.sleep(this.lookupDelayMs);
            } catch (InterruptedException e) {
                LOG.error("Interrupted while waiting for service with search criteria " + criteria + " to become available in the service registry. Aborting.");
                return null;
            }
            service = delegate.lookup(criteria, filter);
            if (service != null) {
                return service;
            }
        }

        // Couldn't find a service within the defined time
        return null;
    }


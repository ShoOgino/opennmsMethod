    /**
     * ZIP a directory.
     *
     * @param zipFile the output ZIP file
     * @param sourceFolder the source folder
     * @throws OnmsUpgradeException the OpenNMS upgrade exception
     */
    protected void zipDir(File zipFile, File sourceFolder) throws OnmsUpgradeException {
        try {
            List<String> filesListInDir = new ArrayList<String>();
            populateFilesList(sourceFolder, filesListInDir);
            FileOutputStream fos = new FileOutputStream(zipFile);
            ZipOutputStream zos = new ZipOutputStream(fos);
            for(String filePath : filesListInDir){
                log("  Zipping %s\n", filePath);
                ZipEntry ze = new ZipEntry(filePath.substring(sourceFolder.getAbsolutePath().length() + 1, filePath.length()));
                zos.putNextEntry(ze);
                FileInputStream fis = new FileInputStream(filePath);
                byte[] buffer = new byte[1024];
                int len;
                while ((len = fis.read(buffer)) > 0) {
                    zos.write(buffer, 0, len);
                }
                zos.closeEntry();
                fis.close();
            }
            zos.flush();
            zos.close();
            fos.close();
        } catch (Exception e) {
            throw new OnmsUpgradeException("Cannot ZIP directory because " + e.getMessage(), e);
        }
    }


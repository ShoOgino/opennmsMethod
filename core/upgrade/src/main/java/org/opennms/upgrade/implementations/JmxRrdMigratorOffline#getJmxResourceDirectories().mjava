    /**
     * Gets the JMX resource directories.
     *
     * @return the JMX resource directories
     * @throws OnmsUpgradeException the OpenNMS upgrade exception
     */
    private List<File> getJmxResourceDirectories() throws OnmsUpgradeException {
        if (jmxResourceDirectories == null) {
            jmxResourceDirectories = new ArrayList<File>();
            CollectdConfiguration config;
            try {
                config = CollectdConfigFactory.getInstance().getCollectdConfig().getConfig();
            } catch (Exception e) {
                throw new OnmsUpgradeException("Can't upgrade the JRBs because " + e.getMessage(), e);
            }
            List<String> services = getJmxServices(config);
            log("JMX services found: %s\n", services);
            List<String> jmxFriendlyNames = new ArrayList<String>();
            for (String service : services) {
                Service svc = getServiceObject(config, service);
                String friendlyName = getSvcPropertyValue(svc, "friendly-name");
                jmxFriendlyNames.add(friendlyName);
            }
            log("JMX friendly names found: %s\n", jmxFriendlyNames);
            File rrdDir = new File(JMXDataCollectionConfigFactory.getInstance().getRrdPath());
            findJmxDirectories(rrdDir, jmxFriendlyNames, jmxResourceDirectories);
        }
        return jmxResourceDirectories;
    }


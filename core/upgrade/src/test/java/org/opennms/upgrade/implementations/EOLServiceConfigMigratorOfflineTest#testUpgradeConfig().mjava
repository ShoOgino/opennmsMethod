    /**
     * Test fixing the configuration file.
     *
     * @throws Exception the exception
     */
    @Test
    public void testUpgradeConfig() throws Exception {
        File cfgFile = ConfigFileConstants.getFile(ConfigFileConstants.SERVICE_CONF_FILE_NAME);
        ServiceConfiguration cfg = JaxbUtils.unmarshal(ServiceConfiguration.class, cfgFile);

        // check the total and active services before doing the upgrade
        assertEquals(m_totalBefore, cfg.getServiceCount());

        // perform the upgrade
        final EOLServiceConfigMigratorOffline migrator = new EOLServiceConfigMigratorOffline();
        migrator.execute();

        // confirm the total and active services after the upgrade
        cfg = JaxbUtils.unmarshal(ServiceConfiguration.class, cfgFile);
        final ServiceConfigFactory factory = new ServiceConfigFactory();
        Assert.assertEquals(m_totalAfter, cfg.getServiceCount());
        Assert.assertEquals(m_enabledAfter, factory.getServices().length);

        for (final Service svc : cfg.getServiceCollection()) {
            final String serviceName = svc.getName();
            if (m_disabled.contains(serviceName)) {
                assertFalse("Service " + serviceName + " should be disabled.", svc.isEnabled());
            }
        }
        for (final Service svc : factory.getServices()) {
            final String serviceName = svc.getName();
            assertFalse("Service " + serviceName + " should not be in the active service list.", m_disabled.contains(svc.getName()));
        }
    }


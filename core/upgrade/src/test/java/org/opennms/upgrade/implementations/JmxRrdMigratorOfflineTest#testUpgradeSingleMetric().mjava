    /**
     * Test upgrade (single-metric JRBs, i.e. storeByGroup=false).
     *
     * @throws Exception the exception
     */
    @Test
    public void testUpgradeSingleMetric() throws Exception {
        FileUtils.copyDirectory(new File("src/test/resources/rrd"), new File("target/home/rrd"));

        executeUpgrader();

        File rrdDir = new File("target/home/rrd/1/opennms-jvm/");
        for (File file : getFiles(rrdDir, ".jrb")) {
            RrdDb jrb = new RrdDb(file, true);
            String ds = jrb.getDsNames()[0];
            jrb.close();
            Assert.assertFalse(ds.contains("."));
            Assert.assertEquals(file.getName(), ds + ".jrb");
        }
        for (File file : getFiles(rrdDir, ".meta")) {
            String ds = file.getName().replaceFirst("\\.meta", "");
            Properties p = new Properties();
            p.load(new FileReader(file));
            for (Object o : p.keySet()) {
                String key = (String) o;
                Assert.assertTrue(key.endsWith(ds));
                Assert.assertEquals(ds, p.getProperty(key));
            }
        }
    }


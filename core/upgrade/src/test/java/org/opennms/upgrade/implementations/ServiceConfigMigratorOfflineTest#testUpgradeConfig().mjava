    /**
     * Test fixing the configuration file.
     *
     * @throws Exception the exception
     */
    @Test
    public void testUpgradeConfig() throws Exception {
        File cfgFile = ConfigFileConstants.getFile(ConfigFileConstants.SERVICE_CONF_FILE_NAME);
        ServiceConfiguration cfg = JaxbUtils.unmarshal(ServiceConfiguration.class, cfgFile);

        // check the total and active services before doing the upgrade
        assertEquals(m_totalBefore, cfg.getServiceCount());

        // perform the upgrade
        final ServiceConfigMigratorOffline migrator = new ServiceConfigMigratorOffline();
        migrator.execute();

        // confirm the total and active services after the upgrade
        cfg = JaxbUtils.unmarshal(ServiceConfiguration.class, cfgFile);
        final ServiceConfigFactory factory = new ServiceConfigFactory();
        Assert.assertEquals(m_totalAfter, cfg.getServiceCount());
        Assert.assertEquals(m_enabledAfter, factory.getServices().length);

        for (final Service svc : cfg.getServiceCollection()) {
            if ("OpenNMS:Name=Linkd".equals(svc.getName())) {
                assertFalse(svc.isEnabled());
            };
            if ("OpenNMS:Name=Xmlrpcd".equals(svc.getName())) {
                assertFalse(svc.isEnabled());
            };
            if ("OpenNMS:Name=XmlrpcProvisioner".equals(svc.getName())) {
                assertFalse(svc.isEnabled());
            };
            if ("OpenNMS:Name=AccessPointMonitor".equals(svc.getName())) {
                assertFalse(svc.isEnabled());
            };
        }
    }


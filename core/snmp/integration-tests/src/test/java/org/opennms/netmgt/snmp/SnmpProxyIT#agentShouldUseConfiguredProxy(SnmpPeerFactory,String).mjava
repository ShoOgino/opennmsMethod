    public void agentShouldUseConfiguredProxy(final SnmpPeerFactory snmpAgentConfigFactory,
                                              final String targetHost) throws Exception {

        final List<SnmpObjId> snmpObjIds = Collections.singletonList(SnmpObjId.get(".1.3.6.1.2.1.1.2"));

        final SnmpAgentConfig agent = snmpAgentConfigFactory.getAgentConfig(InetAddress.getByName(targetHost));
        final CompletableFuture<List<SnmpResult>> future = locationAwareSnmpClient.walk(agent, snmpObjIds)
                .withDescription("snmp:walk")
                .execute();

        future.get(1, TimeUnit.SECONDS)
                .forEach(res -> {
                    LOG.info("[{}].[{}] = {}", res.getBase(), res.getInstance(), res.getValue());
                });
        // if we get to here all is good, test passed => we have received an answer from the proxy, otherwise a
        // TimeoutException is thrown.
    }


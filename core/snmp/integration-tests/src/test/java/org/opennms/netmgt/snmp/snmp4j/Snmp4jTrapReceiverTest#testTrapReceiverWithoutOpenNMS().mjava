    /*
     * IMPORTANT:
     *
     * The sentence <code>snmp.getUSM().addUser(...)</code>, is the only requirement in order to properly process SNMPv3 traps.
     * This is related with the credentials that should be created for Trapd in order to properly authenticate and/or decode SNMPv3 traps in OpennMS.
     * This is a user that should be configured (or should be used) by the external  devices to send SNMPv3 Traps to OpenNMS.
     * The SNMPv3 users should be configured in trapd-configuration.xml
     *
     */
    @Test
    public void testTrapReceiverWithoutOpenNMS() {
        System.out.println("SNMP4J: Register for Traps");
        trapCount = 0;
        DefaultUdpTransportMapping transportMapping = null;
        Snmp snmp = null;

        try {
            transportMapping = new DefaultUdpTransportMapping(new UdpAddress(9162));
            snmp = new Snmp(transportMapping);
            
            snmp.addCommandResponder(this);
            snmp.getUSM().addUser(
                    new OctetString("opennmsUser"),
                    new UsmUser(new OctetString("opennmsUser"), AuthMD5.ID, new OctetString("0p3nNMSv3"), PrivDES.ID, new OctetString("0p3nNMSv3")));
            snmp.listen();

            sendTraps();
        } catch (final IOException e) {
            LogUtils.debugf(this, e, "Failed to grab UDP port.");
        } catch (final InterruptedException e) {
            LogUtils.debugf(this, e, "Interrupted while sending traps.");
        } catch (Exception e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } finally {
            System.out.println("SNMP4J: Unregister for Traps");
            if (snmp != null) {
                try {
                    snmp.close();
                } catch (final IOException e) {
                    LogUtils.debugf(this, e, "Failed to close Snmp object: " + snmp);
                }
            }
            if (transportMapping != null) {
                try {
                    transportMapping.close();
                } catch (final IOException e) {
                    LogUtils.debugf(this, e, "Failed to close transport mapping: " + transportMapping);
                }
            }
        }

        System.out.println("SNMP4J: Checking Trap status");
        assertEquals(2, trapCount);
    }


    /**
     * We want to make sure that the SnmpClient calls the configured proxy host and not the target destination. Therefor
     * we set up an UDP socket listener and check if 127.0.0.1 (the proxy host) is called.
     */
    @Test
    public void agentShouldUseConfiguredProxy() throws Exception {

        final List<SnmpObjId> snmpObjIds = Collections.singletonList(SnmpObjId.get(".1.3.6.1.2.1.1.2"));
        Resource configuration = createConfiguration(port);
        SnmpPeerFactory snmpAgentConfigFactory = new SnmpPeerFactory(configuration);

        String targetHost = "169.254.1.1";
        final SnmpAgentConfig agent = snmpAgentConfigFactory.getAgentConfig(InetAddress.getByName(targetHost));
        final CompletableFuture<List<SnmpResult>> future = locationAwareSnmpClient.walk(agent, snmpObjIds)
                .withDescription("snmp:walk")
                .execute();

        boolean answerReceived = false;


        while (true) {
            try {
                future.get(1, TimeUnit.SECONDS)
                        .forEach(res -> {
                            LOG.info("[{}].[{}] = {}", res.getBase(), res.getInstance(), res.getValue());
                        });
                answerReceived = true;
                break;
            } catch (TimeoutException e) {
                // pass
            }
            System.out.print(".");
        }

        assertTrue(answerReceived);
    }


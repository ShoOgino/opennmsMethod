    /**
     * We want to make sure that the SnmpClient calls the configured proxy host and not the target destination. Therefor
     * we set up an UDP socket listener and check if 127.0.0.1 (the proxy host) is called.
     */
    @Test
    public void agentShouldUseConfiguredProxy() throws Exception {
        int port = SocketUtils.findAvailableUdpPort();
        UDPListener udpListener = new UDPListener(port);
        executorService.submit(udpListener);

        final List<SnmpObjId> snmpObjIds = Collections.singletonList(SnmpObjId.get(new int[]{port}));
        Resource configuration = createConfiguration(port);
        SnmpPeerFactory snmpAgentConfigFactory = new SnmpPeerFactory(configuration);

        String targetHost = "169.254.1.1";
        final SnmpAgentConfig agent = snmpAgentConfigFactory.getAgentConfig(InetAddress.getByName(targetHost));
        locationAwareSnmpClient.walk(agent, snmpObjIds)
                .withDescription("snmp:walk")
                .execute();

        assertTrue(udpListener.wasCalled);
    }


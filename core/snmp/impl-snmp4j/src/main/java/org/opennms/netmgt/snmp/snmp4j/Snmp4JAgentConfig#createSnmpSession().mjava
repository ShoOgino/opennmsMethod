    public Snmp createSnmpSession() throws IOException {
        final TransportMapping<?> transport = new DefaultUdpTransportMapping();
        final MessageDispatcher disp = new MessageDispatcherImpl();
        final Snmp session;
        // Here we create the SNMP session, while only adding the message processing
        // models we need for the specific agent
        if (!isSnmpV3()) {
            disp.addMessageProcessingModel(new MPv1());
            disp.addMessageProcessingModel(new MPv2c());
            session = new Snmp(disp, transport);
        } else {
            // Make a new USM
            final USM usm = new USM(SecurityProtocols.getInstance(), new OctetString(MPv3.createLocalEngineID()), 0);
            // Add the specified user to the USM
            usm.addUser(
                getSecurityName(),
                new UsmUser(
                    getSecurityName(),
                    getAuthProtocol(),
                    getAuthPassPhrase(),
                    getPrivProtocol(),
                    getPrivPassPhrase()
                )
            );
            disp.addMessageProcessingModel(new MPv3(usm));
            session = new Snmp(disp, transport);
        }
        return session;
    }


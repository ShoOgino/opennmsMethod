    @Test
    public void testFitProfile() throws UnknownHostException {

        // Add profile with custom timeout and ttl
        int timeout = 10000;
        long ttl = 8000;
        SnmpAgentConfig snmpAgentConfig = null;
        SnmpProfiles snmpProfiles = new SnmpProfiles();
        SnmpProfile snmpProfile = new SnmpProfile();
        snmpProfile.setLabel("profile1");
        snmpProfile.setVersion("v1");
        snmpProfile.setTimeout(timeout);
        snmpProfile.setTTL(ttl);
        snmpProfiles.addSnmpProfile(snmpProfile);
        snmpPeerFactory.getSnmpConfig().setSnmpProfiles(snmpProfiles);
        //Profile without filter expression should always match and that would be set.
        CompletableFuture<Optional<SnmpAgentConfig>> future = profileMapper.fitProfile("profile1", InetAddress.getByName("192.0.1.206"), "Minion", ".1.3.6.1.2.1.1.3.0");
        try {
            Optional<SnmpAgentConfig> agentConfig = future.get();
            if (agentConfig.isPresent()) {
                snmpAgentConfig = agentConfig.get();
            }
            assertNotNull(snmpAgentConfig);
            assertEquals(snmpAgentConfig.getTTL().longValue(), ttl);
            assertEquals(snmpAgentConfig.getTimeout(), timeout);
            List<Definition> definitions = snmpPeerFactory.getSnmpConfig().getDefinitions();
            Optional<Definition> definition = definitions.stream().filter(def -> def.getTimeout() == timeout).findFirst();
            assertFalse(definition.isPresent());
        } catch (InterruptedException | ExecutionException e) {
            fail();
        }

    }


    @Test(timeout = 30000)
    public void testFitProfile() throws UnknownHostException {

        // timeout and ttl from profile.
        int timeout = 6000;
        long ttl = 7000;
        SnmpAgentConfig snmpAgentConfig = null;
        URL url = getClass().getResource("/snmp-config3.xml");
        try (InputStream configStream = url.openStream()) {
            setUpProfileMapper(configStream, url);
            //Profile without filter expression should always match and that would be set.
            CompletableFuture<Optional<SnmpAgentConfig>> future = profileMapper.fitProfile("profile1", InetAddress.getByName("192.0.1.206"), "Minion", ".1.3.6.1.2.1.1.3.0");
            Optional<SnmpAgentConfig> agentConfig = future.get();
            if (agentConfig.isPresent()) {
                snmpAgentConfig = agentConfig.get();
            }
            assertNotNull(snmpAgentConfig);
            assertEquals(snmpAgentConfig.getTTL().longValue(), ttl);
            assertEquals(snmpAgentConfig.getTimeout(), timeout);
            // Check that fit profile doesn't actually save definitions in the config.
            List<Definition> definitions = snmpPeerFactory.getSnmpConfig().getDefinitions();
            Optional<Definition> definition = definitions.stream().filter(def -> def.getTimeout() == timeout).findFirst();
            assertFalse(definition.isPresent());
        } catch (InterruptedException | ExecutionException | IOException e) {
            fail();
        }
    }


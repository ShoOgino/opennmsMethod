    @Override
    public void addConnection(ConnectionContext context, ConnectionInfo info) throws Exception {
        if (context.getSecurityContext() == null) {
            // The connection is not yet authenticated, is the remote address trusted?
            authenticateBasedOnRemoteAddress(context, info);
            if (context.getSecurityContext() == null) {
                // We don't trust the remote address, authenticate using JAAS
                synchronized(this) {
                    // The JAAS context may not be currently available, so staal
                    // until it does become available
                    if (!isJaasContextAvailable) {
                        isJaasContextAvailable = waitForJaasContext();
                    }
                }
                authenticateUsingJaas(context, info);
            }
        }
        // Continue calling the chain of filters
        super.addConnection(context, info);
    }


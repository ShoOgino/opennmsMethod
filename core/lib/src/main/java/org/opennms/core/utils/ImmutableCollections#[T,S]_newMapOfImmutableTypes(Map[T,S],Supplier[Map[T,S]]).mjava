    /**
     * Creates an unmodifiable copy of a Map that already contains immutable types. This is essentially a
     * convenience method for avoiding NPE when using a Map copy constructor.
     *
     * @param toCopy      the collection to copy
     * @param mapSupplier a supplier that supplies the desired type of Map
     * @return an unmodifiable Map containing the same elements as in the given Map
     */
    public static <T, S> Map<T, S> newMapOfImmutableTypes(Map<T, S> toCopy, Supplier<Map<T, S>> mapSupplier) {
        if (toCopy == null || toCopy.isEmpty()) {
            return Collections.emptyMap();
        }
        Map<T, S> map = mapSupplier.get();
        map.putAll(toCopy);
        return Collections.unmodifiableMap(map);
    }


    @Override
    public Response perform(Context context) throws Exception {
        // Don't check within this delay period, because the container may not be started yet
        if (ManagementFactory.getRuntimeMXBean().getUptime() <= 10000) {
            return new Response(Starting, "Container is in spin up phase");
        }

        // Verify all bundles
        final Health health = new Health();
        for (Bundle b : bundleContext.getBundles()) {
            final BundleInfo info = bundleService.getInfo(b);
            switch (info.getState()) {
                // Success
                case Active:
                    break;
                // only success if bundle is a fragment bundle
                case Resolved:
                    if ((b.adapt(BundleRevision.class).getTypes() & BundleRevision.TYPE_FRAGMENT) != 0) {
                        break;
                    }
                    health.add(new Response(Failure, "Bundle " + b.getBundleId() + " is resolved, but not active"));
                    break;
                case Waiting:
                case GracePeriod:
                    health.add(new Response(Starting, "Bundle " + b.getBundleId() + " is waiting for dependencies"));
                    break;
                case Installed:
                    health.add(new Response(Starting, "Bundle " + b.getBundleId() + " is not yet started"));
                    break;
                case Starting:
                    health.add(new Response(Starting, "Bundle " + b.getBundleId() + " is starting"));
                    break;
                case Stopping:
                case Failure:
                case Unknown:
                    health.add(new Response(Failure, "Bundle " + b.getBundleId() + " is not started"));
                    break;
            }
        }

        // If there are some issues, we return the worst one, otherwise everything is okay
        return health.getWorst().orElse(new Response(Status.Success));
    }


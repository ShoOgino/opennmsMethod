	/**
	 * Get a JAXB unmarshaller for the given object.  If no JAXBContext is provided,
	 * JAXBUtils will create and cache a context for the given object.
	 * @param obj The object type to be unmarshaled.
	 * @param jaxbContext An optional JAXB context to create the unmarshaller from.
	 * @param validate TODO
	 * @return an Unmarshaller
	 */
	public static Unmarshaller getUnmarshallerFor(final Object obj, final JAXBContext jaxbContext, boolean validate) {
		final Class<?> clazz = (Class<?>)(obj instanceof Class<?> ? obj : obj.getClass());

		Unmarshaller unmarshaller = null;

		Map<Class<?>, Unmarshaller> unmarshallers = m_unMarshallers.get();
		if (jaxbContext == null) {
			if (unmarshallers == null) {
				unmarshallers = new WeakHashMap<Class<?>, Unmarshaller>();
				m_unMarshallers.set(unmarshallers);
			}
			if (unmarshallers.containsKey(clazz)) {
				LogUtils.debugf(clazz, "found unmarshaller for %s", clazz);
				unmarshaller = unmarshallers.get(clazz);
			}
		}
		
		if (unmarshaller == null) {
            try {
                final JAXBContext context;
                if (jaxbContext == null) {
                        context = getContextFor(clazz);
                } else {
                    context = jaxbContext;
                }
                unmarshaller = context.createUnmarshaller();
            } catch (final JAXBException e) {
                throw EXCEPTION_TRANSLATOR.translate("creating XML marshaller", e);
            }
		}

		LogUtils.debugf(clazz, "created unmarshaller for %s", clazz);

		if (validate) {
            final Schema schema = getValidatorFor(clazz);
            if (schema == null) {
                LogUtils.debugf(clazz, "Validation is enabled, but no XSD found for class %s", clazz.getSimpleName());
            }
            unmarshaller.setSchema(schema);
		}
        if (jaxbContext == null) unmarshallers.put(clazz, unmarshaller);

        return unmarshaller;
	}


    /**
     * Create an Unmarshaller for a specific class and configure it with our
     * default configuration details.  In particular, the Unmarshaller is set
     * to not ignore extra attributes and elements.
     * 
     * @param clazz the class to unmarshal
     * @param preserveWhitespace whether to preserve whitespace when parsing
     * @return
     */
    private static <T> Unmarshaller createUnmarshaller(Class<T> clazz, boolean preserveWhitespace) {
        Unmarshaller u = new Unmarshaller(clazz);
        u.setIgnoreExtraAttributes(false);
        u.setIgnoreExtraElements(false);
        u.setWhitespacePreserve(preserveWhitespace);

        /*
         * Disable SAX features that allow XXE attacks
         * See:
         *   http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3004
         *   http://issues.opennms.org/browse/NMS-7291
         */
        u.setProperty(
            "org.exolab.castor.sax.features",
            "http://apache.org/xml/features/disallow-doctype-decl"
        );
        u.setProperty(
            "org.exolab.castor.sax.features-to-disable",
            "http://xml.org/sax/features/external-general-entities,http://xml.org/sax/features/external-parameter-entities,http://apache.org/xml/features/nonvalidating/load-external-dtd"
        );

        return u;
    }


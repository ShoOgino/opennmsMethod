    /**
     * Verifies that a {@link ByteBuffer} can be successfully marshalled
     * when {@link ByteBuffer#hasArray()} is <code>false</code>.
     */
    @Test
    public void marshalByteBufferWithoutArray() {
        ByteBuffer bbWithArray = ByteBuffer.allocate(1);
        bbWithArray.put((byte)42);

        assertTrue("bytebuffer array should be accessbile", bbWithArray.hasArray());
        ByteBuffer bbWithoutArray = bbWithArray.asReadOnlyBuffer();
        assertFalse("bytebuffer array should not be accessbile", bbWithoutArray.hasArray());

        byte bytes[] = adapter.marshal(bbWithoutArray);
        assertArrayEquals(new byte[]{42}, bytes);
    }


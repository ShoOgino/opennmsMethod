    @Test
    public void testICMPPacketSets() throws Exception {
        
        // payload 64 bytes: ICMP header (8 bytes) followed by byte values 0, 1, 2, 3, ... 54, 55
        byte[] bytes = new byte[64];
        ByteBuffer buf = ByteBuffer.wrap(bytes, 0, 64);
        ICMPPacket icmpPacket = new ICMPPacket(buf);
        ICMPEchoPacket echoRequest = new ICMPEchoPacket(icmpPacket);
        echoRequest.setType(Type.EchoRequest);
        echoRequest.setCode(0);
        echoRequest.setIdentifier(0x1234);
        echoRequest.setSequenceNumber(0x5678);
        
        ByteBuffer content = echoRequest.getContentBuffer();
        for(int i = 0; i < 56; i++) {
            content.put((byte)i);
        }
        
        echoRequest.setChecksum(); // check sum is 0x9840
        
        assertThat(bytes[0], is(equalTo((byte)8))); // icmp type
        assertThat(bytes[1], is(equalTo((byte)0))); // icmp code (zero for echo pkts)
        assertThat(bytes[2], is(equalTo((byte)0x98))); // checksum hi
        assertThat(bytes[3], is(equalTo((byte)0x40))); // checksum lo
        assertThat(bytes[4], is(equalTo((byte)0x12))); // id hi
        assertThat(bytes[5], is(equalTo((byte)0x34))); // id lo
        assertThat(bytes[6], is(equalTo((byte)0x56))); // seq_num hi
        assertThat(bytes[7], is(equalTo((byte)0x78))); // seq_num lo

        for(int i = 0; i < 56; i++) {
            assertThat(bytes[8+i], is(equalTo((byte)i)));
        }
        
        NativeDatagramPacket pkt = echoRequest.toDatagramPacket(InetAddress.getByName("127.0.0.1"));
        
        assertThat(pkt.getAddress(), is(equalTo(InetAddress.getByName("127.0.0.1"))));
        assertThat(pkt.getPort(), is(equalTo(0)));
        
        ByteBuffer data = pkt.getContent();
        assertThat(data.position(), is(equalTo(0)));
        assertThat(data.limit(), is(equalTo(64)));
        assertThat(data.remaining(), is(equalTo(64)));
        assertThat(data.hasArray(), is(true));
        assertThat(data.array(), is(sameInstance(bytes)));
        assertThat(data.arrayOffset(), is(equalTo(0)));
        
    }


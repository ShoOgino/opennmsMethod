    @Test
    public void testServer() throws Exception  {
        String[] cmds = new String[] { "echo", "echo2", "quit" };
        DatagramSocket socket = null;
        try {
            socket = new DatagramSocket();
        
            for(String cmd : cmds) {
                
                printf("Sending cmd: %s\n", cmd);

                byte[] data = cmd.getBytes("UTF-8");

                DatagramPacket p = new DatagramPacket(data, data.length, InetAddress.getLocalHost(), 7777);

                socket.send(p);

                DatagramPacket r = new DatagramPacket(new byte[128], 128);
                socket.receive(r);
                
                String response = new String(r.getData(), r.getOffset(), r.getLength(), "UTF-8");
                
                printf("Received Response: %s from %s:%d\n", response, r.getAddress().getHostAddress(), r.getPort());

                assertEquals(cmd, response);
            }
        
        } finally {
            if (socket != null) socket.close();
        }
    }


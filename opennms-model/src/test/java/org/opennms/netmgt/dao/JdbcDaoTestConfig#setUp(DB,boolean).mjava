    protected PlatformTransactionManager setUp(DB db, boolean createDb) throws Exception {
        m_createDb = createDb;
        
        if (createDb) {
            String cmd = ( System.getProperty("psql.command", "psql") == null ? "/usr/bin/psql" : System.getProperty("psql.command", "psql") ) ;
            Process p = Runtime.getRuntime().exec(cmd+" onmstest -U opennms -f etc/create.sql");
            p.waitFor();
            System.err.println("Got an exitValue of "+p.exitValue());
            
        }
        
        
        //m_dataSource = db.getDataSource();
        m_dataSource = db.getPoolingDataSource();
        
        // initialize the factory classs and register them with the Cache
        AssetRecordFactory.register(m_dataSource);
        DistPollerFactory.register(m_dataSource);
        IpInterfaceFactory.register(m_dataSource);
        MonitoredServiceFactory.register(m_dataSource);
        NodeFactory.register(m_dataSource);
        CategoryFactory.register(m_dataSource);
        ServiceTypeFactory.register(m_dataSource);
        SnmpInterfaceFactory.register(m_dataSource);
        
        return new DataSourceTransactionManager(m_dataSource);
    }


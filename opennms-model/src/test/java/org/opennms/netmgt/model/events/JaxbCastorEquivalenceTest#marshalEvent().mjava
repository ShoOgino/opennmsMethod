	@Test
	@Ignore("castor-specific things have been removed from the classes now")
	public void marshalEvent() throws Exception {
		final Event event = getFullEvent();

		final StringWriter jaxbWriter = new StringWriter();
        final JAXBContext c = JAXBContext.newInstance("org.opennms.netmgt.xml.event");
        final javax.xml.bind.Marshaller jaxbMarshaller = c.createMarshaller();

        final SchemaFactory factory = SchemaFactory.newInstance("http://www.w3.org/2001/XMLSchema");
        final Schema schema = factory.newSchema(new StreamSource("src/main/resources/xsds/event.xsd"));
        jaxbMarshaller.setSchema(schema);
		jaxbMarshaller.marshal(event, jaxbWriter);
        final String jaxbXml = jaxbWriter.toString();
		System.err.println("JAXB:   " + jaxbXml);

		final StringWriter castorWriter = new StringWriter();
		final Marshaller m = new Marshaller(castorWriter);
        m.setSuppressNamespaces(true);
        m.marshal(event);
        final String castorXml = castorWriter.toString();
        final String formattedCastorXml = castorXml.replaceFirst("<event ", "<event xmlns=\"http://xmlns.opennms.org/xsd/event\" ").replaceFirst("\\?>\n", " standalone=\"yes\"?>");
		System.err.println("Castor: " + formattedCastorXml);

        XMLUnit.setIgnoreWhitespace(true);
        XMLUnit.setIgnoreAttributeOrder(true);
        XMLUnit.setNormalize(true);
        
        assertXmlEquals(formattedCastorXml, jaxbXml);

        org.exolab.castor.xml.Unmarshaller castorUnmarshaller = new org.exolab.castor.xml.Unmarshaller(Event.class);
        castorUnmarshaller.setIgnoreExtraAttributes(false);
        castorUnmarshaller.setIgnoreExtraElements(false);
        castorUnmarshaller.setWhitespacePreserve(true);
        final Reader jaxbStringReader = new StringReader(jaxbXml);
        final InputSource jaxbInputSource = new InputSource(jaxbStringReader);
        final Event jaxbEvent = (Event)castorUnmarshaller.unmarshal(jaxbInputSource);
        System.err.println("event = " + jaxbEvent);

        final Unmarshaller jaxbUnmarshaller = c.createUnmarshaller();
        jaxbUnmarshaller.setSchema(schema);

        final XMLReader jaxbReader = XMLReaderFactory.createXMLReader();
        final StringReader castorXmlReader = new StringReader(castorXml);
        final InputSource xmlSource = new InputSource(castorXmlReader);

        final SimpleNamespaceFilter filter = new SimpleNamespaceFilter("http://xmlns.opennms.org/xsd/event", true);
        filter.setParent(jaxbReader);

        final SAXSource source = new SAXSource(filter, xmlSource);
        Event newCastorEvent = (Event)jaxbUnmarshaller.unmarshal(source);
        assertNotNull(newCastorEvent);
	}


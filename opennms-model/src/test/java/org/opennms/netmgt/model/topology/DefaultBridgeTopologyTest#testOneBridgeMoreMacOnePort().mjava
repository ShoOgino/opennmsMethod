    @Test
    public void testOneBridgeMoreMacOnePort() throws Exception {

        Integer nodeAId  = 20;
        OnmsNode nodeA= new OnmsNode();
        nodeA.setId(nodeAId);
        BridgeElement element = new BridgeElement();
        element.setNode(nodeA);
        element.setBaseBridgeAddress("aaaaaaaaaaaa");
        List<BridgeElement> elemlist = new ArrayList<BridgeElement>();
        elemlist.add(element);
        List<BridgeMacLink> bftA = new ArrayList<BridgeMacLink>();

        Integer portA1 = 1;

        String mac1 = "000daaaa0001"; // port A1 
        String mac2 = "000daaaa0002"; // port A1
        String mac3 = "000daaaa0003"; // port A1
        String mac4 = "000daaaa0004"; // port A1


        bftA = addBridgeForwardingTableEntry(nodeA,portA1, mac1,bftA);
        bftA = addBridgeForwardingTableEntry(nodeA,portA1, mac2,bftA);
        bftA = addBridgeForwardingTableEntry(nodeA,portA1, mac3,bftA);
        bftA = addBridgeForwardingTableEntry(nodeA,portA1, mac4,bftA);

        BroadcastDomain bridgeTopology = new BroadcastDomain();

        bridgeTopology.loadBFT(nodeAId,bftA,null,elemlist);
        assertTrue(bridgeTopology.isTopologyChanged());
        assertTrue(!bridgeTopology.isCalculating());

        bridgeTopology.calculate();
        List<SharedSegment> links = bridgeTopology.getTopology();
        printBridgeTopology(links);

        assertEquals(1, links.size());
        for (SharedSegment shared: links) {
            assertTrue(!shared.noMacsOnSegment());
            assertEquals(nodeAId,shared.getDesignatedBridge());
            assertEquals(portA1,shared.getDesignatedPort());
            assertEquals(1, shared.getBridgeIdsOnSegment().size());
            assertEquals(4, shared.getMacsOnSegment().size());
            final Set<String> macs = shared.getMacsOnSegment();
            assertTrue(macs.contains(mac1));
            assertTrue(macs.contains(mac2));
            assertTrue(macs.contains(mac3));
            assertTrue(macs.contains(mac4));
            for (BridgeMacLink link: shared.getBridgeMacLinks())
                assertEquals(portA1, link.getBridgePort());
        }

    }


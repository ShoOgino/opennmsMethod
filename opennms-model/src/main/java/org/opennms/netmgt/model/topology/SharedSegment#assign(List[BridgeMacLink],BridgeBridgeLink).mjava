    public void assign(List<BridgeMacLink> links, BridgeBridgeLink dlink) {
        // if there is not yet links on segment add it
       if (isEmpty() && !links.isEmpty()) {
            LOG.debug("assign: shared segment is empty and maclinks not empty");
            m_bridgeportsOnSegment = links;
            return;
        }
        // if there are no macs on segment...just add the BridgeBridgeLink
        if (noMacsOnSegment() && links.isEmpty()) {
            LOG.debug("assign: no macs on shared and bridge not null");
            m_bridgeportsOnLink.add(dlink);
            return;
        }
        
        // we are assigning links to a segment that has mac address
        // the set of link must be ...merged using mac address, 
        // this means that
        // only intersection of common macs is
        // must be saved to segment
        
        Set<String> macsonLinks=new HashSet<String>();
        for (BridgeMacLink link: links)
            macsonLinks.add(link.getMacAddress());
        LOG.debug("macs to add on segment: {}", macsonLinks);

        Set<String> macsonSegment=new HashSet<String>(getMacsOnSegment());
        LOG.debug("macs found on segment: {}",macsonSegment);
        
        Set<String> retained = new HashSet<String>(macsonSegment);
        retained.retainAll(macsonLinks);
        LOG.debug("macs retained on segment: {}", retained);
        // intersection is null
        // we need to convert all the 
        // local links to BridgeBridgeLink
        // and add the BridgeBridgeLink
        if (retained.isEmpty()) {
            convertSegmentToLink();
            m_bridgeportsOnLink.add(dlink);
            m_bridgeportsOnSegment.clear();
            return;
        }
        
        //intersection is not null, then we have to add all the BridgeMacLink
        // for each mac address
        List<BridgeMacLink> sharedsegmentmaclinks = new ArrayList<BridgeMacLink>();
        Set<Integer> nodeidadding = new HashSet<Integer>();
        for (BridgeMacLink link: links) {
            if (retained.contains(link.getMacAddress())) {
                sharedsegmentmaclinks.add(link);
                nodeidadding.add(link.getNode().getId());
            }
        }
        for (BridgeMacLink link: m_bridgeportsOnSegment) {
            if (nodeidadding.contains(link.getNode().getId()))
                    continue;
            if (retained.contains(link.getMacAddress()))
                sharedsegmentmaclinks.add(link);
        }

        m_bridgeportsOnSegment = sharedsegmentmaclinks;
        m_bridgeportsOnLink.clear();
    }


    private Integer getTopLevelPortUpBridge(SharedSegment down,Bridge bridge) {
            Integer upBridgeId = down.getDesignatedBridge();
            // if segment is on the bridge then...
            if (upBridgeId.intValue() == bridge.getId().intValue())
                return down.getDesignatedPort();
            // if segment is a root segment add mac on port
            if (upBridgeId.intValue() == m_rootBridgeId.intValue())
                return bridge.getRootPort();
            // iterate until you got it
            Bridge upBridge = null;
            for (Bridge cbridge: m_bridges) {
                if (cbridge.getId().intValue() == upBridgeId.intValue()) {
                    upBridge=cbridge;
                    break;
                }
            }
            if (upBridge == null)
                return null;
            SharedSegment shared = getSharedSegment(upBridgeId,upBridge.getRootPort());
            if (shared == null)
                return null;
        return getTopLevelPortUpBridge(shared, bridge);
    }


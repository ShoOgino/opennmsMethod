    /**
     * Test generate graph templates.
     *
     * @throws Exception the exception
     */
    @Test
    public void testGenerateGraphTemplates() throws Exception {
        if (parser.parseMib(new File(MIB_DIR, "Clavister-MIB.mib"))) {
            List<PrefabGraph> graphs = parser.getPrefabGraphs();
            StringWriter writer = new StringWriter();
            PrefabGraphDumper dumper = new PrefabGraphDumper();
            dumper.dump(graphs, writer);
            System.out.println(writer.getBuffer().toString());
            Assert.assertEquals(102533, writer.getBuffer().toString().length()); // FIXME we should implement a more comprehensive check here.

            PropertiesGraphDao dao = new PropertiesGraphDao();
            final StringBuilder sb = new StringBuilder();
            sb.append("command.prefix=/usr/bin/rrdtool\n");
            sb.append("output.mime=image/png\n");
            sb.append(writer.getBuffer().toString());
            dao.loadProperties("performance", new ByteArrayInputStream(sb.toString().getBytes()));
            Assert.assertEquals(graphs.size(), dao.getAllPrefabGraphs().size());
            for (PrefabGraph g : graphs) {
                try {
                    PrefabGraph graph = dao.getPrefabGraph(g.getName());
                    Assert.assertEquals(g.getTitle(), graph.getTitle());
                } catch (ObjectRetrievalFailureException e) {
                    Assert.fail(e.getMessage());
                }
            }
        } else {
            Assert.fail("The Clavister-MIB.mib file couldn't be parsed successfully.");
        }
    }


    static CountDownLatch startServer() throws Exception {
        CountDownLatch latch = new CountDownLatch(1);
        ServerSocket serverSocket = TEST_SERVER_SOCKET_FACTORY.createServerSocket(PORT);
        Runnable server = () -> {
            try {
                acceptAndHandle(serverSocket, false);
                latch.countDown();
            } catch (Exception e) {
                e.printStackTrace();
            } finally {
                try {
                    serverSocket.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        };
        new Thread(server).start();
        return latch;
    }


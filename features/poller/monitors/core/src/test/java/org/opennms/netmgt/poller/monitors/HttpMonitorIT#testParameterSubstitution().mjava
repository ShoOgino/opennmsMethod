    @Test
    @JUnitHttpServer()
    public void testParameterSubstitution() throws UnknownHostException {
        HttpMonitor monitor = new HttpMonitor();
        Map<String, Object> parameters = new ConcurrentSkipListMap<String, Object>();
        final int port = JUnitHttpServerExecutionListener.getPort();
        if (port > 0) {
            parameters.put("port", String.valueOf(port));
        } else {
            throw new IllegalStateException("Unable to determine what port the HTTP server started on!");
        }
        parameters.put("url", "/test-NMS2702.html");
        parameters.put("retry", "1");
        parameters.put("timeout", "500");
        parameters.put("verbose", "true");
        parameters.put("user-agent", "Hello from {ipAddr} {ipAddress} {nodeId} {nodeLabel}");
        parameters.put("response-text", "~.*OK.*");
        MockMonitoredService svc = MonitorTestUtils.getMonitoredService(3, "localhost", DnsUtils.resolveHostname("localhost", false), "HTTP");
        svc.setNodeLabel("localhost.localdomain");
        Map<String, Object> subbedParams = monitor.getRuntimeAttributes(svc, parameters);
        assertTrue(subbedParams.get("subbed-user-agent").toString().equals("Hello from 127.0.0.1 127.0.0.1 3 localhost.localdomain"));
    }


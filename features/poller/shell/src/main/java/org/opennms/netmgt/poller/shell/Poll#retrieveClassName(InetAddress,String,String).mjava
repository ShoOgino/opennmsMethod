    private String retrieveClassName(final InetAddress ipAddress, final String packageName, final String serviceName) throws Exception {
        final PollerConfig pollerConfig = ReadOnlyPollerConfigManager.create();

        final org.opennms.netmgt.config.poller.Package pkg = packageName == null ? pollerConfig.getFirstLocalPackageMatch(InetAddressUtils.str(ipAddress)) : pollerConfig.getPackage(packageName);
        if (pkg == null) {
            System.err.printf("Error: Package %s doesn't exist%n", packageName);
            return null;
        }

        final org.opennms.netmgt.config.poller.Service svc = pollerConfig.getServiceInPackage(serviceName, pkg);
        if (svc == null) {
            System.err.printf("Error: Service %s not defined on package %s%n", serviceName, packageName);
            return null;
        }

        final Optional<Package.ServiceMatch> service = pkg.findService(serviceName);
        if (!service.isPresent()) {
            System.err.printf("Error: Service %s not defined%n", serviceName);
            return null;
        }

        final ServiceMonitor monitor = pollerConfig.getServiceMonitor(service.get().service.getName());
        if (monitor == null) {
            System.err.printf("Error: Service %s doesn't have a monitor class defined%n", serviceName);
            return null;
        }

        return monitor.getClass().getName();
    }


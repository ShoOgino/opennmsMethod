	/** 
	 * this handles the incoming event and deals with it as an alarm change event or a normal event
	 * @param event
	 */
	public void forwardEvent(Event event){

		try{
			maybeRefreshCache(event);

			// handling uei definitions of alarm change events

			String uei = event.getUei();

			// if alarm change notification then handle change
			// change alarm index and add event to alarm change event index
			if(uei.startsWith(ALARM_NOTIFICATION_UEI_STEM)) {
				if (STICKY_MEMO_EVENT.equals(uei)|| JOURNAL_MEMO_EVENT.equals(uei) ){
					// handle memo change events
					// TODO may want to create a sticky and journal memo field in alarms index and update accordingly
					// currently we just save the event as an event to ES with no other processing
					if (LOG.isDebugEnabled()) LOG.debug("Sending Alarm MEMO Event to ES:"+event.toString());

				} else {
					// handle alarm change events

					if (LOG.isDebugEnabled()) {
						if (ALARM_CREATED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Created Event to ES:"+event.toString());
						} else if( ALARM_DELETED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Deleted Event to ES:"+event.toString());
						} else if (ALARM_SEVERITY_CHANGED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Changed Severity Event to ES:"+event.toString());
						} else if (ALARM_CLEARED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Cleared Event to ES:"+event.toString());
						} else if (ALARM_ACKNOWLEDGED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Acknowledged Event to ES:"+event.toString());
						} else if (ALARM_UNACKNOWLEDGED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Unacknowledged Event to ES:"+event.toString());
						} else if (ALARM_SUPPRESSED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Suppressed Event to ES:"+event.toString());
						} else if (ALARM_UNSUPPRESSED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Unsuppressed Event to ES:"+event.toString());
						} else if (ALARM_TROUBLETICKET_STATE_CHANGE_EVENT.equals(uei)){
							LOG.debug("Sending Alarm TroubleTicked state changed Event to ES:"+event.toString());
						} else if (ALARM_CHANGED_EVENT.equals(uei)){
							LOG.debug("Sending Alarm Changed Event to ES:"+event.toString());
						}
					}

					if(archiveAlarms){
						// if an alarm change event, use the alarm change fields to update the alarm index
						Update alarmUpdate = populateAlarmIndexBodyFromAlarmChangeEvent(event, INDEX_NAMES.get(Indices.ALARMS), INDEX_TYPES.get(Indices.ALARMS));
						String alarmindexname=alarmUpdate.getIndex();

						DocumentResult alarmIndexresult = getJestClient().execute(alarmUpdate);

						if(alarmIndexresult.getResponseCode() == 404){
							// index doesn't exist for upsert command so create new index and try again

							if(LOG.isDebugEnabled()) {
								LOG.debug("trying to update alarm"
										+ "\n   received search result: "+alarmIndexresult.getJsonString()
										+ "\n   response code:" +alarmIndexresult.getResponseCode() 
										+ "\n   error message: "+alarmIndexresult.getErrorMessage());
								LOG.debug("index name "+alarmindexname + " doesnt exist creating new index");
							}

							createIndex(alarmindexname, INDEX_TYPES.get(Indices.ALARMS));

							alarmIndexresult = getJestClient().execute(alarmUpdate);
						}

						if(alarmIndexresult.getResponseCode()!=200){
							LOG.error("Problem sending alarm to es index:" +alarmindexname+ " type:"+ INDEX_TYPES.get(Indices.ALARMS)
									+ "\n   received search result: "+alarmIndexresult.getJsonString()
									+ "\n   response code:" +alarmIndexresult.getResponseCode() 
									+ "\n   error message: "+alarmIndexresult.getErrorMessage());
						} else if(LOG.isDebugEnabled()) {
							LOG.debug("Alarm sent to es index:" +alarmindexname+ " type:"+ INDEX_TYPES.get(Indices.ALARMS)
									+ "\n   received search result: "+alarmIndexresult.getJsonString()
									+ "\n   response code:" +alarmIndexresult.getResponseCode() 
									+ "\n   error message: "+alarmIndexresult.getErrorMessage());

						}
					}
				}

				// save all Alarm Change Events including memo change events
				if(archiveAlarmChangeEvents){
					Index eventIndex = populateEventIndexBodyFromEvent(event, INDEX_NAMES.get(Indices.ALARM_EVENTS), INDEX_TYPES.get(Indices.ALARM_EVENTS));
					String alarmeventindexname=eventIndex.getIndex();
					DocumentResult eventIndexresult = getJestClient().execute(eventIndex);

					if(eventIndexresult.getResponseCode()==404){
						// index doesn't exist for upsert command so create new index first

						if(LOG.isDebugEnabled()) {
							LOG.debug("trying to update alarm event index"
									+ "\n   received search result: "+eventIndexresult.getJsonString()
									+ "\n   response code:" +eventIndexresult.getResponseCode() 
									+ "\n   error message: "+eventIndexresult.getErrorMessage());
							LOG.debug("index name "+alarmeventindexname + " doesnt exist creating new index");
						}

						createIndex(alarmeventindexname, INDEX_TYPES.get(Indices.ALARM_EVENTS));

						eventIndexresult = getJestClient().execute(eventIndex);
					}


					if(eventIndexresult.getResponseCode()!=200){
						LOG.error("Problem sending Alarm Event to es index:" +alarmeventindexname+ " type:"+ INDEX_TYPES.get(Indices.ALARM_EVENTS)
								+ "\n   received search result: "+eventIndexresult.getJsonString()
								+ "\n   response code:" +eventIndexresult.getResponseCode() 
								+ "\n   error message: "+eventIndexresult.getErrorMessage());
					} else if(LOG.isDebugEnabled()) {
						LOG.debug("Alarm Event sent to es index:"+alarmeventindexname+" type:"+ INDEX_TYPES.get(Indices.ALARM_EVENTS)
								+ "\n   received search result: "+eventIndexresult.getJsonString()
								+ "\n   response code:" +eventIndexresult.getResponseCode() 
								+ "\n   error message: "+eventIndexresult.getErrorMessage());

					}
				}

			} else {
				// else handle all other event types

				if(archiveRawEvents){
					// only send events to ES if they are persisted to database or logAllEvents is set to true
					if(logAllEvents || (event.getDbid()!=null && event.getDbid()!=0)) {
						if (LOG.isDebugEnabled()) LOG.debug("Sending Event to ES:"+event.toString());
						// Send the event to the event forwarder
						Index eventIndex = populateEventIndexBodyFromEvent(event, INDEX_NAMES.get(Indices.EVENTS), INDEX_TYPES.get(Indices.EVENTS));
						String eventindexname=eventIndex.getIndex();
						DocumentResult eventIndexresult = getJestClient().execute(eventIndex);

						if(eventIndexresult.getResponseCode()==404){
							// index doesn't exist for upsert command so create new index first

							if(LOG.isDebugEnabled()) {
								LOG.debug("trying to update event index"
										+ "\n   received search result: "+eventIndexresult.getJsonString()
										+ "\n   response code:" +eventIndexresult.getResponseCode() 
										+ "\n   error message: "+eventIndexresult.getErrorMessage());
								LOG.debug("index name "+eventindexname + " doesnt exist creating new index");
							}

							createIndex(eventindexname, INDEX_TYPES.get(Indices.EVENTS));

							eventIndexresult = getJestClient().execute(eventIndex);
						}

						if(LOG.isDebugEnabled()) {
							LOG.debug("Event sent to es index:"+eventindexname+" type:"+ INDEX_TYPES.get(Indices.EVENTS)
									+ "\n   received search result: "+eventIndexresult.getJsonString()
									+ "\n   response code:" +eventIndexresult.getResponseCode() 
									+ "\n   error message: "+eventIndexresult.getErrorMessage());
						}
					}

				} else {
					if (LOG.isDebugEnabled()) LOG.debug("Not Sending Event to ES: null event.getDbid()="+event.getDbid()+ " Event="+event.toString());
				}
			}

		} catch (Throwable ex){
			LOG.error("Unexpected problem sending event to Elasticsearch",ex);
		}

	}


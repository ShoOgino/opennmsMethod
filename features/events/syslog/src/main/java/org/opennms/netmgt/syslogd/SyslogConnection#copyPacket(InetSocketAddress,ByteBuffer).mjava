    private static DatagramPacket copyPacket(final InetSocketAddress source, final ByteBuffer buffer) {
        byte[] message = new byte[0xffff];
        int i = 0;
        // Copy the buffer into the byte array
        while (buffer.hasRemaining()) {
            message[i++] = buffer.get();
        }
        DatagramPacket retPacket = new DatagramPacket(
            message,
            0,
            i,
            source.getAddress(),
            source.getPort()
        );
        return retPacket;
    }


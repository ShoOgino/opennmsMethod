    public static SyslogParser getParserInstance(SyslogdConfig config, String text) throws MessageDiscardedException {
        Class<? extends SyslogParser> parserClass = PARSER_CLASSES.get(config.getParser());
        if (parserClass == null) {
            try {
                parserClass = Class.forName(config.getParser()).asSubclass(SyslogParser.class);
                PARSER_CLASSES.put(config.getParser(), parserClass);
            } catch (final Exception ex) {
                LOG.debug("Unable to instantiate Syslog parser class specified in config: {}", config.getParser(), ex);
                parserClass = CustomSyslogParser.class;
            }
        }

        final SyslogParser retval;
        try {
            Constructor<? extends SyslogParser> m = parserClass.getConstructor(SyslogdConfig.class, String.class);
            retval = (SyslogParser)m.newInstance(config, text);
        } catch (final Exception ex) {
            LOG.debug("Unable to get parser for class '{}'", parserClass.getName(), ex);
            throw new MessageDiscardedException(ex);
        }

        return retval;
    }


	@Override
	public CompletableFuture<EventBuilder> parse(ByteBuffer incoming) {
		ParserState state = new ParserState(incoming, new EventBuilder());

// TODO
//		state.builder.setDistPoller(systemId);
		state.builder.setLogDest("logndisplay");
		state.builder.setSource(Syslogd.LOG4J_CATEGORY);
		// Set event host
		state.builder.setHost(InetAddressUtils.getLocalHostName());


		// TODO: Use better collection than ArrayList?
		final List<CompletableFuture<ParserState>> finishedFutures = new ArrayList<>();

		// Top of future tree is parser state
		final CompletableFuture<ParserState> parent = CompletableFuture.completedFuture(state);

		// Recursively construct the parser tree
		addStageFutures(finishedFutures, parent, tree);

		return firstNonNullResult(finishedFutures).thenApply(s -> {
			if (s == null) {
				return null;
			} else {
				return s.builder;
			}
		});
	}


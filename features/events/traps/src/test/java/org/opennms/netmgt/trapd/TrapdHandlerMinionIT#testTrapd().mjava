	@Test
	public void testTrapd() throws Exception {
		
		MockEndpoint broadcasTrap = getMockEndpoint("mock:queuingservice:broadcastTrap", false);
		broadcasTrap.setExpectedMessageCount(1);
		
		MockEventIpcManager mockEventIpcManager = new MockEventIpcManager();

		MockTrapdIpMgr m_trapdIpMgr=new MockTrapdIpMgr();

		m_trapdIpMgr.clearKnownIpsMap();
		m_trapdIpMgr.setNodeId("127.0.0.1", 1);


		TrapQueueProcessor trap=new TrapQueueProcessor();
		trap.setNewSuspect(false);
		trap.setEventManager(mockEventIpcManager);
		
		EventCreator trapProcess = new EventCreator(m_trapdIpMgr);
		trapProcess.setAgentAddress(InetAddressUtils.ONE_TWENTY_SEVEN);
		trapProcess.setCommunity("comm");
		trapProcess.setTrapAddress(InetAddressUtils.ONE_TWENTY_SEVEN);
		
		PDU snmp4JV2cTrapPdu = new PDU();
		
		OID oid = new OID(".1.3.6.1.2.1.1.3.0");
		snmp4JV2cTrapPdu.add(new VariableBinding(SnmpConstants.sysUpTime, new TimeTicks(5000)));
		snmp4JV2cTrapPdu.add(new VariableBinding(SnmpConstants.snmpTrapOID, new OID(oid)));
		snmp4JV2cTrapPdu.add(new VariableBinding(SnmpConstants.snmpTrapAddress,
				new IpAddress("127.0.0.1")));

		snmp4JV2cTrapPdu.add(new VariableBinding(new OID(oid), new OctetString("Major")));
		snmp4JV2cTrapPdu.setType(PDU.NOTIFICATION);

		TrapNotification snmp4JV2cTrap = new Snmp4JTrapNotifier.Snmp4JV2TrapInformation(
				InetAddressUtils.ONE_TWENTY_SEVEN, new String("public"),
				snmp4JV2cTrapPdu, trapProcess);
		
		trap.setTrapNotification(snmp4JV2cTrap);


		template.requestBody("seda:handleMessage", trap.call());

		assertMockEndpointsSatisfied();

	}


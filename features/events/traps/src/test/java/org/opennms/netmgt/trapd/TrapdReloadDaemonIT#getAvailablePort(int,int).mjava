    private static int getAvailablePort(int current, final int max) {
        while (current < max) {
            try (final ServerSocket socket = new ServerSocket(current)) {
                return socket.getLocalPort();
            } catch (final Throwable e) {}
            current++;
        }
        throw new IllegalStateException("Can't find an available network port");
    }


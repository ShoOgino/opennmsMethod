	@Test
	public void testTrapd() throws Exception {
		for (int i = 0; i < 3; i++) {
			LOG.info("Sending trap");
			try {
				SnmpTrapBuilder pdu = SnmpUtils.getV2TrapBuilder();
				pdu.addVarBind(SnmpObjId.get(".1.3.6.1.2.1.1.3.0"), SnmpUtils.getValueFactory().getTimeTicks(0));
				pdu.addVarBind(SnmpObjId.get(".1.3.6.1.6.3.1.1.4.1.0"), SnmpUtils.getValueFactory().getObjectId(SnmpObjId.get(".1.3.6.1.4.1.5813.1")));
				pdu.addVarBind(SnmpObjId.get(".1.3.6.1.4.1.5813.20.1"), SnmpUtils.getValueFactory().getOctetString("Hello world".getBytes("UTF-8")));
				pdu.send(InetAddressUtils.str(InetAddressUtils.ONE_TWENTY_SEVEN), 10514, "public");
			} catch (Throwable e) {
				LOG.error(e.getMessage(), e);
			}
			LOG.info("Trap has been sent");
		}
		m_handler.getLatch().await(30, TimeUnit.SECONDS);
		
		TrapNotification notification = m_handler.getLast();
		notification.setTrapProcessor(new TrapProcessor() {

			@Override
			public void setCommunity(String community) {
				LOG.info("Comparing community");
				assertEquals("public", community);
			}

			@Override
			public void setTimeStamp(long timeStamp) {
				// TODO: Assert something?
			}

			@Override
			public void setVersion(String version) {
				LOG.info("Comparing version");
				assertEquals("v2", version);
			}

			@Override
			public void setAgentAddress(InetAddress agentAddress) {
				LOG.info("Comparing agent address");
				assertEquals(InetAddressUtils.ONE_TWENTY_SEVEN, agentAddress);
			}

			@Override
			public void processVarBind(SnmpObjId name, SnmpValue value) {
			}

			@Override
			public void setTrapAddress(InetAddress trapAddress) {
				LOG.info("Comparing trap address");
				assertEquals(InetAddressUtils.ONE_TWENTY_SEVEN, trapAddress);
			}

			@Override
			public void setTrapIdentity(TrapIdentity trapIdentity) {
				LOG.info("Comparing trap identity");
				assertEquals(new TrapIdentity(SnmpObjId.get(".1.3.6.1.4.1.5813"), 6, 1).toString(), trapIdentity.toString());
			}
		});
		
		notification.getTrapProcessor();
	}


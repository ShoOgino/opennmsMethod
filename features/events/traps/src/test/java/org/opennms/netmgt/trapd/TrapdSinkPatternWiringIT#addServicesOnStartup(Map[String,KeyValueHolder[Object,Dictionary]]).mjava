    @Override
    protected void addServicesOnStartup(Map<String, KeyValueHolder<Object, Dictionary>> services) {
        final MessageProducerFactory mockMessageProducerFactory = mock(MessageProducerFactory.class);
        when(mockMessageProducerFactory.getProducer(Mockito.any(TrapSinkModule.class)))
            .thenAnswer(invocation -> {
                // register call
                messageProcessedLatch.countDown();
                return mock(MessageProducer.class);
            });

        // add mocked services to osgi mocked container (Felix Connect)
        services.put(MessageConsumerManager.class.getName(), asService(new MockMessageConsumerManager(), null, null));
        services.put(MessageProducerFactory.class.getName(), asService(mockMessageProducerFactory, null, null));
        services.put(RestClient.class.getName(), asService(Mockito.mock(RestClient.class), null, null));
        services.put(DistPollerDao.class.getName(), asService(distPollerDao, null, null));
    }


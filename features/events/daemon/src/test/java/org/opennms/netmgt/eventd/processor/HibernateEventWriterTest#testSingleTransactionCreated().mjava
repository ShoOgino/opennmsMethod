    /**
     * Verifies that a transaction is opened when at least of
     * of the events in the log need to be persisted.
     */
    @Test
    public void testSingleTransactionCreated() throws EventProcessorException {
        // A log with a single event that marked as 'logndisplay'
        EventBuilder bldr = new EventBuilder("testUei", "testSource");
        bldr.setLogDest(HibernateEventWriter.LOG_MSG_DEST_LOG_AND_DISPLAY);
        eventWriter.process(bldr.getLog());
        verify(transactionManager, times(1)).execute(any());
        reset(transactionManager);

        // A log with a multiple events that marked as 'logndisplay'
        bldr = new EventBuilder("testUei", "testSource");
        bldr.setLogDest(HibernateEventWriter.LOG_MSG_DEST_LOG_AND_DISPLAY);
        Event e1 = bldr.getEvent();

        bldr = new EventBuilder("testUei", "testSource");
        bldr.setLogDest(HibernateEventWriter.LOG_MSG_DEST_LOG_AND_DISPLAY);
        Event e2 = bldr.getEvent();

        Events events = new Events();
        events.setEvent(new Event[]{e1, e2});

        Log log = new Log();
        log.setEvents(events);

        eventWriter.process(log);
        verify(transactionManager, times(1)).execute(any());
    }


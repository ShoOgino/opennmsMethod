    private BusinessServiceEntity createBusinessServiceWithApplicationEdge(String name) {
        final OnmsApplication onmsApplication = new OnmsApplication();

        onmsApplication.setName("myApp");

        final OnmsMonitoredService ipService = m_databasePopulator.getNode1()
                .getIpInterfaces().iterator().next()
                .getMonitoredServices().iterator().next();

        onmsApplication.addMonitoredService(ipService);
        int id = m_applicationDao.save(onmsApplication);
        m_applicationDao.flush();

        final BusinessServiceEntity bs = new BusinessServiceEntity();
        bs.setName(name);
        bs.setReductionFunction(new HighestSeverityEntity());
        bs.setAttribute("my-attr-key", "my-attr-value");
        bs.addApplicationEdge(m_applicationDao.get(id), new IdentityEntity());

        // Persist
        m_businessServiceDao.save(bs);
        m_businessServiceDao.flush();

        return bs;
    }


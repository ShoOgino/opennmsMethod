    @Test
    public void verifyNoDaoLookupsWhenNoRulesAreDefined() throws Exception {
        // Mock the DAO
        AlarmDao alarmDao = mock(AlarmDao.class);
        m_bsmd.setAlarmDao(alarmDao);

        // Start up without any business services
        m_bsmd.start();

        // Create the alarm
        OnmsAlarm alarm = createAlarm();
        m_alarmDao.save(alarm);

        // Send alarm created event
        EventBuilder ebldr = new EventBuilder(EventConstants.ALARM_CREATED_UEI, "test");
        ebldr.addParam(EventConstants.PARM_ALARM_ID, alarm.getId());
        m_bsmd.handleAlarmLifecycleEvents(ebldr.getEvent());

        // The AlarmDAO should not have any lookups
        verify(alarmDao, never()).get(anyObject());

        // Now let's add a rule
        createBusinessService("svc");

        // Reload the daemon
        ebldr = new EventBuilder(EventConstants.RELOAD_DAEMON_CONFIG_UEI, "test");
        ebldr.addParam(EventConstants.PARM_DAEMON_NAME, "bsmd");
        m_eventMgr.sendNow(ebldr.getEvent());

        // Send alarm updated event
        ebldr = new EventBuilder(EventConstants.ALARM_UPDATED_WITH_REDUCED_EVENT_UEI, "test");
        ebldr.addParam(EventConstants.PARM_ALARM_ID, alarm.getId());
        m_bsmd.handleAlarmLifecycleEvents(ebldr.getEvent());

        // The AlarmDAO should have a single lookup
        verify(alarmDao, times(1)).get(anyObject());
    }


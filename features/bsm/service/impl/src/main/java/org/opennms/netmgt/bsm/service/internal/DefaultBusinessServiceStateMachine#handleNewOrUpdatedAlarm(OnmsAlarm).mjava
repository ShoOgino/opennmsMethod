    @Override
    public void handleNewOrUpdatedAlarm(OnmsAlarm alarm) {
        // The ReadWriteLock doesn't give us the ability to upgrade from a
        // read lock to a write lock, so we acquire a write lock even
        // if we may not need it
        m_rwLock.writeLock().lock();
        try {
            // Are there any business services referencing this alarm?
            Set<BusinessServiceEntity> affectedBusinessServices = m_reductionKeys.get(alarm.getReductionKey());
            if (affectedBusinessServices == null || affectedBusinessServices.isEmpty()) {
                if (LOG.isDebugEnabled()) {
                    LOG.debug("No Business Service depends on alarm with reduction key: '{}'. "
                            + "Monitored reduction keys include: {}.", alarm.getReductionKey(), m_reductionKeys.keySet());
                }
                return;
            }

            // Maintain the last known severity for the reduction key
            LOG.debug("Alarm with id: {} and reduction key: {} has severity: {}", alarm.getId(), alarm.getReductionKey(), alarm.getSeverity());
            m_reductionKeyToSeverity.put(alarm.getReductionKey(), alarm.getSeverity());

            // Get the maximum level
            Integer maxLevel = affectedBusinessServices.stream().mapToInt(s -> s.getLevel()).max().getAsInt();
            // Propagate to the affected business services
            for (int eachLevel = maxLevel; eachLevel>=0; eachLevel--) {
                calculateStatus(eachLevel);
            }
        } finally {
            m_rwLock.writeLock().unlock();
        }
    }


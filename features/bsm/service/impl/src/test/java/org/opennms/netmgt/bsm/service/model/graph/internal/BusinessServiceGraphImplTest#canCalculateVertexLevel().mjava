    @Test
    public void canCalculateVertexLevel()  {
        /**
         * Creates a graph that looks like:
         *   B1    B5   B6   B7
         *    |   /     /
         *    B2  /    /
         *    | /   /
         *    B3   /
         *    | /
         *    B4
         */
        MockBusinessServiceHierarchy h = MockBusinessServiceHierarchy.builder()
                .withBusinessService(1)
                .withBusinessService(2)
                    .withBusinessService(3)
                        .withBusinessService(4).commit()
                    .commit()
                .commit()
            .commit()
            .withBusinessService(5)
                .withBusinessService(3).commit()
            .commit()
            .withBusinessService(6)
                .withBusinessService(4).commit()
            .commit()
            .withBusinessService(7).commit()
            .build();
        List<ReadOnlyBusinessService> businessServices = h.getBusinessServices();

        // Quick sanity check of the generated hierarchy
        assertEquals(7, businessServices.size());
        assertEquals(1, h.getBusinessServiceById(3).getEdges().size());

        // Create the graph
        BusinessServiceGraph graph = new BusinessServiceGraphImpl(h.getBusinessServices());

        // Verify the services at every level
        Map<Integer, Set<ReadOnlyBusinessService>> servicesByLevel = Maps.newTreeMap();
        servicesByLevel.put(0, Sets.newHashSet(h.getBusinessServiceById(1), h.getBusinessServiceById(5), h.getBusinessServiceById(6), h.getBusinessServiceById(7)));
        servicesByLevel.put(1, Sets.newHashSet(h.getBusinessServiceById(2)));
        servicesByLevel.put(2, Sets.newHashSet(h.getBusinessServiceById(3)));
        servicesByLevel.put(3, Sets.newHashSet(h.getBusinessServiceById(4)));
        servicesByLevel.put(4, Sets.newHashSet());
        for (Entry<Integer, Set<ReadOnlyBusinessService>> entry : servicesByLevel.entrySet()) {
            int level = entry.getKey();
            Set<ReadOnlyBusinessService> servicesAtLevel = graph.getVerticesByLevel(level).stream()
                .filter(v -> v.getLevel() == level) // Used to verify the level on the actual vertex
                .map(v -> v.getBusinessService())
                .collect(Collectors.toSet());
            assertEquals(String.format("Mismatch at level %d",  level), entry.getValue(), servicesAtLevel);
        }
    }


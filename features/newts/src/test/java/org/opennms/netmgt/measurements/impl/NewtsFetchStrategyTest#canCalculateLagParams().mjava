    @Test
    public void canCalculateLagParams() {
        replay();

        // Supply sane values and make sure the same values are returned
        LateAggregationParams lag = NewtsFetchStrategy.getLagParams(30*1000L, 15*1000L, 450*1000L);
        assertEquals(30*1000L, lag.step);
        assertEquals(15*1000L, lag.interval);
        assertEquals(450*1000L, lag.heartbeat);

        // Supply a step that is not a multiple of the interval, make sure this is corrected
        lag = NewtsFetchStrategy.getLagParams(31*1000L, 15*1000L, 450*1000L);
        assertEquals(31000L, lag.step);
        assertEquals(15500L, lag.interval);
        assertEquals(450500L, lag.heartbeat);

        // Supply an interval that is much larger than the step
        lag = NewtsFetchStrategy.getLagParams(30*1000L, 150*1000L, 4500*1000L);
        assertEquals(30*1000L, lag.step);
        // Interval should be reduced
        assertEquals(15*1000L, lag.interval);
        // But the hearbeat should stay the same
        assertEquals(4500*1000L, lag.heartbeat);
    }


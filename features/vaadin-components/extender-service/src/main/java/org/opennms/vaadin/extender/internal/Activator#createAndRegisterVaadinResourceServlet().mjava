    private void createAndRegisterVaadinResourceServlet() {
        Bundle vaadin = null;
        for (Bundle bundle : bundleContext.getBundles()) {
            if ("com.vaadin.client-compiled".equals(bundle.getSymbolicName())) {
                vaadin = bundle;
                break;
            }
        }

        Dictionary<String, String> props;

        props = new Hashtable<String, String>();
        props.put(Constants.ALIAS, VaadinResourceServlet.VAADIN + "/*");
        props.put(Constants.OSGI_HTTP_WHITEBOARD_SERVLET_PATTERN, VaadinResourceServlet.VAADIN + "/*");

        HttpServlet vaadinResourceServlet = new VaadinResourceServlet(vaadin);

        resourceService = bundleContext.registerService( Servlet.class.getName(), vaadinResourceServlet, props );

        bundleContext.registerService(VaadinResourceService.class.getName(), vaadinResourceServlet, null);
    }


	// y = a * f(n) + b * f(n-1) + c * f(n-2)
	@Test
	public void checkTimeSeriesConstantBasedContextExpression() throws ExpressionException{
		final String expression = "jexl:evaluate(__formula)";

		final String formula = "a * x + b * fn:arrayNaN(\"x\", 1) + c * fn:arrayNaN(\"x\", 2)";

		final Map<String,Object> constants = Maps.newHashMap();

		constants.put("__formula", formula);

		constants.put("a", 2);
		constants.put("b", 0.5);
		constants.put("c", 0.25);


		StringBuffer sb = new StringBuffer("");

		double[] result = performExpression(expression,constants);

		for (double value: result){
			sb.append(value+",");
		}
		System.out.println("JEXLExpressionEngineEnhancedTest:\n   expression:"+expression +"\n   formula:"+formula+ "\n   result "+sb.toString());

		assertEquals(Double.NaN, result[0], DELTA);
		assertEquals(Double.NaN, result[1], DELTA);
		assertEquals(Double.valueOf(18.25), result[2], DELTA);
		assertEquals(Double.valueOf(21.0), result[3], DELTA);
		assertEquals(Double.valueOf(23.75), result[4], DELTA);
		assertEquals(Double.valueOf(26.5), result[5], DELTA);

	}


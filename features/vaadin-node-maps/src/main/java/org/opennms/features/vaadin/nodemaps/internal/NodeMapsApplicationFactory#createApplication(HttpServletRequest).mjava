    /*
     * (non-Javadoc)
     * @see
     * org.ops4j.pax.vaadin.ApplicationFactory#createApplication(javax.servlet
     * .http.HttpServletRequest)
     */
    @Override
    public Application createApplication(final HttpServletRequest request) throws ServletException {
        if (m_nodeDao == null) {
            throw new RuntimeException("m_nodeDao cannot be null.");
        }
        final NodeMapsApplication app = new NodeMapsApplication();
        app.setNodeDao(m_nodeDao);
        app.setAssetRecordDao(m_assetDao);
        app.setAlarmDao(m_alarmDao);
        app.setGeocoderService(m_geocoder);
        app.setTransactionOperations(m_transaction);
        
        if (m_headerProvider != null) {
            try {
                app.setHeaderHtml(m_headerProvider.getHeaderHtml(request));
            } catch (final Exception e) {
                LOG.warn("failed to get header HTML for request {}", request.getPathInfo(), e);
            }
        }
        return app;
    }


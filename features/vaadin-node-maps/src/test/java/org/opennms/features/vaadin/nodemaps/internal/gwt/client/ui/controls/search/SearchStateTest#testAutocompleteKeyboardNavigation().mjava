    @Test
    public void testAutocompleteKeyboardNavigation() throws Exception {
        final MockSearchStateManager searchManager = new MockSearchStateManager(m_valueItem);

        // autocomplete shouldn't do anything even if we down-arrow, since we haven't started searching yet
        typeCharacter(searchManager, (char)KeyCodes.KEY_DOWN);
        searchManager.updateMatchCount(100);
        assertEquals(State.NOT_SEARCHING, searchManager.getState());
        assertEquals(false, searchManager.isAutocompleteVisible());
        assertEquals(false, searchManager.isAutocompleteFocused());

        // start typing
        typeCharacter(searchManager, 'a');
        searchManager.updateMatchCount(15);
        assertEquals(State.SEARCHING_AUTOCOMPLETE_VISIBLE, searchManager.getState());
        assertEquals(true, searchManager.isAutocompleteVisible());
        assertEquals(false, searchManager.isAutocompleteFocused());

        // hit down-arrow
        typeCharacter(searchManager, (char)KeyCodes.KEY_DOWN);
        searchManager.updateMatchCount(15);
        assertEquals(State.SEARCHING_AUTOCOMPLETE_ACTIVE, searchManager.getState());
        assertEquals(true, searchManager.isAutocompleteVisible());
        assertEquals(true, searchManager.isAutocompleteFocused());

        // hit enter
        hitEnterInInput(searchManager);
        searchManager.updateMatchCount(15);
        assertEquals(State.SEARCHING_FINISHED, searchManager.getState());
        assertEquals(false, searchManager.isAutocompleteVisible());
        assertEquals(false, searchManager.isAutocompleteFocused());
    }


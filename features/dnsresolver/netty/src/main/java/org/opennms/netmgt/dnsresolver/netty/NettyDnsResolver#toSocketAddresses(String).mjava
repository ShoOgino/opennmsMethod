    public static List<InetSocketAddress> toSocketAddresses(String commaSeparatedAddressesWithPorts) {
        final String[] servers = commaSeparatedAddressesWithPorts.split(",");
        return Arrays.stream(servers)
                .map(s -> {
                    final String[] parts;
                    final Matcher matcher = IPV6_ADDR_PATTERN.matcher(s);
                    if (matcher.matches()) {
                        // We've got an IPv6 address
                        final String addrStr = matcher.group(1);
                        final String portStr = matcher.group(3);
                        if (portStr != null) {
                            parts = new String[]{addrStr, portStr};
                        } else {
                            parts = new String[]{addrStr};
                        }
                    } else {
                        // We've got an IPv4 address or a hostname
                        parts = s.split(":");
                    }

                    if (parts.length > 1) {
                        return SocketUtils.socketAddress(parts[0].trim(), Integer.parseInt(parts[1].trim()));
                    } else {
                        return SocketUtils.socketAddress(parts[0].trim(),53);
                    }
                })
                .collect(Collectors.toList());
    }


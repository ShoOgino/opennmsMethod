    public void updateServiceTemplates() {
        // Build a hash map of all service-templates
        Map<String, ServiceTemplate> serviceTemplateMap = new HashMap<String, ServiceTemplate>();
        if (getServiceTemplates() != null) {
            for (ServiceTemplate t : getServiceTemplates()) {
                serviceTemplateMap.put(t.getName(), t);
            }
        }

        // Iterate over all the services
        for (Package p : m_packages) {
            Service s = p.getService();

            // Default to null in case an existing template was removed
            s.setTemplate(null);

            if (StringUtils.isNotBlank(s.getTemplateName())) {
                // The template name is set, try and associate it to the
                // service
                if (serviceTemplateMap.containsKey(s.getTemplateName())) {
                    s.setTemplate(serviceTemplateMap.get(s.getTemplateName()));
                }
            } else {
                // The template name is not set, try and find one with the
                // service's name
                if (serviceTemplateMap.containsKey(s.getName())) {
                    s.setTemplate(serviceTemplateMap.get(s.getName()));
                }
            }
        }
    }


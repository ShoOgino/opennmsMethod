	@Override
	public void process(final Exchange exchange) throws Exception {
		final Event event = exchange.getIn().getBody(Event.class);
		
		Endpoint from = exchange.getFromEndpoint();

		if (event.getNodeid() > 0) {
			String foreignSource = exchange.getIn().getHeader(EVENT_HEADER_FOREIGNSOURCE, String.class);
			String foreignId = exchange.getIn().getHeader(EVENT_HEADER_FOREIGNID, String.class);

			OnmsNode node = nodeDao.findByForeignId(foreignSource, foreignId);

			if (node != null && node.getId() != null) {
				event.setNodeid(node.getId().longValue());
				event.setDistPoller(from.getEndpointKey());
				event.setSource("Endpoint="+from.getEndpointKey()+":"+event.getSource());
			} else {
				LOG.warn("Could not find node {}/{} in the database, cannot update node ID to local value; discarding event", foreignSource, foreignId);
				// Halt the route if we cannot translate the node ID
				exchange.setProperty(Exchange.ROUTE_STOP, Boolean.TRUE);
			}
		}
	}


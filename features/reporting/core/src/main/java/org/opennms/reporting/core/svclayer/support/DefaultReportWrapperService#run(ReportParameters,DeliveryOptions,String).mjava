    /* (non-Javadoc)
     * @see org.opennms.api.reporting.ReportService#run(java.util.HashMap, org.opennms.api.reporting.DeliveryOptions, java.lang.String)
     */
    public void run(ReportParameters reportParms,
            DeliveryOptions deliveryOptions, String reportId) {
        if (!deliveryOptions.getPersist()) {
            ByteArrayOutputStream out = new ByteArrayOutputStream();
            BufferedOutputStream bout = new BufferedOutputStream(out);
            getReportService(reportId).runAndRender(reportParms.getReportParms(), reportId, deliveryOptions.getFormat(), bout);
            mailReport(deliveryOptions, out);
        } else {
            String outputPath = getReportService(reportId).run(reportParms.getReportParms(), reportId);
            ReportCatalogEntry catalogEntry = new ReportCatalogEntry();
            catalogEntry.setReportId(reportId);
            catalogEntry.setTitle(reportId);
            catalogEntry.setLocation(outputPath);
            catalogEntry.setDate(new Date());
            m_reportStoreService.save(catalogEntry);
            if (deliveryOptions.getMailTo().length() != 0){
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                BufferedOutputStream bout = new BufferedOutputStream(out);
                getReportService(reportId).render(reportId, outputPath, deliveryOptions.getFormat(), bout);
                mailReport(deliveryOptions, out);
            }
            
        }

    }


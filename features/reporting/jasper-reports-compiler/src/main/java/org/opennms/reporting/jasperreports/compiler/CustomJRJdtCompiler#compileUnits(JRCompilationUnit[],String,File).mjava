    @Override
    protected String compileUnits(final JRCompilationUnit[] units, String classpath, File tempDirFile) {
        final INameEnvironment env = getNameEnvironment(units);

        final IErrorHandlingPolicy policy = DefaultErrorHandlingPolicies.proceedWithAllProblems();

        final CompilerOptions options = getJdtSettings();

        final IProblemFactory problemFactory = new DefaultProblemFactory(Locale.getDefault());

        final CompilerRequestor requestor = getCompilerRequestor(units);

        final Compiler compiler = new Compiler(env, policy, options, requestor, problemFactory);

        do {
            CompilationUnit[] compilationUnits = requestor.processCompilationUnits();

            compiler.compile(compilationUnits);
        } while (requestor.hasMissingMethods());

        requestor.processProblems();

        return requestor.getFormattedProblems();
    }


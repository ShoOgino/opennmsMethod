    @Override
    public Response getReportDetails(String reportId, String userId) {
        final List<ReportFormat> formats = reportWrapperService.getFormats(reportId);
        final ReportParameters parameters = reportWrapperService.getParameters(reportId);
        final Collection<Category> categories = categoryConfigDao.findAll();
        final List<OnmsCategory> surveillanceCategories = categoryDao.findAll();
        final ReportDetailsBuilder reportDetailsBuilder = new ReportDetailsBuilder()
                .withReportId(reportId)
                .withFormats(formats)
                .withParameters(parameters)
                .withCategories(categories)
                .withSurveillanceCategories(surveillanceCategories)
                .withDefaultTimezones();

        // Apply delivery Options if user Id is provided
        if (userId != null) {
            final DeliveryOptions deliveryOptions = reportWrapperService.getDeliveryOptions(reportId, userId);
            reportDetailsBuilder.withDeliveryOptions(deliveryOptions);
        }

        // Convert to JSON
        final JSONObject jsonObject = reportDetailsBuilder.build().toJson();
        return Response.ok(jsonObject.toString()).type(MediaType.APPLICATION_JSON_TYPE).build();
    }


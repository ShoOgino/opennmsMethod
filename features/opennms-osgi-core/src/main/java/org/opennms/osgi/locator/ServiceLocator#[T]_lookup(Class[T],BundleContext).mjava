    public <T> T lookup(Class<T> lookupClass, BundleContext bundleContext) {
        if (bundleContext == null) throw new IllegalArgumentException("BundleContext must not be null!");
        if (lookupClass == null) throw new IllegalArgumentException("LookupClass must not be null!");
        try {
            ServiceReference[] serviceReferences = bundleContext.getAllServiceReferences(
                    lookupClass.getName(),
                    String.format("(bundleId=%d)", bundleContext.getBundle().getBundleId()));
            if (serviceReferences == null || serviceReferences.length == 0) {
                Log.warn("No {} found", lookupClass);
                return null;
            }
            return (T) bundleContext.getService(serviceReferences[0]);
        } catch (InvalidSyntaxException ex) {
            Log.warn(String.format("Error while retrieving %s", lookupClass), ex);
        }
        Log.warn("No {} found", lookupClass);
        return null;
    }


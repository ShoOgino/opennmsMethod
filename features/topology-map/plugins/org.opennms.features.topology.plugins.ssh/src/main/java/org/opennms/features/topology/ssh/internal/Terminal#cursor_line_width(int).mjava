    private int[] cursor_line_width(int next_char) {
        int wx = utf8_charwidth(next_char);
        int lx = 0;
        for (int x = 0; x < Math.min(cx, width); x++) {
            int c = peek(cy, x, cy + 1, x + 1)[0] & 0xffff;
            wx += utf8_charwidth(c);
            lx += 1;
        }
        return new int[] { wx, lx };
    }


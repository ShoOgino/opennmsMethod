    private String getDefaultIp(Vertex vertex, Optional<OnmsNode> node) {
        if (hasValidIpAddress(vertex)) {
            return vertex.getIpAddress();
        }
        if (node.isPresent() && node.get().getPrimaryInterface() != null) {
            return InetAddressUtils.str(node.get().getPrimaryInterface().getIpAddress());
        }
        if (node.isPresent()) {
            return InetAddressUtils.str(node.get().getIpInterfaces().iterator().next().getIpAddress());
        }
        throw new IllegalStateException("The vertex does not have a ip address or a node assigned.");
    }


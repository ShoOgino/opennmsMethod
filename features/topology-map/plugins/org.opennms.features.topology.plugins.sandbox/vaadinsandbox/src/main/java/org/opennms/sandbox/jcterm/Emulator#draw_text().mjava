  protected void draw_text() throws java.io.IOException{

    int rx;
    int ry;
    int w;
    int h;

    check_region();

    rx=x;
    ry=y;

    byte b=getChar();
    term.draw_cursor();
    //System.out.print(new Character((char)b)+"["+Integer.toHexString(b&0xff)+"]");
    if((b&0x80)!=0){
      term.clear_area(x, y-char_height, x+char_width*2, y);
      b2[0]=b;
      b2[1]=getChar();
      term.drawString(new String(b2, 0, 2, "EUC-JP"), x, y);
      x+=char_width;
      x+=char_width;
      w=char_width*2;
      h=char_height;
    }
    else{
      pushChar(b);
      int foo=getASCII(term_width-(x/char_width));
      if(foo!=0){
        //System.out.println("foo="+foo+" "+x+", "+(y-char_height)+" "+(x+foo*char_width)+" "+y+" "+buf+" "+bufs+" "+b+" "+buf[bufs-foo]);
        //System.out.println("foo="+foo+" ["+new String(buf, bufs-foo, foo));
        term.clear_area(x, y-char_height, x+foo*char_width, y);
        term.drawBytes(buf, bufs-foo, foo, x, y);
      }
      else{
        foo=1;
        term.clear_area(x, y-char_height, x+foo*char_width, y);
        b1[0]=getChar();
        term.drawBytes(b1, 0, foo, x, y);
        //System.out.print("["+Integer.toHexString(bar[0]&0xff)+"]");
      }
      x+=(char_width*foo);
      w=char_width*foo;
      h=char_height;
    }
    term.redraw(rx, ry-char_height, w, h);
    term.setCursor(x, y);
    term.draw_cursor();
  }


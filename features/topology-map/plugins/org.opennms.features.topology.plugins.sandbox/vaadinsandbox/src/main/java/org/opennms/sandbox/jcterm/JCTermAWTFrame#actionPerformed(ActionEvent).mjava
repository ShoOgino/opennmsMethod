  public void actionPerformed(ActionEvent e) {
    String action = e.getActionCommand();
    if (action.equals("Open SHELL Session...") ||
	action.equals("Open SFTP Session...")
	){
      if(thread==null){
        if(action.equals("Open SHELL Session...")){ mode=SHELL; }
        else if(action.equals("Open SFTP Session...")){ mode=SFTP; }
	while(true){
	  InputDialog dialog=new InputDialog("Enter username@hostname",
					     "",
					     false);
	  try{
	    String _host=dialog.getText();
	    if(_host==null) return;
	    String _user=_host.substring(0, _host.indexOf('@'));
	    _host=_host.substring(_host.indexOf('@')+1);
	    if(_host==null || _host.length()==0){
	      return;
	    }
	    user=_user;
	    host=_host;
	    openSession();
	    return;
	  }
	  catch(Exception ee){
	  }
	}
      }
    }
    else if (action.equals("HTTP...")){
      String foo=getProxyHttpHost();
      int bar=getProxyHttpPort();

      InputDialog dialog=new InputDialog("HTTP proxy server (hostname:port)",
					 ((foo!=null&&bar!=0)? foo+":"+bar : ""),
					 false);
      String proxy=dialog.getText();
      if(proxy==null) return;
      if(proxy.length()==0){
        setProxyHttp(null, 0);
        return;
      }
      try{
        foo=proxy.substring(0, proxy.indexOf(':'));
	bar=Integer.parseInt(proxy.substring(proxy.indexOf(':')+1));
	if(foo!=null){
          setProxyHttp(foo, bar);
	}
      }
      catch(Exception ee){
      }

    }
    else if (action.equals("SOCKS5...")){
      String foo=getProxySOCKS5Host();
      int bar=getProxySOCKS5Port();

      InputDialog dialog=new InputDialog("SOCKS5 server (hostname:1080)",
					 ((foo!=null&&bar!=0)? foo+":"+bar : ""),
					 false);
      String proxy=textf.getText();
      if(proxy==null) return;
      if(proxy.length()==0){
        setProxySOCKS5(null, 0);
	return;
      }
      try{
        foo=proxy.substring(0, proxy.indexOf(':'));
  	bar=Integer.parseInt(proxy.substring(proxy.indexOf(':')+1));
        if(foo!=null){
          setProxySOCKS5(foo, bar);
	}
      }
      catch(Exception ee){
      }
    }
      /*
    else if(action.equals("X11 Forwarding...")){
      String display=null;
      display=JOptionPane.showInputDialog(this,
					  "XDisplay name (hostname:0)", 
					  (xhost==null)? "": (xhost+":"+xport));
      try{
        if(display!=null){
          xhost=display.substring(0, display.indexOf(':'));
	  xport=Integer.parseInt(display.substring(display.indexOf(':')+1));
	  xforwarding=true;
	}
      }
      catch(Exception ee){
        xforwarding=false;
	xhost=null;
      }
    }
      */
    /*
    else if((action.equals("AntiAliasing"))){
      setAntiAliasing(!antialiasing);
    }
      */
    else if(action.equals("About...")){
      MessageDialog msg=new MessageDialog("About...", JCTermAWT.COPYRIGHT);
    }
    else if(action.equals("Compression...")){
      InputDialog dialog=new InputDialog("Compression level(0-9)",
					 new Integer(compression).toString(),
					 false);

      String foo=dialog.getText();
      try{
        if(foo!=null){
	  compression=Integer.parseInt(foo);
	}
      }
      catch(Exception ee){
      }
    }
    else if(action.equals("Line Space...")){
      InputDialog dialog=new InputDialog("Line Space",
					 new Integer(line_space).toString(),
					 false);

      String foo=dialog.getText();
      try{
        if(foo!=null){
	  setLineSpace(Integer.parseInt(foo));
	}
      }
      catch(Exception ee){
      }
    }
    else if((action.equals("Local Port...")) || 
	    (action.equals("Remote Port..."))){
      if(jschsession==null){
//        JOptionPane.showMessageDialog(this,
//				      "Establish the connection before this setting.");
	return;
      }

      try{
        String title="";
	if(action.equals("Local Port...")){
          title+="Local port forwarding";
	}
	else{
          title+="remote port forwarding";
	}
        title+="(port:host:hostport)";

	InputDialog dialog=new InputDialog(title, "", false);

	String foo=dialog.getText();
	if(foo==null) return;
	int port1=Integer.parseInt(foo.substring(0, foo.indexOf(':')));
	foo=foo.substring(foo.indexOf(':')+1);
	String host=foo.substring(0, foo.indexOf(':'));
	int port2=Integer.parseInt(foo.substring(foo.indexOf(':')+1));

	if(action.equals("Local Port...")){
	  setPortForwardingL(port1, host, port2);
	}
	else{
	  setPortForwardingR(port1, host, port2);
	}
      }
      catch(Exception ee){
      }
    }
    else if (action.equals("Quit")){
      quit();
    }
    else if (action.equals("CANCEL")){
      dialog.setVisible(false);
    }
/*
    else if (action.equals("passwd")){
      ui.passwd=textf.getText();
      dialog.setVisible(false);
      return;
    }
    else if (action.equals("passphrase")){
      ui.passphrase=textf.getText();
      dialog.setVisible(false);
      return;
    }
    else if (action.equals("SOCKS5... return")){
      String proxy=textf.getText();
      if(proxy.length()==0){
        setProxySOCKS5(null, 0);
	dialog.setVisible(false);
	return;
      }
      try{
        String foo=proxy.substring(0, proxy.indexOf(':'));
  	int bar=Integer.parseInt(proxy.substring(proxy.indexOf(':')+1));
        if(foo!=null){
          setProxySOCKS5(foo, bar);
	  dialog.setVisible(false);
	}
      }
      catch(Exception ee){
      }
    }

    else if ((action.equals("Local Port... return")) || 
	    (action.equals("Remote Port... return"))){
      String foo=textf.getText();
      int port1=Integer.parseInt(foo.substring(0, foo.indexOf(':')));
      foo=foo.substring(foo.indexOf(':')+1);
      String host=foo.substring(0, foo.indexOf(':'));
      int port2=Integer.parseInt(foo.substring(foo.indexOf(':')+1));

      if(action.equals("Local Port...")){
	setPortForwardingL(port1, host, port2);
      }
      else{
	setPortForwardingR(port1, host, port2);
      }
      dialog.setVisible(false);
    }
    else if (action.equals("HTTP... return")){
      String proxy=textf.getText();
      if(proxy.length()==0){
        setProxyHttp(null, 0);
	dialog.setVisible(false);
        return;
      }
      try{
        String foo=proxy.substring(0, proxy.indexOf(':'));
	int bar=Integer.parseInt(proxy.substring(proxy.indexOf(':')+1));
	if(foo!=null){
          setProxyHttp(foo, bar);
	  dialog.setVisible(false);
	}
      }
      catch(Exception ee){
      }
    }
    else if (action.equals("Open SHELL Session... return") ||
	     action.equals("Open SFTP Session... return")
	     ){
      try{
	String _host=textf.getText();
	String _user=_host.substring(0, _host.indexOf('@'));
	_host=_host.substring(_host.indexOf('@')+1);
	if(_host==null || _host.length()==0){
	  return;
	}
	user=_user;
	host=_host;
	dialog.setVisible(false);
	openSession();
      }
      catch(Exception ee){
      }
    }
    */
  }


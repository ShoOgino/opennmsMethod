  public synchronized byte[] sign(byte[] blob, byte[] data) {
    byte[] result = null;

    byte code1 = SSH2_AGENTC_SIGN_REQUEST;
    byte code2 = SSH2_AGENT_SIGN_RESPONSE;

    buffer.reset();
    buffer.putByte(code1);
    buffer.putString(blob);
    buffer.putString(data);
    buffer.putInt(0);   // SSH_AGENT_OLD_SIGNATURE
    buffer.insertLength();

    try {
      connector.query(buffer);
    }
    catch(AgentProxyException e){
      buffer.rewind();
      buffer.putByte(SSH_AGENT_FAILURE);
    }

    int rcode = buffer.getByte();

    check_reply(rcode);

//System.out.println(rcode == code2);

    result = buffer.getString();

    return result;
  }


  public void keyPressed(KeyEvent e){
    //System.out.println("keyPressed: "+emulator+" "+graphics+" "+img);
    if(emulator==null)
      return;

    int stateMask=e.stateMask;
    int keycode=e.keyCode;
    //System.out.println("keycode: "+keycode); 
    byte[] code=null;
    switch(keycode){
      case SWT.CONTROL:
      case SWT.SHIFT:
      case SWT.ALT:
        //case KeyEvent.VK_CAPS_LOCK:
        return;
      case SWT.CR:
        code=emulator.getCodeENTER();
        break;
      case SWT.ARROW_UP:
        code=emulator.getCodeUP();
        break;
      case SWT.ARROW_DOWN:
        code=emulator.getCodeDOWN();
        break;
      case SWT.ARROW_RIGHT:
        code=emulator.getCodeRIGHT();
        break;
      case SWT.ARROW_LEFT:
        code=emulator.getCodeLEFT();
        break;
      case SWT.F1:
        code=emulator.getCodeF1();
        break;
      case SWT.F2:
        code=emulator.getCodeF2();
        break;
      case SWT.F3:
        code=emulator.getCodeF3();
        break;
      case SWT.F4:
        code=emulator.getCodeF4();
        break;
      case SWT.F5:
        code=emulator.getCodeF5();
        break;
      case SWT.F6:
        code=emulator.getCodeF6();
        break;
      case SWT.F7:
        code=emulator.getCodeF7();
        break;
      case SWT.F8:
        code=emulator.getCodeF8();
        break;
      case SWT.F9:
        code=emulator.getCodeF9();
        break;
      case SWT.F10:
        code=emulator.getCodeF10();
        break;
      case SWT.TAB:
        code=emulator.getCodeTAB();
        break;
    }
    if(code!=null){
      try{
        out.write(code, 0, code.length);
        out.flush();
      }
      catch(Exception ee){
      }
      return;
    }
    /*
    SWT.SHIFT
    SWT.ALT
    SWT.ARROW_DOWN
    SWT.ARROW_LEFT
    SWT.ARROW_RIGHT
    SWT.ARROW_UP
    SWT.BS
    SWT.CONTROL / SWT.CTRL
    SWT.CTRL
    SWT.DEL
    SWT.ESC
    SWT.F1 - SWT.F12
    SWT.CR <- RETURN
    */

    char character=e.character;
    //System.out.println("character: " + character);
    buf[0]=(byte)(character);
    try{
      out.write(buf, 0, 1);
      out.flush();
    }
    catch(Exception ee){
    }
  }


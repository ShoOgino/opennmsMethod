    // TODO how to populate the context correctly?
    private Map<String, Object> createVertexContext(final VertexRef vertex) {
        final Map<String, Object> context = Maps.newHashMap();
        if (vertex instanceof AbstractVertex) {
            final AbstractVertex abstractVertex = (AbstractVertex) vertex;
            if (abstractVertex.getNodeID() != null) {
                final OnmsNode node = this.nodeDao.get(abstractVertex.getNodeID());
                if (node != null) {
                    context.put("node", node);
                }
            }
        }
        if (vertex instanceof GraphMLVertex) {
            final GraphMLVertex atlasVertex = (GraphMLVertex) vertex;
            context.putAll(atlasVertex.getProperties());
        }
        context.put("vertex", vertex);
        return context;
    }


	public void updateFromUIDL(UIDL uidl, ApplicationConnection client) {

		if(client.updateComponent(this, uidl, true)) {
			return;
		}

		m_client = client;
		m_paintableId = uidl.getId();

		setScale(uidl.getDoubleAttribute("scale"), uidl.getIntAttribute("clientX"), uidl.getIntAttribute("clientY"));
		setSemanticZoomLevel(uidl.getIntAttribute("semanticZoomLevel"));
		setPanToSelection(uidl.getBooleanAttribute("panToSelection"));
		setFitToView(uidl.getBooleanAttribute("fitToView"));
		setActiveTool(uidl.getStringAttribute("activeTool"));

		UIDL graphUIDL = uidl.getChildByTagName("graph");
		Iterator<?> children = graphUIDL.getChildIterator();

		GWTGraph graph = GWTGraph.create();
		GWTVertex.setBackgroundImage(client.translateVaadinUri("theme://images/vertex_circle_selector.png"));
		while(children.hasNext()) {
			UIDL child = (UIDL) children.next();

			if(child.getTag().equals("vertex")) {
				String vertexKey = child.getStringAttribute("key");
				//consoleLog("UIDL vertex: " + vertexKey);

				GWTVertex vertex = GWTVertex.create(vertexKey, child.getIntAttribute("x"), child.getIntAttribute("y"));
				
				vertex.setInitialX(child.getIntAttribute("initialX"));
				vertex.setInitialY(child.getIntAttribute("initialY"));
				
				boolean selected = child.getBooleanAttribute("selected");
				vertex.setSelected(selected);

				vertex.setIconUrl(client.translateVaadinUri(child.getStringAttribute("iconUrl")));

				if (child.hasAttribute("label")) {
					vertex.setLabel(child.getStringAttribute("label"));
				}

				graph.addVertex(vertex);

				if(m_client != null) {
					TooltipInfo ttInfo = new TooltipInfo(child.getStringAttribute("tooltipText"));
					m_client.registerTooltip(this, vertex, ttInfo);
				}
				
			}else if(child.getTag().equals("edge")) {
				String edgeKey = child.getStringAttribute("key");
				String sourceKey = child.getStringAttribute("source");
				String targetKey = child.getStringAttribute("target");
				//consoleLog("UIDL edge: " + edgeKey + "(" + sourceKey +"," + targetKey +")");
				
				GWTVertex source = graph.findVertexById(sourceKey);
				GWTVertex target = graph.findVertexById( targetKey );
				GWTEdge edge = GWTEdge.create(edgeKey, source, target);
				boolean selected = child.getBooleanAttribute("selected");
				String cssClass = child.getStringAttribute("cssClass");
				edge.setSelected(selected);
				edge.setCssClass(cssClass);
				String ttText = child.getStringAttribute("tooltipText");
				edge.setTooltipText(ttText);
				graph.addEdge(edge);

			}
		}
		
		JsArray<GWTEdge> edges = graph.getEdges();
        for( int i = 0; i < edges.length(); i++) {
		    if(i != 0) {
		        GWTEdge edge1 = edges.get(i-1);
		        GWTEdge edge2 = edges.get(i);
		        
		        if(edge1.getSource() == edge2.getSource() && edge1.getTarget() == edge2.getTarget()) {
		            edge2.setLinkNum(edge1.getLinkNum() + 1);
		        }else {
		            edge2.setLinkNum(1);
		        }
		    }
		}

		setGraph(graph);
		
	}


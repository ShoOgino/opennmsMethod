	public void apply(MenuBar rootMenu, List<VertexRef> targets, OperationContext operationContext, Runnable... hooks) {
		final List<Runnable> hookList = hooks == null ? Collections.emptyList() : Arrays.asList(hooks);

		// Determine the order of the items in the menu
		determineAndApplyOrder();

		// Start building menubar
		List<MenuItem> rootItems = new ArrayList<>(m_menuBar);
		Collections.sort(rootItems);
		for (MenuItem eachRootElement : rootItems) {
			MenuBar.MenuItem menuItem = addItem(() -> rootMenu.addItem(removeLabelProperties(eachRootElement.getLabel()), null), eachRootElement, targets, operationContext, hookList);

			// Add children
			addItems(menuItem, eachRootElement, targets, operationContext, hookList);
		}
	}


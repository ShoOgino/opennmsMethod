    /**
     * Centers the view on a selection
     */
    public void centerSelection() {
        
        final D3 selection = D3.d3().selectAll(GWTVertex.SELECTED_VERTEX_CLASS_NAME);
        
        SVGMatrix viewportMatrix = getSVGViewPort().getCTM();
        final int svgWidth = getSVGElement().getBoundingClientRect().getWidth();
        final int svgHeight = getSVGElement().getBoundingClientRect().getHeight();

        double svgCenterX = Math.abs(getSVGElement().getCTM().getE() - svgWidth/2);
        double svgCenterY = Math.abs(getSVGElement().getCTM().getF() - svgHeight/2);
        
        final BoundingRect rect = new BoundingRect();

        selection.each(new Handler<GWTVertex>() {

            @Override
            public void call(GWTVertex vertex, int index) {
                SVGGElement vertexElem = D3.d3().getElement(selection, index).cast();
                
                SVGMatrix vertexCTM = vertexElem.getCTM();

                double vertexX = vertexCTM.getE();
                double vertexY = vertexCTM.getF();
                
                rect.addPoint(new Point(vertexX, vertexY));
            }
        });
        
        final double scaleFactor = viewportMatrix.getA();
        final double percent = 100 / (scaleFactor * 100);
        double translateX = (svgCenterX - rect.getCenterX()) * percent;
        double translateY = (svgCenterY - rect.getCenterY()) * percent;
        
        D3.d3().select(getSVGViewPort()).transition().duration(500).attr("transform", matrixTransform(viewportMatrix.translate(translateX, translateY))).each("end", new AnonymousFunc() {

            @Override
            public void call() {
                
                double rectWidthPercent = svgWidth / rect.getWidth() ;
                double rectHeightPercent = svgHeight / rect.getHeight() ;
                        
                if(rectWidthPercent < 1 && rectWidthPercent < rectHeightPercent) {
                    setMapScaleNow( rectWidthPercent * scaleFactor );
                }else if(rectHeightPercent < 1 && rectHeightPercent < rectWidthPercent) {
                    setMapScaleNow( rectHeightPercent * scaleFactor );
                }else if(scaleFactor < 1) {
                    setMapScaleNow(1);
                }
            }
        });
        
        
        
        
    }


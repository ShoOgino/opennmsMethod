    private void centerD3Selection(JsArray<GWTVertex> vertices, boolean fitToView) {
        SVGMatrix viewportMatrix = getSVGElement().createSVGMatrix();
        
        SVGElement svg = getSVGElement();
        final int svgWidth = svg.getParentElement().getOffsetWidth(); 
        final int svgHeight = svg.getParentElement().getOffsetHeight();
        
        double svgCenterX = svgWidth/2;
        double svgCenterY = svgHeight/2;
        
        final BoundingRect rect = new BoundingRect();

        for(int i = 0; i < vertices.length(); i++) {
            GWTVertex vertex = vertices.get(i);
            
            if(fitToView || vertex.isSelected()) {
                double vertexX = vertex.getX();//vertexCTM.getE();
                double vertexY = vertex.getY(); //vertexCTM.getF();
                consoleLog("(" + vertexX + "," + vertexY+")");
                rect.addPoint(new Point(vertexX, vertexY));
            }
        }
        
        double translateX = (svgCenterX - rect.getCenterX());
        double translateY = (svgCenterY - rect.getCenterY());
        
        D3.d3().select(getSVGViewPort()).transition().duration(500).attr("transform", matrixTransform(viewportMatrix.translate(translateX, translateY))).each("end", new AnonymousFunc() {

            @Override
            public void call() {
                
                double rectWidthPercent = svgWidth / rect.getWidth() ;
                double rectHeightPercent = svgHeight / rect.getHeight() ;
                consoleLog("rect.getWidth: " + rect.getWidth() + " rect.getHeight: " + rect.getHeight() + " rect.getCenterY: " + rect.getCenterY() + " rect.getCenterX: " + rect.getCenterX());
                consoleLog("setting scale: " + (1 * Math.min( rectWidthPercent, rectHeightPercent )));
                setMapScaleNow( 1 * Math.min( rectWidthPercent, rectHeightPercent ) );
                        
//                if(rectWidthPercent < 1 && rectWidthPercent < rectHeightPercent) {
//                    setMapScaleNow( rectWidthPercent * scaleFactor );
//                }else if(rectHeightPercent < 1 && rectHeightPercent < rectWidthPercent) {
//                    setMapScaleNow( rectHeightPercent * scaleFactor );
//                }else if(scaleFactor < 1) {
//                    setMapScaleNow(1);
//                }
            }
        });
    }


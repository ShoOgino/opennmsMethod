    private Converter getConverter(Class<?> clazz) throws IllegalStateException {
        Optional<Converter<?>> converter = converterRegistry.stream().filter(con -> con.canConvert(clazz)).findFirst();
        if (!converter.isPresent()) {
            throw new IllegalStateException("Missing converter for class '" + clazz + "'");
        }
        return converter.get();
    }


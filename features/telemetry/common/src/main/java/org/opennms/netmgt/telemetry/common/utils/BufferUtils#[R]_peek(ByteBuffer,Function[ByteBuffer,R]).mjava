    public static <R> R peek(final ByteBuffer buffer, Function<ByteBuffer, R> consumer) {
        final int position = buffer.position();
        try {
            return consumer.apply(buffer);
        } finally {
            buffer.position(position);
        }
    }


    @Override
    public Adapter createAdapter(Protocol protocol, Map<String, String> properties) {
        if (delegateFactory == null) {
            delegateFactory = new Netflow5AdapterFactory();
            delegateFactory.setTransactionOperations(createTransactionOperations());
            delegateFactory.setNodeDao(nodeDao);
            delegateFactory.setMetricRegistry(createMetricRegistry());
            delegateFactory.setInterfaceToNodeCache(interfaceToNodeCache);
            delegateFactory.setFlowRepository(createFlowRepository());
            delegateFactory.setClassificationEngine(new DefaultClassificationEngine(() -> Collections.emptyList()));
        }
        return delegateFactory.createAdapter(protocol, properties);
    }


    @Override
    public Handler accept(final InetSocketAddress remoteAddress,
                          final InetSocketAddress localAddress) {
        return buffer -> {
            buffer.markReaderIndex();

            final Header header;
            if (buffer.isReadable(Header.SIZE)) {
                header = new Header(slice(buffer, Header.SIZE));
            } else {
                buffer.resetReaderIndex();
                return Optional.empty();
            }

            final Packet packet;
            if (buffer.isReadable(header.payloadLength())) {
                packet = header.parsePayload(slice(buffer, header.payloadLength()));
            } else {
                buffer.resetReaderIndex();
                return Optional.empty();
            }

            LOG.trace("Got packet: {}", packet);

            final BasicOutputBuffer output = new BasicOutputBuffer();
            try (final BsonBinaryWriter writer = new BsonBinaryWriter(output)) {
                writer.writeStartDocument();

                writer.writeInt32("@version", header.version);
                writer.writeString("@type", header.type.name());

                packet.accept(new Serializer(writer));

                writer.writeEndDocument();
            }

            this.recordsDispatched.mark();

            final TelemetryMessage message = new TelemetryMessage(remoteAddress, output.getByteBuffers().get(0).asNIO());
            return Optional.of(dispatcher.send(message));
        };
    }


    @Override
    public List<StatsPeerRib> getPeerRibCountsByPeer() {
        return getHibernateTemplate().execute(session -> (List<StatsPeerRib>) session.createSQLQuery(
                "SELECT to_timestamp((cast((extract(epoch from now())) as bigint)/900)*900)," +
                        " peer_hash_id," +
                        " sum(CASE WHEN is_ipv4 = true THEN 1 ELSE 0 END) AS v4_prefixes, " +
                        " sum(CASE WHEN is_ipv4 = false THEN 1 ELSE 0 END) as v6_prefixes " +
                        " FROM bmp_ip_ribs " +
                        " WHERE is_withdrawn = false" +
                        " GROUP BY peer_hash_id"
        ).setResultTransformer(new ResultTransformer() {
            @Override
            public Object transformTuple(Object[] tuple, String[] aliases) {
                return new StatsPeerRib((Date) tuple[0], (String) tuple[1], (BigInteger) tuple[2], (BigInteger) tuple[3]);
            }

            @SuppressWarnings("rawtypes")
            @Override
            public List transformList(List collection) {
                return collection;
            }
        }).list());
    }


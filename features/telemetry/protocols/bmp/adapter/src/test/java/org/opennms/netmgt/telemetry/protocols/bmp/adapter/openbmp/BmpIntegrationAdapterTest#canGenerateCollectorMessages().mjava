    @Test
    public void canGenerateCollectorMessages() {
        final Transport.Heartbeat.Builder heartbeat = Transport.Heartbeat.newBuilder()
                                                                         .setMode(Transport.Heartbeat.Mode.CHANGE);
        heartbeat.addRoutersBuilder().setV4(ByteString.copyFrom(InetAddressUtils.toIpAddrBytes("1.2.3.4")));
        heartbeat.addRoutersBuilder().setV4(ByteString.copyFrom(InetAddressUtils.toIpAddrBytes("5.6.7.8")));
        heartbeat.addRoutersBuilder().setV6(ByteString.copyFrom(InetAddressUtils.toIpAddrBytes("2001:0db8:85a3::8a2e:0370:7334")));

        Transport.Message message = Transport.Message.newBuilder()
                                                     .setVersion(3)
                                                     .setHeartbeat(heartbeat)
                                                     .build();

        send(message.toByteString());

        List<Collector> collectorMessages = getHandledRecordsOfType(Type.COLLECTOR);
        assertThat(collectorMessages, hasSize(1));
        assertThat(collectorMessages.get(0).adminId, is("0xDEADBEEF"));
        assertThat(collectorMessages.get(0).action, is(Collector.Action.CHANGE));
        assertThat(collectorMessages.get(0).routers, contains(InetAddressUtils.addr("1.2.3.4"),
                                                              InetAddressUtils.addr("5.6.7.8"),
                                                              InetAddressUtils.addr("2001:0db8:85a3::8a2e:0370:7334")));
    }


    public final void serialize(final StringBuffer buffer) {
        // Serialize records to data buffer (required to know buffer length beforehand)
        final StringBuffer data = new StringBuffer();
        for (final Record record : this.records) {
            record.serialize(data);
        }

        // Write headers
        serializeHeader(buffer, "V", "1.7");
        serializeHeader(buffer, "C_HASH_ID", this.collectorHashId);
        serializeHeader(buffer, "T", this.type.toString());
        serializeHeader(buffer, "L", Integer.toString(data.length()));
        serializeHeader(buffer, "R", Integer.toString(this.records.size()));

        // Headers and data separated by double newline
        buffer.append('\n');

        // Append data from buffer
        buffer.append(data);
    }


    public Array(final ByteBuf buffer,
                 final Optional<Integer> size,
                 final Parser<? extends T> parser) throws InvalidPacketException {

        this.size = size.orElseGet(() -> (int) BufferUtils.uint32(buffer));

        final List<T> values = new ArrayList<>(this.size);
        for (int i = 0; i < this.size; i++) {
            values.add(parser.parse(buffer));
        }
        this.values = Collections.unmodifiableList(values);
    }


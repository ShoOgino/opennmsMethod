    public Record(final ByteBuf buffer, final Map<DataFormat, Opaque.Parser<T>> dataFormats) throws InvalidPacketException {
        this.dataFormat = new DataFormat(buffer);

        final Opaque.Parser<T> parser = dataFormats.get(this.dataFormat);
        if (parser != null) {
            this.data = new Opaque(buffer, Optional.empty(), parser);

        } else {
            LOG.debug("Unknown record type: {}:{}", dataFormat.enterpriseNumber, dataFormat.formatNumber);
            this.data = new Opaque(buffer, Optional.empty(), Opaque::parseUnknown);
        }
    }


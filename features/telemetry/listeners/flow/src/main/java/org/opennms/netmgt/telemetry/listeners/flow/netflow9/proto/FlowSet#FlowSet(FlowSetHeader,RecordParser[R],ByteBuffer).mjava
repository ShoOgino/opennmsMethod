    public FlowSet(final FlowSetHeader header,
                   final RecordParser<R> parser,
                   final ByteBuffer buffer) throws InvalidPacketException {
        this.header = Objects.requireNonNull(header);

        final List<R> records = new LinkedList<>();
        while (buffer.remaining() >= parser.getMinimumRecordLength()) {
            records.add(parser.parse(buffer));
        }

        this.records = Collections.unmodifiableList(records);
        if (this.records.size() == 0) {
            throw new InvalidPacketException(buffer, "Empty set");
        }
    }


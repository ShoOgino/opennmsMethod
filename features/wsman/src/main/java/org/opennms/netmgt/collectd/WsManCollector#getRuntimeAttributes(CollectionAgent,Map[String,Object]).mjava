    @Override
    public Map<String, Object> getRuntimeAttributes(CollectionAgent agent, Map<String, Object> parameters) {
        final Map<String, Object> runtimeAttributes = new HashMap<>();

        final String collectionName = ParameterMap.getKeyedString(parameters, "collection", null);
        if (collectionName == null) {
            throw new IllegalArgumentException("Collector configuration does not include the required 'collection' parameter.");
        }

        final Collection collection = m_wsManDataCollectionConfigDao.getCollectionByName(collectionName);
        if (collection == null) {
            throw new IllegalArgumentException("No collection found with name: " + collectionName);
        }

        final OnmsNode node = m_nodeDao.get(agent.getNodeId());
        if (node == null) {
            throw new IllegalArgumentException("Could not find node with id: " + agent.getNodeId());
        }

        final Definition agentConfig = m_wsManConfigDao.getAgentConfig(agent.getAddress());
        final Groups groups = new Groups(m_wsManDataCollectionConfigDao.getGroupsForAgent(collection, agent, agentConfig, node));

        runtimeAttributes.put(WSMAN_AGENT_CONFIG_KEY, agentConfig);
        runtimeAttributes.put(WSMAN_GROUPS_KEY, groups);
        return runtimeAttributes;
    }


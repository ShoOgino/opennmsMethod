    @Override
    public List<Group> getGroupsForAgent(Collection collection, CollectionAgent agent, WsmanAgentConfig agentConfig, OnmsNode node) {
        // Fetch the system definitions for the given collection
        List<SystemDefinition> sysDefs = getSystemDefinitionsForCollection(collection);

        // Map all of the available groups by name for easy lookup
        final Map<String, Group> groupsByName = Maps.uniqueIndex(getConfig().getGroup(), Group::getName);

        // Gather the groups from all of the supported system definitions
        final List<Group> groups = Lists.newArrayList();
        for (SystemDefinition sysDef : sysDefs) {
            if (isAgentSupportedBySystemDefinition(sysDef, agent, agentConfig, node)) {
                for (String groupName : sysDef.getIncludeGroup()) {
                    Group group = groupsByName.get(groupName);
                    if (group == null) {
                        LOG.warn("System definition with name {} includes group with name {}, "
                                + "but no such group was found.", sysDef.getName(), groupName);
                        continue;
                    }
                    groups.add(group);
                }
            }
        }
        return groups;
    }


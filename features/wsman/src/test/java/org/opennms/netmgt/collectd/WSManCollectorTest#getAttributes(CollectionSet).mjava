    private static Map<String, CollectionAttribute> getAttributes(CollectionSet collectionSet) {
        final Map<String, CollectionAttribute> attributesByName = Maps.newHashMap();
        collectionSet.visit(new AbstractCollectionSetVisitor() {
            @Override
            public void visitAttribute(CollectionAttribute attribute) {
                attributesByName.put(attribute.getName(), attribute);
            }
        });
        return attributesByName;
    }


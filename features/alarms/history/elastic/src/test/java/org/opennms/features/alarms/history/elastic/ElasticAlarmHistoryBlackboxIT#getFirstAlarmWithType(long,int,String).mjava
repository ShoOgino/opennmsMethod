    private AlarmState getFirstAlarmWithType(long time, int type, String typeDescr) {
        return alarmHistoryRepo.getActiveAlarmsAt(time).stream()
                .filter(a -> a.getType() == type)
                .findFirst()
                .orElseThrow(() -> new RuntimeException("No " + typeDescr + " alarms at time: " + time));
    }


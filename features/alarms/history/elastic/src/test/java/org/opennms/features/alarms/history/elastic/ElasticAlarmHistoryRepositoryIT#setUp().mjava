    @Before
    public void setUp() throws IOException {
        RestClientFactory restClientFactory = new RestClientFactory("http://localhost:" + HTTP_PORT);
        jestClient = restClientFactory.createClient();
        repo = new ElasticAlarmHistoryRepository(jestClient, IndexStrategy.MONTHLY, new IndexSettings());

        TemplateInitializerForAlarms templateInitializer = new TemplateInitializerForAlarms(jestClient);
        MetricRegistry metrics = new MetricRegistry();
        indexer = new ElasticAlarmIndexer(metrics, jestClient, templateInitializer);
        indexer.setUsePseudoClock(true);
        indexer.setIndexAllUpdates(true);
        indexer.init();

        // Increase the default timeout for these tests
        Awaitility.setDefaultTimeout(1, TimeUnit.MINUTES);
        Awaitility.setDefaultPollInterval(5, TimeUnit.SECONDS);

        PseudoClock.getInstance().reset();

        // Wait until ES is up and running - initially there should be no documents
        await().ignoreExceptions()
                .until(repo::getActiveAlarmsNow, hasSize(equalTo(0)));
    }


    @Test
    public void testDiscover() throws Exception
    {
        for ( RouteDefinition route : new ArrayList<RouteDefinition>( context.getRouteDefinitions() ) )
        {
            route.adviceWith( context, new AdviceWithRouteBuilder() {
                @Override
                public void configure() throws Exception
                {
                    mockEndpoints();
                }
            } );
        }
        context.start();

        // We should get 1 call to the scheduler endpoint
        MockEndpoint endpoint = getMockEndpoint( "mock:bean:eventWriter", false );
        endpoint.setExpectedMessageCount( 1 );

        // Create message
        // DiscoveryJob job = new DiscoveryJob( Lists.newArrayList(), "myForeignSource",
        // "myLocation" );
        DiscoveryConfiguration config = new DiscoveryConfiguration();

        Specific specific = new Specific();
        specific.setContent( "4.2.2.2" );
        specific.setForeignSource( "Bogus FS" );
        specific.setRetries( 2 );
        specific.setTimeout( 3000 );
        config.addSpecific( specific );
        config.setForeignSource( "Bogus FS" );
        config.setTimeout( 3000 );
        config.setRetries( 2 );

        template.requestBody( "direct:createDiscoveryJobs", config );

        assertMockEndpointsSatisfied();
    }


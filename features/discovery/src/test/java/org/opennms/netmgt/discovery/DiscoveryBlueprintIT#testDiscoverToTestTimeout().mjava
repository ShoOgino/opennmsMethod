    @Test(timeout=60000)
    public void testDiscoverToTestTimeout() throws Exception {

        /*
         * Create a Camel listener for the location queue that will respond with
         * {@link DiscoveryResult} objects.
         */
        SimpleRegistry registry = new SimpleRegistry();
        CamelContext mockDiscoverer = new DefaultCamelContext(registry);
        mockDiscoverer.addComponent("queuingservice", ActiveMQComponent.activeMQComponent("vm://localhost?create=false"));

        mockDiscoverer.addRoutes(new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                JmsQueueNameFactory factory = new JmsQueueNameFactory("Discovery", "Discoverer", LOCATION);
                String from = String.format("queuingservice:%s", factory.getName());

                from(from)
                .process(new Processor() {
                    @Override
                    public void process(Exchange exchange) throws Exception {
                        DiscoveryJob job = exchange.getIn().getBody(DiscoveryJob.class);
                        String foreignSource = job.getForeignSource();
                        String location = job.getLocation();

                        // Sleep to trigger a timeout, make this greater than the timeout calculated below
                        Thread.sleep(15000);

                        Message out = exchange.getOut();
                        DiscoveryResults results = new DiscoveryResults(
                            Collections.singletonMap(InetAddressUtils.addr("4.2.2.3"), 1000L),
                            foreignSource,
                            location
                        );
                        out.setBody(results);
                    }
                });
            }
        });

        mockDiscoverer.start();

        final String ipAddress = "4.2.2.3";
        final String foreignSource = "testDiscoverToTestTimeout";
        final String location = LOCATION;

        // Create the config aka job
        Specific specific = new Specific();
        specific.setContent( ipAddress );

        DiscoveryConfiguration config = new DiscoveryConfiguration();
        config.addSpecific( specific );
        config.setForeignSource( foreignSource );
        config.setTimeout( 3000 );
        config.setRetries( 2 );
        config.setLocation( location );

        // Timeout should be 1 * 3000 * (2 + 1) * 1.5 = 13500ms

        // Execute the job
        try {
            template.requestBody( "seda:submitDiscoveryTask", config );
        } catch(CamelExecutionException e) {
            // Expected failure exception
            switch(e.getCause().getClass().getName()) {
                case "org.apache.camel.ExchangeTimedOutException":
                case "org.springframework.jms.UncategorizedJmsException":
                case "org.apache.camel.language.bean.RuntimeBeanExpressionException":
                    LOG.info("An expected exception was thrown", e);
                    return;
                default:
                    LOG.error("The exception cause was not an expected type", e);
                    fail("The exception cause was not an expected type: " + e.getCause());
            }
            fail("A timeout exception should be thrown from the exchange");
        } finally {
            mockDiscoverer.stop();
        }
    }


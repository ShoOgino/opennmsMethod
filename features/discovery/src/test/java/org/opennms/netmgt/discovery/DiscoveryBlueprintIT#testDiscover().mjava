    @Test
    public void testDiscover() throws Exception
    {
        final String ipAddress = "4.2.2.2";
        final String foreignSource = "Bogus FS";
        final String location = "LOC1";

        EventAnticipator anticipator = IPC_MANAGER_INSTANCE.getEventAnticipator();

        EventBuilder eb = new EventBuilder( EventConstants.NEW_SUSPECT_INTERFACE_EVENT_UEI, "OpenNMS.Discovery" );
        eb.setInterface( InetAddress.getByName( ipAddress ) );
        eb.setHost( InetAddressUtils.getLocalHostName() );

        eb.addParam( "RTT", 0 );
        eb.addParam( "foreignSource", foreignSource );

        anticipator.anticipateEvent( eb.getEvent() );

        // Create the config aka job
        Specific specific = new Specific();
        specific.setContent( ipAddress );

        DiscoveryConfiguration config = new DiscoveryConfiguration();
        config.addSpecific( specific );
        config.setForeignSource( foreignSource );
        config.setTimeout( 3000 );
        config.setRetries( 2 );
        config.setLocation( location );

        // Execute the job
        template.requestBody( "direct:submitDiscoveryTask", config );

        Thread.sleep( 1000 );
        anticipator.verifyAnticipated();
    }


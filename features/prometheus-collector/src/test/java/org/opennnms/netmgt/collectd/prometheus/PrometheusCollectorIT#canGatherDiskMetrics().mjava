    @Test
    public void canGatherDiskMetrics() {
        // Define our configuration
        Collection collection = new Collection();
        Group nodeExporterDisks = new Group();
        nodeExporterDisks.setName("node-exporter-disks");
        nodeExporterDisks.setFilterExp("name matches 'node_disk_.*'");
        nodeExporterDisks.setGroupByExp("labels[device]");
        nodeExporterDisks.setResourceType("nodeExporterDisk");

        NumericAttribute attribute = new NumericAttribute();
        attribute.setAliasExp("name.substring('node_disk_'.length())");
        nodeExporterDisks.getNumericAttribute().add(attribute);

        // Define the resource type
        ResourceType resourceType = createStandardResourceType("nodeExporterDisk");
        ResourceTypeMapper.getInstance().setResourceTypeMapper((rt) -> resourceType);
        
        // Collect!
        CollectionSet collectionSet = collect(collection, Lists.newArrayList(nodeExporterDisks));

        // Verify
        List<String> collectionSetKeys = CollectionSetUtils.flatten(collectionSet);
        assertEquals(Arrays.asList("0/nodeExporterDisk/dm-0/node-exporter-disks/bytes_read[null,2539520.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/bytes_written[null,1318912.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/io_now[null,0.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/io_time_ms[null,604.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/io_time_weighted[null,755.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/read_time_ms[null,591.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/reads_completed[null,156.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/reads_merged[null,0.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/sectors_read[null,4960.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/sectors_written[null,2576.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/write_time_ms[null,164.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/writes_completed[null,322.0]",
                "0/nodeExporterDisk/dm-0/node-exporter-disks/writes_merged[null,0.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/bytes_read[null,1.792955392E9]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/bytes_written[null,8.90744832E8]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/io_now[null,2.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/io_time_ms[null,106110.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/io_time_weighted[null,1761109.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/read_time_ms[null,157601.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/reads_completed[null,76622.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/reads_merged[null,0.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/sectors_read[null,3501866.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/sectors_written[null,1739736.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/write_time_ms[null,1602698.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/writes_completed[null,95298.0]",
                "0/nodeExporterDisk/dm-1/node-exporter-disks/writes_merged[null,0.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/bytes_read[null,4.133188608E9]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/bytes_written[null,6.6522103808E10]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/io_now[null,0.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/io_time_ms[null,371775.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/io_time_weighted[null,7.0852048E7]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/read_time_ms[null,117412.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/reads_completed[null,317168.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/reads_merged[null,0.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/sectors_read[null,8072634.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/sectors_written[null,1.29925984E8]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/write_time_ms[null,7.0724706E7]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/writes_completed[null,2246867.0]",
                "0/nodeExporterDisk/dm-2/node-exporter-disks/writes_merged[null,0.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/bytes_read[null,1.809073664E9]",
                "0/nodeExporterDisk/sda/node-exporter-disks/bytes_written[null,8.92125696E8]",
                "0/nodeExporterDisk/sda/node-exporter-disks/io_now[null,0.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/io_time_ms[null,103955.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/io_time_weighted[null,711198.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/read_time_ms[null,109492.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/reads_completed[null,74745.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/reads_merged[null,2634.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/sectors_read[null,3533347.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/sectors_written[null,1742433.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/write_time_ms[null,600041.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/writes_completed[null,68129.0]",
                "0/nodeExporterDisk/sda/node-exporter-disks/writes_merged[null,32275.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/bytes_read[null,4.135788032E9]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/bytes_written[null,6.6522103808E10]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/io_now[null,0.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/io_time_ms[null,351586.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/io_time_weighted[null,1.4474691E7]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/read_time_ms[null,83011.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/reads_completed[null,303217.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/reads_merged[null,13779.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/sectors_read[null,8077711.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/sectors_written[null,1.29925984E8]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/write_time_ms[null,1.4379594E7]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/writes_completed[null,1024681.0]",
                "0/nodeExporterDisk/sdb/node-exporter-disks/writes_merged[null,1234629.0]"), collectionSetKeys);
    }


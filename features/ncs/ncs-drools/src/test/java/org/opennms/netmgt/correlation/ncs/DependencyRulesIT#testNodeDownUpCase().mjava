    @Test
    @DirtiesContext
    public void testNodeDownUpCase() throws Exception {

        // Get engine
        DroolsCorrelationEngine engine = findEngineByName("dependencyRules");


        // Antecipate down event
        getAnticipator().reset();
        
        Set<NCSComponent> impactedByNodeDown = new LinkedHashSet<>();
        
        for(NCSComponent c : findSubcomponentsOnNode(m_svc, "space", "1111-PE1") ) {
            impactedByNodeDown.addAll( findPathToSubcomponent(m_svc, c.getForeignSource(), c.getForeignId()));
        }
        
        impactedByNodeDown = uniq( impactedByNodeDown );
        
        anticipate( transform( impactedByNodeDown, toComponentImpactedEvent(17) ) );

        // Generate down event
        System.err.println("SENDING nodeDown EVENT!!");
        engine.correlate( createNodeDownEvent( 17, m_pe1NodeId ) );

        // Check down event
        getAnticipator().verifyAnticipated();

        // Anticipate up event
        getAnticipator().reset();
        anticipate( transform( impactedByNodeDown, toComponentResolvedEvent(19) ) );
        
        // Generate up event
        System.err.println("SENDING nodeUpEvent EVENT!!");
        engine.correlate( createNodeUpEvent( 19, m_pe1NodeId ) );
        
        // Check up event
        getAnticipator().verifyAnticipated();

        // Memory should be clean!
        assertEquals( "Unexpected objects in memory" + engine.getKieSessionObjects(), 0, engine.getKieSessionObjects().size() );

    }


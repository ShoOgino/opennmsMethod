	@Override
	@Transactional
	public NCSComponent addSubcomponent(final String type, final String foreignSource, final String foreignId, final NCSComponent subComponent) {
		LogUtils.debugf(this, "addSubcomponent: %s/%s/%s - %s", type, foreignSource, foreignId, subComponent);

		final NCSComponent component = getComponent(type, foreignSource, foreignId);
		if (component == null) {
			throw new ObjectRetrievalFailureException(NCSComponent.class, "Unable to locate component with type=" + type + ", foreignSource=" + foreignSource + ", foreignId=" + foreignId);
		}
		LogUtils.debugf(this, "found component: %s", component);

		final NCSComponent updatedComponent = addOrUpdateComponents(subComponent);
		
		LogUtils.debugf(this, "adding subcomponent: %s", updatedComponent);
		component.addSubcomponent(updatedComponent);
		
		LogUtils.debugf(this, "saving");
		m_componentDao.update(component);
		m_componentDao.flush();

		try {
			sendComponentUpdated(component);
		} catch (final EventProxyException e) {
			throw new RecoverableDataAccessException("update completed, but unable to send componentUpdated event", e);
		}

		return getComponent(type, foreignSource, foreignId);
	}


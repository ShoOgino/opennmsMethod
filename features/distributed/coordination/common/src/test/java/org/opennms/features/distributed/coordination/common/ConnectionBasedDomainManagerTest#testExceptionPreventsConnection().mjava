    /**
     * Tests to make sure that an exception encountered while trying to connect prevents the connection from
     * succeeding.
     *
     * @throws Exception
     */
    @Test
    public void testExceptionPreventsConnection() throws Exception {
        ExceptionOnConnectDomainManager manager = new ExceptionOnConnectDomainManager(domain);

        manager.register(id, (role, domain) -> {});
        waitForFuture(connectThreadFuture);
        assertThat(manager.isConnected(), is(equalTo(false)));
    }


    /**
     * Test that once we have deregistered we won't receive anymore notifications to our callbacks.
     */
    @Test
    public void testDeregisterThenDisconnect() {
        TestDomainManager manager = new TestDomainManager(domain);
        AtomicInteger active = new AtomicInteger(0);
        AtomicInteger standby = new AtomicInteger(0);

        manager.register(id, (role, domain) -> {
            if (role == Role.ACTIVE) {
                active.incrementAndGet();
            } else if (role == Role.STANDBY) {
                standby.incrementAndGet();
            }
        });
        await().atMost(10, TimeUnit.SECONDS).until(() -> active.get() > 0);

        manager.deregister(id);
        await().atMost(10, TimeUnit.SECONDS).until(() -> !manager.isConnected());

        manager.register("dummyId", (role, domain) -> {});
        await().atMost(10, TimeUnit.SECONDS).until(manager::isConnected);

        assertEquals(1, active.get());
        assertEquals(0, standby.get());
    }


    /**
     * Executed when becoming ACTIVE for the managed domain. This blocks until all registrants have processed the
     * becomeActive() in their handler.
     */
    protected synchronized final void becomeActive() {
        currentRole = Role.ACTIVE;
        LOG.debug("Notifying all registrants of {} role", currentRole);

        // Handlers must not block so that this happens in a timely manner
        for (Map.Entry<String, RoleChangeHandler> handler : roleChangeHandlers.entrySet()) {
            try {
                handler.getValue().handleRoleChange(Role.ACTIVE, getDomain());
            } catch (Exception e) {
                LOG.warn("Got exception while notifying handler {} of role {}", handler.getKey(), currentRole, e);
            }
        }
    }


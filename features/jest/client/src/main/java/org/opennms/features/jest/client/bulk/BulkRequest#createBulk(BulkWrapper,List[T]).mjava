    // This creates a new (smaller) bulk action if the new document list is smaller than the bulk.actions
    // This can only be the case if less than all documents failed.
    private BulkWrapper createBulk(BulkWrapper bulk, List<T> documents) {
        if (bulk == null || bulk.size() != documents.size()) {
            return transformer.apply(documents);
        }
        return bulk;
    }


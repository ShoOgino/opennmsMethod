    private void doInitialize() throws IOException {
        // Retrieve the server version
        final Version version = getServerVersion();
        // Load the appropriate template
        final String template = templateLoader.load(version, templateLocation);

        // Apply the index prefix to the template name as well so that templates from multiple instances
        // do not overwrite each other
        String effectiveTemplateName = templateName;
        if (indexSettings.getIndexPrefix() != null) {
            effectiveTemplateName = indexSettings.getIndexPrefix() + templateName;
        }

        // Post it to elastic
        final PutTemplate putTemplate = new PutTemplate.Builder(effectiveTemplateName, template).build();
        final JestResult result = client.execute(putTemplate);
        if (!result.isSucceeded()) {
            // In case the template could not be created, we bail
            throw new IllegalStateException("Template '" + templateName + "' could not be persisted. Reason: " + result.getErrorMessage());
        }
    }


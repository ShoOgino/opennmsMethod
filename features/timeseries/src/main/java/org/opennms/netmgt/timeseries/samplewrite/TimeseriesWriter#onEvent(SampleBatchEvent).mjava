    @Override
    public void onEvent(SampleBatchEvent event) throws Exception {
        // We'd expect the logs from this thread to be in collectd.log
        Logging.putPrefix("collectd");

        // Decrement our entry counter
        numEntriesOnRingBuffer.decrementAndGet();

        try {
            if (event.isMetadata()) {
                storeMetadata(event); // Sample represents metadata, no "real" Samples. Metadata is stored in table.
            } else {
                try(Timer.Context context = this.sampleWriteTsTimer.time()) {
                    this.storage.get().store(event.getSamples());
                }
            }
        } catch (Throwable t) {
            RATE_LIMITED_LOGGER.error("An error occurred while inserting samples. Some sample may be lost.", t);
        }
    }


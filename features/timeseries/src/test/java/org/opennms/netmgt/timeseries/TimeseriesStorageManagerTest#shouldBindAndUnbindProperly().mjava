    @Test
    public void shouldBindAndUnbindProperly() {
        ServiceLookup<Class<?>, String> lookup = Mockito.mock(ServiceLookup.class);
        TimeSeriesStorage storage1 = new InMemoryStorage();
        TimeSeriesStorage storage2 = new InMemoryStorage();

        // test for null values
        TimeseriesStorageManager manager = new TimeseriesStorageManager(lookup);
        manager.onUnbind(null, null); // should be ignored
        assertNull(manager.get());
        manager.onUnbind(storage1, null); // should be ignored
        assertNull(manager.get());

        // add multiple storages, the last added should be given back
        manager.onBind(storage1, null);
        assertEquals(storage1, manager.get());
        manager.onBind(storage2, null);
        assertEquals(storage2, manager.get());
        manager.onBind(storage1, null);
        assertEquals(storage2, manager.get()); // we expect storage 2 since the storage1 was added already and is thus ignored
        manager.onUnbind(storage1, null);
        manager.onUnbind(storage1, null); // should be ignored
        assertEquals(storage2, manager.get());
        manager.onBind(storage1, null);
        assertEquals(storage1, manager.get()); // we expect storage 1 since storage1 was newly added

        // remove all storage
        manager.onUnbind(storage1, null);
        manager.onUnbind(storage2, null);
        assertNull(manager.get());
    }


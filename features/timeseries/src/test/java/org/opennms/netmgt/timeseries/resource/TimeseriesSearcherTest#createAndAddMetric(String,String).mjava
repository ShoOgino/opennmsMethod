    private Metric createAndAddMetric(final String path, final String name) throws StorageException {
        ImmutableMetric.MetricBuilder metricBuilder = ImmutableMetric.builder()
                .intrinsicTag(IntrinsicTagNames.resourceId, path)
                .intrinsicTag(IntrinsicTagNames.name, name);

        // add index tags
        Map<String, String> attributes = new HashMap<>();
        TimeseriesUtils.addIndicesToAttributes(ResourcePath.fromString(path), attributes);
        attributes.entrySet().stream()
                .map(e -> new ImmutableTag(e.getKey(), e.getValue()))
                .forEach(metricBuilder::metaTag);
        Metric metric = metricBuilder.build();

        storage.store(Collections.singletonList(ImmutableSample.builder().metric(metric).time(Instant.now()).value(3.0).build()));
        return metric;
    }


    @Test
    public void shouldFindAllMetrics() throws StorageException {
        TimeseriesStorageManager storageManager = Mockito.mock(TimeseriesStorageManager.class);
        TimeSeriesMetaDataDao metaDataDao = Mockito.mock(TimeSeriesMetaDataDao.class);
        when(storageManager.get()).thenReturn(storage);
        CacheConfig cacheConfig = new CacheConfigBuilder().withName(TimeseriesSearcherTest.class.getSimpleName()).build();
        searcher = new TimeseriesSearcher(storageManager, metaDataDao, cacheConfig);

        Metric abc = createAndAddMetric("a/b", "c");
        Metric abcd1 = createAndAddMetric("a/b/c", "d1");
        Metric abcd1e = createAndAddMetric("a/b/c/d1", "e");
        Metric abcd2 = createAndAddMetric("a/b/c", "d2");
        test("a",  abc);
        test("a",  abc); // test cache: we should not have another invocation
        verify(storage, times(1)).getMetrics(any());

        test("a/b", abcd1, abcd2);
        test("a/b/c", abcd1e);
        test("a/b/not-existing");

        // verify wildcard cache: we expect only 1 more getMetrics() invocation for the 3 calls above
        verify(storage, times(2)).getMetrics(any());
    }


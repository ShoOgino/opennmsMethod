    @Override
    public void start(BundleContext context) throws Exception {
        // Determine if any vaadin theme fragments are unresolved
        final Set<Bundle> unresolvedVaadinThemeFragments = getUnresolvedVaadinThemeFragments(context);
        if (!unresolvedVaadinThemeFragments.isEmpty()) {
            // Get vaadin theme host bundle to initialize refresh
            final Bundle vaadinThemeHostBundle = getVaadinThemeHostbundle(context);
            final List<Bundle> bundlesToRefresh = new ArrayList<>();
            bundlesToRefresh.add(vaadinThemeHostBundle);

            // Refresh
            final Bundle systemBundle = context.getBundle(0);
            FrameworkWiring frameworkWiring = systemBundle.adapt(FrameworkWiring.class);
            frameworkWiring.refreshBundles(bundlesToRefresh);
        }

        KarafHealthServiceImpl karafHealthService = new KarafHealthServiceImpl();
        Dictionary<String, Object> props = new Hashtable<>();
        props.put("registration.export", "true");
        karafHealthServiceSvcReg = context.registerService(KarafHealthService.class, karafHealthService, props);
    }


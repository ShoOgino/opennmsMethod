    private void persist(int nodeId, InetAddress iface, CollectionSet collectionSet, RrdRepository repository) {
        final CollectionAgent agent = collectionAgentFactory.createCollectionAgent(Integer.toString(nodeId), iface);
        final CollectionSetBuilder builder = new CollectionSetBuilder(agent);
        final org.opennms.netmgt.collection.api.CollectionSet internalCollectionSet = CollectionSetMapper.buildCollectionSet(builder, collectionSet);

        // Assume we're dealing with node level resources and not response time
        repository.setRrdBaseDir(new File(ResourceTypeUtils.DEFAULT_RRD_ROOT, ResourceTypeUtils.SNMP_DIRECTORY));

        // Create the persister
        final Persister persister = persisterFactory.createPersister(EMPTY_SERVICE_PARAMETERS, repository);

        // Persist
        internalCollectionSet.visit(persister);
    }


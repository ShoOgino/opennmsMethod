    @Override
    public AlarmPersisterExtension map(org.opennms.integration.api.v1.alarms.AlarmPersisterExtension ext) {
        return new AlarmPersisterExtension() {
            @Override
            public void afterAlarmCreated(OnmsAlarm alarm, Event event, OnmsEvent dbEvent) {
                final Alarm mappedAlarm = ModelMappers.toAlarm(alarm);
                final InMemoryEvent inMemoryEvent = ModelMappers.toEvent(event);
                final DatabaseEvent databaseEvent = ModelMappers.toEvent(dbEvent);
                final Alarm updatedAlarm = ext.afterAlarmCreated(mappedAlarm, inMemoryEvent, databaseEvent);

                maybeUpdateAlarm(alarm, updatedAlarm);
            }

            @Override
            public void afterAlarmUpdated(OnmsAlarm alarm, Event event, OnmsEvent dbEvent) {
                final Alarm mappedAlarm = ModelMappers.toAlarm(alarm);
                final InMemoryEvent inMemoryEvent = ModelMappers.toEvent(event);
                final DatabaseEvent databaseEvent = ModelMappers.toEvent(dbEvent);
                final Alarm updatedAlarm = ext.afterAlarmUpdated(mappedAlarm, inMemoryEvent, databaseEvent);
                maybeUpdateAlarm(alarm, updatedAlarm);
            }
        };
    }


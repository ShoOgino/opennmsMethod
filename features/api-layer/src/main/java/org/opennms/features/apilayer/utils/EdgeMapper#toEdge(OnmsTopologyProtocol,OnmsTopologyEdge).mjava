    public TopologyEdge toEdge(OnmsTopologyProtocol protocol, OnmsTopologyEdge edge) {
        ImmutableTopologyEdge.Builder topologyEdge = ImmutableTopologyEdge.newBuilder()
                .setId(edge.getId())
                .setProtocol(ModelMappers.toTopologyProtocol(protocol))
                .setTooltipText(edge.getToolTipText());

        // Set the source
        if (edge.getSource().getVertex().getNodeid() == null) {
            // Source is a segment
            topologyEdge.setSource(getSegment(edge.getSource(), protocol));
        } else if (edge.getSource().getIfindex() != null && edge.getSource().getIfindex() >= 0) {
            // Source is a port
            topologyEdge.setSource(getPort(edge.getSource()));
        } else {
            // Source is a node
            topologyEdge.setSource(getNode(edge.getSource()));
        }

        // Set the target
        if (edge.getTarget().getVertex().getNodeid() == null) {
            // Target is a segment
            topologyEdge.setTarget(getSegment(edge.getTarget(), protocol));
        } else if (edge.getTarget().getIfindex() != null && edge.getTarget().getIfindex() >= 0) {
            // Target is a port
            topologyEdge.setTarget(getPort(edge.getTarget()));
        } else {
            // Target is a node
            topologyEdge.setTarget(getNode(edge.getTarget()));
        }

        return topologyEdge.build();
    }


    @Before
    public void setup() {
        when(mockNodeCriteriaCache.getNodeCriteria(anyLong())).thenReturn(Optional.empty());
        Map<OnmsTopologyProtocol, OnmsTopology> topologyMap = new HashMap<>();

        when(onmsTopologyDao.getSupportedProtocols()).thenReturn(
                new HashSet<>(Arrays.asList(OnmsTopologyProtocol.create("CDP"), OnmsTopologyProtocol.create("ISIS"))));

        // Create two dummy edges to respond with for calls to the DAO
        OnmsTopology mockCDPTopology = mock(OnmsTopology.class);
        Set<OnmsTopologyEdge> cdpEdges = new HashSet<>();
        OnmsTopologyEdge mockCdpEdge = mock(OnmsTopologyEdge.class);
        when(mockCdpEdge.getId()).thenReturn(CDP_EDGE_ID);
        OnmsTopologyPort mockCdpEdgePort = mock(OnmsTopologyPort.class);
        OnmsTopologyVertex mockCdpEdgePortVertex = mock(OnmsTopologyVertex.class);
        when(mockCdpEdgePortVertex.getNodeid()).thenReturn(1);
        when(mockCdpEdgePort.getId()).thenReturn(CDP_EDGE_ID);
        when(mockCdpEdgePort.getVertex()).thenReturn(mockCdpEdgePortVertex);
        when(mockCdpEdge.getSource()).thenReturn(mockCdpEdgePort);
        when(mockCdpEdge.getTarget()).thenReturn(mockCdpEdgePort);
        cdpEdges.add(mockCdpEdge);
        when(mockCDPTopology.getEdges()).thenReturn(cdpEdges);
        topologyMap.put(OnmsTopologyProtocol.create("CDP"), mockCDPTopology);

        OnmsTopology mockIsIsTopology = mock(OnmsTopology.class);
        Set<OnmsTopologyEdge> isisEdges = new HashSet<>();
        OnmsTopologyEdge mockIsIsEdge = mock(OnmsTopologyEdge.class);
        when(mockIsIsEdge.getId()).thenReturn(ISIS_EDGE_ID);
        OnmsTopologyPort mockIsIsEdgePort = mock(OnmsTopologyPort.class);
        OnmsTopologyVertex mockIsIsEdgePortVertex = mock(OnmsTopologyVertex.class);
        when(mockIsIsEdgePortVertex.getNodeid()).thenReturn(2);
        when(mockIsIsEdgePort.getId()).thenReturn(ISIS_EDGE_ID);
        when(mockIsIsEdgePort.getVertex()).thenReturn(mockIsIsEdgePortVertex);
        when(mockIsIsEdge.getSource()).thenReturn(mockIsIsEdgePort);
        when(mockIsIsEdge.getTarget()).thenReturn(mockIsIsEdgePort);
        isisEdges.add(mockIsIsEdge);
        when(mockIsIsTopology.getEdges()).thenReturn(isisEdges);
        topologyMap.put(OnmsTopologyProtocol.create("ISIS"), mockIsIsTopology);

        when(onmsTopologyDao.getTopologies()).thenReturn(topologyMap);
    }


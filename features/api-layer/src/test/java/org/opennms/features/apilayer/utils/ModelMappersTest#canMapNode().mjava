    @Test
    public void canMapNode() throws UnknownHostException {
        OnmsNode onmsNode = new OnmsNode();
        onmsNode.setId(1);
        onmsNode.setForeignSource("test.fs");
        onmsNode.setForeignId("test.fid");
        onmsNode.setLabel("test.label");
        String locationName = "test.location";
        onmsNode.setLocation(new OnmsMonitoringLocation(locationName, null));

        OnmsAssetRecord onmsAssetRecord = new OnmsAssetRecord();
        onmsAssetRecord.setVendor("test.vendor");
        onmsAssetRecord.setModelNumber("test.model");
        onmsAssetRecord.setDescription("test.description");
        onmsAssetRecord.setAssetNumber("test.assetnum");
        onmsAssetRecord.setOperatingSystem("test.os");
        onmsAssetRecord.setRegion("test.region");
        onmsAssetRecord.setDivision("test.division");
        onmsAssetRecord.setDepartment("test.department");
        onmsAssetRecord.setBuilding("test.building");
        onmsAssetRecord.setFloor("test.floor");

        OnmsGeolocation onmsGeolocation = new OnmsGeolocation();
        onmsGeolocation.setAddress1("test.addr1");
        onmsGeolocation.setAddress2("test.addr2");
        onmsGeolocation.setCity("test.city");
        onmsGeolocation.setState("test.state");
        onmsGeolocation.setZip("test.zip");
        onmsGeolocation.setCountry("test.country");
        onmsGeolocation.setLongitude(100.0);
        onmsGeolocation.setLatitude(200.0);
        onmsAssetRecord.setGeolocation(onmsGeolocation);

        onmsNode.setAssetRecord(onmsAssetRecord);

        OnmsMetaData onmsMetaData = new OnmsMetaData();
        onmsMetaData.setContext("test.context");
        onmsMetaData.setKey("test.key");
        onmsMetaData.setValue("test.value");
        List<OnmsMetaData> metaDataList = Collections.singletonList(onmsMetaData);
        onmsNode.setMetaData(metaDataList);

        OnmsSnmpInterface onmsSnmpInterface = new OnmsSnmpInterface();
        onmsSnmpInterface.setIfDescr("test.ifdescr");
        onmsSnmpInterface.setIfName("test.ifname");
        onmsSnmpInterface.setIfIndex(1);
        onmsNode.setSnmpInterfaces(Collections.singleton(onmsSnmpInterface));

        OnmsIpInterface onmsIpInterface = new OnmsIpInterface();
        onmsIpInterface.setIpAddress(InetAddress.getLocalHost());
        onmsIpInterface.setSnmpInterface(onmsSnmpInterface);
        onmsIpInterface.setMetaData(metaDataList);
        onmsNode.setIpInterfaces(Collections.singleton(onmsIpInterface));

        Node node = ModelMappers.toNode(onmsNode);
        assertThat(node.getId(), equalTo(onmsNode.getId()));
        assertThat(node.getForeignSource(), equalTo(onmsNode.getForeignSource()));
        assertThat(node.getForeignId(), equalTo(onmsNode.getForeignId()));
        assertThat(node.getLabel(), equalTo(onmsNode.getLabel()));
        assertThat(node.getLocation(), equalTo(onmsNode.getLocation().getLocationName()));

        NodeAssetRecord nodeAssetRecord = node.getAssetRecord();
        assertThat(nodeAssetRecord.getVendor(), equalTo(onmsAssetRecord.getVendor()));
        assertThat(nodeAssetRecord.getModelNumber(), equalTo(onmsAssetRecord.getModelNumber()));
        assertThat(nodeAssetRecord.getDescription(), equalTo(onmsAssetRecord.getDescription()));
        assertThat(nodeAssetRecord.getAssetNumber(), equalTo(onmsAssetRecord.getAssetNumber()));
        assertThat(nodeAssetRecord.getOperatingSystem(), equalTo(onmsAssetRecord.getOperatingSystem()));
        assertThat(nodeAssetRecord.getRegion(), equalTo(onmsAssetRecord.getRegion()));
        assertThat(nodeAssetRecord.getDivision(), equalTo(onmsAssetRecord.getDivision()));
        assertThat(nodeAssetRecord.getDepartment(), equalTo(onmsAssetRecord.getDepartment()));
        assertThat(nodeAssetRecord.getBuilding(), equalTo(onmsAssetRecord.getBuilding()));
        assertThat(nodeAssetRecord.getFloor(), equalTo(onmsAssetRecord.getFloor()));

        Geolocation geolocation = nodeAssetRecord.getGeolocation();
        assertThat(geolocation.getAddress1(), equalTo(onmsGeolocation.getAddress1()));
        assertThat(geolocation.getAddress2(), equalTo(onmsGeolocation.getAddress2()));
        assertThat(geolocation.getCity(), equalTo(onmsGeolocation.getCity()));
        assertThat(geolocation.getState(), equalTo(onmsGeolocation.getState()));
        assertThat(geolocation.getZip(), equalTo(onmsGeolocation.getZip()));
        assertThat(geolocation.getCountry(), equalTo(onmsGeolocation.getCountry()));
        assertThat(geolocation.getLongitude(), equalTo(onmsGeolocation.getLongitude()));
        assertThat(geolocation.getLatitude(), equalTo(onmsGeolocation.getLatitude()));

        MetaData metaData = node.getMetaData().get(0);
        assertThat(node.getMetaData().size(), equalTo(onmsNode.getMetaData().size()));
        assertThat(metaData.getContext(), equalTo(onmsNode.getMetaData().get(0).getContext()));
        assertThat(metaData.getKey(), equalTo(onmsNode.getMetaData().get(0).getKey()));
        assertThat(metaData.getValue(), equalTo(onmsNode.getMetaData().get(0).getValue()));

        IpInterface ipInterface = node.getIpInterfaces().get(0);
        assertThat(ipInterface.getIpAddress(), equalTo(onmsNode.getIpInterfaces().iterator().next().getIpAddress()));
        assertThat(ipInterface.getSnmpInterface().get().getIfIndex(), equalTo(onmsNode.getSnmpInterfaces().iterator().next().getIfIndex()));

        assertThat(ipInterface.getMetaData().get(0).getKey(),
                equalTo(onmsNode.getIpInterfaces().iterator().next().getMetaData().get(0).getKey()));

        SnmpInterface snmpInterface = node.getSnmpInterfaces().get(0);
        assertThat(snmpInterface.getIfDescr(), equalTo(onmsNode.getSnmpInterfaces().iterator().next().getIfDescr()));
        assertThat(snmpInterface.getIfName(), equalTo(onmsNode.getSnmpInterfaces().iterator().next().getIfName()));
        assertThat(snmpInterface.getIfIndex(), equalTo(onmsNode.getSnmpInterfaces().iterator().next().getIfIndex()));

        assertThat(node.getMetaData().size(), equalTo(onmsNode.getMetaData().size()));
    }


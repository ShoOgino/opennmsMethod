    @Test
    public void closedIsNotSkippedWhenAlarmIsNotCleared() throws PluginException {
        // This should only happen when skipCreateWhenCleared=false
        System.setProperty(DefaultTicketerServiceLayer.SKIP_CLOSE_WHEN_NOT_CLEARED_SYS_PROP, Boolean.FALSE.toString());

        m_defaultTicketerServiceLayer = new DefaultTicketerServiceLayer();
        m_defaultTicketerServiceLayer.setAlarmDao(m_alarmDao);
        m_defaultTicketerServiceLayer.setTicketerPlugin(m_ticketerPlugin);
        m_defaultTicketerServiceLayer.setAlarmEntityNotifier(m_alarmEntityNotifier);

        m_alarm.setSeverity(OnmsSeverity.CRITICAL);
        EasyMock.expect(m_alarmDao.get(m_alarm.getId())).andReturn(m_alarm);

        EasyMock.expect(m_ticketerPlugin.get(m_ticket.getId())).andReturn(m_ticket);
        EasyMock.expectLastCall();

        m_ticketerPlugin.saveOrUpdate(EasyMock.isA(Ticket.class));
        EasyMock.expectLastCall();

        m_alarmDao.saveOrUpdate(m_alarm);
        EasyMock.expectLastCall();

        expectAnUpdateToAlarmNotifier(null, TroubleTicketState.CLOSED);
        m_easyMockUtils.replayAll();

        m_defaultTicketerServiceLayer.closeTicketForAlarm(m_alarm.getId(), m_ticket.getId());

        // Verify that no additional calls where made (such as trying to close the ticket)
        m_easyMockUtils.verifyAll();
    }


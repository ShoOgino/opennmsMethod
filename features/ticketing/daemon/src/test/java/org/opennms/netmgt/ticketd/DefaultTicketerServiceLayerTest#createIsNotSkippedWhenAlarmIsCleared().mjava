    @Test
    public void createIsNotSkippedWhenAlarmIsCleared() throws PluginException {
        // This should only happen when skipCreateWhenCleared=false
        System.setProperty(DefaultTicketerServiceLayer.SKIP_CREATE_WHEN_CLEARED_SYS_PROP, Boolean.FALSE.toString());

        m_defaultTicketerServiceLayer = new DefaultTicketerServiceLayer();
        m_defaultTicketerServiceLayer.setAlarmDao(m_alarmDao);
        m_defaultTicketerServiceLayer.setTicketerPlugin(m_ticketerPlugin);
        m_defaultTicketerServiceLayer.setAlarmEntityNotifier(m_alarmEntityNotifier);

        m_alarm.setSeverity(OnmsSeverity.CLEARED);
        EasyMock.expect(m_alarmDao.get(m_alarm.getId())).andReturn(m_alarm);

        m_ticketerPlugin.saveOrUpdate(EasyMock.isA(Ticket.class));
        EasyMock.expectLastCall();

        m_alarmDao.saveOrUpdate(m_alarm);
        EasyMock.expectLastCall();

        expectAnUpdateToAlarmNotifier(null, TroubleTicketState.OPEN);

        m_easyMockUtils.replayAll();

        m_defaultTicketerServiceLayer.createTicketForAlarm(m_alarm.getId(), Collections.emptyMap());

        m_easyMockUtils.verifyAll();
    }


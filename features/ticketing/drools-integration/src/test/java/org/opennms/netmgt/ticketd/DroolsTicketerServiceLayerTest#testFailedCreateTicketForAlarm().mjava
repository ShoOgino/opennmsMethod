    /**
     * Test method for {@link org.opennms.netmgt.ticketd.DefaultTicketerServiceLayer#createTicketForAlarm(int)}.
     * Tests for correct alarm TroubleTicketState set as CREATE_FAILED when ticketer plugin fails
     */
    public void testFailedCreateTicketForAlarm() {
    	
        EasyMock.expect(m_alarmDao.get(m_alarm.getId())).andReturn(m_alarm);
        
        try {
            m_ticketerPlugin.saveOrUpdate(EasyMock.isA(Ticket.class));
        } catch (PluginException e) {
            e.printStackTrace();
        }
        
        EasyMock.expectLastCall().andThrow(new PluginException("Failed Create"));

        expectNewAlarmState(TroubleTicketState.CREATE_FAILED);
        
        m_easyMockUtils.replayAll();
        
        m_droolsTicketerServiceLayer.createTicketForAlarm(m_alarm.getId());
        
        m_easyMockUtils.verifyAll();
    }


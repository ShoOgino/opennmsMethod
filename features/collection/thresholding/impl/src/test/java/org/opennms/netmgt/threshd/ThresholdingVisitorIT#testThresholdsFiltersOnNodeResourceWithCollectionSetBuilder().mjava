    /**
     * Similar to {@link #testThresholdsFiltersOnNodeResource()}, but we generate the collection set using the CollectionSetBuilder instead of using SnmpCollector specific types.
     */
    @Test
    public void testThresholdsFiltersOnNodeResourceWithCollectionSetBuilder() throws Exception {
        initFactories("/threshd-configuration.xml", "/test-thresholds-5.xml");
        ThresholdingVisitor visitor = createVisitor();

        // Adding Expected Thresholds
        addHighThresholdEvent(1, 30, 25, 50, "/home", "node", "(hda1_hrStorageUsed/hda1_hrStorageSize)*100", null, null);
        addHighThresholdEvent(1, 50, 45, 60, "/opt", "node", "(hda2_hrStorageUsed/hda2_hrStorageSize)*100", null, null);

        // Creating Node ResourceType
        SnmpCollectionAgent agent = createCollectionAgent();
        NodeLevelResource nodeResource = new NodeLevelResource(agent.getNodeId());
        CollectionSet collectionSet = new CollectionSetBuilder(agent).withNumericAttribute(nodeResource, "hd-usage", "hda1_hrStorageUsed", 50,
                                                                                           AttributeType.GAUGE).withNumericAttribute(nodeResource, "hd-usage", "hda1_hrStorageSize",
                                                                                                                                     100, AttributeType.GAUGE).withNumericAttribute(
                                                                                                                                                                                    nodeResource,
                                                                                                                                                                                    "hd-usage",
                                                                                                                                                                                    "hda2_hrStorageUsed",
                                                                                                                                                                                    60,
                                                                                                                                                                                    AttributeType.GAUGE).withNumericAttribute(nodeResource,
                                                                                                                                                                                                                              "hd-usage",
                                                                                                                                                                                                                              "hda2_hrStorageSize",
                                                                                                                                                                                                                              100,
                                                                                                                                                                                                                              AttributeType.GAUGE).withNumericAttribute(nodeResource,
                                                                                                                                                                                                                                                                        "hd-usage",
                                                                                                                                                                                                                                                                        "hda3_hrStorageUsed",
                                                                                                                                                                                                                                                                        70,
                                                                                                                                                                                                                                                                        AttributeType.GAUGE).withNumericAttribute(nodeResource,
                                                                                                                                                                                                                                                                                                                  "hd-usage",
                                                                                                                                                                                                                                                                                                                  "hda3_hrStorageSize",
                                                                                                                                                                                                                                                                                                                  100,
                                                                                                                                                                                                                                                                                                                  AttributeType.GAUGE).build();

        // Creating strings.properties file
        ResourcePath path = ResourcePath.get("snmp", "1");
        m_resourceStorageDao.setStringAttribute(path, "hda1_hrStorageDescr", "/home");
        m_resourceStorageDao.setStringAttribute(path, "hda2_hrStorageDescr", "/opt");
        m_resourceStorageDao.setStringAttribute(path, "hda3_hrStorageDescr", "/usr");

        // Run Visitor and Verify Events
        collectionSet.visit(visitor);
        EasyMock.verify(agent);
        verifyEvents(0);
    }


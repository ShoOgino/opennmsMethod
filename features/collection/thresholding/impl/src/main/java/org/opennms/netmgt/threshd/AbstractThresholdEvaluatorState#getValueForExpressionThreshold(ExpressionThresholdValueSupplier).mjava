    private ExpressionConfigWrapper.ExpressionThresholdValues getValueForExpressionThreshold(ExpressionThresholdValueSupplier valueSupplier)
            throws ThresholdExpressionException {
        if (!state.isCached()) {
            LOG.debug("Interpolating the expression for state {} for the first time", state);
            ExpressionConfigWrapper.ExpressionThresholdValues expressionThresholdValues = valueSupplier.get();
            state.setInterpolatedExpression(expressionThresholdValues.expression);
            state.setThresholdValues(expressionThresholdValues.getThresholdValues());
            state.setCached(true);
            return expressionThresholdValues;
        } else {
            String interpolatedExpression = state.getInterpolatedExpression().get();
            LOG.debug("Using already cached expression {}", interpolatedExpression);
            ExpressionConfigWrapper.ExpressionThresholdValues expressionThresholdValues =
                    new ExpressionConfigWrapper.ExpressionThresholdValues(interpolatedExpression, valueSupplier.get(interpolatedExpression));
            expressionThresholdValues.setThresholdValues(state.getThresholdValues());
            return expressionThresholdValues;
        }
    }


    private void runFileSystemDataTestWithCollectionSetBuilder(ThresholdingVisitor visitor, int resourceId, String fs, long value, long max) throws Exception {
        SnmpCollectionAgent agent = createCollectionAgent();
        NodeLevelResource nodeResource = new NodeLevelResource(agent.getNodeId());
        // Creating Generic ResourceType
        org.opennms.netmgt.config.datacollection.ResourceType indexResourceType = createIndexResourceType(agent, "hrStorageIndex");
        GenericTypeResource genericResource = new GenericTypeResource(nodeResource, indexResourceType, Integer.toString(resourceId));
        // Creating strings.properties file
        ResourcePath path = ResourcePath.get("snmp", "1", "hrStorageIndex", Integer.toString(resourceId));
        m_resourceStorageDao.setStringAttribute(path, "hrStorageType", ".1.3.6.1.2.1.25.2.1.4");
        m_resourceStorageDao.setStringAttribute(path, "hrStorageDescr", fs);
        // Build the collection set
        CollectionSet collectionSet = new CollectionSetBuilder(agent).withNumericAttribute(genericResource, "hd-usage", "hrStorageUsed", value,
                                                                                           AttributeType.GAUGE).withNumericAttribute(genericResource, "hd-usage", "hrStorageSize",
                                                                                                                                     max, AttributeType.GAUGE).withNumericAttribute(
                                                                                                                                                                                    genericResource,
                                                                                                                                                                                    "hd-usage",
                                                                                                                                                                                    "hrStorageAllocUnits",
                                                                                                                                                                                    1,
                                                                                                                                                                                    AttributeType.GAUGE).build();
        // Run Visitor
        collectionSet.visit(visitor);
        EasyMock.verify(agent);
    }


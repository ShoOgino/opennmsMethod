    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws ServletException, IOException {
        final Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        if (authentication != null) {
            final Request jettyReq = Request.getBaseRequest(req);
            if (jettyReq == null) {
                LOG.warn("Failed to find org.eclipse.jetty.server.Request from javax.servlet.ServletRequest. No identity will be set.");
            } else {
                jettyReq.setAuthentication(new AuthenticationUserStub(authentication));
            }
        }
        chain.doFilter(req, res);
    }


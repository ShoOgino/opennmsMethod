    @Test
    public void testTwoSwitchWithOnlyOnePortCondition1() throws Exception {
        Integer portAB = 16;
        Integer portBA = 24;

        String mac1 = "000daaaa0001"; // port AB ---port BA
        String mac2 = "000daaaa0002"; // port AB ---port BA
        String maca = "000daaaa000a"; // port AB ---port BA
        String macb = "000daaaa000b"; // port AB ---port BA
        Integer nodeAId  = 1100011;
        Integer nodeBId  = 2200022;
        OnmsNode nodeA= new OnmsNode();
        OnmsNode nodeB= new OnmsNode();
        BridgeElement elementA = new BridgeElement();
        BridgeElement elementB = new BridgeElement();
        Set<BridgeForwardingTableEntry> bftA = new HashSet<BridgeForwardingTableEntry>();
        Set<BridgeForwardingTableEntry> bftB = new HashSet<BridgeForwardingTableEntry>();
        List<BridgeElement> elemlist = new ArrayList<BridgeElement>();

        nodeA.setId(nodeAId);
        elementA.setNode(nodeA);
        elementA.setBaseBridgeAddress(maca);
        elemlist.add(elementA);

        nodeB.setId(nodeBId);
        elementB.setNode(nodeB);
        elementB.setBaseBridgeAddress(macb);
        elemlist.add(elementB);

        bftA.add(addBridgeForwardingTableEntry(nodeA,portAB, mac1));
        bftA.add(addBridgeForwardingTableEntry(nodeA,portAB, mac2));
        bftA.add(addBridgeForwardingTableEntry(nodeA,portAB, maca));
        bftA.add(addBridgeForwardingTableEntry(nodeA,portAB, macb));

        bftB.add(addBridgeForwardingTableEntry(nodeB,portBA, mac1));
        bftB.add(addBridgeForwardingTableEntry(nodeB,portBA, mac2));
        bftB.add(addBridgeForwardingTableEntry(nodeB,portBA, macb));
        bftB.add(addBridgeForwardingTableEntry(nodeB,portBA, maca));


        BroadcastDomain domain = new BroadcastDomain();
        Bridge.create(domain,nodeAId);
        Bridge.create(domain,nodeBId);
        setBridgeElements(domain,elemlist);
        
        DiscoveryBridgeTopology ndbt= new DiscoveryBridgeTopology(linkd,domain);
        
        ndbt.addUpdatedBFT((nodeAId),bftA);
        ndbt.addUpdatedBFT((nodeBId),bftB);
        ndbt.calculate();
        
        assertEquals(1,domain.getSharedSegments().size());
        SharedSegment shared = domain.getSharedSegments().iterator().next();
        assertEquals(2,shared.getBridgePortsOnSegment().size());
        assertEquals(2,shared.getMacsOnSegment().size());
        assertTrue(shared.containsMac(mac1));
        assertTrue(shared.containsMac(mac2));
        
        assertEquals(2, domain.getForwarding().size());
        assertEquals(1, domain.getForwarders(nodeAId).size());
        assertEquals(1, domain.getForwarders(nodeBId).size());
        BridgePortWithMacs forwarderA = domain.getForwarders(nodeAId).iterator().next();
        BridgePortWithMacs forwarderB = domain.getForwarders(nodeBId).iterator().next();
        assertEquals(1, forwarderA.getMacs().size());
        assertEquals(macb, forwarderA.getMacs().iterator().next());
        assertEquals(portAB, forwarderA.getPort().getBridgePort());
        assertEquals(nodeAId, forwarderA.getPort().getNodeId());
        assertEquals(1, forwarderB.getMacs().size());
        assertEquals(maca, forwarderB.getMacs().iterator().next());
        assertEquals(portBA, forwarderB.getPort().getBridgePort());
        assertEquals(nodeBId, forwarderB.getPort().getNodeId());
        

    }


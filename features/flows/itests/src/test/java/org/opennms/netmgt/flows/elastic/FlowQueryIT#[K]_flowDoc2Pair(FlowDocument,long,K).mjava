    private static <K> Pair<Directional<K>, Map<Long, Double>> flowDoc2Pair(FlowDocument fd, long step, K key) {
        long firstSwitched = fd.getFirstSwitched();
        long lastSwitched = fd.getLastSwitched();
        long duration = lastSwitched - firstSwitched;
        double bytes = fd.getBytes();
        long firstIndex = firstSwitched / step;
        long lastIndex = (lastSwitched - 1) / step;
        HashMap<Long, Double> res = new HashMap<>();
        for (long idx = firstIndex; idx <= lastIndex; idx++) {
            long from = Math.max(idx * step, firstSwitched);
            long to = Math.min((idx + 1) * step, lastSwitched);
            double value = bytes * (to - from) / duration;
            res.put(idx * step, value);
        }
        return Pair.of(new Directional(key, fd.getDirection() == Direction.INGRESS), res);
    }


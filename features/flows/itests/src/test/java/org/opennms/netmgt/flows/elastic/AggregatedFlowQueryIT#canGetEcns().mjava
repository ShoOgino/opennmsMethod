    @Test
    public void canGetEcns() throws Exception {

        final List<FlowDocument> flows = new FlowBuilder()
                .withExporter("SomeFs", "SomeFid", 99)
                .withSnmpInterfaceId(98)
                // 192.168.1.100:43444 <-> 10.1.1.11:80 (110 bytes in [3,15])
                .withDirection(Direction.INGRESS)
                .withTos(0)
                .withFlow(new Date(3), new Date(15), "192.168.1.100", 43444, "10.1.1.11", 80, 10)
                .withDirection(Direction.EGRESS)
                .withTos(1)
                .withFlow(new Date(3), new Date(15), "10.1.1.11", 80, "192.168.1.100", 43444, 100)
                .withDirection(Direction.INGRESS)
                .withTos(2)
                .withFlow(new Date(20), new Date(45), "192.168.1.100", 43444, "10.1.1.11", 80, 10)
                .withDirection(Direction.EGRESS)
                .withTos(3)
                .withFlow(new Date(20), new Date(45), "10.1.1.11", 80, "192.168.1.100", 43444, 100)
                .build();

        // expect 15 flow summary documents
        // - 1 for exporter/interface (98/0)
        // - 3 for exporter/interface/tos (0, 1, 3); code 2 is treated as code 1
        // - 3 * 1 for exporter/interface/tos/application (http)
        // - 3 * 1 for exporter/interface/tos/conversation (10.1.1.11 <-> 192.168.1.100)
        // - 3 * 2 for exporter/interface/tos/host (10.1.1.11, 192.168.1.100)
        loadFlows(flows, 16);

        List<String> hosts = smartQueryService.getFieldValues(LimitedCardinalityField.ECN, getFilters()).get();
        assertThat(hosts, equalTo(Arrays.asList("0", "1", "3")));

    }


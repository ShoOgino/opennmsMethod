    @Override
    public void importRules(InputStream inputStream, boolean hasHeader, boolean deleteExistingRules) throws CSVImportException {
        runInTransaction(status -> {
            // Parse and validate the rules
            final CsvImportResult result = csvService.parseCSV(inputStream, hasHeader);
            if (!result.isSuccess()) {
                throw new CSVImportException(result);
            }


            final Group group = classificationGroupDao.findByName(Groups.USER_DEFINED); // Automatically add all rules to the USER_DEFINED space

            // Remove existing rules and afterwards add new rules
            if (deleteExistingRules) {
                for (Rule eachRule : group.getRules()) {
                    eachRule.setGroup(null);
                }
                group.getRules().clear();
            }
            final List<Rule> rules = result.getRules();
            for (int i=0; i<rules.size(); i++) {
                final Rule rule = rules.get(i);
                try {
                    groupValidator.validate(group, rule);
                    group.addRule(rule);
                } catch (ClassificationException ex) {
                    result.markError(i, ex.getError());
                }
            }

            // before continuing, verify everything is okay, otherwise bail
            if (!result.isSuccess()) {
                throw new CSVImportException(result);
            }

            // Reload engine
            updateRulePositionsAndReloadEngine(group);
            classificationGroupDao.saveOrUpdate(group);
            return null;
        });
    }


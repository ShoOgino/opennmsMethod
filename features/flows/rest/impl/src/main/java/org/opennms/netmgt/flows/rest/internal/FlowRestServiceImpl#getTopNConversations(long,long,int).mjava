    @Override
    public FlowSummaryResponse getTopNConversations(long start, long end, int N) {
        final long effectiveEnd = getEffectiveEnd(end);
        final long effectiveStart = getEffectiveStart(start, effectiveEnd);

        final CompletableFuture<FlowSummaryResponse> future = flowRepository.getTopNConversations(N, effectiveStart, effectiveEnd).thenApply(res -> {
            final FlowSummaryResponse response = new FlowSummaryResponse();
            response.setStart(effectiveStart);
            response.setEnd(effectiveEnd);
            response.setHeaders(Lists.newArrayList("Location", "Protocol", "Source IP", "Source Port", "Dest. IP", "Dest. Port", "Bytes In", "Bytes Out"));
            response.setRows(res.stream()
                    .map(sum -> {
                        final ConversationKey key = sum.getEntity();
                        return Lists.newArrayList((Object)key.getLocation(), key.getProtocol(),
                                key.getSrcIp(), key.getSrcPort(), key.getDstIp(), key.getDstPort(),
                                sum.getBytesIn(), sum.getBytesOut());
                    })
                    .collect(Collectors.toList()));
            return response;
        });
        return waitForFuture(future);
    }


    @Override
    public String getDeepDiveToolUrl(UriInfo uriInfo) {

        long count = waitForFuture(
                flowRepository.getFlowCount(getFiltersFromQueryString(uriInfo.getQueryParameters())));

        if (count > 0) {
            // If there are valid flows then generate URL from template.
            String deepDiveToolUrl = System.getProperty("org.opennms.netmgt.flows.deepDiveUrl");
            if (StringUtils.isBlank(deepDiveToolUrl)) {
                throw new BadRequestException("deepDiveUrl not configured in opennms.properties");
            }
            MultivaluedMap<String, String> queryParams = uriInfo.getQueryParameters();
            deepDiveToolUrl = deepDiveToolUrl.replaceAll("\\$nodeId", queryParams.getFirst("exporterNode"))
                                             .replaceAll("\\$ifIndex", queryParams.getFirst("ifIndex"))
                                             .replaceAll("\\$start", queryParams.getFirst("start"))
                                             .replaceAll("\\$end", queryParams.getFirst("end"));
            return deepDiveToolUrl;
        }
        return null;
    }


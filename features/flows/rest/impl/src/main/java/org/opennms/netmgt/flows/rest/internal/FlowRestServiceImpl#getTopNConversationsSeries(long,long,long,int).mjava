    @Override
    public FlowSeriesResponse getTopNConversationsSeries(long start, long end, long step, int N) {
        final long effectiveEnd = getEffectiveEnd(end);
        final long effectiveStart = getEffectiveStart(start, effectiveEnd);

        final CompletableFuture<FlowSeriesResponse> future = flowRepository.getTopNConversationsSeries(N, effectiveStart, effectiveEnd, step).thenApply(res -> {
            final FlowSeriesResponse response = new FlowSeriesResponse();
            response.setStart(effectiveEnd);
            response.setEnd(effectiveEnd);
            response.setLabels(res.rowKeySet().stream()
                    .map((d) -> {
                        final ConversationKey key = d.getValue();
                        return String.format("%s:%d <-> %s:%d (%s)", key.getSrcIp(), key.getSrcPort(),
                                key.getDstIp(), key.getDstPort(), d.isSource() ? "In" : "Out");
                    })
                    .collect(Collectors.toList()));
            populateResponseFromTable(res, response);
            return response;
        });
        return waitForFuture(future);
    }


    @Test
    public void canCreateAndParseConversationKey() {
        FlowDocument flowIn = new FlowDocument();
        flowIn.setDirection(Direction.INGRESS);
        flowIn.setLocation("SomeLoc");
        flowIn.setProtocol(1);
        flowIn.setSrcAddr("1.1.1.1");
        flowIn.setSrcPort(9999);
        flowIn.setDstAddr("2.2.2.2");
        flowIn.setDstPort(10000);

        FlowDocument flowOut = new FlowDocument();
        flowOut.setDirection(Direction.EGRESS);
        flowOut.setLocation(flowIn.getLocation());
        flowOut.setProtocol(flowIn.getProtocol());
        flowOut.setSrcAddr(flowIn.getDstAddr());
        flowOut.setSrcPort(flowIn.getDstPort());
        flowOut.setDstAddr(flowIn.getSrcAddr());
        flowOut.setDstPort(flowIn.getSrcPort());

        String inKey = ConversationKeyUtils.getConvoKeyAsJsonString(flowIn);
        String outKey = ConversationKeyUtils.getConvoKeyAsJsonString(flowOut);

        // We should have generated some key, and both should match
        assertThat(inKey, notNullValue());
        assertThat(inKey, equalTo(outKey));

        ConversationKey expectedKey = new ConversationKey(
                flowIn.getLocation(),
                flowIn.getProtocol(),
                flowIn.getSrcAddr(),
                flowIn.getSrcPort(),
                flowIn.getDstAddr(),
                flowIn.getDstPort());
        ConversationKey actualKey = ConversationKeyUtils.fromJsonString(inKey);
        assertThat(actualKey, equalTo(expectedKey));
    }


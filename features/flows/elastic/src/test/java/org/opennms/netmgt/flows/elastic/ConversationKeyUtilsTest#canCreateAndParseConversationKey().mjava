    @Test
    public void canCreateAndParseConversationKey() {
        FlowDocument flowIn = new FlowDocument();
        flowIn.setDirection(Direction.INGRESS);
        flowIn.setLocation("SomeLoc");
        flowIn.setProtocol(1);
        flowIn.setSrcAddr("1.1.1.1");
        flowIn.setDstAddr("2.2.2.2");
        flowIn.setApplication("ulf");

        FlowDocument flowOut = new FlowDocument();
        flowOut.setDirection(Direction.EGRESS);
        flowOut.setLocation(flowIn.getLocation());
        flowOut.setProtocol(flowIn.getProtocol());
        flowOut.setSrcAddr(flowIn.getDstAddr());
        flowOut.setDstAddr(flowIn.getSrcAddr());
        flowOut.setApplication(flowIn.getApplication());

        String inKey = ConversationKeyUtils.getConvoKeyAsJsonString(flowIn);
        String outKey = ConversationKeyUtils.getConvoKeyAsJsonString(flowOut);

        // We should have generated some key, and both should match
        assertThat(inKey, notNullValue());
        assertThat(inKey, equalTo(outKey));

        ConversationKey expectedKey = new ConversationKey(
                flowIn.getLocation(),
                flowIn.getProtocol(),
                flowIn.getSrcAddr(),
                flowIn.getDstAddr(),
                flowIn.getApplication());
        ConversationKey actualKey = ConversationKeyUtils.fromJsonString(inKey);
        assertThat(actualKey, equalTo(expectedKey));
    }


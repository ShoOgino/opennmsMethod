    @Test
    public void canGetTopNConversations() throws ExecutionException, InterruptedException {
        // Retrieve the Top N conversation over the entire time range
        final List<TrafficSummary<Conversation>> convoTrafficSummary = flowRepository.getTopNConversations(2, getFilters()).get();
        assertThat(convoTrafficSummary, hasSize(2));

        // Expect the conversations, with the sum of all the bytes from all the flows
        TrafficSummary<Conversation> convo = convoTrafficSummary.get(0);
        assertThat(convo.getEntity().getKey().getSrcIp(), equalTo("192.168.1.101"));
        assertThat(convo.getEntity().getKey().getDstIp(), equalTo("10.1.1.12"));
        assertThat(convo.getEntity().getApplication(), equalTo("https"));
        assertThat(convo.getBytesIn(), equalTo(110L));
        assertThat(convo.getBytesOut(), equalTo(1100L));

        convo = convoTrafficSummary.get(1);
        assertThat(convo.getEntity().getKey().getSrcIp(), equalTo("192.168.1.100"));
        assertThat(convo.getEntity().getKey().getDstIp(), equalTo("10.1.1.12"));
        assertThat(convo.getEntity().getApplication(), equalTo("https"));
        assertThat(convo.getBytesIn(), equalTo(100L));
        assertThat(convo.getBytesOut(), equalTo(1000L));
    }


    public static String getConvoKeyAsJsonString(FlowDocument document) {
        // Only generate the key if all of the required fields are set
        if (document.getLocation() != null
                && document.getProtocol() != null
                && document.getSrcAddr() != null
                && document.getSrcPort() != null
                && document.getDstAddr() != null
                && document.getDstPort() != null) {
            // Build the JSON string manually
            // This is faster than creating some new object on which we can use gson.toJson or similar
            final StringWriter writer = new StringWriter();
            writer.write("[");
            // Use GSON to encode the location, since this may contain characters that need to be escape
            writer.write(gson.toJson(document.getLocation()));
            writer.write(",");
            writer.write(Integer.toString(document.getProtocol()));
            writer.write(",\"");
            if (Direction.INGRESS.equals(document.getDirection())) {
                writer.write(document.getSrcAddr());
                writer.write("\",");
                writer.write(Integer.toString(document.getSrcPort()));
                writer.write(",\"");
                writer.write(document.getDstAddr());
                writer.write("\",");
                writer.write(Integer.toString(document.getDstPort()));
            } else {
                writer.write(document.getDstAddr());
                writer.write("\",");
                writer.write(Integer.toString(document.getDstPort()));
                writer.write(",\"");
                writer.write(document.getSrcAddr());
                writer.write("\",");
                writer.write(Integer.toString(document.getSrcPort()));
            }
            writer.write("]");
            return writer.toString();
        }
        return null;
    }


    @Override
    public <P> void persist(final Collection<? extends P> packets, final FlowSource source, final Converter<P> converter) throws FlowException {
        LOG.debug("Converting {} flow packets from {} to flow documents.", packets.size(), source);
        final Stream<FlowDocument> documents = packets.stream()
                .map(converter::convert)
                .flatMap(Collection::stream)
                .map(FlowDocument::from);
        enrichAndPersistFlows(documents, source);
    }


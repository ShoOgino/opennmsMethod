    @Override
    public CompletableFuture<List<TrafficSummary<Conversation>>> getTopNConversationSummaries(int N,
                                                                                              boolean includeOther,
                                                                                              List<Filter> filters) {
        if (aggFlowRepository.shouldUseAggregatedDocuments(filters)) {
            return aggFlowRepository.getTopNConversationSummaries(N, includeOther, filters);
        }
        return getTotalBytesFromTopN(N, "netflow.convo_key", null, includeOther, filters)
                .thenCompose((summaries) -> transpose(summaries.stream()
                                                               .map(summary -> this.resolveHostnameForConversation(summary.getEntity(), filters)
                                                                                   .thenApply(conversation -> TrafficSummary.from(conversation)
                                                                                           .withBytesFrom(summary)
                                                                                           .build()))
                                                               .collect(Collectors.toList()),
                                                      Collectors.toList()));
    }


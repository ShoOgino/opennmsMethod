    public void checkConstraints() throws Exception {
        List<Constraint> constraints = getForeignKeyConstraints();

        m_out.print("- checking for rows that violate constraints... ");

        Statement st = m_dbconnection.createStatement();
        for (Constraint constraint : constraints) {
            String name = constraint.getName();
            String table = constraint.getTable();
            String column = constraint.getColumns().get(0);
            String ftable = constraint.getForeignTable();
            String fcolumn = constraint.getForeignColumns().get(0);

            if (!tableExists(table) || !tableColumnExists(table, column)) {
                // The constrained table or column does not exist
                continue;
            }

            if (table.equals("usersNotified") && column.equals("id")) {
                // m_out.print("Skipping usersNotified.id");
                continue;
            }

            String query = "SELECT count("
                    + table
                    + "."
                    + column
                    + ") FROM "
                    + table
                    + " "
                    + getForeignConstraintWhere(table, column, ftable,
                                                fcolumn);

            ResultSet rs = st.executeQuery(query);

            rs.next();
            int count = rs.getInt(1);
            rs.close();

            if (count != 0) {
                rs = st.executeQuery("SELECT count(*) FROM " + table);
                rs.next();
                int total = rs.getInt(1);
                rs.close();
                st.close();

                throw new Exception("Table " + table + " contains " + count
                        + " rows " + "(out of " + total
                        + ") that violate new constraint " + name + ".  "
                        + "See the install guide for details "
                        + "on how to correct this problem.");
            }
        }
        st.close();

        m_out.println("NONE");
    }


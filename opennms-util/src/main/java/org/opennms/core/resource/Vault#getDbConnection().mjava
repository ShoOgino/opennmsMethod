    /**
     * Retrieve a database connection from the database connection factory.
     * Depending on the implementation of the delegate
     * {@link DbConnectionFactory DbConnectionFactory}, this method may wait
     * until a connection is available.
     * 
     * @return A database connection.
     * @throws SQLException
     *             If a SQL error occurs while requesting or allocating the
     *             connection. This depends on the implementation of
     *             {@link DbConnectionFactory DbConnectionFactory}being used.
     * @throws IllegalStateException
     *             If no {@link DbConnectionFactory DbConnectionFactory} has
     *             been specified.
     */
    public static Connection getDbConnection() throws SQLException {
        if (dbConnectionFactory == null) {
            throw new IllegalStateException("You must set a DbConnectionFactory before requesting a database connection.");
        }

        return dbConnectionFactory.getConnection();
    }


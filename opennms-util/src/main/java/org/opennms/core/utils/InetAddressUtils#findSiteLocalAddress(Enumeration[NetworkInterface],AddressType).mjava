    private static InetAddress findSiteLocalAddress(Enumeration<NetworkInterface> ifaces, AddressType type) {
        for (NetworkInterface iface : Collections.list(ifaces)) {
            for (InetAddress address : Collections.list(iface.getInetAddresses())) {
                LogUtils.errorf(InetAddressUtils.class, "findSiteLocalAddress: Address: " + address + ", site local?: " + address.isSiteLocalAddress());
                if (address.isSiteLocalAddress()) {
                    if (AddressType.IPv4.equals(type) && address instanceof Inet4Address) {
                        LogUtils.errorf(InetAddressUtils.class, "findSiteLocalAddress: Returning IPv4: " + address);
                        return address;
                    } else if (AddressType.IPv6.equals(type) && address instanceof Inet6Address) {
                        LogUtils.errorf(InetAddressUtils.class, "findSiteLocalAddress: Returning IPv6: " + address);
                        return address;
                    }
                }
            }
            // Recursively search for a suitable child interface
            Enumeration<NetworkInterface> children = iface.getSubInterfaces();
            InetAddress child = findSiteLocalAddress(children, type);
            if (child != null) return child;
        }
        LogUtils.errorf(InetAddressUtils.class, "findSiteLocalAddress: Returning null");
        return null;
    }


    private static InetAddress findLinkLocalAddress(Enumeration<NetworkInterface> ifaces, AddressType type, int scope) {
        for (NetworkInterface iface : Collections.list(ifaces)) {
            for (InetAddress address : Collections.list(iface.getInetAddresses())) {
                LogUtils.errorf(InetAddressUtils.class, "findLinkLocalAddress: Address: " + address + ", link local?: " + address.isLinkLocalAddress());
                if (address.isLinkLocalAddress()) {
                    if (AddressType.IPv4.equals(type) && address instanceof Inet4Address) {
                        LogUtils.errorf(InetAddressUtils.class, "findLinkLocalAddress: Returning IPv4: " + address);
                        return address;
                    } else if (AddressType.IPv6.equals(type) && address instanceof Inet6Address && ((Inet6Address)address).getScopeId() == scope) {
                        LogUtils.errorf(InetAddressUtils.class, "findLinkLocalAddress: Returning IPv6: " + address);
                        return address;
                    }
                }
            }
            // Recursively search for a suitable child interface
            Enumeration<NetworkInterface> children = iface.getSubInterfaces();
            InetAddress child = findLinkLocalAddress(children, type, scope);
            if (child != null) return child;
        }
        LogUtils.errorf(InetAddressUtils.class, "findLinkLocalAddress: Returning null");
        return null;
    }


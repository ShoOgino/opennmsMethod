    public synchronized void expire(final long ageInMilliseconds) {
        final long now = System.currentTimeMillis();

        /**
         * logout and remove outdated idle connections
         */
        this.unlocked.removeIf(e -> {
            if (!this.accessTimestamp.containsKey(e) || now - this.accessTimestamp.get(e) > ageInMilliseconds) {
                // try to logout
                if (e.getServerConnection() != null) {
                    e.getServerConnection().logout();
                }

                return true;
            } else {
                return !this.serviceInstancePool.validate(e);
            }
        });

        /**
         * remove invalid locked connections
         */
        this.locked.removeIf(e -> {
            if (!this.accessTimestamp.containsKey(e) || now - this.accessTimestamp.get(e) > ageInMilliseconds) {
                return !this.serviceInstancePool.validate(e);
            } else {
                return false;
            }
        });

        this.accessTimestamp.entrySet().removeIf(e -> !this.locked.contains(e.getKey()) && !this.unlocked.contains(e.getKey()));
    }


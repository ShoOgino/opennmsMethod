	private InetAddress getIpForNode(final OnmsNode node) {
		LogUtils.debugf(this, "getIpForNode: node: %s Foreign Source: %s", node.getNodeId(), node.getForeignSource());
		final OnmsIpInterface primaryInterface = node.getPrimaryInterface();
		InetAddress ipaddr = null;
		try { 
			ipaddr = InetAddress.getLocalHost();
		} catch (final UnknownHostException e) {
			// Can this even happen?
			log().error("Could not fetch localhost address", e);
		}
		if (primaryInterface == null) {
			log().debug("getIpForNode: found null Snmp Primary Interface, getting interfaces");
			final Set<OnmsIpInterface> ipInterfaces = node.getIpInterfaces();
			for (final OnmsIpInterface onmsIpInterface : ipInterfaces) {
				log().debug("getIpForNode: trying Interface with id: " + onmsIpInterface.getId());
				if (onmsIpInterface.getIpAddressAsString() != null) 
					ipaddr = onmsIpInterface.getIpAddress();
				else 
					log().debug("getIpForNode: found null ip address on Interface with id: " + onmsIpInterface.getId());

			}
		} else {        
			log().debug("getIpForNode: found Snmp Primary Interface");
			if (primaryInterface.getIpAddressAsString() != null )
				ipaddr = primaryInterface.getIpAddress();
			else 
				log().debug("getIpForNode: found null ip address on Primary Interface");
		}
		return ipaddr;
	}


    /**
     * Test discover SNMP entities.
     *
     * @throws Exception the exception
     */
    @Test
    @Transactional
    public void testDiscoverSnmpEntities() throws Exception {
        m_adapter.processPendingOperationForNode(m_operation);

        OnmsHwEntity root = m_entityDao.findRootByNodeId(m_nodeId);
        Assert.assertNotNull(root);
        Assert.assertTrue(root.isRoot());
        FileWriter w = new FileWriter("target/" + m_nodeId + ".xml");
        JaxbUtils.marshal(root, w);
        w.close();

        m_nodeDao.flush();
        m_entityDao.flush();

        Assert.assertEquals(61, m_entityDao.countAll());
    }


    /**
     * Reparent an interface. This effectively means updating the nodelist of
     * the categories and the map
     * 
     * Use the ip/oldnodeid combination to get all nodes that will be affected -
     * for each of these nodes, remove the old entry and add a new one with new
     * keys to the map
     * 
     * <em>Note:</em> Each of these nodes could belong to more than one
     * category. However, category rule evaluation is done based ONLY on the IP -
     * therefore changing the nodeID on the node should update the categories
     * appropriately
     * 
     * @param ip
     *            the interface to reparent
     * @param oldNodeId
     *            the node that the ip belonged to earlier
     * @param newNodeId
     *            the node that the ip now belongs to
     */
    public synchronized void interfaceReparented(String ip, long oldNodeId, long newNodeId) {
        // get all RTCNodes with the ip/oldNodeId
    	List nodesList = m_map.getRTCNodes(oldNodeId, ip);
        if (nodesList == null) {
            // nothing to do - simply means ip does not belong
            // to any of the categories
            return;
        }

        // iterate through this list - make a copy as we modify it as we iterate
        ListIterator listIter = new LinkedList(nodesList).listIterator();
        while (listIter.hasNext()) {
            RTCNode rtcN = (RTCNode) listIter.next();

            // remove the node with the oldnode id from the map
            m_map.delete(rtcN);

            // change the nodeid on the RTCNode
            rtcN.setNodeID(newNodeId);

            // now add the node with the new nodeid
            m_map.add(rtcN);

            // remove old nodeid from the categories it belonged to
            // and the new nodeid
            Iterator catIter = rtcN.getCategories().listIterator();
            while (catIter.hasNext()) {
                String catlabel = (String) catIter.next();

                RTCCategory rtcCat = (RTCCategory) m_categories.get(catlabel);
                rtcCat.deleteNode(oldNodeId);
                rtcCat.addNode(newNodeId);
            }

        }
    }


	/**
	 * The execution context.
	 */
	public void run()
	{
		// get the context
		//
		m_context = Thread.currentThread();

		// Get a log instance
		//
		ThreadCategory.setPrefix(m_logPrefix);
		Category log = ThreadCategory.getInstance(getClass());
		boolean isTracing = log.isDebugEnabled();

		if(m_stop)
		{
			if(isTracing)
				log.debug( "Stop flag set before thread started, exiting");
			return;
		}
		else if(isTracing)
			log.debug( "Thread context started");

		// allocate a buffer
		//
		final int length = 0xffff;
		final byte[] buffer = new byte[length];
		DatagramPacket pkt = new DatagramPacket(buffer, length);

		// set an SO timout to make sure we don't block forever
		// if a socket is closed.
		//
		try
		{
			if(isTracing)
				log.debug( "Setting socket timeout to 500ms");

			m_dgSock.setSoTimeout(500);
		}
		catch(SocketException e)
		{
			log.warn("An I/O error occured while trying to set the socket timeout", e);
		}

		// Increase the receive buffer for the 
		// socket
		//
		try
		{
			if(isTracing)
				log.debug( "Setting receive buffer size to " + length);

			m_dgSock.setReceiveBufferSize(length);
		}
		catch(SocketException e)
		{
			log.info("Failed to set the receive buffer to " + length, e);
		}

		// set to avoid numerious tracing message
		// 
		boolean ioInterrupted = false;

		// now start processing incomming request
		//
		while(!m_stop)
		{
			if(m_context.isInterrupted())
			{
				if(isTracing)
					log.debug( "Thread context interrupted");

				break;
			}

			try
			{
				if(isTracing && !ioInterrupted)
					log.debug( "Wating on a datagram to arrive");

				m_dgSock.receive(pkt);
				ioInterrupted = false; // reset the flag
			}
			catch(InterruptedIOException e)
			{
				ioInterrupted = true;
				continue;
			}
			catch(IOException e)
			{
				log.error("An I/O exception occured on the datagram receipt port, exiting",e);
				break;
			}

			try
			{
				if(isTracing)
					log.debug( "Sending received packet to processor");

				UdpReceivedEvent re = UdpReceivedEvent.make(pkt);
				synchronized(m_eventsIn)
				{
					m_eventsIn.add(re);
					m_eventsIn.notify();
				}
			}
			catch(UnsupportedEncodingException e)
			{
				log.warn("Failed to convert received XML event, discarding", e);
			}

			pkt = new DatagramPacket(buffer, length);

		} // end while status ok

		if(isTracing)
			log.debug( "Thread context exiting");

	} // end run method


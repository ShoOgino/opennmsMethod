	/**
	 * This method is responsible for reparenting an interface's database
	 * table entries under its new node identifier.  The following tables
	 * are updated:
	 *
	 * 	ipInterface
	 *  	snmpInterface
	 * 	ifServices
	 *
	 * @param dbc		Database connection
	 * @param ifAddr	Interface to be reparented.
	 * @param newNodeId	Interface's new node identifier
	 * @param oldNodeId	Interfaces' old node identifier
	 * 
	 * @throws SQLException if a database error occurs during reparenting. 
	 */
	private void reparentInterface(Connection  dbc,
				InetAddress 	ifAddr,
				int             ifIndex,
				int 		newNodeId,
				int		oldNodeId)
		throws SQLException
	{
		Category log = ThreadCategory.getInstance(getClass());
		
		// Reparent the interface
		//
		PreparedStatement ipInterfaceStmt = dbc.prepareStatement(SQL_DB_REPARENT_IP_INTERFACE);
		PreparedStatement snmpIfLookupStmt = dbc.prepareStatement(SQL_DB_REPARENT_SNMP_IF_LOOKUP);
		PreparedStatement snmpIfDeleteStmt = dbc.prepareStatement(SQL_DB_REPARENT_SNMP_IF_DELETE);
		PreparedStatement snmpInterfaceStmt = dbc.prepareStatement(SQL_DB_REPARENT_SNMP_INTERFACE);
		PreparedStatement ifServicesStmt = dbc.prepareStatement(SQL_DB_REPARENT_IF_SERVICES);
		
		try
		{
			log.debug("reparentInterfaces: reparenting address/ifIndex/nodeID: " + ifAddr.getHostAddress() + "/" + ifIndex + "/" + newNodeId);
			
			// Update the 'ipInterface' table entry so that this
			// interface's nodeID is set to the value of reparentNodeID
			ipInterfaceStmt.setInt(1, newNodeId);
			ipInterfaceStmt.setInt(2, oldNodeId);
			ipInterfaceStmt.setString(3, ifAddr.getHostAddress());
					
			// execute and log
			ipInterfaceStmt.executeUpdate();
			
			// SNMP interface
			//
			// NOTE:  Only reparent SNMP interfaces if we have valid ifIndex
			if (ifIndex < 1)
			{
				log.debug("reparentInterfaces: don't have a valid ifIndex, skipping snmpInterface table reparenting.");
			}
			else
			{
				// NOTE:  Now that the snmpInterface table is uniquely keyed
				//        by nodeId and ifIndex we must only reparent the
				//        old entry if there isn't already an entry with 
				//        the same nodeid/ifindex pairing.  If it can't
				//        be reparented it will be deleted.
				
				// Look for matching nodeid/ifindex for the entry to be reparented
				boolean alreadyExists = false;
				snmpIfLookupStmt.setInt(1, newNodeId);
				snmpIfLookupStmt.setInt(2, ifIndex);
				ResultSet rs = snmpIfLookupStmt.executeQuery();
				if (rs.next())
				{
					// Looks like we got a match so just delete
					// the entry from the old node
					log.debug("interface with ifindex " + ifIndex + " already exists under new node " + newNodeId + ", deleting from under old node " + oldNodeId);
					alreadyExists = true;
					
					snmpIfDeleteStmt.setInt(1, oldNodeId);
					snmpIfDeleteStmt.setInt(2, ifIndex);
					
					snmpIfDeleteStmt.executeUpdate();
				}
				
				if (alreadyExists == false)
				{
					// Update the 'snmpinterface' table entry so that this
					// interface's nodeID is set to the value of reparentNodeID
					//
					log.debug("interface with ifindex " + ifIndex + " does not yet exist under new node " + newNodeId + ", reparenting.");
					
					snmpInterfaceStmt.setInt(1, newNodeId);
					snmpInterfaceStmt.setInt(2, oldNodeId);
					snmpInterfaceStmt.setInt(3, ifIndex);
							
					// execute and log
					snmpInterfaceStmt.executeUpdate();
				}
			}
			
			// Update the 'nodeID' field of all 'ifservices' table entries for 
			// the reparented interfaces.
			ifServicesStmt.setInt(1, newNodeId);
			ifServicesStmt.setInt(2, oldNodeId);
			ifServicesStmt.setString(3, ifAddr.getHostAddress());
					
			// execute and log
			ifServicesStmt.executeUpdate();
					
			log.debug("reparentInterface: reparented " + ifAddr.getHostAddress() + 
						" : ifIndex: " + ifIndex +
						" : oldNodeID: " + oldNodeId + 
						" newNodeID: " + newNodeId);
		}	
		catch(SQLException sqlE)
		{
			log.error("SQLException while reparenting addr/ifindex/nodeid " + ifAddr.getHostAddress() + "/" + ifIndex + "/" + oldNodeId);
			throw sqlE;
		}
		finally
		{
			ipInterfaceStmt.close();
			snmpIfLookupStmt.close();
			snmpIfDeleteStmt.close(); 
			snmpInterfaceStmt.close();
			ifServicesStmt.close();
		}
	}


    private void processAction(Automation auto) throws SQLException {

        if (log().isDebugEnabled())
            log().debug("runAutomation: running action(s): "+auto.getActionName());

        getConn().setAutoCommit(false);
        if (isTriggerInAutomation()) {
            getTriggerResultSet().beforeFirst();
            
            //Loop through the select results
            while (getTriggerResultSet().next()) {                        
                processActionStatement(getAutomationSQL(auto), getTriggerResultSet());            
                sendAutoEvent(auto);
            }
            setActionSuccessful(true);
        } else {
            //No trigger defined, just running the action.
            if (getTokenCount(getAutomationSQL(auto)) != 0) {
                log().info("runAutomation: not running action: "+auto.getActionName()+".  Action contains tokens in an automation ("+auto.getName()+") with no trigger.");
                setActionSuccessful(false);
            } else {
                processActionStatement(getAutomationSQL(auto), getTriggerResultSet());
                sendAutoEvent(auto);
                setActionSuccessful(true);
            }
        }
        getConn().commit();
    }


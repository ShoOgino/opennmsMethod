	public void doTestTrap(int version, boolean newSuspectOnTrap) throws UnknownHostException, InterruptedException {
		setUpTrapHandler(newSuspectOnTrap);
		
		Event snmpEvent = new Event();
		snmpEvent.setInterface("127.0.0.1");
		snmpEvent.setNodeid(0);
		snmpEvent.setUei("uei.opennms.org/default/event");
		System.out.println("Anticipating: " + new EventWrapper(snmpEvent));
		m_anticipator.anticipateEvent(snmpEvent);
		
		if (newSuspectOnTrap) {
			Event newSuspectEvent = new Event();
			newSuspectEvent.setInterface("127.0.0.1");
			newSuspectEvent.setNodeid(0);
			newSuspectEvent.setUei("uei.opennms.org/internal/discovery/newSuspect");
			System.out.println("Anticipating: " + new EventWrapper(newSuspectEvent));
			m_anticipator.anticipateEvent(newSuspectEvent);
		}
		
		if (version == 1) {
			SnmpPduTrap pdu = new SnmpPduTrap();
			pdu.setGeneric(6);
			pdu.setSpecific(1);
			pdu.setAgentAddress(new SnmpIPAddress(InetAddress.getByName("127.0.0.1")));
			m_trapHandler.snmpReceivedTrap(null, InetAddress.getByName("127.0.0.1"), 10000,
					new SnmpOctetString("public".getBytes()), pdu);
		} else if (version == 2) {
			SnmpPduRequest pdu = new SnmpPduRequest(SnmpPduPacket.V2TRAP);
//			pdu.setGeneric(6);
//			pdu.setSpecific(1);
			m_trapHandler.snmpReceivedTrap(null, InetAddress.getByName("127.0.0.1"), 10000,
					new SnmpOctetString("public".getBytes()), pdu);
		} else {
			throw new UndeclaredThrowableException(null, "unsupported SNMP version for test: " + version); 
		}
		
		Thread.sleep(1000);
	}


	public void doTestTrap(String version, boolean newSuspectOnTrap) throws UnknownHostException, InterruptedException {
		setUpTrapHandler(newSuspectOnTrap);

		Event snmpEvent = new Event();
		snmpEvent.setInterface("127.0.0.1");
		snmpEvent.setNodeid(0);
		snmpEvent.setUei("uei.opennms.org/default/trap");
		System.out.println("Anticipating: " + new EventWrapper(snmpEvent));
		m_anticipator.anticipateEvent(snmpEvent);
		
		if (version.equals("v1")) {
			SnmpPduTrap pdu = new SnmpPduTrap();
			pdu.setGeneric(6);
			pdu.setSpecific(1);
			pdu.setAgentAddress(new SnmpIPAddress(InetAddress.getByName("127.0.0.1")));
			m_trapHandler.snmpReceivedTrap(null, InetAddress.getByName("127.0.0.1"), 10000,
					new SnmpOctetString("public".getBytes()), pdu);
		} else if (version.equals("v2c")) {
			SnmpPduRequest pdu = new SnmpPduRequest(SnmpPduPacket.V2TRAP);
//			pdu.setGeneric(6);
//			pdu.setSpecific(1);
			m_trapHandler.snmpReceivedTrap(null, InetAddress.getByName("127.0.0.1"), 10000,
					new SnmpOctetString("public".getBytes()), pdu);
		} else {
			throw new UndeclaredThrowableException(null, "unsupported SNMP version for test: " + version); 
		}
		
		finishUp();
	}


    protected void setUp() throws Exception {
        super.setUp();
        MockLogAppender.setupLogging();
        MockDatabase db = new MockDatabase();
        DatabaseConnectionFactory.setInstance(db);
        
        Properties properties = new Properties();
        RrdConfig.setProperties(properties);

        m_strategy = mock(RrdStrategy.class);
        RrdUtils.setStrategy((RrdStrategy)m_strategy.proxy());
        
        m_provisioner = new OpenNMSProvisioner();
        
        m_capsdConfig = new TestCapsdConfigManager(CAPSD_CONFIG);
        m_capsdConfig.setNextSvcIdSql(db.getNextServiceIdStatement());
        CapsdConfigFactory.setInstance(m_capsdConfig);
        
        Connection conn = db.getConnection();
        try {
            m_capsdConfig.syncServices(conn);
        } finally {
            conn.close();
        }
        
        m_pollerConfig = new TestPollerConfigManager(POLLER_CONFIG, "localhost", false);
        PollerConfigFactory.setInstance(m_pollerConfig);
        
        m_provisioner.setCapsdConfig(m_capsdConfig);
        m_provisioner.setPollerConfig(m_pollerConfig);

    }


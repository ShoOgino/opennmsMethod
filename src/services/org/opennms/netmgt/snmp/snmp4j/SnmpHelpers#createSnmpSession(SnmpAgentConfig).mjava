    public static Snmp createSnmpSession(SnmpAgentConfig agentConfig) throws IOException {
        if (!agentConfig.isAdapted()) {
            throw new IllegalArgumentException("Error creating SNMP session... agentConfig has not been adapted to SNMP4J.");
        }
        
        Snmp session = createSnmpSession();
        if (agentConfig.getVersion() == SnmpConstants.version3) {
            session.getUSM().addUser((Snmp4JStrategy.createOctetString(agentConfig.getSecurityName())),
                    new UsmUser(Snmp4JStrategy.createOctetString(agentConfig.getSecurityName()),
                            Snmp4JStrategy.convertAuthProtocol(agentConfig.getAuthProtocol()),
                            Snmp4JStrategy.createOctetString(agentConfig.getAuthPassPhrase()),
                            Snmp4JStrategy.convertPrivProtocol(agentConfig.getPrivProtocol()),
                            Snmp4JStrategy.createOctetString(agentConfig.getPrivPassPhrase())));

        }
        return session;
    }


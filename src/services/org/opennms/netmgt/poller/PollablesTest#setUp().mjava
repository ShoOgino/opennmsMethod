    /*
     * @see TestCase#setUp()
     */
    protected void setUp() throws Exception {
        super.setUp();
        
        m_pollContext = new MockPollContext();
        m_pollContext.setCriticalServiceName("ICMP");
        m_pollContext.setNodeProcessingEnabled(true);
        m_pollContext.setPollingAllIfCritServiceUndefined(true);

        
        m_mockNetwork = new MockNetwork();
        m_mockNetwork.addNode(1, "Router");
        m_mockNetwork.addInterface("192.168.1.1");
        m_mockNetwork.addService("ICMP");
        m_mockNetwork.addService("SMTP");
        m_mockNetwork.addInterface("192.168.1.2");
        m_mockNetwork.addService("ICMP");
        m_mockNetwork.addService("SMTP");
        m_mockNetwork.addNode(2, "Server");
        m_mockNetwork.addInterface("192.168.1.3");
        m_mockNetwork.addService("ICMP");
        m_mockNetwork.addService("HTTP");
        m_mockNetwork.addNode(3, "Firewall");
        m_mockNetwork.addInterface("192.168.1.4");
        m_mockNetwork.addService("SMTP");
        m_mockNetwork.addService("HTTP");
        m_mockNetwork.addInterface("192.168.1.5");
        m_mockNetwork.addService("SMTP");
        m_mockNetwork.addService("HTTP");

        m_db = new MockDatabase();
        m_db.populate(m_mockNetwork);
        
        m_anticipator = new EventAnticipator();
        
        m_eventMgr = new MockEventIpcManager();
        m_eventMgr.setEventWriter(m_db);
        m_eventMgr.setEventAnticipator(m_anticipator);
        
        m_pollContext.sentEventMgr(m_eventMgr);

        m_network = new PollableNetwork(m_pollContext);
        m_network.createService(1, InetAddress.getByName("192.168.1.1"), "ICMP");
        m_network.createService(1, InetAddress.getByName("192.168.1.1"), "SMTP");
        m_network.createService(1, InetAddress.getByName("192.168.1.2"), "ICMP");
        m_network.createService(1, InetAddress.getByName("192.168.1.2"), "SMTP");
        m_network.createService(2, InetAddress.getByName("192.168.1.3"), "ICMP");
        m_network.createService(2, InetAddress.getByName("192.168.1.3"), "HTTP");
        m_network.createService(3, InetAddress.getByName("192.168.1.4"), "SMTP");
        m_network.createService(3, InetAddress.getByName("192.168.1.4"), "HTTP");
        m_network.createService(3, InetAddress.getByName("192.168.1.5"), "SMTP");
        m_network.createService(3, InetAddress.getByName("192.168.1.5"), "HTTP");
        
        PollableVisitor upper = new PollableVisitorAdaptor() {
            public void visitElement(PollableElement e) {
                e.updateStatus(PollStatus.STATUS_UP);  
            }
            public void visitService(PollableService svc) {
                MockPollConfig pollConfig = new MockPollConfig(m_mockNetwork, svc.getSvcName());
                svc.setPollConfig(pollConfig);
            }
        };
        m_network.visit(upper);
        m_network.resetStatusChanged();
        
        mNode1 = m_mockNetwork.getNode(1);
        mDot1 = mNode1.getInterface("192.168.1.1");
        mDot1Smtp = mDot1.getService("SMTP");
        mDot1Icmp = mDot1.getService("ICMP");
        mDot2 = mNode1.getInterface("192.168.1.2");
        mDot2Smtp = mDot2.getService("SMTP");
        mDot2Icmp = mDot2.getService("ICMP");
        
        mNode2 = m_mockNetwork.getNode(2);
        mDot3 = mNode2.getInterface("192.168.1.3");
        mDot3Http = mDot3.getService("HTTP");
        mDot3Icmp = mDot3.getService("ICMP");
        
        pNode1 = m_network.getNode(1);
        pDot1 = pNode1.getInterface(InetAddress.getByName("192.168.1.1"));
        pDot1Smtp = pDot1.getService("SMTP");
        pDot1Icmp = pDot1.getService("ICMP");
        pDot2 = pNode1.getInterface(InetAddress.getByName("192.168.1.2"));
        pDot2Smtp = pDot2.getService("SMTP");
        pDot2Icmp = pDot2.getService("ICMP");
        
        pNode2 = m_network.getNode(2);
        pDot3 = pNode2.getInterface(InetAddress.getByName("192.168.1.3"));
        pDot3Http = pDot3.getService("HTTP");
        pDot3Icmp = pDot3.getService("ICMP");
        
    }


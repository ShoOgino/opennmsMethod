    public void withTreeLock(Runnable r) {
        Category log = ThreadCategory.getInstance(getClass());
        Object lock = getTreeLock();
        log.debug("Trying to obtain lock "+lock);
        synchronized (lock) {
            log.debug("Obtained lock "+lock);
            r.run();
            log.debug("Releasing lock "+lock);
        }
    }


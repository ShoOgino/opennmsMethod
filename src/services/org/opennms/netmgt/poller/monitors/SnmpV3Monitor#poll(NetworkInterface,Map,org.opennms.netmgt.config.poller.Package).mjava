    public int poll(NetworkInterface iface, Map parameters, org.opennms.netmgt.config.poller.Package pkg) {
        // Log4j category
        //
        Category log = ThreadCategory.getInstance(getClass());

        int status = SERVICE_UNAVAILABLE;
        InetAddress inetAddress = (InetAddress) iface.getAddress();

        // Retrieve this interface's SNMP peer object
        //
        Target target = (Target)iface.getAttribute(SNMPV3_TARGET_KEY);
        
        if (target == null)
            throw new RuntimeException("Target object not available for interface " + inetAddress);

        String oid = ParameterMap.getKeyedString(parameters, "oid", DEFAULT_OID);
        String operator = ParameterMap.getKeyedString(parameters, "operator", null);
        String operand = ParameterMap.getKeyedString(parameters, "operand", null);

        //Need this for logging only
        TransportIpAddress address = (TransportIpAddress)target.getAddress();
        
        if (log.isDebugEnabled())
            log.debug("poll: service= SNMP address= " + inetAddress.getHostAddress() + " port= " + address.getPort() + " oid=" + oid + " timeout= " + target.getTimeout() + " retries= " + target.getRetries() + " operator = " + operator + " operand = " + operand);

        //Now poll
        Snmp snmp = null;
        try {
            snmp = SnmpHelpers.createSnmpSession();
            snmp.listen();
            PDU request = SnmpHelpers.createPDU(target.getVersion());
            VariableBinding vb = new VariableBinding(new OID(DEFAULT_OID));
            request.add(vb);
            
            PDU response = null;
            ResponseEvent responseEvent = snmp.send(request, target);
            snmp.close();

            Vector vbs = responseEvent.getResponse().getVariableBindings();
            VariableBinding firstVB = (VariableBinding)vbs.firstElement();
            status = SERVICE_UNAVAILABLE;
            if (responseEvent.getResponse() != null) {
                if (responseEvent.getResponse().getErrorStatus() != 0) {
                    log.error("SnmpV3Monitor: PDU reponse errorStatus > 0.  The errorStatus is: "+responseEvent.getResponse().getErrorStatus());
                    status = SERVICE_UNAVAILABLE;
                } else {
                    status = SERVICE_AVAILABLE;

                    //got a valid SNMPv3 response from the agent, but the response may contain
                    //v3 error codes in the first varbind
                    if (vbs != null && vbs.size() >0) {
                        
                        //this comparison is very v3 protocol specific.  This left most compare
                        //efficiently matches most all errors found in the first varbind.
                        if (USM_STATS.leftMostCompare(USM_STATS.size(), firstVB.getOid()) == 0 || 
                                SNMP_MPD_STATS.leftMostCompare(SNMP_MPD_STATS.size(), firstVB.getOid()) ==0 ) {
                            status = SERVICE_UNAVAILABLE;
                            log.error("SnmpV3Monitor: responseError: " +firstVB.getOid());
                        }
                    }
                }
            }
            
            String hostAddress = inetAddress.getHostAddress();
            Variable var = firstVB.getVariable();

            if (status == SERVICE_AVAILABLE) {
                log.debug("poll: SNMP poll succeeded, addr=" + hostAddress + " oid=" + oid + " value=" + responseEvent.getResponse().toString());
                try {
                    status = (meetsCriteria(var, operator, operand) ? ServiceMonitor.SERVICE_AVAILABLE : ServiceMonitor.SERVICE_UNAVAILABLE);
                } catch (NumberFormatException e) {
                    log.warn("Number operator used on a non-number " + e.getMessage());
                    status = ServiceMonitor.SERVICE_AVAILABLE;
                } catch (IllegalArgumentException e) {
                    log.warn("Invalid Snmp Criteria: " + e.getMessage());
                    status = ServiceMonitor.SERVICE_UNAVAILABLE;
                }
            } else {
                log.debug("poll: SNMPv3Monitor poll failed, addr=" + hostAddress + " oid=" + oid);
                status = ServiceMonitor.SERVICE_UNAVAILABLE;
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }

        return status;
    }


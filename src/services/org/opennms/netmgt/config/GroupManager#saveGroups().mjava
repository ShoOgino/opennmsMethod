    /**
     */
    public synchronized void saveGroups() throws Exception {
        Header header = m_oldHeader;
    
        header.setCreated(EventConstants.formatToString(new Date()));
    
        Groups groups = new Groups();
        Collection collgroups = (Collection) m_groups.values();
        Iterator iter = collgroups.iterator();
        while (iter != null && iter.hasNext()) {
            Group grp = (Group) iter.next();
            groups.addGroup(grp);
        }
        
        Roles roles = new Roles();
        Iterator it = m_roles.values().iterator();
        while(it.hasNext()) {
            Role role = (Role)it.next();
            roles.addRole(role);
        }
    
        Groupinfo groupinfo = new Groupinfo();
        groupinfo.setGroups(groups);
        groupinfo.setRoles(roles);
        groupinfo.setHeader(header);
    
        m_oldHeader = header;
    
        // marshall to a string first, then write the string to the file. This
        // way the original config
        // isn't lost if the xml from the marshall is hosed.
        StringWriter stringWriter = new StringWriter();
        Marshaller.marshal(groupinfo, stringWriter);
        String data = stringWriter.toString();
        saveXml(data);
    }


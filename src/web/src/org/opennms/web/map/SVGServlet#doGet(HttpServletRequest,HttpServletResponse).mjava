    public void doGet(HttpServletRequest request, HttpServletResponse response) 
	throws ServletException {

	// the docbase to which all our elements will be relative
	String base = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort() + request.getContextPath() + "/";

	response.setContentType("image/svg+xml");

	try {
	    // create the object that will make our SVG for us
	    // DocumentGenerator docgen = new DocumentGenerator();
	    // we should find this in our HttpSession object
	    DocumentGenerator docgen = (DocumentGenerator)request.getSession().getAttribute("docgen");

	    // pass the servlet context so the DocumentGenerator can find its icons
	    // these should be set from the jsp page now
	    // ServletContext ctx = getServletContext();
	    // docgen.setServletContext(ctx);
	    // docgen.setNodes(nodes);
	    // docgen.setUrlBase(base); 

	    // generate and retrieve the SVG DOM we're generating
	    Document doc = docgen.getHostDocument(false);

	    // get the PrintWriter we'll use to output the SVG
	    PrintWriter docwriter = response.getWriter();

	    // send the SVG to the other end
	    DOMUtilities.writeDocument(doc, docwriter);

	    // flush and close
	    docwriter.flush();
	    docwriter.close();
	}
	catch(IOException e) {
	    log("IOException in SVGServlet");
	    log(e.toString());
	}
	catch(Exception e) {
	    log("Exception in SVGServlet");
	    log(e.toString());
	}

    }


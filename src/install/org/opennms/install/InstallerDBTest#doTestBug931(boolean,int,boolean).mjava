	public void doTestBug931(boolean dropForeignTable, int badRows,
			boolean fixConstraint) throws Exception {
		final String errorSubstring = "Table events contains " + badRows
				+ " rows (out of 2) that violate new constraint "
				+ s_constraint;

		setupBug931((badRows != 0) || fixConstraint, dropForeignTable);

		if (fixConstraint) {
			m_installer.fixConstraint();
		}

		try {
			m_installer.checkConstraints();
		} catch (Exception e) {
			if (badRows == 0) {
				fail("Received an unexpected exception: " + e.toString());
			} else {
				if (e.getMessage().indexOf(errorSubstring) >= 0) {
					// Received expected error, so the test is successful.
					return;
				} else {
					fail("Expected an exception matching \""
							+ errorSubstring
							+ "\", but instead received an unexpected Exception: "
							+ e.toString());
				}
			}
		}

		if (badRows != 0) {
			fail("Did not receive expected exception: " + errorSubstring);
		}
	}


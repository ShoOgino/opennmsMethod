    public void updateServerXml() throws Exception {
	File f = new File(m_server_xml);

	m_out.print("- checking Tomcat 4 for OpenNMS web UI... ");

	BufferedReader r = new BufferedReader(new FileReader(f));
	StringBuffer b = new StringBuffer();
	String line;

	while ((line = r.readLine()) != null) {
	    b.append(line);
	    b.append("\n");
	}

	r.close();

	String server_in = b.toString();

	// XXX Can the next two patterns be made more specific?
	Matcher m = Pattern.compile("(?si)opennms").matcher(server_in);
	if (m.find()) {
	    m = Pattern.compile("(?s)homeDir").matcher(server_in);
	    if (m.find()) {
		m_out.println("FOUND");
	    } else {
		m_out.println("UPDATING");
		server_in = server_in.replaceAll("(?s)userFile\\s*=\\s*\".*?\"\\s*", "homeDir=" + m_opennms_home + "\" ");
		server_in = server_in.replaceAll("(?s)<Logger className=\"org.apache.catalina.logger.FileLogger\" prefix=\"localhost_opennms_log.\" suffix=\".txt\" timestamp=\"true\"/>", "<Logger className=\"org.opennms.web.log.Log4JLogger\" homeDir=\"" + m_opennms_home + "\" />");

		f.renameTo(new File(m_server_xml + ".before-opennms" +
				    System.currentTimeMillis()));

		f = new File(m_server_xml);
		PrintWriter w = new PrintWriter(new FileOutputStream(f));

		w.print(server_in);
		w.close();

		m_out.println("DONE");
	    }
	} else {
	    m_out.println("UPDATING");

	    String add = "\n" +
		"        <Context path=\"/opennms\" docBase=\"opennms\" debug=\"0\" reloadable=\"true\">\n" +
		"         <Logger className=\"org.opennms.web.log.Log4JLogger\" homeDir=\"" + m_opennms_home + "\"/>\n" +
		"         <Realm className=\"org.opennms.web.authenticate.OpenNMSTomcatRealm\" homeDir=\"" + m_opennms_home + "\"/>\n" +
		"        </Context>\n";
	    server_in = server_in.replaceAll("(?mi)^(.*)(</host>)",
					     add + "$1$2");

	    f.renameTo(new File(m_server_xml + ".before-opennms" +
				System.currentTimeMillis()));

	    f = new File(m_server_xml);
	    PrintWriter w = new PrintWriter(new FileOutputStream(f));

	    w.print(server_in);
	    w.close();

	    m_out.println("DONE");
	}
    }


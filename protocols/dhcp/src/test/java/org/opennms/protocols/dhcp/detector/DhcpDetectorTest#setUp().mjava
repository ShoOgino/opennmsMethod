    @Before
    public void setUp() throws Exception {
        MockLogAppender.setupLogging();

        File etc = new File("target/test-work-dir/etc");
        etc.mkdirs();
        m_onmsHome = etc.getParent();
        System.setProperty("opennms.home", m_onmsHome);
        ConfigurationTestUtils.setRelativeHomeDirectory(m_onmsHome);
        File dhcpConfig = new File(etc, "dhcpd-configuration.xml");
        FileUtils.writeStringToFile(dhcpConfig, "<DhcpdConfiguration\n" + 
                "        port=\"5818\"\n" + 
                "        macAddress=\"" + MY_MAC + "\"\n" + 
                "        myIpAddress=\"" + MY_IP + "\"\n" + 
                "        extendedMode=\"false\"\n" + 
                "        requestIpAddress=\"" + MY_IP + "\">\n" + 
                "</DhcpdConfiguration>");

        DhcpdConfigFactory.init();
        m_detector = m_detectorFactory.createDetector();
        m_dhcpd = Dhcpd.getInstance();
        m_dhcpd.init();

        if (m_extendedTests) {
            // binds on port 68, hardcoded  :P
            m_dhcpd.start();
        }
    }


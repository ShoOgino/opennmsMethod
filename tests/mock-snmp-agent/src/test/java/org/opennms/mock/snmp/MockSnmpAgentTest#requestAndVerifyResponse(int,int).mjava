    private void requestAndVerifyResponse(int pduType, int version) throws Exception {
        PDU pdu = createPDU(version);

        for(AnticipatedRequest a : m_requestedVarbinds) {
            pdu.add(a.getRequestVarbind());
        }
        pdu.setType(pduType);

        PDU response = sendRequest(pdu, version);

        assertNotNull("request timed out", response);
        System.err.println("Response is: "+response);
        assertTrue("unexpected report pdu: " + ((VariableBinding)response.getVariableBindings().get(0)).getOid(), response.getType() != PDU.REPORT);

        assertEquals("Unexpected number of varbinds returned.", m_requestedVarbinds.size(), response.getVariableBindings().size());

        for(int i = 0; i < m_requestedVarbinds.size(); i++) {
            AnticipatedRequest a = m_requestedVarbinds.get(i);
            VariableBinding vb = response.get(i);
            a.verify(vb);
        }

        reset();

    }

